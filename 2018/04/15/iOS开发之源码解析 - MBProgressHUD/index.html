<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.1.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.1.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.1.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.1.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.1.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.1.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="MBProgressHUD 是一个为 APP 添加 HUD 窗口的第三方框架，使用起来极其简单方便，关于 MBProgressHUD 的使用方法，GitHub 上有详细的说明，这里就不多加介绍了，本文主要是从源码的角度分析 MBProgressHUD的具体实现。   先来对 MBProgressHUD 有个大体的认识，这是刚从 GitHub 上拉下来的代码，如下图，MBProgressHUD 的">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS开发之源码解析 - MBProgressHUD">
<meta property="og:url" content="http://yoursite.com/2018/04/15/iOS开发之源码解析 - MBProgressHUD/index.html">
<meta property="og:site_name" content="以梦为马">
<meta property="og:description" content="MBProgressHUD 是一个为 APP 添加 HUD 窗口的第三方框架，使用起来极其简单方便，关于 MBProgressHUD 的使用方法，GitHub 上有详细的说明，这里就不多加介绍了，本文主要是从源码的角度分析 MBProgressHUD的具体实现。   先来对 MBProgressHUD 有个大体的认识，这是刚从 GitHub 上拉下来的代码，如下图，MBProgressHUD 的">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/2665449-3cbf54d2915cfc84.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/2665449-2c0e36917095f806.gif?imageMogr2/auto-orient/strip">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/2665449-33d61502f23a1cb8.gif?imageMogr2/auto-orient/strip">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/2665449-137f0865dea6bc2c.gif?imageMogr2/auto-orient/strip">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/2665449-6813068f5afe1668.gif?imageMogr2/auto-orient/strip">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/2665449-9afbf851e3b786ed.gif?imageMogr2/auto-orient/strip">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/2665449-bfa363444cff270a.gif?imageMogr2/auto-orient/strip">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/2665449-c61402fca48f7cea.gif?imageMogr2/auto-orient/strip">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/2665449-c955394ba5fe50c9.gif?imageMogr2/auto-orient/strip">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/2665449-edeee858374f6c16.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/2665449-effb289399c57e61.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/2665449-d01f3044d62ba8d6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:updated_time" content="2018-04-15T12:20:05.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iOS开发之源码解析 - MBProgressHUD">
<meta name="twitter:description" content="MBProgressHUD 是一个为 APP 添加 HUD 窗口的第三方框架，使用起来极其简单方便，关于 MBProgressHUD 的使用方法，GitHub 上有详细的说明，这里就不多加介绍了，本文主要是从源码的角度分析 MBProgressHUD的具体实现。   先来对 MBProgressHUD 有个大体的认识，这是刚从 GitHub 上拉下来的代码，如下图，MBProgressHUD 的">
<meta name="twitter:image" content="http://upload-images.jianshu.io/upload_images/2665449-3cbf54d2915cfc84.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">






  <link rel="canonical" href="http://yoursite.com/2018/04/15/iOS开发之源码解析 - MBProgressHUD/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>iOS开发之源码解析 - MBProgressHUD | 以梦为马</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">以梦为马</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">谨以此纪念岁月</p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>




<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-主页">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />主页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-归档">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/15/iOS开发之源码解析 - MBProgressHUD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="刘朋坤">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="以梦为马">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">iOS开发之源码解析 - MBProgressHUD
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
                
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-15T12:30:20+08:00">2018-04-15</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote>
<p><a href="https://github.com/jdg/MBProgressHUD" target="_blank" rel="noopener">MBProgressHUD</a> 是一个为 <code>APP</code> 添加 <code>HUD</code> 窗口的第三方框架，使用起来极其简单方便，关于 <code>MBProgressHUD</code> 的使用方法，<code>GitHub</code> 上有详细的说明，这里就不多加介绍了，本文主要是从源码的角度分析 <code>MBProgressHUD</code>的具体实现。</p>
</blockquote>
<ul>
<li>先来对 <a href="https://github.com/jdg/MBProgressHUD" target="_blank" rel="noopener">MBProgressHUD</a> 有个大体的认识，这是刚从 <code>GitHub</code> 上拉下来的代码，如下图，MBProgressHUD 的主要文件只有两个：<br><br><br></li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-3cbf54d2915cfc84.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="MBProgressHUD 源码解析"></p>
<hr>
<p>下面我们就开始分析 <a href="https://github.com/jdg/MBProgressHUD" target="_blank" rel="noopener">MBProgressHUD</a> 的具体实现。在此之前先了解下文章的目录，本文主要有三个部分：</p>
<a id="more"></a>
<ol>
<li><strong>MBProgressHUD 核心 API</strong></li>
</ol>
<ul>
<li>这一部分讲的主要是 MBProgressHUD 的一些属性方法等，主要是为了对 MBProgressHUD 先有个大概的认识</li>
</ul>
<ol start="2">
<li><strong>show 系列方法</strong></li>
</ol>
<ul>
<li>这一部分主要是展示 HUD 窗口时调用的方法及代码分析</li>
</ul>
<ol start="3">
<li><strong>hide 系列方法</strong></li>
</ol>
<ul>
<li>这一部分主要是隐藏 HUD 窗口时调用的方法及代码分析</li>
</ul>
<p><br><br></p>
<p><strong>begin~~~</strong></p>
<h2 id="一、MBProgressHUD-核心-API"><a href="#一、MBProgressHUD-核心-API" class="headerlink" title="一、MBProgressHUD 核心 API"></a>一、MBProgressHUD 核心 API</h2><blockquote>
<p>这一部分讲的主要是 MBProgressHUD 的一些属性方法等，主要是为了对 MBProgressHUD 先有个大概的认识</p>
</blockquote>
<h4 id="1-1-模式"><a href="#1-1-模式" class="headerlink" title="1.1 模式"></a>1.1 模式</h4><p>首先来看看 <a href="https://github.com/jdg/MBProgressHUD" target="_blank" rel="noopener">MBProgressHUD</a> 中定义的枚举，<code>mode</code> 一共有六种显示样式：</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/// 显示样式</span><br><span class="line">typedef <span class="type">NS_ENUM</span>(<span class="type">NSInteger</span>, <span class="type">MBProgressHUDMode</span>) &#123;</span><br><span class="line">/// 默认模式, 系统自带的指示器</span><br><span class="line"><span class="type">MBProgressHUDModeIndeterminate</span>,</span><br><span class="line">/// 圆形饼图</span><br><span class="line"><span class="type">MBProgressHUDModeDeterminate</span>,</span><br><span class="line">/// 水平进度条</span><br><span class="line"><span class="type">MBProgressHUDModeDeterminateHorizontalBar</span>,</span><br><span class="line">/// 圆环</span><br><span class="line"><span class="type">MBProgressHUDModeAnnularDeterminate</span>,</span><br><span class="line">/// 自定义视图</span><br><span class="line"><span class="type">MBProgressHUDModeCustomView</span>,</span><br><span class="line">/// 只显示文字</span><br><span class="line"><span class="type">MBProgressHUDModeText</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>简单的效果图如下（颜色尺寸等都可以优化，我这里只是简单地示例）：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-2c0e36917095f806.gif?imageMogr2/auto-orient/strip" alt="默认模式：hud.mode = MBProgressHUDModeIndeterminate"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-33d61502f23a1cb8.gif?imageMogr2/auto-orient/strip" alt="圆形饼图：hud.mode = MBProgressHUDModeDeterminate"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-137f0865dea6bc2c.gif?imageMogr2/auto-orient/strip" alt="水平进度条：hud.mode = MBProgressHUDModeDeterminateHorizontalBar"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-6813068f5afe1668.gif?imageMogr2/auto-orient/strip" alt="圆环：hud.mode = MBProgressHUDModeAnnularDeterminate"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-9afbf851e3b786ed.gif?imageMogr2/auto-orient/strip" alt="自定义视图：hud.mode = MBProgressHUDModeCustomView"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-bfa363444cff270a.gif?imageMogr2/auto-orient/strip" alt="只显示文字：hud.mode = MBProgressHUDModeText"></p>
<p><br><br></p>
<h4 id="1-2-动画效果"><a href="#1-2-动画效果" class="headerlink" title="1.2 动画效果"></a>1.2 动画效果</h4><p>MBProgressHUD 在显示 HUD 窗口的时候，一般都伴随着动画效果，MBProgressHUD 中的动画效果也是一个枚举，如下：</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">typedef <span class="type">NS_ENUM</span>(<span class="type">NSInteger</span>, <span class="type">MBProgressHUDAnimation</span>) &#123;</span><br><span class="line">///  默认效果，只有透明度变化</span><br><span class="line"><span class="type">MBProgressHUDAnimationFade</span>,</span><br><span class="line">/// 透明度变化 + 形变 (放大时出现缩小消失)</span><br><span class="line"><span class="type">MBProgressHUDAnimationZoom</span>,</span><br><span class="line">/// 透明度变化 + 形变 (缩小)</span><br><span class="line"><span class="type">MBProgressHUDAnimationZoomOut</span>,</span><br><span class="line">/// 透明度变化 + 形变 (放大)</span><br><span class="line"><span class="type">MBProgressHUDAnimationZoomIn</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><em>这里先简单的罗列出来，下文中还会多次用到。</em><br><br><br></p>
<h4 id="1-3-MBProgressHUD-组成"><a href="#1-3-MBProgressHUD-组成" class="headerlink" title="1.3 MBProgressHUD 组成"></a>1.3 MBProgressHUD 组成</h4><p><code>MBProgressHUD</code> 主要由四部分组成：<strong>loading 动画视图</strong>、<strong>标题文本框</strong>、<strong>详情文本框</strong>、<strong>HUD 背景框</strong>，如下图。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-c61402fca48f7cea.gif?imageMogr2/auto-orient/strip" alt="MBProgressHUD 组成"></p>
<p>之前用 <code>MBProgressHUD</code> 设置标题文本详情文本是通过几个属性来实现的，功能少也较为繁琐，因此被遗弃了；现在设置标题文本详情文本等十分简便，直接通过 label 等控件就可以实现，而且在功能上也有很大的扩展，详情请看下面这个代码块：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// bezelView 是指包括文本和指示器的视图，和自定义的 customView 类似</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) MBBackgroundView *bezelView;</span><br><span class="line"><span class="comment">/// backgroundView 背景视图</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) MBBackgroundView *backgroundView;</span><br><span class="line"><span class="comment">/// customView 自定义视图</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>, <span class="keyword">nullable</span>) <span class="built_in">UIView</span> *customView;</span><br><span class="line"><span class="comment">/// label 指的是标题文本</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">UILabel</span> *label;</span><br><span class="line"><span class="comment">/// detailsLabel指的是详情文本</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">UILabel</span> *detailsLabel;</span><br><span class="line"><span class="comment">/// hud 窗口还可以加入button，添加事件</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">UIButton</span> *button;</span><br></pre></td></tr></table></figure>
<p>另外这里再附加两张 <code>MBProgressHUD</code> 的整体布局图，以便更好地认识 <code>MBProgressHUD</code>。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-c955394ba5fe50c9.gif?imageMogr2/auto-orient/strip" alt=" MBProgressHUD 的整体布局图 1"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-edeee858374f6c16.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="MBProgressHUD 的整体布局图 2"></p>
<p><strong>简单介绍</strong>：</p>
<ul>
<li>backgroundView：整个背景图层，可以通过 MBBackgroundView 的 style 属性设置</li>
<li>bezelView：提供元素 （indicator、label、detailLabel、button）的背景</li>
<li>indicator：指示器显示进度情况 这个视图由我们设定的mode属性决定</li>
<li>label：显示标题文本</li>
<li>detailLabel：显示详情文本</li>
<li>button：添加点击事件<br><br><br></li>
</ul>
<h4 id="1-4-MBProgressHUD-中的属性"><a href="#1-4-MBProgressHUD-中的属性" class="headerlink" title="1.4 MBProgressHUD 中的属性"></a>1.4 MBProgressHUD 中的属性</h4><p>MBProgressHUD 文件中主要包括四个类，它们分别是 <strong>MBProgressHUD</strong>、<strong>MBRoundProgressView</strong>、 <strong>MBBarProgressView</strong>、 <strong>MBBackgroundView</strong>。这四个类各有各的用法，比如如果是进度条模式(MBProgressHUDModeDeterminateHorizontalBar)，则使用的是 <code>MBBarProgressView</code> 类；如果是饼图模式(MBProgressHUDModeDeterminate)或环形模式(MBProgressHUDModeAnnularDeterminate)，则使用的是 <code>MBRoundProgressView</code>类。下面是这四个类的相关属性。</p>
<h6 id="1-41-MBProgressHUD-相关属性"><a href="#1-41-MBProgressHUD-相关属性" class="headerlink" title="1.41  MBProgressHUD 相关属性"></a>1.41  MBProgressHUD 相关属性</h6><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// show 方法触发到显示 HUD 窗口的间隔时间，默认是 0</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSTimeInterval</span> graceTime;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// HUD 窗口显示的最短时间，默认是 0</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSTimeInterval</span> minShowTime;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// HUD 窗口显示模式, 默认是系统自带的指示器</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) MBProgressHUDMode mode;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 进度条指示器以及文本的颜色</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>, <span class="keyword">nullable</span>) <span class="built_in">UIColor</span> *contentColor <span class="built_in">UI_APPEARANCE_SELECTOR</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// HUD 窗口显示和隐藏的动画类型MBProgressHUD</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) MBProgressHUDAnimation animationType <span class="built_in">UI_APPEARANCE_SELECTOR</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// HUD 窗口位置设置，比如 hud.offset = CGPointMake(0.f, MBProgressMaxOffset)，可以移到底部中心位置</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="built_in">CGPoint</span> offset <span class="built_in">UI_APPEARANCE_SELECTOR</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// HUD 元素到 HUD 边缘的距离，默认是 20.f</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="built_in">CGFloat</span> margin <span class="built_in">UI_APPEARANCE_SELECTOR</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// HUD 窗口背景框的最小尺寸</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="built_in">CGSize</span> minSize <span class="built_in">UI_APPEARANCE_SELECTOR</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 是否强制 HUD 背景框宽高相等</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>, <span class="keyword">getter</span> = isSquare) <span class="built_in">BOOL</span> square <span class="built_in">UI_APPEARANCE_SELECTOR</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 进度条 (0.0 到 1.0)</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="keyword">float</span> progress;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// bezelView 是指包括文本和指示器的视图，和自定义的 customView 类似</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) MBBackgroundView *bezelView;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// backgroundView 背景视图</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) MBBackgroundView *backgroundView;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// customView 自定义视图</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>, <span class="keyword">nullable</span>) <span class="built_in">UIView</span> *customView;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// label 指的是标题文本</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">UILabel</span> *label;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// detailsLabel指的是详情文本</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">UILabel</span> *detailsLabel;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// hud 窗口还可以加入button，添加事件</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">UIButton</span> *button;</span><br></pre></td></tr></table></figure>
<h6 id="1-42-MBRoundProgressView-相关属性"><a href="#1-42-MBRoundProgressView-相关属性" class="headerlink" title="1.42 MBRoundProgressView 相关属性"></a>1.42 MBRoundProgressView 相关属性</h6><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 进度条 (0.0 到 1.0)</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="keyword">float</span> progress;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 进度条颜色</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIColor</span> *progressColor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 进度条指示器的颜色</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIColor</span> *progressTintColor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 进度条指示器的背景颜色，只适用在 iOS7 以上，默认为半透明的白色 (透明度 0.1)</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIColor</span> *backgroundTintColor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 显示模式，NO = 圆形；YES = 环形。默认是 NO</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>, <span class="keyword">getter</span> = isAnnular) <span class="built_in">BOOL</span> annular;</span><br></pre></td></tr></table></figure>
<h6 id="1-43-MBBarProgressView-相关属性"><a href="#1-43-MBBarProgressView-相关属性" class="headerlink" title="1.43 MBBarProgressView 相关属性"></a>1.43 MBBarProgressView 相关属性</h6><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 进度条 (0.0 到 1.0)</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="keyword">float</span> progress;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 进度条边界线的颜色，默认是白色</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIColor</span> *lineColor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 进度条背景色，默认是透明</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIColor</span> *progressRemainingColor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 进度条颜色</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIColor</span> *progressColor;</span><br></pre></td></tr></table></figure>
<h6 id="1-44-MBBackgroundView-相关属性"><a href="#1-44-MBBackgroundView-相关属性" class="headerlink" title="1.44 MBBackgroundView 相关属性"></a>1.44 MBBackgroundView 相关属性</h6><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 背景图层样式，有两种，iOS7 或者以上版本默认风格是MBProgressHUDBackgroundStyleBlur，其他为MBProgressHUDBackgroundStyleSolidColor，由于 iOS7 不支持 UIVisualEffectView，所以在 iOS7 和更高版本中会有所不同</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) MBProgressHUDBackgroundStyle style;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 背景颜色，由于 iOS7 不支持 UIVisualEffectView，所以在 iOS7 和更高版本中会有所不同</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIColor</span> *color;</span><br></pre></td></tr></table></figure>
<p><br><br></p>
<h4 id="1-5-MBProgressHUD-中的一些方法"><a href="#1-5-MBProgressHUD-中的一些方法" class="headerlink" title="1.5 MBProgressHUD 中的一些方法"></a>1.5 MBProgressHUD 中的一些方法</h4><h6 id="1-51-类方法"><a href="#1-51-类方法" class="headerlink" title="1.51 类方法"></a>1.51 类方法</h6><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 创建一个 HUD 窗口，并把它显示在 view 上，还可以设置是否有动画</span></span><br><span class="line">+ (<span class="keyword">instancetype</span>)showHUDAddedTo:(<span class="built_in">UIView</span> *)view animated:(<span class="built_in">BOOL</span>)animated;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 找到最上层的 HUD subview 并把它隐藏，成功为YES、其他情况为 NO</span></span><br><span class="line">+ (<span class="built_in">BOOL</span>)hideHUDForView:(<span class="built_in">UIView</span> *)view animated:(<span class="built_in">BOOL</span>)animated;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 返回最上层的 HUD subview</span></span><br><span class="line">+ (<span class="keyword">nullable</span> MBProgressHUD *)HUDForView:(<span class="built_in">UIView</span> *)view;</span><br></pre></td></tr></table></figure>
<p>这三个类方法中，常用的是第一个函数<code>+ (instancetype)showHUDAddedTo:(UIView *)view animated:(BOOL)animated;</code>直接创建 HUD，并把它显示在 view 上，用起来极其方便</p>
<h6 id="1-52-对象方法"><a href="#1-52-对象方法" class="headerlink" title="1.52 对象方法"></a>1.52 对象方法</h6><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 以view为基准创建初始化一个HUD对象，为HUD的初始化构造函数</span></span><br><span class="line"><span class="selector-tag">-</span> (instancetype)<span class="selector-tag">initWithView</span><span class="selector-pseudo">:(UIView</span> *)<span class="selector-tag">view</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 显示HUD控件，此函数应该在主线程中调用</span></span><br><span class="line"><span class="selector-tag">-</span> (void)<span class="selector-tag">showAnimated</span><span class="selector-pseudo">:(BOOL)animated</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 隐藏HUD控件，animated控制是否显示动画。对应于- (void)showAnimated:(BOOL)animated;</span></span><br><span class="line"><span class="selector-tag">-</span> (void)<span class="selector-tag">hideAnimated</span><span class="selector-pseudo">:(BOOL)animated</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 在delay时间之后隐藏HUD，animated控制显示动画与否，delay控制延迟时间</span></span><br><span class="line"><span class="selector-tag">-</span> (void)<span class="selector-tag">hideAnimated</span><span class="selector-pseudo">:(BOOL)animated</span> <span class="selector-tag">afterDelay</span><span class="selector-pseudo">:(NSTimeInterval)delay</span>;</span><br></pre></td></tr></table></figure>
<p>这几个对象方法中，常用的也有两个<code>- (void)hideAnimated:(BOOL)animated;</code>和<code>- (void)hideAnimated:(BOOL)animated afterDelay:(NSTimeInterval)delay;</code></p>
<p><br><br></p>
<h2 id="二、show-系列方法"><a href="#二、show-系列方法" class="headerlink" title="二、show 系列方法"></a>二、show 系列方法</h2><blockquote>
<p>这一部分主要是展示 HUD 窗口时调用的方法及代码分析</p>
</blockquote>
<p>下面这个方法在我们创建 MBProgressHUD 对象时首先调用</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">+ (instance<span class="keyword">type</span>)showHUDAddedTo:(<span class="type">UIView</span> *)view animated:(<span class="type">BOOL</span>)animated &#123;</span><br><span class="line"></span><br><span class="line">/// 创建并初始化 <span class="type">MBProgressHUD</span> 对象，根据传进来的 view 来设定</span><br><span class="line"><span class="type">MBProgressHUD</span> *hud = [[self alloc] initWithView:view];</span><br><span class="line"></span><br><span class="line">/// 移除 <span class="type">HUD</span> 窗口</span><br><span class="line">hud.removeFromSuperViewOnHide = <span class="type">YES</span>;</span><br><span class="line"></span><br><span class="line">/// 添加到 <span class="type">View</span> 上，并显示</span><br><span class="line">[view addSubview:hud];</span><br><span class="line">[hud showAnimated:animated];</span><br><span class="line">return hud;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个方法会调用两个主要方法：<code>- (id)initWithView:(UIView *)view</code> 和 <code>- (void)showAnimated:(BOOL)animated</code>，具体的调用流程如下图：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-effb289399c57e61.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="show 相关的方法调用"></p>
<p>当然在 MBProgressHUD 中，<code>+ (instancetype)showHUDAddedTo:(UIView *)view animated:(BOOL)animated</code> 调用的方法远不止上图列的这些，图上列的只是几个主要方法。接下来我们就根据程序的执行过程来一步一步分析一下代码。</p>
<p>在方法 <code>- (id)initWithView:(UIView *)view</code>中，调用 <code>- (instancetype)initWithFrame:(CGRect)frame</code>，接着会调用<code>- (void)commonInit</code>。<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">id</span>)initWithView:(<span class="built_in">UIView</span> *)view &#123;</span><br><span class="line"><span class="built_in">NSAssert</span>(view, <span class="string">@"View must not be nil."</span>);</span><br><span class="line"><span class="keyword">return</span> [<span class="keyword">self</span> initWithFrame:view.bounds];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithFrame:(<span class="built_in">CGRect</span>)frame &#123;</span><br><span class="line"><span class="keyword">if</span> ((<span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame])) &#123;</span><br><span class="line">[<span class="keyword">self</span> commonInit];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithCoder:(<span class="built_in">NSCoder</span> *)aDecoder &#123;</span><br><span class="line"><span class="keyword">if</span> ((<span class="keyword">self</span> = [<span class="keyword">super</span> initWithCoder:aDecoder])) &#123;</span><br><span class="line">[<span class="keyword">self</span> commonInit];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)commonInit &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 默认效果, 透明度变化</span></span><br><span class="line">_animationType = MBProgressHUDAnimationFade;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 默认模式, 系统自带的指示器</span></span><br><span class="line">_mode = MBProgressHUDModeIndeterminate;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// HUD 元素到 HUD 边缘的距离，默认是 20.f</span></span><br><span class="line">_margin = <span class="number">20.0</span>f;</span><br><span class="line">_opacity = <span class="number">1.</span>f;</span><br><span class="line">_defaultMotionEffectsEnabled = <span class="literal">YES</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 默认颜色，根据当前的 iOS 版本</span></span><br><span class="line"><span class="built_in">BOOL</span> isLegacy = kCFCoreFoundationVersionNumber &lt; kCFCoreFoundationVersionNumber_iOS_7_0;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 进度条指示器以及文本的颜色</span></span><br><span class="line">_contentColor = isLegacy ? [<span class="built_in">UIColor</span> whiteColor] : [<span class="built_in">UIColor</span> colorWithWhite:<span class="number">0.</span>f alpha:<span class="number">0.7</span>f];</span><br><span class="line"></span><br><span class="line"><span class="comment">/// opaque 类似 Alpha，表示当前 UIView 的不透明度，设置是否之后对于 UIView 的显示并没有什么影响,官方文档的意思是 opaque 默认为 YES，如果 alpha 小于 1，那么应该设置 opaque 设置为 NO，当 alpha 为 1，opaque设置为 NO</span></span><br><span class="line"><span class="keyword">self</span>.opaque = <span class="literal">NO</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 背景色</span></span><br><span class="line"><span class="keyword">self</span>.backgroundColor = [<span class="built_in">UIColor</span> clearColor];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 透明度为 0</span></span><br><span class="line"><span class="keyword">self</span>.alpha = <span class="number">0.0</span>f;</span><br><span class="line"><span class="comment">/// 自动调整子控件与父控件之间的宽高</span></span><br><span class="line"><span class="keyword">self</span>.autoresizingMask = <span class="built_in">UIViewAutoresizingFlexibleWidth</span> | <span class="built_in">UIViewAutoresizingFlexibleHeight</span>;</span><br><span class="line"><span class="keyword">self</span>.layer.allowsGroupOpacity = <span class="literal">NO</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 设置所需的子view</span></span><br><span class="line">[<span class="keyword">self</span> setupViews];</span><br><span class="line"><span class="comment">/// 设置指示器样式</span></span><br><span class="line">[<span class="keyword">self</span> updateIndicators];</span><br><span class="line"><span class="comment">/// 注册通知</span></span><br><span class="line">[<span class="keyword">self</span> registerForNotifications];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>上面代码块中的代码已经加过注释，因此在这里不再累述某句代码有什么作用，这里直接说程序的执行流程。当程序执行到 <code>- (void)commonInit</code> 这个方法时，会相继执行<code>- (void)setupViews</code>，<code>- (void)updateIndicators</code>，<code>- (void)registerForNotifications</code> 这三个方法，当然在执行这三个方法期间，也会执行其它的方法，比如会执行<code>- (void)updateForBackgroundStyle</code> 和<code>- (void)updateBezelMotionEffects</code>等等，这和你设置的 mode 的模式，以及和 label，detailsLabel ，button 这一系列元素，以及和相应的属性都有一定的关系。</p>
<p>接着我们来分析一下 <code>- (void)setupViews</code>，<code>- (void)updateIndicators</code>，<code>- (void)registerForNotifications</code> 这三个方法。</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)setupViews &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 进度条指示器以及文本的颜色</span></span><br><span class="line"><span class="built_in">UIColor</span> *defaultColor = <span class="keyword">self</span>.contentColor;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/// 创建背景视图</span></span><br><span class="line">MBBackgroundView *backgroundView = [[MBBackgroundView alloc] initWithFrame:<span class="keyword">self</span>.bounds];</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 背景图层样式</span></span><br><span class="line">backgroundView.style = MBProgressHUDBackgroundStyleSolidColor;</span><br><span class="line">backgroundView.backgroundColor = [<span class="built_in">UIColor</span> clearColor];</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 自动调整 view 的宽度和高度</span></span><br><span class="line">backgroundView.autoresizingMask = <span class="built_in">UIViewAutoresizingFlexibleWidth</span> | <span class="built_in">UIViewAutoresizingFlexibleHeight</span>;</span><br><span class="line">backgroundView.alpha = <span class="number">0.</span>f;</span><br><span class="line">[<span class="keyword">self</span> addSubview:backgroundView];</span><br><span class="line">_backgroundView = backgroundView;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 创建背景视图（和上面那个大小不同）</span></span><br><span class="line">MBBackgroundView *bezelView = [MBBackgroundView new];</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 代码层面使用 Autolayout，需要对使用的 View 的translatesAutoresizingMaskIntoConstraints 属性设置为NO</span></span><br><span class="line">bezelView.translatesAutoresizingMaskIntoConstraints = <span class="literal">NO</span>;</span><br><span class="line">bezelView.layer.cornerRadius = <span class="number">5.</span>f;</span><br><span class="line">bezelView.alpha = <span class="number">0.</span>f;</span><br><span class="line">[<span class="keyword">self</span> addSubview:bezelView];</span><br><span class="line">_bezelView = bezelView;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 调用 updateBezelMotionEffects 方法，设置视差效果</span></span><br><span class="line">[<span class="keyword">self</span> updateBezelMotionEffects];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/// 创建 label 标签，显示主要文本</span></span><br><span class="line"><span class="built_in">UILabel</span> *label = [<span class="built_in">UILabel</span> new];</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 取消文字大小自适应</span></span><br><span class="line">label.adjustsFontSizeToFitWidth = <span class="literal">NO</span>;</span><br><span class="line">label.textAlignment = <span class="built_in">NSTextAlignmentCenter</span>;</span><br><span class="line">label.textColor = defaultColor;</span><br><span class="line">label.font = [<span class="built_in">UIFont</span> boldSystemFontOfSize:MBDefaultLabelFontSize];</span><br><span class="line"></span><br><span class="line"><span class="comment">/// opaque 类似 Alpha，表示当前 UIView 的不透明度，设置是否之后对于 UIView 的显示并没有什么影响,官方文档的意思是 opaque 默认为 YES，如果 alpha 小于 1，那么应该设置 opaque 设置为 NO，当 alpha 为 1，opaque设置为 NO</span></span><br><span class="line">label.opaque = <span class="literal">NO</span>;</span><br><span class="line">label.backgroundColor = [<span class="built_in">UIColor</span> clearColor];</span><br><span class="line">_label = label;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/// 创建 detailsLabel 标签，显示详细信息</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">UILabel</span> *detailsLabel = [<span class="built_in">UILabel</span> new];</span><br><span class="line"><span class="comment">/// 取消文字大小自适应</span></span><br><span class="line">detailsLabel.adjustsFontSizeToFitWidth = <span class="literal">NO</span>;</span><br><span class="line">detailsLabel.textAlignment = <span class="built_in">NSTextAlignmentCenter</span>;</span><br><span class="line">detailsLabel.textColor = defaultColor;</span><br><span class="line">detailsLabel.numberOfLines = <span class="number">0</span>;</span><br><span class="line">detailsLabel.font = [<span class="built_in">UIFont</span> boldSystemFontOfSize:MBDefaultDetailsLabelFontSize];</span><br><span class="line"></span><br><span class="line"><span class="comment">/// opaque 类似 Alpha，表示当前 UIView 的不透明度，设置是否之后对于 UIView 的显示并没有什么影响,官方文档的意思是 opaque 默认为 YES，如果 alpha 小于 1，那么应该设置 opaque 设置为 NO，当 alpha 为 1，opaque设置为 NO</span></span><br><span class="line">detailsLabel.opaque = <span class="literal">NO</span>;</span><br><span class="line">detailsLabel.backgroundColor = [<span class="built_in">UIColor</span> clearColor];</span><br><span class="line">_detailsLabel = detailsLabel;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/// 创建 button 按钮，并添加响应按钮</span></span><br><span class="line"><span class="built_in">UIButton</span> *button = [MBProgressHUDRoundedButton buttonWithType:<span class="built_in">UIButtonTypeCustom</span>];</span><br><span class="line">button.titleLabel.textAlignment = <span class="built_in">NSTextAlignmentCenter</span>;</span><br><span class="line">button.titleLabel.font = [<span class="built_in">UIFont</span> boldSystemFontOfSize:MBDefaultDetailsLabelFontSize];</span><br><span class="line">[button setTitleColor:defaultColor forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">_button = button;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/// 将 label，detailLabel，button 添加到蒙版视图</span></span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">UIView</span> *view <span class="keyword">in</span> @[label, detailsLabel, button]) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 代码层面使用 Autolayout，需要对使用的 View 的translatesAutoresizingMaskIntoConstraints 属性设置为NO</span></span><br><span class="line">view.translatesAutoresizingMaskIntoConstraints = <span class="literal">NO</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 为视图设置水平方向上优先级为 998 的压缩阻力</span></span><br><span class="line">[view setContentCompressionResistancePriority:<span class="number">998.</span>f forAxis:<span class="built_in">UILayoutConstraintAxisHorizontal</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 为视图设置垂直方向上优先级为 998 的压缩阻力</span></span><br><span class="line">[view setContentCompressionResistancePriority:<span class="number">998.</span>f forAxis:<span class="built_in">UILayoutConstraintAxisVertical</span>];</span><br><span class="line">[bezelView addSubview:view];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/// 创建顶部视图</span></span><br><span class="line"><span class="built_in">UIView</span> *topSpacer = [<span class="built_in">UIView</span> new];</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 代码层面使用 Autolayout，需要对使用的 View 的translatesAutoresizingMaskIntoConstraints 属性设置为NO</span></span><br><span class="line">topSpacer.translatesAutoresizingMaskIntoConstraints = <span class="literal">NO</span>;</span><br><span class="line">topSpacer.hidden = <span class="literal">YES</span>;</span><br><span class="line">[bezelView addSubview:topSpacer];</span><br><span class="line">_topSpacer = topSpacer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 创建底部视图</span></span><br><span class="line"><span class="built_in">UIView</span> *bottomSpacer = [<span class="built_in">UIView</span> new];</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 代码层面使用 Autolayout，需要对使用的 View 的translatesAutoresizingMaskIntoConstraints 属性设置为NO</span></span><br><span class="line">bottomSpacer.translatesAutoresizingMaskIntoConstraints = <span class="literal">NO</span>;</span><br><span class="line">bottomSpacer.hidden = <span class="literal">YES</span>;</span><br><span class="line">[bezelView addSubview:bottomSpacer];</span><br><span class="line">_bottomSpacer = bottomSpacer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)updateIndicators &#123;</span><br><span class="line"><span class="built_in">UIView</span> *indicator = <span class="keyword">self</span>.indicator;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 判断当前指示器是否是 UIActivityIndicatorView</span></span><br><span class="line"><span class="built_in">BOOL</span> isActivityIndicator = [indicator isKindOfClass:[<span class="built_in">UIActivityIndicatorView</span> <span class="keyword">class</span>]];</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 判断当前指示器是否是 MBRoundProgressView</span></span><br><span class="line"><span class="built_in">BOOL</span> isRoundIndicator = [indicator isKindOfClass:[MBRoundProgressView <span class="keyword">class</span>]];</span><br><span class="line"></span><br><span class="line">MBProgressHUDMode mode = <span class="keyword">self</span>.mode;</span><br><span class="line"><span class="comment">/// MBProgressHUDModeIndeterminate:系统自带的指示器</span></span><br><span class="line"><span class="keyword">if</span> (mode == MBProgressHUDModeIndeterminate) &#123;</span><br><span class="line"><span class="keyword">if</span> (!isActivityIndicator) &#123;</span><br><span class="line"><span class="comment">// 如果当前指示器不属于 UIActivityIndicatorView 类型，则移除之前的indicator，重新创建</span></span><br><span class="line">[indicator removeFromSuperview];</span><br><span class="line">indicator = [[<span class="built_in">UIActivityIndicatorView</span> alloc] initWithActivityIndicatorStyle:<span class="built_in">UIActivityIndicatorViewStyleWhiteLarge</span>];</span><br><span class="line">[(<span class="built_in">UIActivityIndicatorView</span> *)indicator startAnimating];</span><br><span class="line">[<span class="keyword">self</span>.bezelView addSubview:indicator];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (mode == MBProgressHUDModeDeterminateHorizontalBar) &#123;</span><br><span class="line"><span class="comment">/// 如果当前指示器不属于 MBBarProgressView 类型，则移除之前的indicator，重新创建</span></span><br><span class="line">[indicator removeFromSuperview];</span><br><span class="line">indicator = [[MBBarProgressView alloc] init];</span><br><span class="line">[<span class="keyword">self</span>.bezelView addSubview:indicator];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (mode == MBProgressHUDModeDeterminate || mode == MBProgressHUDModeAnnularDeterminate) &#123;</span><br><span class="line"><span class="keyword">if</span> (!isRoundIndicator) &#123;</span><br><span class="line"><span class="comment">/// 如果当前指示器不属于 MBRoundProgressView 类型，则移除之前的indicator，重新创建</span></span><br><span class="line">[indicator removeFromSuperview];</span><br><span class="line">indicator = [[MBRoundProgressView alloc] init];</span><br><span class="line">[<span class="keyword">self</span>.bezelView addSubview:indicator];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (mode == MBProgressHUDModeAnnularDeterminate) &#123; <span class="comment">/// 圆环指示器</span></span><br><span class="line">[(MBRoundProgressView *)indicator setAnnular:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (mode == MBProgressHUDModeCustomView &amp;&amp; <span class="keyword">self</span>.customView != indicator) &#123; <span class="comment">/// 自定义视图指示器</span></span><br><span class="line">[indicator removeFromSuperview];</span><br><span class="line">indicator = <span class="keyword">self</span>.customView;</span><br><span class="line">[<span class="keyword">self</span>.bezelView addSubview:indicator];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (mode == MBProgressHUDModeText) &#123; <span class="comment">/// 文本形式，去除指示器视图</span></span><br><span class="line">[indicator removeFromSuperview];</span><br><span class="line">indicator = <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/// 代码层面使用 Autolayout，需要对使用的 View 的translatesAutoresizingMaskIntoConstraints 属性设置为NO</span></span><br><span class="line">indicator.translatesAutoresizingMaskIntoConstraints = <span class="literal">NO</span>;</span><br><span class="line"><span class="keyword">self</span>.indicator = indicator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ([indicator respondsToSelector:<span class="keyword">@selector</span>(setProgress:)]) &#123;</span><br><span class="line"><span class="comment">/// 设置进度条的数值</span></span><br><span class="line">[(<span class="keyword">id</span>)indicator setValue:@(<span class="keyword">self</span>.progress) forKey:<span class="string">@"progress"</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/// 为视图设置水平方向上优先级为 998 的压缩阻力</span></span><br><span class="line">[indicator setContentCompressionResistancePriority:<span class="number">998.</span>f forAxis:<span class="built_in">UILayoutConstraintAxisHorizontal</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 为视图设置垂直方向上优先级为 998 的压缩阻力</span></span><br><span class="line">[indicator setContentCompressionResistancePriority:<span class="number">998.</span>f forAxis:<span class="built_in">UILayoutConstraintAxisVertical</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 设置控件颜色</span></span><br><span class="line">[<span class="keyword">self</span> updateViewsForColor:<span class="keyword">self</span>.contentColor];</span><br><span class="line"><span class="comment">/// 更新布局</span></span><br><span class="line">[<span class="keyword">self</span> setNeedsUpdateConstraints];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)registerForNotifications &#123;</span><br><span class="line"><span class="meta">#if !TARGET_OS_TV</span></span><br><span class="line"><span class="built_in">NSNotificationCenter</span> *nc = [<span class="built_in">NSNotificationCenter</span> defaultCenter];</span><br><span class="line"><span class="comment">/// 通过通知 UIApplicationDidChangeStatusBarOrientationNotification 来处理屏幕转屏事件</span></span><br><span class="line">[nc addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(statusBarOrientationDidChange:)</span><br><span class="line">name:<span class="built_in">UIApplicationDidChangeStatusBarOrientationNotification</span> object:<span class="literal">nil</span>];</span><br><span class="line"><span class="meta">#endif</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>由上面代码我们可以看出，在方法<code>- (void)setupViews</code>中，创建了 backgroundView、bezelView、label、detailsLabel、button 这几个控件，并使用 for 循环把 label、detailsLabel、button 添加到bezelView 视图中，最后还创建了顶部视图和底部视图，不过默认是隐藏的。有一点值得说明，在创建 button 时并没有设置 button 的 size 等属性，那么这个按钮是不会显示的。在这里 MBProgressHUD 重写了一个 Unbutton 的子类 MBProgressHUDRoundedButton。这个子类里面有一个方法，<code>- (CGSize)intrinsicContentSize</code>，通过这个方法来设置 Unbutton 的 size。</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">CGSize</span>)intrinsicContentSize &#123;</span><br><span class="line"><span class="comment">/// 只有当有事件才显示（这里也告诉我们，如果这个 button 没有任何事件的话，它的大小就是 CGSizeZero，即不会显示）</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">self</span>.allControlEvents == <span class="number">0</span>) <span class="keyword">return</span> <span class="built_in">CGSizeZero</span>;</span><br><span class="line"><span class="built_in">CGSize</span> size = [<span class="keyword">super</span> intrinsicContentSize];</span><br><span class="line"><span class="comment">// Add some side padding</span></span><br><span class="line">size.width += <span class="number">20.</span>f;</span><br><span class="line"><span class="keyword">return</span> size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>- (void)updateIndicators</code>这个方法主要是用来设置 indicator 指示器的，根据 mode 的属性显示不同的形式，具体可以参看代码注释。这个方法最后调用的是<code>setNeedsUpdateConstraints</code>函数，这个函数是系统自带的方法，它会自动调用<code>- (void)updateConstraints</code> 方法，<code>- (void)updateConstraints</code> 主要作用是更新各个控件的布局，我们稍后再对这个方法进行详细分析。</p>
</li>
<li><p><code>- (void)registerForNotifications</code>这个方法中的代码量很少，它的作用是通过通知 UIApplicationDidChangeStatusBarOrientationNotification 来处理屏幕转屏事件</p>
</li>
</ul>
<p>当<code>- (void)registerForNotifications</code>这一系列方法执行完毕之后，程序会重新返回到<code>+ (instancetype)showHUDAddedTo:(UIView *)view animated:(BOOL)animated</code>这个方法中，接着调用另一个主要函数<code>- (void)showAnimated:(BOOL)animated</code>。</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)showAnimated:(<span class="built_in">BOOL</span>)animated &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 显示放在主线程中</span></span><br><span class="line">MBMainThreadAssert();</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 取消定时器</span></span><br><span class="line">[<span class="keyword">self</span>.minShowTimer invalidate];</span><br><span class="line"><span class="keyword">self</span>.useAnimation = animated;</span><br><span class="line"><span class="keyword">self</span>.finished = <span class="literal">NO</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 如果设置了宽限时间graceTime，则延迟显示（避免 HUD 一闪而过的差体验）</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">self</span>.graceTime &gt; <span class="number">0.0</span>) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 创建定时器，把它加入 NSRunLoop 中</span></span><br><span class="line"><span class="built_in">NSTimer</span> *timer = [<span class="built_in">NSTimer</span> timerWithTimeInterval:<span class="keyword">self</span>.graceTime target:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(handleGraceTimer:) userInfo:<span class="literal">nil</span> repeats:<span class="literal">NO</span>];</span><br><span class="line">[[<span class="built_in">NSRunLoop</span> currentRunLoop] addTimer:timer forMode:<span class="built_in">NSRunLoopCommonModes</span>];</span><br><span class="line"><span class="keyword">self</span>.graceTimer = timer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 没有设置 graceTime，则直接显示</span></span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">[<span class="keyword">self</span> showUsingAnimation:<span class="keyword">self</span>.useAnimation];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 设置宽限时间 graceTime时调用的方法</span></span><br><span class="line">- (<span class="keyword">void</span>)handleGraceTimer:(<span class="built_in">NSTimer</span> *)theTimer &#123;</span><br><span class="line"><span class="comment">// Show the HUD only if the task is still running</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">self</span>.hasFinished) &#123;</span><br><span class="line">[<span class="keyword">self</span> showUsingAnimation:<span class="keyword">self</span>.useAnimation];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)showUsingAnimation:(<span class="built_in">BOOL</span>)animated &#123;</span><br><span class="line"><span class="comment">/// 移除所有动画</span></span><br><span class="line">[<span class="keyword">self</span>.bezelView.layer removeAllAnimations];</span><br><span class="line">[<span class="keyword">self</span>.backgroundView.layer removeAllAnimations];</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 取消 hideDelayTimer</span></span><br><span class="line">[<span class="keyword">self</span>.hideDelayTimer invalidate];</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 开始时间</span></span><br><span class="line"><span class="keyword">self</span>.showStarted = [<span class="built_in">NSDate</span> date];</span><br><span class="line"><span class="keyword">self</span>.alpha = <span class="number">1.</span>f;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 以防我们隐藏 NSProgress 对象</span></span><br><span class="line">[<span class="keyword">self</span> setNSProgressDisplayLinkEnabled:<span class="literal">YES</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (animated) &#123;</span><br><span class="line">[<span class="keyword">self</span> animateIn:<span class="literal">YES</span> withType:<span class="keyword">self</span>.animationType completion:<span class="literal">NULL</span>];</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">/// 方法弃用告警</span></span><br><span class="line"><span class="meta">#pragma clang diagnostic push</span></span><br><span class="line"><span class="meta">#pragma clang diagnostic ignored <span class="meta-string">"-Wdeprecated-declarations"</span></span></span><br><span class="line"><span class="keyword">self</span>.bezelView.alpha = <span class="keyword">self</span>.opacity;</span><br><span class="line"><span class="meta">#pragma clang diagnostic pop</span></span><br><span class="line"><span class="keyword">self</span>.backgroundView.alpha = <span class="number">1.</span>f;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由上面这段代码我们可以看出，在方法<code>- (void)showAnimated:(BOOL)animated</code>中，无论我们有没有设置<code>graceTime</code>这个属性，最后都会去执行一个方法 <code>- (void)showUsingAnimation:(BOOL)animated</code>，<code>- (void)showUsingAnimation:(BOOL)animated</code> 这个方法在上面已经做过注释，不再细说，不过有两小点值得我们注意，第一点是 <code>- (void)showUsingAnimation:(BOOL)animated</code> 在执行过程中调用了一个方法 <code>- (void)setNSProgressDisplayLinkEnabled:(BOOL)enabled</code>，先来看下这个方法<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)setNSProgressDisplayLinkEnabled:(<span class="built_in">BOOL</span>)enabled &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 这里使用 CADisplayLink，是因为如果使用 KVO 机制会非常消耗主线程（因为 NSProgress 频率非常快）</span></span><br><span class="line"><span class="keyword">if</span> (enabled &amp;&amp; <span class="keyword">self</span>.progressObject) &#123;</span><br><span class="line"><span class="comment">/// 创建 CADisplayLink 对象</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">self</span>.progressObjectDisplayLink) &#123;</span><br><span class="line"><span class="keyword">self</span>.progressObjectDisplayLink = [<span class="built_in">CADisplayLink</span> displayLinkWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(updateProgressFromProgressObject)];</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">self</span>.progressObjectDisplayLink = <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这个方法是关于 <code>CADisplayLink</code> 的，<code>CADisplayLink</code> 是一个能让我们以和屏幕刷新率相同的频率将内容画到屏幕上的定时器。我们在应用中创建一个新的 <code>CADisplayLink</code> 对象，把它添加到一个<code>runloop</code> 中，并给它提供一个 <code>target</code> 和 <code>selector</code> 在屏幕刷新的时候调用。一旦 <code>CADisplayLink</code> 以特定的模式注册到 <code>runloop</code> 之后，每当屏幕需要刷新，<code>runloop</code> 就会向 <code>CADisplayLink</code> 指定的<code>target</code> 发送一次指定的 <code>selector</code> 消息， <code>CADisplayLink</code> 类对应的 <code>selector</code> 就会被调用一次。</p>
<p><code>- (void)showUsingAnimation:(BOOL)animated</code> 这个方法中还有一点值得注意，就是只有具有动画效果的前提下，即 <code>animated</code> 为真时才会调用 <code>- (void)animateIn:(BOOL)animatingIn withType:(MBProgressHUDAnimation)type completion:(void(^)(BOOL finished))completion</code> 这个方法，下面我们再一起来看下这个方法。<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// animated 为真时调用，消失或出现时的伸缩效果，以及透明度</span></span><br><span class="line">- (<span class="keyword">void</span>)animateIn:(<span class="built_in">BOOL</span>)animatingIn withType:(MBProgressHUDAnimation)type completion:(<span class="keyword">void</span>(^)(<span class="built_in">BOOL</span> finished))completion &#123;</span><br><span class="line"><span class="comment">/// 自动确定正确的缩放动画类型，关于 MBProgressHUDAnimation 的几种类型，上文已全部列出，这里不再详细介绍</span></span><br><span class="line"><span class="keyword">if</span> (type == MBProgressHUDAnimationZoom) &#123;</span><br><span class="line">type = animatingIn ? MBProgressHUDAnimationZoomIn : MBProgressHUDAnimationZoomOut;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// CGAffineTransformMakeScale 中的两个参数，分别代表x和y方向缩放倍数</span></span><br><span class="line"><span class="built_in">CGAffineTransform</span> small = <span class="built_in">CGAffineTransformMakeScale</span>(<span class="number">0.5</span>f, <span class="number">0.5</span>f);</span><br><span class="line"><span class="built_in">CGAffineTransform</span> large = <span class="built_in">CGAffineTransformMakeScale</span>(<span class="number">1.5</span>f, <span class="number">1.5</span>f);</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 设定初始状态</span></span><br><span class="line"><span class="built_in">UIView</span> *bezelView = <span class="keyword">self</span>.bezelView;</span><br><span class="line"><span class="keyword">if</span> (animatingIn &amp;&amp; bezelView.alpha == <span class="number">0.</span>f &amp;&amp; type == MBProgressHUDAnimationZoomIn) &#123;</span><br><span class="line">bezelView.transform = small; <span class="comment">/// 缩放</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (animatingIn &amp;&amp; bezelView.alpha == <span class="number">0.</span>f &amp;&amp; type == MBProgressHUDAnimationZoomOut) &#123;</span><br><span class="line">bezelView.transform = large; <span class="comment">/// 扩大</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 创建动画任务</span></span><br><span class="line">dispatch_block_t animations = ^&#123;</span><br><span class="line"><span class="keyword">if</span> (animatingIn) &#123;</span><br><span class="line">bezelView.transform = <span class="built_in">CGAffineTransformIdentity</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!animatingIn &amp;&amp; type == MBProgressHUDAnimationZoomIn) &#123;</span><br><span class="line">bezelView.transform = large;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!animatingIn &amp;&amp; type == MBProgressHUDAnimationZoomOut) &#123;</span><br><span class="line">bezelView.transform = small;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 方法弃用告警</span></span><br><span class="line"><span class="meta">#pragma clang diagnostic push</span></span><br><span class="line"><span class="meta">#pragma clang diagnostic ignored <span class="meta-string">"-Wdeprecated-declarations"</span></span></span><br><span class="line">bezelView.alpha = animatingIn ? <span class="keyword">self</span>.opacity : <span class="number">0.</span>f;</span><br><span class="line"><span class="meta">#pragma clang diagnostic pop</span></span><br><span class="line"><span class="keyword">self</span>.backgroundView.alpha = animatingIn ? <span class="number">1.</span>f : <span class="number">0.</span>f;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 动画的两种形式，&gt;= iOS7 的是一种形式，iOS7以下是另一种</span></span><br><span class="line"><span class="meta">#if __IPHONE_OS_VERSION_MAX_ALLOWED &gt;= 70000 || TARGET_OS_TV</span></span><br><span class="line"><span class="keyword">if</span> (kCFCoreFoundationVersionNumber &gt;= kCFCoreFoundationVersionNumber_iOS_7_0) &#123;</span><br><span class="line"><span class="comment">/// 只支持 &gt;= iOS7</span></span><br><span class="line">[<span class="built_in">UIView</span> animateWithDuration:<span class="number">0.3</span> delay:<span class="number">0.</span> usingSpringWithDamping:<span class="number">1.</span>f initialSpringVelocity:<span class="number">0.</span>f options:<span class="built_in">UIViewAnimationOptionBeginFromCurrentState</span> animations:animations completion:completion];</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#endif</span></span><br><span class="line">[<span class="built_in">UIView</span> animateWithDuration:<span class="number">0.3</span> delay:<span class="number">0.</span> options:<span class="built_in">UIViewAnimationOptionBeginFromCurrentState</span> animations:animations completion:completion];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>- (void)animateIn:(BOOL)animatingIn withType:(MBProgressHUDAnimation)type completion:(void(^)(BOOL finished))completion</code> 这个方法，无论是处于 show 状态还是处于 hide 状态，都会调用，下边我们再一起看下 hide 系列的一些方法。</p>
<h2 id="三、hide-系列方法"><a href="#三、hide-系列方法" class="headerlink" title="三、hide 系列方法"></a>三、hide 系列方法</h2><blockquote>
<p>这一部分主要是隐藏 HUD 窗口时调用的方法及代码分析</p>
</blockquote>
<p>关于隐藏 HUD 窗口，MBProgressHUD 给我们提供的方法有以下几个：<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 找到最上层的 HUD subview 并把它隐藏，成功为YES、其他情况为 NO</span></span><br><span class="line">+ (<span class="built_in">BOOL</span>)hideHUDForView:(<span class="built_in">UIView</span> *)view animated:(<span class="built_in">BOOL</span>)animated;</span><br><span class="line"></span><br><span class="line"><span class="comment">//隐藏HUD控件，animated控制是否显示动画。对应于- (void)showAnimated:(BOOL)animated;</span></span><br><span class="line">- (<span class="keyword">void</span>)hideAnimated:(<span class="built_in">BOOL</span>)animated;</span><br><span class="line"></span><br><span class="line"><span class="comment">//在delay时间之后隐藏HUD，animated控制显示动画与否，delay控制延迟时间</span></span><br><span class="line">- (<span class="keyword">void</span>)hideAnimated:(<span class="built_in">BOOL</span>)animated afterDelay:(<span class="built_in">NSTimeInterval</span>)delay;</span><br></pre></td></tr></table></figure></p>
<p>最常用的是后面两个： <code>- (void)hideAnimated:(BOOL)animated</code> 和  <code>- (void)hideAnimated:(BOOL)animated afterDelay:(NSTimeInterval)delay</code>，这两个方法的本质是相同的，不同的只是形式，也就是说这两个方法的实现流程基本上是一致的，只不过 <code>- (void)hideAnimated:(BOOL)animated afterDelay:(NSTimeInterval)delay</code> 多执行一两个方法而已。下面我们就来具体分析下 hide 系列的方法。</p>
<ul>
<li>首先还是来说说<code>+ (BOOL)hideHUDForView:(UIView *)view animated:(BOOL)animated</code>这个函数，如果调用这个方法来隐藏 HUD 窗口，那么会先调用两个方法：</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="built_in">BOOL</span>)hideHUDForView:(<span class="built_in">UIView</span> *)view animated:(<span class="built_in">BOOL</span>)animated &#123;</span><br><span class="line"><span class="comment">/// 获取当前 view 的最上面的 HUD</span></span><br><span class="line">MBProgressHUD *hud = [<span class="keyword">self</span> HUDForView:view];</span><br><span class="line"><span class="keyword">if</span> (hud != <span class="literal">nil</span>) &#123;</span><br><span class="line"><span class="comment">/// 移除 HUD 窗口</span></span><br><span class="line">hud.removeFromSuperViewOnHide = <span class="literal">YES</span>;</span><br><span class="line">[hud hideAnimated:animated];</span><br><span class="line"><span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (MBProgressHUD *)HUDForView:(<span class="built_in">UIView</span> *)view &#123;</span><br><span class="line"><span class="comment">/// NSEnumerator 是一个枚举器，依附于集合类（NSArray,NSSet,NSDictionary等），reverseObjectEnumerator 倒序遍历</span></span><br><span class="line"><span class="built_in">NSEnumerator</span> *subviewsEnum = [view.subviews reverseObjectEnumerator];</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">UIView</span> *subview <span class="keyword">in</span> subviewsEnum) &#123;</span><br><span class="line"><span class="keyword">if</span> ([subview isKindOfClass:<span class="keyword">self</span>]) &#123;</span><br><span class="line"><span class="keyword">return</span> (MBProgressHUD *)subview;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当执行完上面这两个方法之后，接下来执行的方法和调用<code>- (void)hideAnimated:(BOOL)animated</code>隐藏 HUD 窗口时执行的方法相同，所以下边会详细分析。</p>
<ul>
<li>接下来说说调用<code>- (void)hideAnimated:(BOOL)animated afterDelay:(NSTimeInterval)delay</code> 隐藏 HUD 窗口时的情况，上文已经说过，调用这个方法会比调用<code>- (void)hideAnimated:(BOOL)animated</code> 多执行一两个方法：</li>
</ul>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)<span class="string">hideAnimated:</span>(BOOL)animated <span class="string">afterDelay:</span>(NSTimeInterval)delay &#123;</span><br><span class="line"><span class="comment">/// 创建定时器，并把它加入到 NSRunLoop 中</span></span><br><span class="line">NSTimer *timer = [NSTimer <span class="string">timerWithTimeInterval:</span>delay <span class="string">target:</span>self <span class="string">selector:</span><span class="meta">@selector</span>(<span class="string">handleHideTimer:</span>) <span class="string">userInfo:</span>@(animated) <span class="string">repeats:</span>NO];</span><br><span class="line">[[NSRunLoop currentRunLoop] <span class="string">addTimer:</span>timer <span class="string">forMode:</span>NSRunLoopCommonModes];</span><br><span class="line">self.hideDelayTimer = timer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)<span class="string">handleHideTimer:</span>(NSTimer *)timer &#123;</span><br><span class="line">[self <span class="string">hideAnimated:</span>[timer.userInfo boolValue]];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由上面代码可以清晰的看出，<code>- (void)hideAnimated:(BOOL)animated afterDelay:(NSTimeInterval)delay</code> 这个方法中加了一个定时器，当执行完这个定时器的<code>selector</code>时，就会执行<code>- (void)hideAnimated:(BOOL)animated</code>方法。</p>
<ul>
<li>由此可见无论使用哪种方法隐藏 HUD 窗口，最终都会来到这个方法，<code>- (void)hideAnimated:(BOOL)animated</code>，接下来我们就来分析下这个方法的具体调用流程，先看个图：</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-d01f3044d62ba8d6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="hide 相关的方法调用"></p>
<p>上图显示的是 hide 相关的方法调用，只罗列了几个主要方法。接下来我们就来分析下这几个主要方法。先来到<code>- (void)hideAnimated:(BOOL)animated</code>方法中：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)hideAnimated:(<span class="built_in">BOOL</span>)animated &#123;</span><br><span class="line">MBMainThreadAssert();</span><br><span class="line">[<span class="keyword">self</span>.graceTimer invalidate];</span><br><span class="line"><span class="keyword">self</span>.useAnimation = animated;</span><br><span class="line"><span class="keyword">self</span>.finished = <span class="literal">YES</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 如果设置了最小显示时间，则执行此步骤，否则直接隐藏</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">self</span>.minShowTime &gt; <span class="number">0.0</span> &amp;&amp; <span class="keyword">self</span>.showStarted) &#123;</span><br><span class="line"><span class="built_in">NSTimeInterval</span> interv = [[<span class="built_in">NSDate</span> date] timeIntervalSinceDate:<span class="keyword">self</span>.showStarted];</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 如果 minShowTime 比较大，则暂时不触发 HUD 的隐藏，而是启动一个 NSTimer</span></span><br><span class="line"><span class="keyword">if</span> (interv &lt; <span class="keyword">self</span>.minShowTime) &#123;</span><br><span class="line"><span class="comment">/// 创建定时器，并把它加入到 NSRunLoop 中</span></span><br><span class="line"><span class="built_in">NSTimer</span> *timer = [<span class="built_in">NSTimer</span> timerWithTimeInterval:(<span class="keyword">self</span>.minShowTime - interv) target:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(handleMinShowTimer:) userInfo:<span class="literal">nil</span> repeats:<span class="literal">NO</span>];</span><br><span class="line">[[<span class="built_in">NSRunLoop</span> currentRunLoop] addTimer:timer forMode:<span class="built_in">NSRunLoopCommonModes</span>];</span><br><span class="line"><span class="keyword">self</span>.minShowTimer = timer;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/// 直接隐藏 HUD</span></span><br><span class="line">[<span class="keyword">self</span> hideUsingAnimation:<span class="keyword">self</span>.useAnimation];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)handleMinShowTimer:(<span class="built_in">NSTimer</span> *)theTimer &#123;</span><br><span class="line">[<span class="keyword">self</span> hideUsingAnimation:<span class="keyword">self</span>.useAnimation];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从上面代码块中可以看出，无论我们有没有设置最小显示时间 <code>self.minShowTime</code>，都会触发 <code>- (void)hideUsingAnimation:(BOOL)animated</code> 这个方法，因此程序最后都会来到 <code>- (void)hideUsingAnimation:(BOOL)animated</code> 这个方法中：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)hideUsingAnimation:(<span class="built_in">BOOL</span>)animated &#123;</span><br><span class="line"><span class="keyword">if</span> (animated &amp;&amp; <span class="keyword">self</span>.showStarted) &#123;</span><br><span class="line"><span class="comment">/// 将 showStarted 设为 nil</span></span><br><span class="line"><span class="keyword">self</span>.showStarted = <span class="literal">nil</span>;</span><br><span class="line">[<span class="keyword">self</span> animateIn:<span class="literal">NO</span> withType:<span class="keyword">self</span>.animationType completion:^(<span class="built_in">BOOL</span> finished) &#123;</span><br><span class="line">[<span class="keyword">self</span> done];</span><br><span class="line">&#125;];</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">self</span>.showStarted = <span class="literal">nil</span>;</span><br><span class="line"><span class="keyword">self</span>.bezelView.alpha = <span class="number">0.</span>f;</span><br><span class="line"><span class="keyword">self</span>.backgroundView.alpha = <span class="number">1.</span>f;</span><br><span class="line">[<span class="keyword">self</span> done];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个方法和 show 系列的 <code>- (void)showUsingAnimation:(BOOL)animated</code> 方法一样，只要设定 animated 的属性为 YES，最终都会走到 <code>- (void)animateIn:(BOOL)animatingIn withType:(MBProgressHUDAnimation)type completion:(void(^)(BOOL finished))completion</code> 这个方法中，同时会执行一个方法：<code>- (void)done</code>，接下来我们来看一下这两个方法：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// animated 为真时调用，消失或出现时的伸缩效果，以及透明度</span></span><br><span class="line">- (<span class="keyword">void</span>)animateIn:(<span class="built_in">BOOL</span>)animatingIn withType:(MBProgressHUDAnimation)type completion:(<span class="keyword">void</span>(^)(<span class="built_in">BOOL</span> finished))completion &#123;</span><br><span class="line"><span class="comment">/// 自动确定正确的缩放动画类型，关于 MBProgressHUDAnimation 的几种类型，上文已全部列出，这里不再详细介绍</span></span><br><span class="line"><span class="keyword">if</span> (type == MBProgressHUDAnimationZoom) &#123;</span><br><span class="line">type = animatingIn ? MBProgressHUDAnimationZoomIn : MBProgressHUDAnimationZoomOut;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// CGAffineTransformMakeScale 中的两个参数，分别代表x和y方向缩放倍数</span></span><br><span class="line"><span class="built_in">CGAffineTransform</span> small = <span class="built_in">CGAffineTransformMakeScale</span>(<span class="number">0.5</span>f, <span class="number">0.5</span>f);</span><br><span class="line"><span class="built_in">CGAffineTransform</span> large = <span class="built_in">CGAffineTransformMakeScale</span>(<span class="number">1.5</span>f, <span class="number">1.5</span>f);</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 设定初始状态</span></span><br><span class="line"><span class="built_in">UIView</span> *bezelView = <span class="keyword">self</span>.bezelView;</span><br><span class="line"><span class="keyword">if</span> (animatingIn &amp;&amp; bezelView.alpha == <span class="number">0.</span>f &amp;&amp; type == MBProgressHUDAnimationZoomIn) &#123;</span><br><span class="line">bezelView.transform = small; <span class="comment">/// 缩放</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (animatingIn &amp;&amp; bezelView.alpha == <span class="number">0.</span>f &amp;&amp; type == MBProgressHUDAnimationZoomOut) &#123;</span><br><span class="line">bezelView.transform = large; <span class="comment">/// 扩大</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 创建动画任务</span></span><br><span class="line">dispatch_block_t animations = ^&#123;</span><br><span class="line"><span class="keyword">if</span> (animatingIn) &#123;</span><br><span class="line">bezelView.transform = <span class="built_in">CGAffineTransformIdentity</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!animatingIn &amp;&amp; type == MBProgressHUDAnimationZoomIn) &#123;</span><br><span class="line">bezelView.transform = large;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!animatingIn &amp;&amp; type == MBProgressHUDAnimationZoomOut) &#123;</span><br><span class="line">bezelView.transform = small;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 方法弃用告警</span></span><br><span class="line"><span class="meta">#pragma clang diagnostic push</span></span><br><span class="line"><span class="meta">#pragma clang diagnostic ignored <span class="meta-string">"-Wdeprecated-declarations"</span></span></span><br><span class="line">bezelView.alpha = animatingIn ? <span class="keyword">self</span>.opacity : <span class="number">0.</span>f;</span><br><span class="line"><span class="meta">#pragma clang diagnostic pop</span></span><br><span class="line"><span class="keyword">self</span>.backgroundView.alpha = animatingIn ? <span class="number">1.</span>f : <span class="number">0.</span>f;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 动画的两种形式，&gt;= iOS7 的是一种形式，iOS7以下是另一种</span></span><br><span class="line"><span class="meta">#if __IPHONE_OS_VERSION_MAX_ALLOWED &gt;= 70000 || TARGET_OS_TV</span></span><br><span class="line"><span class="keyword">if</span> (kCFCoreFoundationVersionNumber &gt;= kCFCoreFoundationVersionNumber_iOS_7_0) &#123;</span><br><span class="line"><span class="comment">/// 只支持 &gt;= iOS7</span></span><br><span class="line">[<span class="built_in">UIView</span> animateWithDuration:<span class="number">0.3</span> delay:<span class="number">0.</span> usingSpringWithDamping:<span class="number">1.</span>f initialSpringVelocity:<span class="number">0.</span>f options:<span class="built_in">UIViewAnimationOptionBeginFromCurrentState</span> animations:animations completion:completion];</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#endif</span></span><br><span class="line">[<span class="built_in">UIView</span> animateWithDuration:<span class="number">0.3</span> delay:<span class="number">0.</span> options:<span class="built_in">UIViewAnimationOptionBeginFromCurrentState</span> animations:animations completion:completion];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)done &#123;</span><br><span class="line"><span class="comment">/// 取消 hideDelayTimer</span></span><br><span class="line">[<span class="keyword">self</span>.hideDelayTimer invalidate];</span><br><span class="line"><span class="comment">/// 隐藏 NSProgress 对象</span></span><br><span class="line">[<span class="keyword">self</span> setNSProgressDisplayLinkEnabled:<span class="literal">NO</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">self</span>.hasFinished) &#123;</span><br><span class="line"><span class="keyword">self</span>.alpha = <span class="number">0.0</span>f;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">self</span>.removeFromSuperViewOnHide) &#123;</span><br><span class="line"><span class="comment">/// 从父视图中移除</span></span><br><span class="line">[<span class="keyword">self</span> removeFromSuperview];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">MBProgressHUDCompletionBlock completionBlock = <span class="keyword">self</span>.completionBlock;</span><br><span class="line"><span class="keyword">if</span> (completionBlock) &#123;</span><br><span class="line">completionBlock();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">id</span>&lt;MBProgressHUDDelegate&gt; delegate = <span class="keyword">self</span>.delegate;</span><br><span class="line"><span class="keyword">if</span> ([delegate respondsToSelector:<span class="keyword">@selector</span>(hudWasHidden:)]) &#123;</span><br><span class="line">[delegate performSelector:<span class="keyword">@selector</span>(hudWasHidden:) withObject:<span class="keyword">self</span>];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>关于 <code>- (void)animateIn:(BOOL)animatingIn withType:(MBProgressHUDAnimation)type completion:(void(^)(BOOL finished))completion</code> 这个方法，只要 <code>animated</code> 的属性为 YES，都会调用；而在<code>- (void)done</code> 这个方法中，如果 removeFromSuperViewOnHide 属性为 YES，则将自己从父视图上移除；如果有 completionBlock 回调函数，则执行回调；如果实现了代理并实现了代理方法，则执行代理方法。而且我们还观察到在 hide 时，也会调用 <code>- (void)setNSProgressDisplayLinkEnabled:(BOOL)enabled</code> 方法，只是在 hide 时 enabled 为 NO。</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)setNSProgressDisplayLinkEnabled:(<span class="built_in">BOOL</span>)enabled &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 这里使用 CADisplayLink，是因为如果使用 KVO 机制会非常消耗主线程（因为 NSProgress 频率非常快）</span></span><br><span class="line"><span class="keyword">if</span> (enabled &amp;&amp; <span class="keyword">self</span>.progressObject) &#123;</span><br><span class="line"><span class="comment">/// 创建 CADisplayLink 对象</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">self</span>.progressObjectDisplayLink) &#123;</span><br><span class="line"><span class="keyword">self</span>.progressObjectDisplayLink = [<span class="built_in">CADisplayLink</span> displayLinkWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(updateProgressFromProgressObject)];</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">self</span>.progressObjectDisplayLink = <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>over</strong></p>
<hr>
<p>以上便是对 MBProgressHUD 源码的一些总结和认识，如果有不足之处，还希望各位道友能多指点哈！</p>
<hr>

      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/04/15/数据结构 -《大话数据结构》读书笔记(2)/" rel="next" title="数据结构 -《大话数据结构》读书笔记(2)">
                <i class="fa fa-chevron-left"></i> 数据结构 -《大话数据结构》读书笔记(2)
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/04/15/iOS开发之源码解析 - Masonry/" rel="prev" title="iOS开发之源码解析 - Masonry">
                iOS开发之源码解析 - Masonry <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">刘朋坤</p>
              <p class="site-description motion-element" itemprop="description">iOS 修炼中...</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives">
                
                    <span class="site-state-item-count">44</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              

              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#一、MBProgressHUD-核心-API"><span class="nav-number">1.</span> <span class="nav-text">一、MBProgressHUD 核心 API</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-模式"><span class="nav-number">1.0.1.</span> <span class="nav-text">1.1 模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-动画效果"><span class="nav-number">1.0.2.</span> <span class="nav-text">1.2 动画效果</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-MBProgressHUD-组成"><span class="nav-number">1.0.3.</span> <span class="nav-text">1.3 MBProgressHUD 组成</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-MBProgressHUD-中的属性"><span class="nav-number">1.0.4.</span> <span class="nav-text">1.4 MBProgressHUD 中的属性</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#1-41-MBProgressHUD-相关属性"><span class="nav-number">1.0.4.0.1.</span> <span class="nav-text">1.41  MBProgressHUD 相关属性</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#1-42-MBRoundProgressView-相关属性"><span class="nav-number">1.0.4.0.2.</span> <span class="nav-text">1.42 MBRoundProgressView 相关属性</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#1-43-MBBarProgressView-相关属性"><span class="nav-number">1.0.4.0.3.</span> <span class="nav-text">1.43 MBBarProgressView 相关属性</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#1-44-MBBackgroundView-相关属性"><span class="nav-number">1.0.4.0.4.</span> <span class="nav-text">1.44 MBBackgroundView 相关属性</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-5-MBProgressHUD-中的一些方法"><span class="nav-number">1.0.5.</span> <span class="nav-text">1.5 MBProgressHUD 中的一些方法</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#1-51-类方法"><span class="nav-number">1.0.5.0.1.</span> <span class="nav-text">1.51 类方法</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#1-52-对象方法"><span class="nav-number">1.0.5.0.2.</span> <span class="nav-text">1.52 对象方法</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#二、show-系列方法"><span class="nav-number">2.</span> <span class="nav-text">二、show 系列方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#三、hide-系列方法"><span class="nav-number">3.</span> <span class="nav-text">三、hide 系列方法</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">刘朋坤</span>

  

  
</div>




  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Muse</a> v6.1.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.1.0"></script>



  



	





  





  










  





  

  

  

  

  
  

  

  

  

  

</body>
</html>
