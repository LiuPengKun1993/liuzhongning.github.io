<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.1.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.1.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.1.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.1.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.1.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.1.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="iOS ä¿®ç‚¼ä¸­...">
<meta property="og:type" content="website">
<meta property="og:title" content="ä»¥æ¢¦ä¸ºé©¬">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="ä»¥æ¢¦ä¸ºé©¬">
<meta property="og:description" content="iOS ä¿®ç‚¼ä¸­...">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ä»¥æ¢¦ä¸ºé©¬">
<meta name="twitter:description" content="iOS ä¿®ç‚¼ä¸­...">






  <link rel="canonical" href="http://yoursite.com/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>ä»¥æ¢¦ä¸ºé©¬</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">ä»¥æ¢¦ä¸ºé©¬</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">è°¨ä»¥æ­¤çºªå¿µå²æœˆ</p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>




<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-ä¸»é¡µ menu-item-active">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />ä¸»é¡µ</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-å½’æ¡£">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />å½’æ¡£</a>
  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/15/iOSå¼€å‘ä¹‹ - AFNetworking - ä¸Šä¼ ã€ä¸‹è½½ã€ç½‘ç»œç›‘å¬/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="åˆ˜æœ‹å¤">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ä»¥æ¢¦ä¸ºé©¬">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/15/iOSå¼€å‘ä¹‹ - AFNetworking - ä¸Šä¼ ã€ä¸‹è½½ã€ç½‘ç»œç›‘å¬/" itemprop="url">
                  iOSå¼€å‘ä¹‹ - AFNetworking - ä¸Šä¼ ã€ä¸‹è½½ã€ç½‘ç»œç›‘å¬
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
                
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-15T12:30:20+08:00">2018-04-15</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>è¿™ä¸€ç¯‡æ˜¯æ¥ç€ä¸Šä¸€ç¯‡æ€»ç»“çš„ï¼Œå¦‚æœæœ‰æœ‹å‹éœ€è¦äº†è§£ç½‘ç»œè¯·æ±‚çš„å†…å®¹ï¼Œå¯ä»¥<a href="http://www.jianshu.com/p/d23f4f913af1" target="_blank" rel="noopener">åˆ°è¿™é‡Œ</a>ã€‚å’Œä¸Šç¯‡ä¸€æ ·ï¼Œå…ˆè¯´ä¸‹è¿™ç¯‡æ–‡ç« çš„å¤§æ¦‚å†…å®¹ï¼Œä»¥ä¾¿æœ‹å‹ä»¬èƒ½å¤Ÿå¿«é€Ÿæ‰¾åˆ°è‡ªå·±éœ€è¦çš„ã€‚è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº† AFNetworking çš„ä¸‰ä¸ªå¾ˆå¹¿æ³›çš„åº”ç”¨ï¼šä¸Šä¼ ã€ä¸‹è½½ä»¥åŠç½‘ç»œç›‘å¬ã€‚å¦‚æœæœ‰æœ‹å‹æƒ³äº†è§£è‹¹æœè‡ªå¸¦çš„ NSURLSession ç›¸å…³çš„ä¸Šä¼ ä¸ä¸‹è½½ï¼Œå¯ä»¥<a href="http://www.jianshu.com/p/be94889824d9" target="_blank" rel="noopener">åˆ°è¿™é‡Œ</a>ã€‚æ¥ä¸‹æ¥æ˜¯ä½¿ç”¨ AFNetworking ä¸Šä¼ ã€ä¸‹è½½ä»¥åŠç½‘ç»œç›‘å¬çš„ demo.</p>
<h2 id="ä¸€ã€ä¸Šä¼ ï¼š"><a href="#ä¸€ã€ä¸Šä¼ ï¼š" class="headerlink" title="ä¸€ã€ä¸Šä¼ ï¼š"></a>ä¸€ã€ä¸Šä¼ ï¼š</h2><p>è¿™é‡Œä»‹ç»äº† AFN çš„ä¸¤ç§ä¸Šä¼ æ–¹å¼ï¼š</p>
<p>1.é€šè¿‡å·¥ç¨‹ä¸­çš„æ–‡ä»¶ä¸Šä¼ <br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºç®¡ç†è€…å¯¹è±¡</span></span><br><span class="line">AFHTTPSessionManager *sessionManager = [AFHTTPSessionManager manager];</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯·æ±‚å‚æ•°</span></span><br><span class="line"><span class="built_in">NSString</span> *urlStr = <span class="string">@" "</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSDictionary</span> *dic = @&#123;<span class="string">@" "</span> : <span class="string">@" "</span>,<span class="string">@" "</span> : <span class="string">@" "</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘é€ post è¯·æ±‚ï¼Œä¸Šä¼ ä¸€å¼ å›¾ç‰‡</span></span><br><span class="line">[sessionManager POST:urlStr parameters:dic constructingBodyWithBlock:^(<span class="keyword">id</span>&lt;AFMultipartFormData&gt;  _Nonnull formData) &#123;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSString</span> *filePath = [[<span class="built_in">NSBundle</span> mainBundle] pathForResource:<span class="string">@"a.jpg"</span> ofType:<span class="literal">nil</span>];</span><br><span class="line"><span class="built_in">NSData</span> *imgData = [<span class="built_in">NSData</span> dataWithContentsOfFile:filePath];</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†å›¾ç‰‡æ•°æ®æ‹¼æ¥ï¼Œè¿›è¡Œä¸Šä¼ </span></span><br><span class="line">[formData appendPartWithFileData:imgData name:<span class="string">@"pic"</span> fileName:<span class="string">@"filename"</span> mimeType:<span class="string">@"image/jpg"</span>];</span><br><span class="line"></span><br><span class="line">&#125; progress:^(<span class="built_in">NSProgress</span> * _Nonnull uploadProgress) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–ä¸Šä¼ çš„è¿›åº¦</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%.2f"</span>,uploadProgress.fractionCompleted);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,[<span class="built_in">NSThread</span> currentThread]); <span class="comment">//å­çº¿ç¨‹</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125; success:^(<span class="built_in">NSURLSessionDataTask</span> * _Nonnull task, <span class="keyword">id</span>  _Nullable responseObject) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯·æ±‚æˆåŠŸ</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"è¯·æ±‚æˆåŠŸï¼š%@"</span>,responseObject);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,[<span class="built_in">NSThread</span> currentThread]); <span class="comment">//ä¸»çº¿ç¨‹</span></span><br><span class="line"></span><br><span class="line">&#125; failure:^(<span class="built_in">NSURLSessionDataTask</span> * _Nullable task, <span class="built_in">NSError</span> * _Nonnull error) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯·æ±‚å¤±è´¥</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"è¯·æ±‚å¤±è´¥ï¼š%@"</span>,error);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure></p>
<p>2.æ ¹æ®URLè·¯å¾„ä¸Šä¼ <br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºç®¡ç†è€…å¯¹è±¡</span></span><br><span class="line">AFHTTPSessionManager *sessionManager = [AFHTTPSessionManager manager];</span><br><span class="line"></span><br><span class="line">[sessionManager <span class="string">POST:</span>@<span class="string">" "</span> <span class="string">parameters:</span>@&#123;@<span class="string">" "</span> : @<span class="string">" "</span>&#125; <span class="string">constructingBodyWithBlock:</span>^(id&lt;AFMultipartFormData&gt; formData) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨blockä¸­è®¾ç½®éœ€è¦ä¸Šä¼ çš„æ–‡ä»¶</span></span><br><span class="line">[formData <span class="string">appendPartWithFileURL:</span>[NSURL <span class="string">fileURLWithPath:</span>@<span class="string">"æ–‡ä»¶è·¯å¾„"</span>] <span class="string">name:</span>@<span class="string">"file"</span> <span class="string">error:</span>nil];</span><br><span class="line"></span><br><span class="line">&#125; <span class="string">success:</span>^(NSURLSessionDataTask *task, id responseObject) &#123;</span><br><span class="line"></span><br><span class="line">NSLog(@<span class="string">"æˆåŠŸï¼š%@"</span>, responseObject);</span><br><span class="line"></span><br><span class="line">&#125; <span class="string">failure:</span>^(NSURLSessionDataTask *task, NSError *error) &#123;</span><br><span class="line">NSLog(@<span class="string">"å¤±è´¥ï¼š%@"</span>, error);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure></p>
<h2 id="äºŒã€ä¸‹è½½"><a href="#äºŒã€ä¸‹è½½" class="headerlink" title="äºŒã€ä¸‹è½½"></a>äºŒã€ä¸‹è½½</h2><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºç®¡ç†è€…å¯¹è±¡</span></span><br><span class="line">AFHTTPSessionManager *manager = [AFHTTPSessionManager manager];</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¡®å®šè¯·æ±‚çš„URLåœ°å€</span></span><br><span class="line"><span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@" "</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºè¯·æ±‚å¯¹è±¡</span></span><br><span class="line"><span class="built_in">NSURLRequest</span> *request = [<span class="built_in">NSURLRequest</span> requestWithURL:url];</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸‹è½½æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">NSURLSessionDownloadTask</span> *task = [manager downloadTaskWithRequest:request progress:^(<span class="built_in">NSProgress</span> * _Nonnull downloadProgress) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// blockä¼šå®æ—¶è°ƒç”¨</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%.2f"</span>,downloadProgress.fractionCompleted);</span><br><span class="line"></span><br><span class="line">&#125; destination:^<span class="built_in">NSURL</span> * _Nonnull(<span class="built_in">NSURL</span> * _Nonnull targetPath, <span class="built_in">NSURLResponse</span> * _Nonnull response) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NSHomeDirectory()å¯ä»¥å¾—åˆ°åº”ç”¨ç¨‹åºç›®å½•çš„è·¯å¾„</span></span><br><span class="line"><span class="comment">// è¿”å›ä¸€ä¸ªURLå­˜å‚¨æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">NSString</span> *filePath = [<span class="built_in">NSHomeDirectory</span>() stringByAppendingPathComponent:<span class="string">@"Documents/***.mp3"</span>];</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> fileURLWithPath:filePath];</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> url;</span><br><span class="line"></span><br><span class="line">&#125; completionHandler:^(<span class="built_in">NSURLResponse</span> * _Nonnull response, <span class="built_in">NSURL</span> * _Nullable filePath, <span class="built_in">NSError</span> * _Nullable error) &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (error) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"ä¸‹è½½å¤±è´¥ ~~~ %@"</span>,error);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"ä¸‹è½½æˆåŠŸ"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼€å§‹ä¸‹è½½ä»»åŠ¡</span></span><br><span class="line">[task resume];</span><br></pre></td></tr></table></figure>
<h2 id="ä¸‰ã€ç½‘ç»œç›‘å¬ï¼ˆç›‘å¬æ‰‹æœºç½‘ç»œçš„ä¸åŒçŠ¶æ€ï¼‰"><a href="#ä¸‰ã€ç½‘ç»œç›‘å¬ï¼ˆç›‘å¬æ‰‹æœºç½‘ç»œçš„ä¸åŒçŠ¶æ€ï¼‰" class="headerlink" title="ä¸‰ã€ç½‘ç»œç›‘å¬ï¼ˆç›‘å¬æ‰‹æœºç½‘ç»œçš„ä¸åŒçŠ¶æ€ï¼‰"></a>ä¸‰ã€ç½‘ç»œç›‘å¬ï¼ˆç›‘å¬æ‰‹æœºç½‘ç»œçš„ä¸åŒçŠ¶æ€ï¼‰</h2><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å¾—ç½‘ç»œç›‘æ§çš„ç®¡ç†è€…</span></span><br><span class="line">AFNetworkReachabilityManager *manager = [AFNetworkReachabilityManager manager];</span><br><span class="line"></span><br><span class="line"><span class="comment">// åªè¦ç½‘ç»œç¯å¢ƒå‘ç”Ÿå˜åŒ–ï¼Œå°±ä¼šè°ƒç”¨æ­¤ block</span></span><br><span class="line">[manager <span class="string">setReachabilityStatusChangeBlock:</span>^(AFNetworkReachabilityStatus status) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* æšä¸¾é‡Œé¢çš„å››ä¸ªçŠ¶æ€</span></span><br><span class="line"><span class="comment">AFNetworkReachabilityStatusUnknown          = -1,  æœªçŸ¥</span></span><br><span class="line"><span class="comment">AFNetworkReachabilityStatusNotReachable     = 0,   ä¸å¯ç”¨</span></span><br><span class="line"><span class="comment">AFNetworkReachabilityStatusReachableViaWWAN = 1,   æ‰‹æœºè‡ªå¸¦ç½‘ç»œ</span></span><br><span class="line"><span class="comment">AFNetworkReachabilityStatusReachableViaWiFi = 2,   wifi</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> (status) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">AFNetworkReachabilityStatusUnknown:</span></span><br><span class="line">NSLog(@<span class="string">"æœªçŸ¥"</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="string">AFNetworkReachabilityStatusNotReachable:</span></span><br><span class="line">NSLog(@<span class="string">"ä¸å¯ç”¨"</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="string">AFNetworkReachabilityStatusReachableViaWWAN:</span></span><br><span class="line">NSLog(@<span class="string">"æ‰‹æœºè‡ªå¸¦ç½‘ç»œ"</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="string">AFNetworkReachabilityStatusReachableViaWiFi:</span></span><br><span class="line">NSLog(@<span class="string">"Wifi"</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="string">default:</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼€å§‹ç›‘å¬</span></span><br><span class="line">[manager startMonitoring];</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯ä»Šå¤©åšçš„ä¸€äº›å…³äº AFNetworking çš„æ€»ç»“ï¼Œå¦‚æœæœ‰é”™è¯¯æˆ–ç–å¿½çš„åœ°æ–¹ï¼Œå¸Œæœ›å¤§å®¶èƒ½å¤ŸæŒ‡å‡ºï¼è°¢è°¢å¤§å®¶ï¼ï¼ï¼</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/15/iOSå¼€å‘ä¹‹ - AFNetworking - ç½‘ç»œè¯·æ±‚/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="åˆ˜æœ‹å¤">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ä»¥æ¢¦ä¸ºé©¬">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/15/iOSå¼€å‘ä¹‹ - AFNetworking - ç½‘ç»œè¯·æ±‚/" itemprop="url">
                  iOSå¼€å‘ä¹‹ - AFNetworking - ç½‘ç»œè¯·æ±‚
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
                
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-15T12:30:20+08:00">2018-04-15</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>æœ€è¿‘ä¸€ç›´å¾ˆå¿™ä¹Ÿæ²¡æœ‰æ—¶é—´å†™åšå®¢ï¼Œä»Šå¤©æ­£å¥½æœ‰ç‚¹ç©ºé—²æ—¶é—´ï¼Œæ‰€ä»¥å°±å¯¹ <a href="https://github.com/AFNetworking/AFNetworking/" target="_blank" rel="noopener">AFNetworking</a> åšäº†ä¸€äº›ç®€å•çš„æ€»ç»“ï¼Œç‰¹åœ°è®°å½•ä¸‹æ¥ï¼Œä»¥ä¾¿é‡åˆ°çš„æœ‹å‹ä»¬çœ‹çœ‹ï¼ï¼ï¼</p>
</blockquote>
<p>å…ˆè¯´ä¸‹è¿™ç¯‡æ–‡ç« çš„å¤§æ¦‚å†…å®¹ï¼Œä»¥ä¾¿æœ‹å‹ä»¬èƒ½å¤Ÿå¿«é€Ÿæ‰¾åˆ°è‡ªå·±éœ€è¦çš„ã€‚è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†ä¸‰ç§ç½‘ç»œè¯·æ±‚çš„æ¸ é“ï¼Œç¬¬ä¸€ç§æ˜¯é€šè¿‡è‹¹æœè‡ªå¸¦çš„ NSURLSession è¯·æ±‚ç½‘ç»œï¼›ç¬¬äºŒç§æ˜¯é€šè¿‡ AFNetworking2.x è¯·æ±‚ç½‘ç»œï¼›æœ€åä¸€ç§æ˜¯é€šè¿‡ AFNetworking3.0 è¯·æ±‚ç½‘ç»œã€‚ä¸‹è¾¹æ˜¯è¿™ä¸‰ç§ç½‘ç»œè¯·æ±‚æ¸ é“çš„ demo.</p>
<h2 id="ä¸€ã€è‹¹æœè‡ªå¸¦çš„è¯·æ±‚ç½‘ç»œæ–¹æ³•ï¼š"><a href="#ä¸€ã€è‹¹æœè‡ªå¸¦çš„è¯·æ±‚ç½‘ç»œæ–¹æ³•ï¼š" class="headerlink" title="ä¸€ã€è‹¹æœè‡ªå¸¦çš„è¯·æ±‚ç½‘ç»œæ–¹æ³•ï¼š"></a>ä¸€ã€è‹¹æœè‡ªå¸¦çš„è¯·æ±‚ç½‘ç»œæ–¹æ³•ï¼š</h2><p>è¿™é‡Œä»‹ç»äº†ä¸‰ç§ï¼ŒGET è¯·æ±‚ã€POST è¯·æ±‚ã€ä»£ç†æ–¹å¼è¯·æ±‚ã€‚</p>
<p>1.GET è¯·æ±‚:<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å¾— NSURLSession å¯¹è±¡</span></span><br><span class="line"><span class="built_in">NSURLSession</span> *session =  [<span class="built_in">NSURLSession</span> sessionWithConfiguration:[<span class="built_in">NSURLSessionConfiguration</span> defaultSessionConfiguration] delegate:<span class="literal">nil</span> delegateQueue:[<span class="built_in">NSOperationQueue</span> mainQueue]];</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºä»»åŠ¡</span></span><br><span class="line"><span class="built_in">NSURLSessionDataTask</span> *dataTask = [session dataTaskWithRequest:[<span class="built_in">NSURLRequest</span> requestWithURL:[<span class="built_in">NSURL</span> URLWithString:<span class="string">@" "</span>]] completionHandler:^(<span class="built_in">NSData</span> * _Nullable data, <span class="built_in">NSURLResponse</span> * _Nullable response, <span class="built_in">NSError</span> * _Nullable error) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"data ~~~ %@ ~~~ response ~~~ %@ ~~~ error~~~ %@"</span>, data, response , error);</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯åŠ¨ä»»åŠ¡</span></span><br><span class="line">[dataTask resume];</span><br></pre></td></tr></table></figure></p>
<p>2.POST è¯·æ±‚:<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å¾—NSURLSessionå¯¹è±¡</span></span><br><span class="line"><span class="built_in">NSURLSession</span> *session = [<span class="built_in">NSURLSession</span> sharedSession];</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºè¯·æ±‚</span></span><br><span class="line"><span class="built_in">NSMutableURLRequest</span> *request = [<span class="built_in">NSMutableURLRequest</span> requestWithURL:[<span class="built_in">NSURL</span> URLWithString:<span class="string">@" "</span>]];</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®è¯·æ±‚æ–¹æ³•</span></span><br><span class="line">request.HTTPMethod = <span class="string">@"POST"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®è¯·æ±‚ä½“</span></span><br><span class="line">request.HTTPBody = [<span class="string">@" "</span> dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºä»»åŠ¡</span></span><br><span class="line"><span class="built_in">NSURLSessionDataTask</span> *task = [session dataTaskWithRequest:request completionHandler:^(<span class="built_in">NSData</span> *data, <span class="built_in">NSURLResponse</span> *response, <span class="built_in">NSError</span> *error) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"data ~~~ %@ ~~~ response ~~~ %@ ~~~ error~~~ %@"</span>, data, response , error);</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯åŠ¨ä»»åŠ¡</span></span><br><span class="line">[task resume];</span><br></pre></td></tr></table></figure></p>
<p>3.ä»£ç†:NSURLSessionDataDelegate<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">[<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSMutableURLRequest</span> *request = [<span class="built_in">NSMutableURLRequest</span> requestWithURL:[<span class="built_in">NSURL</span> URLWithString:<span class="string">@" "</span>]];</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSURLSession</span> *session = [<span class="built_in">NSURLSession</span> sessionWithConfiguration:[<span class="built_in">NSURLSessionConfiguration</span> defaultSessionConfiguration] delegate:<span class="keyword">self</span> delegateQueue:[<span class="built_in">NSOperationQueue</span> mainQueue]];</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœåˆ›å»ºtaskæ—¶ï¼Œæœ‰blockï¼Œä»£ç†ä¼šå¤±æ•ˆ</span></span><br><span class="line"><span class="built_in">NSURLSessionDataTask</span> *task = [session dataTaskWithRequest:request];</span><br><span class="line"></span><br><span class="line">[task resume];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - NSURLSessionDataDelegate</span></span><br><span class="line"><span class="meta">#pragma mark - æ¥æ”¶åˆ°å“åº”å¤´è°ƒç”¨çš„åè®®æ–¹æ³•</span></span><br><span class="line">- (<span class="keyword">void</span>)URLSession:(<span class="built_in">NSURLSession</span> *)session dataTask:(<span class="built_in">NSURLSessionDataTask</span> *)dataTask</span><br><span class="line">didReceiveResponse:(<span class="built_in">NSURLResponse</span> *)response</span><br><span class="line">completionHandler:(<span class="keyword">void</span> (^)(<span class="built_in">NSURLSessionResponseDisposition</span> disposition))completionHandler &#123;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSHTTPURLResponse</span> *httpRes = (<span class="built_in">NSHTTPURLResponse</span> *)response;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,httpRes.allHeaderFields);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é€šè¿‡è®¾ç½® completionHandler, Block å¯ä»¥è®¾ç½®åé¢çš„å“åº”ä½“ä¸­çš„æ•°æ®æ˜¯å¦ç»§ç»­å‘é€,é»˜è®¤æ˜¯ä¸å‘é€</span></span><br><span class="line">completionHandler(<span class="built_in">NSURLSessionResponseAllow</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - æ•°æ®è¯·æ±‚å®Œæˆåï¼Œè°ƒç”¨çš„åè®®æ–¹æ³•ï¼Œdataæ˜¯å“åº”ä½“ä¸­çš„æ•°æ®</span></span><br><span class="line">- (<span class="keyword">void</span>)URLSession:(<span class="built_in">NSURLSession</span> *)session dataTask:(<span class="built_in">NSURLSessionDataTask</span> *)dataTask</span><br><span class="line">didReceiveData:(<span class="built_in">NSData</span> *)data &#123;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - ä¸ç®¡è¯·æ±‚æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œæœ€ç»ˆéƒ½ä¼šè°ƒç”¨æ­¤æ–¹æ³•</span></span><br><span class="line">- (<span class="keyword">void</span>)URLSession:(<span class="built_in">NSURLSession</span> *)session task:(<span class="built_in">NSURLSessionTask</span> *)task didCompleteWithError:(<span class="built_in">NSError</span> *)error &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (error) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"è¯·æ±‚å¤±è´¥"</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"è¯·æ±‚æˆåŠŸ"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="äºŒã€AFNetworking2-x"><a href="#äºŒã€AFNetworking2-x" class="headerlink" title="äºŒã€AFNetworking2.x"></a>äºŒã€AFNetworking2.x</h2><p>1.GET è¯·æ±‚<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">AFHTTPRequestOperationManager *operationManager = [AFHTTPRequestOperationManager manager];</span><br><span class="line"></span><br><span class="line">[operationManager GET:<span class="string">@" "</span> parameters:<span class="literal">nil</span></span><br><span class="line">success:^(AFHTTPRequestOperation *operation, <span class="keyword">id</span> responseObject) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"è¯·æ±‚æˆåŠŸ"</span>);</span><br><span class="line">&#125; failure:^(AFHTTPRequestOperation *operation, <span class="built_in">NSError</span> *error) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"è¯·æ±‚å¤±è´¥"</span>);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure></p>
<p>2.POST è¯·æ±‚</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">AFHTTPRequestOperationManager *operationManager = [AFHTTPRequestOperationManager manager];</span><br><span class="line"></span><br><span class="line">[operationManager POST:<span class="string">@" "</span> parameters:<span class="literal">nil</span></span><br><span class="line">success:^(AFHTTPRequestOperation *operation, <span class="keyword">id</span> responseObject) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"è¯·æ±‚æˆåŠŸ"</span>);</span><br><span class="line">&#125; failure:^(AFHTTPRequestOperation *operation, <span class="built_in">NSError</span> *error) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"è¯·æ±‚å¤±è´¥"</span>);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<h2 id="ä¸‰ã€AFNetworking3-0"><a href="#ä¸‰ã€AFNetworking3-0" class="headerlink" title="ä¸‰ã€AFNetworking3.0"></a>ä¸‰ã€AFNetworking3.0</h2><p>1.GET è¯·æ±‚</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">AFHTTPSessionManager *sessionManager = [AFHTTPSessionManager manager];</span><br><span class="line"></span><br><span class="line"><span class="comment">// è§£ææœåŠ¡å™¨è¿”å›çš„JSONæ•°æ®</span></span><br><span class="line"><span class="comment">//        [AFJSONResponseSerializer serializer];</span></span><br><span class="line"><span class="comment">// è§£ææœåŠ¡å™¨è¿”å›çš„XMLæ•°æ®</span></span><br><span class="line"><span class="comment">//        [AFXMLParserResponseSerializer serializer];</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å‚æ•°1: è¯·æ±‚çš„ç½‘å€</span></span><br><span class="line"><span class="comment">// å‚æ•°2: å‚æ•°</span></span><br><span class="line"><span class="comment">// å‚æ•°3: å½“å‰çš„è¿›åº¦</span></span><br><span class="line"><span class="comment">// å‚æ•°4: è¯·æ±‚æˆåŠŸ</span></span><br><span class="line"><span class="comment">// å‚æ•°5: è¯·æ±‚å¤±è´¥</span></span><br><span class="line">[sessionManager GET:<span class="string">@" "</span> parameters:<span class="literal">nil</span> progress:^(<span class="built_in">NSProgress</span> * _Nonnull downloadProgress) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"è¿›åº¦"</span>);</span><br><span class="line">&#125; success:^(<span class="built_in">NSURLSessionDataTask</span> * _Nonnull task, <span class="keyword">id</span>  _Nullable responseObject) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"è¯·æ±‚æˆåŠŸ"</span>);</span><br><span class="line">&#125; failure:^(<span class="built_in">NSURLSessionDataTask</span> * _Nullable task, <span class="built_in">NSError</span> * _Nonnull error) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"è¯·æ±‚å¤±è´¥"</span>);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<p>2.POST è¯·æ±‚<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºç®¡ç†è€…å¯¹è±¡</span></span><br><span class="line">AFHTTPSessionManager *sessionManager = [AFHTTPSessionManager manager];</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®è¯·æ±‚å‚æ•°</span></span><br><span class="line"><span class="built_in">NSString</span> *urlStr = <span class="string">@" "</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éœ€è¦è®¾ç½® body ä½“</span></span><br><span class="line"><span class="built_in">NSDictionary</span> *dic = @&#123;<span class="string">@" "</span> : <span class="string">@" "</span>,<span class="string">@" "</span> : <span class="string">@" "</span>&#125;;</span><br><span class="line"></span><br><span class="line">[sessionManager POST:urlStr parameters:dic progress:^(<span class="built_in">NSProgress</span> * _Nonnull downloadProgress) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"è¿›åº¦"</span>);</span><br><span class="line">&#125; success:^(<span class="built_in">NSURLSessionDataTask</span> * _Nonnull task, <span class="keyword">id</span>  _Nullable responseObject) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"è¯·æ±‚æˆåŠŸ"</span>);</span><br><span class="line">&#125; failure:^(<span class="built_in">NSURLSessionDataTask</span> * _Nullable task, <span class="built_in">NSError</span> * _Nonnull error) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"è¯·æ±‚å¤±è´¥"</span>);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure></p>
<p>ä¸Šé¢çš„ä¸€äº›ä»£ç éƒ½æ˜¯åŸºç¡€æ€§ä»£ç ï¼Œå› æ­¤ä¹Ÿæ²¡æ€ä¹ˆåšæ³¨é‡Šï¼Œå¦‚æœæœ‰ç–‘é—®çš„è¯å¯ä»¥ç§ä¿¡äº¤æµâ€¦å¦å¤–ä»£ç æœ‰ä»€ä¹ˆé—®é¢˜çš„è¯ä¹Ÿå¸Œæœ›å¤§å®¶èƒ½å¤ŸæŒ‡å‡ºï¼è°¢è°¢å¤§å®¶ï¼</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/15/iOSå¼€å‘ä¹‹ - MD5åŠ å¯†/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="åˆ˜æœ‹å¤">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ä»¥æ¢¦ä¸ºé©¬">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/15/iOSå¼€å‘ä¹‹ - MD5åŠ å¯†/" itemprop="url">
                  iOSå¼€å‘ä¹‹ - MD5åŠ å¯†
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
                
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-15T12:30:20+08:00">2018-04-15</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>MD5ï¼ˆæ¶ˆæ¯æ‘˜è¦ç®—æ³•ç¬¬äº”ç‰ˆï¼‰æ˜¯è®¡ç®—æœºå®‰å…¨é¢†åŸŸå¹¿æ³›ä½¿ç”¨çš„ä¸€ç§æ•£åˆ—å‡½æ•°ï¼Œç”¨ä»¥æä¾›æ¶ˆæ¯çš„å®Œæ•´æ€§ä¿æŠ¤ã€‚</p>
</blockquote>
<ul>
<li><p>MD5ç‰¹ç‚¹ï¼š<br>1ã€å‹ç¼©æ€§ï¼šä»»æ„é•¿åº¦çš„æ•°æ®ï¼Œç®—å‡ºçš„MD5å€¼é•¿åº¦éƒ½æ˜¯å›ºå®šçš„ã€‚<br>2ã€å®¹æ˜“è®¡ç®—ï¼šä»åŸæ•°æ®è®¡ç®—å‡ºMD5å€¼å¾ˆå®¹æ˜“ã€‚<br>3ã€æŠ—ä¿®æ”¹æ€§ï¼šå¯¹åŸæ•°æ®è¿›è¡Œä»»ä½•æ”¹åŠ¨ï¼Œå“ªæ€•åªä¿®æ”¹1ä¸ªå­—èŠ‚ï¼Œæ‰€å¾—åˆ°çš„MD5å€¼éƒ½æœ‰å¾ˆå¤§åŒºåˆ«ã€‚<br>4ã€å¼ºæŠ—ç¢°æ’ï¼šå·²çŸ¥åŸæ•°æ®å’Œå…¶MD5å€¼ï¼Œæƒ³æ‰¾åˆ°ä¸€ä¸ªå…·æœ‰ç›¸åŒMD5å€¼çš„æ•°æ®ï¼ˆå³ä¼ªé€ æ•°æ®ï¼‰æ˜¯éå¸¸å›°éš¾çš„ã€‚</p>
</li>
<li><p>äº‹å…ˆä»‹ç»ä¸€ä¸ªæ¦‚å¿µï¼Œå› ä¸ºä¸‹è¾¹æœ‰ç”¨åˆ°ğŸ‘‡<br>åŠ ç›ï¼šæ‰€è°“åŠ ç›ï¼Œ å°±æ˜¯åœ¨åŸæœ¬éœ€è¦åŠ å¯†çš„ä¿¡æ¯åŸºç¡€ä¸Šï¼Œç³…å…¥å…¶å®ƒå†…å®¹saltã€‚</p>
</li>
<li><p>æ¥ä¸‹æ¥æ˜¯ä¸€äº›ä»£ç çš„å®ç°ï¼Œæ–¹ä¾¿èµ·è§ï¼Œè¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªåˆ†ç±»NSString+MD5ã€‚</p>
</li>
</ul>
<p>åˆ†ç±» NSString+MD5.h ä¸­çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NSString</span> (<span class="title">MD5</span>)</span></span><br><span class="line"><span class="comment">/** ç›´æ¥åŠ å¯† */</span></span><br><span class="line">- (<span class="built_in">NSString</span> *)MD5_32BIT;</span><br><span class="line"><span class="comment">/** åŠ ç› */</span></span><br><span class="line">- (<span class="built_in">NSString</span> *)MD5_saltStr:(<span class="built_in">NSString</span> *)saltStr;</span><br><span class="line"><span class="comment">/** å¤šæ¬¡åŠ å¯† */</span></span><br><span class="line">- (<span class="built_in">NSString</span> *)MD5_againStr:(<span class="built_in">NSString</span> *)againStr;</span><br><span class="line"><span class="comment">/** ä¹±åºåŠ å¯† */</span></span><br><span class="line">- (<span class="built_in">NSString</span> *)MD5_Chaos:(<span class="built_in">NSString</span> *)chaosStr;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæ˜¯åˆ†ç±» NSString+MD5.m ä¸­çš„ä»£ç ï¼Œéœ€è¦å¯¼å…¥å¤´æ–‡ä»¶ #import &lt;CommonCrypto/CommonDigest.h&gt;ï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"NSString+MD5.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;CommonCrypto/CommonDigest.h&gt;</span></span></span><br><span class="line"><span class="meta">#define salt @<span class="meta-string">"qwertyuiop"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">NSString</span> (<span class="title">MD5</span>)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›´æ¥åŠ å¯†</span></span><br><span class="line">- (<span class="built_in">NSString</span> *)MD5_32BIT &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *cStr = [<span class="keyword">self</span> UTF8String];</span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> digest[CC_MD5_DIGEST_LENGTH];</span><br><span class="line"></span><br><span class="line">CC_MD5( cStr, (CC_LONG)<span class="keyword">self</span>.length, digest );</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSMutableString</span> *result = [<span class="built_in">NSMutableString</span> stringWithCapacity:CC_MD5_DIGEST_LENGTH * <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; CC_MD5_DIGEST_LENGTH; i++)</span><br><span class="line">[result appendFormat:<span class="string">@"%02X"</span>, digest[i]];</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŠ ç›</span></span><br><span class="line">- (<span class="built_in">NSString</span> *)MD5_saltStr:(<span class="built_in">NSString</span> *)saltStr &#123;</span><br><span class="line"></span><br><span class="line">saltStr = [saltStr stringByAppendingString:salt];</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSString</span> *result =[saltStr MD5_32BIT];</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤šæ¬¡åŠ å¯†</span></span><br><span class="line">- (<span class="built_in">NSString</span> *)MD5_againStr:(<span class="built_in">NSString</span> *)againStr &#123;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSString</span> *result = [againStr MD5_32BIT];</span><br><span class="line"></span><br><span class="line">result = [result MD5_32BIT];</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¹±åºåŠ å¯†</span></span><br><span class="line">- (<span class="built_in">NSString</span> *)MD5_Chaos:(<span class="built_in">NSString</span> *)chaosStr &#123;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSString</span> *result =[chaosStr MD5_32BIT];</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSString</span> *header =[result substringFromIndex:<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSString</span> *footer=[result substringFromIndex:<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">result =[footer stringByAppendingString:header];</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>æ¥ç€åœ¨æ§åˆ¶å™¨ä¸­è°ƒç”¨ï¼š<br><figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#<span class="keyword">import</span> <span class="string">"ViewController.h"</span></span><br><span class="line">#<span class="keyword">import</span> <span class="string">"NSString+MD5.h"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@implementation</span> ViewController</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">[<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"></span><br><span class="line">NSString *<span class="built_in">string</span> = @<span class="string">"10.24"</span>;</span><br><span class="line"><span class="comment">// è°ƒç”¨ MD5 åŠ å¯†å¹¶æ‰“å°ç»“æœ</span></span><br><span class="line">NSLog(@<span class="string">"MD5Result = %@"</span>, [<span class="built_in">string</span> MD5_32BIT]);</span><br><span class="line">NSLog(@<span class="string">"MD5_saltResult = %@"</span>, [<span class="built_in">string</span> MD5_saltStr:<span class="built_in">string</span>]);</span><br><span class="line">NSLog(@<span class="string">"MD5_againResult = %@"</span>, [<span class="built_in">string</span> MD5_againStr:<span class="built_in">string</span>]);</span><br><span class="line">NSLog(@<span class="string">"chaosResult = %@"</span>, [<span class="built_in">string</span> MD5_Chaos:<span class="built_in">string</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œæ˜¯æ‰“å°ç»“æœï¼š<br><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2016-10-26</span> <span class="number">08</span>:<span class="number">15:49.616</span> md<span class="number">5[92278</span>:<span class="number">6185546</span>] MD5Result = F7F942B87C2D0B62FC27AD465CF0D05B</span><br><span class="line"><span class="number">2016-10-26</span> <span class="number">08</span>:<span class="number">15:49.616</span> md<span class="number">5[92278</span>:<span class="number">6185546</span>] MD5_saltResult = <span class="number">1</span>C2140C07ADD1E334896D499E8C4968C</span><br><span class="line"><span class="number">2016-10-26</span> <span class="number">08</span>:<span class="number">15:49.617</span> md<span class="number">5[92278</span>:<span class="number">6185546</span>] MD5_againResult = <span class="number">01</span>AE5309B5A8E672AE4D427FE987E06A</span><br><span class="line"><span class="number">2016-10-26</span> <span class="number">08</span>:<span class="number">15:49.617</span> md<span class="number">5[92278</span>:<span class="number">6185546</span>] chaosResult = F942B87C2D0B62FC27AD465CF0D05BF942B87C2D0B62FC27AD465CF0D05B</span><br></pre></td></tr></table></figure></p>
<hr>
<p>æ€»ç»“ï¼šå¤§å®¶åº”è¯¥éƒ½çŸ¥é“æœ‰ä¸€ä¸ªMD5ç ´è§£ç½‘ç«™ï¼Œåå­—å«åš <a href="http://www.cmd5.com" target="_blank" rel="noopener">md5åœ¨çº¿è§£å¯†åŠ å¯†</a>ï¼Œå› æ­¤æˆ‘ä»¬åœ¨ä½¿ç”¨MD5åŠ å¯†çš„æ—¶å€™ï¼Œæœ€å¥½ä½¿ç”¨å¤šæ¬¡åŠ å¯†ï¼ŒåŠ ç›ï¼Œä¹±åºåŠ å¯†ç­‰ï¼Œä¸ç„¶ä¼šå¾ˆå®¹æ˜“è¢«ç ´è§£ã€‚è‡³äºå…¶å®ƒåŠ å¯†ï¼Œç­‰ä»¥åç”¨åˆ°äº†ä¼šç»§ç»­æ•´ç†å‡ºæ¥ï¼Œå¦‚æœæ–‡ç« æœ‰ä»€ä¹ˆä¸è¶³ä¹‹å¤„ï¼Œè¿˜è¯·æœ‹å‹ä»¬èƒ½è¿‡æŒ‡å‡ºæ¥ï¼Œè°¢è°¢å¤§å®¶ï¼</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/15/iOSå¼€å‘ä¹‹ - Runtime/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="åˆ˜æœ‹å¤">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ä»¥æ¢¦ä¸ºé©¬">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/15/iOSå¼€å‘ä¹‹ - Runtime/" itemprop="url">
                  iOSå¼€å‘ä¹‹ - Runtime
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
                
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-15T12:30:20+08:00">2018-04-15</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="http://upload-images.jianshu.io/upload_images/2665449-59759f8fb21bb6a9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="iOSå¼€å‘ä¹‹ - Runtime"></p>
<blockquote>
<p>æƒ³æ€»ç»“ Runtime ä¸æ˜¯ä¸€å¤©ä¸¤å¤©äº†ï¼Œå‰å‡ å¤©åˆ©ç”¨ç©ºé—²æ—¶é—´å·²ç»æ‰“å¥½æ–‡ç¨¿ï¼Œä½†è§‰å¾—è¿˜æœ‰éœ€è¦æ”¹è¿›çš„åœ°æ–¹ï¼Œç°åœ¨å·²ç»æ”¹è¿‡æ¥äº†ï¼Œè¿™é‡Œè´´å‡ºæ¥ä¸å¤§å®¶åˆ†äº«ä¸‹ï¼ˆå¦‚æœè¿˜æœ‰ä»€ä¹ˆå°é—®é¢˜ï¼Œè¿˜æœ›å„ä½æœ‹å‹æŒ‡å‡ºæ¥å“ˆï¼‰! ä¸‹é¢æˆ‘ä»¬å°±å¼€å§‹è¿›å…¥è¿è¡Œæ—¶ Runtime çš„ä¸–ç•Œå§ï¼</p>
</blockquote>
<h2 id="ä¸€ã€Runtimeç®€ä»‹"><a href="#ä¸€ã€Runtimeç®€ä»‹" class="headerlink" title="ä¸€ã€Runtimeç®€ä»‹"></a>ä¸€ã€Runtimeç®€ä»‹</h2><p>Runtimeç®€ç§°è¿è¡Œæ—¶ï¼Œæ˜¯ç³»ç»Ÿåœ¨è¿è¡Œçš„æ—¶å€™çš„ä¸€äº›æœºåˆ¶ï¼Œå…¶ä¸­æœ€ä¸»è¦çš„æ˜¯æ¶ˆæ¯æœºåˆ¶ã€‚å®ƒæ˜¯ä¸€å¥—æ¯”è¾ƒåº•å±‚çš„çº¯ C è¯­è¨€ API, å±äºä¸€ä¸ª C è¯­è¨€åº“ï¼ŒåŒ…å«äº†å¾ˆå¤šåº•å±‚çš„ C è¯­è¨€ APIã€‚æˆ‘ä»¬å¹³æ—¶ç¼–å†™çš„ OC ä»£ç ï¼Œåœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹æ—¶ï¼Œå…¶å®æœ€ç»ˆéƒ½æ˜¯è½¬æˆäº† Runtime çš„ C è¯­è¨€ä»£ç ã€‚å¦‚ä¸‹æ‰€ç¤º:</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// OCä»£ç :</span></span><br><span class="line"><span class="selector-attr">[Person coding]</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿è¡Œæ—¶ runtime ä¼šå°†å®ƒè½¬åŒ–æˆ C è¯­è¨€çš„ä»£ç :</span></span><br><span class="line"><span class="selector-tag">objc_msgSend</span>(Person, <span class="variable">@selector</span>(coding));</span><br></pre></td></tr></table></figure>
<h2 id="äºŒã€ç›¸å…³å‡½æ•°"><a href="#äºŒã€ç›¸å…³å‡½æ•°" class="headerlink" title="äºŒã€ç›¸å…³å‡½æ•°"></a>äºŒã€ç›¸å…³å‡½æ•°</h2><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// éå†æŸä¸ªç±»æ‰€æœ‰çš„æˆå‘˜å˜é‡</span></span><br><span class="line"><span class="keyword">class</span><span class="number">_</span>copyIvarList</span><br><span class="line"></span><br><span class="line"><span class="comment">// éå†æŸä¸ªç±»æ‰€æœ‰çš„æ–¹æ³•</span></span><br><span class="line"><span class="keyword">class</span><span class="number">_</span>copyMethodList</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–æŒ‡å®šåç§°çš„æˆå‘˜å˜é‡</span></span><br><span class="line"><span class="keyword">class</span><span class="number">_</span>getInstanceVariable</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–æˆå‘˜å˜é‡å</span></span><br><span class="line">ivar<span class="number">_</span>getName</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–æˆå‘˜å˜é‡ç±»å‹ç¼–ç </span></span><br><span class="line">ivar<span class="number">_</span>getTypeEncoding</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–æŸä¸ªå¯¹è±¡æˆå‘˜å˜é‡çš„å€¼</span></span><br><span class="line"><span class="keyword">object</span><span class="number">_</span>getIvar</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®æŸä¸ªå¯¹è±¡æˆå‘˜å˜é‡çš„å€¼</span></span><br><span class="line"><span class="keyword">object</span><span class="number">_</span>setIvar</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»™å¯¹è±¡å‘é€æ¶ˆæ¯</span></span><br><span class="line">objc<span class="number">_m</span>sgSend</span><br></pre></td></tr></table></figure>
<h2 id="ä¸‰ã€ç›¸å…³åº”ç”¨"><a href="#ä¸‰ã€ç›¸å…³åº”ç”¨" class="headerlink" title="ä¸‰ã€ç›¸å…³åº”ç”¨"></a>ä¸‰ã€ç›¸å…³åº”ç”¨</h2><ul>
<li>1.åˆ©ç”¨Runtimeéå†æ¨¡å‹å¯¹è±¡çš„æ‰€æœ‰å±æ€§</li>
<li>2.å½’æ¡£ä¸è§£æ¡£</li>
<li>3.å­—å…¸æ¨¡å‹äº’è½¬(åˆ©ç”¨ Runtime éå†æ¨¡å‹å¯¹è±¡çš„æ‰€æœ‰å±æ€§, æ ¹æ®å±æ€§åä»å­—å…¸ä¸­å–å‡ºå¯¹çš„å€¼,è®¾ç½®åˆ°æ¨¡å‹çš„å±æ€§ä¸Š)</li>
<li>4.åŠ¨æ€æ·»åŠ /ä¿®æ”¹å±æ€§ã€åŠ¨æ€æ·»åŠ /ä¿®æ”¹/æ›¿æ¢æ–¹æ³•(ä¿®æ”¹Personçš„èº«é«˜ä½“é‡ç­‰ï¼›æ›¿æ¢ coding æ–¹æ³•ä¸º eating ç­‰)</li>
</ul>
<h2 id="å››ã€æ¼”ç¤ºä»£ç "><a href="#å››ã€æ¼”ç¤ºä»£ç " class="headerlink" title="å››ã€æ¼”ç¤ºä»£ç "></a>å››ã€æ¼”ç¤ºä»£ç </h2><h3 id="æ¼”ç¤ºä»£ç ä¸€ï¼šéå†å¯¹è±¡çš„å±æ€§"><a href="#æ¼”ç¤ºä»£ç ä¸€ï¼šéå†å¯¹è±¡çš„å±æ€§" class="headerlink" title="æ¼”ç¤ºä»£ç ä¸€ï¼šéå†å¯¹è±¡çš„å±æ€§"></a>æ¼”ç¤ºä»£ç ä¸€ï¼šéå†å¯¹è±¡çš„å±æ€§</h3><p>æ–°å»ºä¸€ä¸ªPersonç±»ï¼Œç»§æ‰¿è‡ªNSObjectï¼Œåœ¨.hæ–‡ä»¶ä¸­è®¾ç½®å®ƒçš„å±æ€§å¦‚ä¸‹</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NNPerson</span> : <span class="title">NSObject</span> </span>&#123;</span><br><span class="line"><span class="built_in">NSString</span> * _str1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> <span class="built_in">NSString</span> * str2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *str3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSDictionary</span> * dict;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSArray</span> *ary;</span><br></pre></td></tr></table></figure>
<p>åœ¨ ViewController ä¸­è·å–å®ƒçš„å±æ€§ï¼Œä»£ç å¦‚ä¸‹</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;objc/runtime.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"NNPerson.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">[<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å– NNModel ä¸­æ‰€æœ‰çš„å˜é‡å¹¶ä¸”è¾“å‡ºå˜é‡ååŠç±»å‹</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">Ivar * ivars = class_copyIvarList([NNPerson <span class="keyword">class</span>], &amp;count);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">unsigned</span> <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i ++) &#123;</span><br><span class="line">Ivar ivar = ivars[i];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"ç±»å‹: %s -åå­—: %s "</span>, ivar_getTypeEncoding(ivar), ivar_getName(ivar));</span><br><span class="line">&#125;</span><br><span class="line">free(ivars);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ¼”ç¤ºä»£ç äºŒï¼šå½’æ¡£è§£æ¡£"><a href="#æ¼”ç¤ºä»£ç äºŒï¼šå½’æ¡£è§£æ¡£" class="headerlink" title="æ¼”ç¤ºä»£ç äºŒï¼šå½’æ¡£è§£æ¡£"></a>æ¼”ç¤ºä»£ç äºŒï¼šå½’æ¡£è§£æ¡£</h3><p>æ–°å»ºä¸€ä¸ªç±»ï¼Œç»§æ‰¿è‡ª NSObject ã€‚.mä¸­çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#pragma mark -å½’æ¡£</span></span><br><span class="line">- (<span class="keyword">void</span>)encodeWithCoder:(<span class="built_in">NSCoder</span> *)aCoder &#123;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//è·å–ç±»ä¸­æ‰€æœ‰å±æ€§</span></span><br><span class="line">Ivar *vars = class_copyIvarList([<span class="keyword">self</span> <span class="keyword">class</span>], &amp;count);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">unsigned</span> <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i ++) &#123;</span><br><span class="line">Ivar var = vars[i];</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *name = ivar_getName(var);</span><br><span class="line"><span class="built_in">NSString</span> *key = [<span class="built_in">NSString</span> stringWithUTF8String:name];</span><br><span class="line"><span class="comment">//åˆ©ç”¨ KVC è¿›è¡Œå–å€¼ï¼Œæ ¹æ®å±æ€§åç§°è·å–å¯¹åº”çš„å€¼</span></span><br><span class="line"><span class="keyword">id</span> value = [<span class="keyword">self</span> valueForKey:key];</span><br><span class="line">[aCoder encodeObject:value forKey:key];</span><br><span class="line">&#125;</span><br><span class="line">free(vars);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark -è§£æ¡£</span></span><br><span class="line">- (<span class="keyword">nullable</span> <span class="keyword">instancetype</span>)initWithCoder:(<span class="built_in">NSCoder</span> *)aDecoder &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//è·å–ç±»ä¸­æ‰€æœ‰å±æ€§</span></span><br><span class="line">Ivar *vars = class_copyIvarList([<span class="keyword">self</span> <span class="keyword">class</span>], &amp;count);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">unsigned</span> <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i ++) &#123;</span><br><span class="line">Ivar var = vars[i];</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *name = ivar_getName(var);</span><br><span class="line"><span class="built_in">NSString</span> *key = [<span class="built_in">NSString</span> stringWithUTF8String:name];</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿›è¡Œè§£æ¡£å–å€¼</span></span><br><span class="line"><span class="keyword">id</span> value = [aDecoder decodeObjectForKey:key];</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ©ç”¨ KVC å¯¹å±æ€§èµ‹å€¼</span></span><br><span class="line">[<span class="keyword">self</span> setValue:value forKey:key];</span><br><span class="line">&#125;</span><br><span class="line">free(vars);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ViewControllerä¸­çš„ä»£ç ï¼š<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">[<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">LZNArchive *archive = [LZNArchive objectWithKeyValues:<span class="keyword">self</span>.Mydictionary];</span><br><span class="line"><span class="built_in">NSString</span> *path = <span class="built_in">NSSearchPathForDirectoriesInDomains</span>(<span class="built_in">NSDocumentDirectory</span>, <span class="built_in">NSUserDomainMask</span>, <span class="literal">YES</span>).lastObject;</span><br><span class="line">path = [path stringByAppendingPathComponent:<span class="string">@"hello"</span>];</span><br><span class="line">[<span class="built_in">NSKeyedArchiver</span> archiveRootObject:archive toFile:path];</span><br><span class="line">LZNArchive *m = [<span class="built_in">NSKeyedUnarchiver</span> unarchiveObjectWithFile:path];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="æ¼”ç¤ºä»£ç ä¸‰ï¼šå­—å…¸ä¸æ¨¡å‹äº’è½¬"><a href="#æ¼”ç¤ºä»£ç ä¸‰ï¼šå­—å…¸ä¸æ¨¡å‹äº’è½¬" class="headerlink" title="æ¼”ç¤ºä»£ç ä¸‰ï¼šå­—å…¸ä¸æ¨¡å‹äº’è½¬"></a>æ¼”ç¤ºä»£ç ä¸‰ï¼šå­—å…¸ä¸æ¨¡å‹äº’è½¬</h3><p>é¦–å…ˆåº”å¯¼å…¥ä¸€ä¸ª plist æ–‡ä»¶ï¼Œå°†æ–‡ä»¶ä¸­çš„å†…å®¹è¯»å–åˆ°å­—å…¸ä¸­ï¼›ç„¶åæ–°å»ºä¸€ä¸ªåˆ†ç±»å¦‚: NSObject+KeyValues<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#pragma mark -å­—å…¸è½¬æ¨¡å‹</span></span><br><span class="line"></span><br><span class="line">+(<span class="keyword">instancetype</span>)objectWithDict:(<span class="built_in">NSDictionary</span> *)dict &#123;</span><br><span class="line"><span class="keyword">id</span> objc = [[<span class="keyword">self</span> alloc] init];</span><br><span class="line"></span><br><span class="line"><span class="comment">//éå†å­—å…¸ä¸­çš„å±æ€§</span></span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSString</span> *key <span class="keyword">in</span> dict.allKeys) &#123;</span><br><span class="line"><span class="keyword">id</span> value = dict[key];</span><br><span class="line">objc_property_t property = class_getProperty(<span class="keyword">self</span>, key.UTF8String);</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">objc_property_attribute_t *attributeList = property_copyAttributeList(property, &amp;count);</span><br><span class="line">objc_property_attribute_t attribute = attributeList[<span class="number">0</span>];</span><br><span class="line"><span class="built_in">NSString</span> *string = [<span class="built_in">NSString</span> stringWithUTF8String:attribute.value];</span><br><span class="line"><span class="keyword">if</span> ([string isEqualToString:<span class="string">@"@\"LZNArchive\""</span>]) &#123;</span><br><span class="line">value = [<span class="keyword">self</span> objectWithDict:value];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç”Ÿæˆ setter æ–¹æ³•ï¼Œå¹¶ç”¨ objc_msgSend è°ƒç”¨</span></span><br><span class="line"><span class="built_in">NSString</span> *methodName = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"set%@%@:"</span>,[key substringToIndex:<span class="number">1</span>].uppercaseString,[key substringFromIndex:<span class="number">1</span>]];</span><br><span class="line">SEL <span class="keyword">setter</span> = sel_registerName(methodName.UTF8String);</span><br><span class="line"><span class="keyword">if</span> ([objc respondsToSelector:<span class="keyword">setter</span>]) &#123;</span><br><span class="line">((<span class="keyword">void</span> (*) (<span class="keyword">id</span>,SEL,<span class="keyword">id</span>)) objc_msgSend) (objc,<span class="keyword">setter</span>,value);</span><br><span class="line">&#125;</span><br><span class="line">free(attributeList);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> objc;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark -æ¨¡å‹è½¬å­—å…¸</span></span><br><span class="line">-(<span class="built_in">NSDictionary</span> *)keyValuesWithObject &#123;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">objc_property_t *propertyList = class_copyPropertyList([<span class="keyword">self</span> <span class="keyword">class</span>], &amp;count);</span><br><span class="line"><span class="built_in">NSMutableDictionary</span> *dict = [<span class="built_in">NSMutableDictionary</span> dictionary];</span><br><span class="line"></span><br><span class="line"><span class="comment">//éå†æ¨¡å‹ä¸­å±æ€§</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i ++) &#123;</span><br><span class="line">objc_property_t property = propertyList[i];</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç”Ÿæˆ getter æ–¹æ³•ï¼Œå¹¶ç”¨ objc_msgSend è°ƒç”¨</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *propertyName = property_getName(property);</span><br><span class="line">SEL <span class="keyword">getter</span> = sel_registerName(propertyName);</span><br><span class="line"><span class="keyword">if</span> ([<span class="keyword">self</span> respondsToSelector:<span class="keyword">getter</span>]) &#123;</span><br><span class="line"><span class="keyword">id</span> value = ((<span class="keyword">id</span> (*) (<span class="keyword">id</span>,SEL)) objc_msgSend) (<span class="keyword">self</span>,<span class="keyword">getter</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ¤æ–­å½“å‰å±æ€§</span></span><br><span class="line"><span class="keyword">if</span> ([value isKindOfClass:[<span class="keyword">self</span> <span class="keyword">class</span>]] &amp;&amp; value) &#123;</span><br><span class="line">value = [value keyValuesWithObject];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (value) &#123;</span><br><span class="line"><span class="built_in">NSString</span> *key = [<span class="built_in">NSString</span> stringWithUTF8String:propertyName];</span><br><span class="line">[dict setObject:value forKey:key];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">free(propertyList);</span><br><span class="line"><span class="keyword">return</span> dict;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="æ¼”ç¤ºä»£ç å››ï¼šobjc-msgSend-æ¶ˆæ¯ä¼ é€’"><a href="#æ¼”ç¤ºä»£ç å››ï¼šobjc-msgSend-æ¶ˆæ¯ä¼ é€’" class="headerlink" title="æ¼”ç¤ºä»£ç å››ï¼šobjc_msgSend æ¶ˆæ¯ä¼ é€’"></a>æ¼”ç¤ºä»£ç å››ï¼šobjc_msgSend æ¶ˆæ¯ä¼ é€’</h3><p>æ–°å»ºä¸€ä¸ªç±»ï¼Œç»§æ‰¿è‡ªNSObjectï¼Œ.mä¸­çš„ä»£ç å¦‚ä¸‹:<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)sayHello &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"Hello!"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(<span class="keyword">void</span>)showName:(<span class="built_in">NSString</span> *)name &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"My name is %@"</span>,name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(<span class="keyword">void</span>)showAge:(<span class="built_in">NSInteger</span>)age &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"My age is %ld"</span>, age);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(<span class="keyword">float</span>)showHeight&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">180.0</span>f;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(<span class="built_in">NSString</span> *)showInformation &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">@"Nice to meet you!"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ViewControllerä¸­çš„ä»£ç :<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">LZN_msgSend *msgSend = [[LZN_msgSend alloc] init];</span><br><span class="line">((<span class="keyword">void</span> (*) (<span class="keyword">id</span>, SEL)) objc_msgSend) (msgSend, sel_registerName(<span class="string">"sayHello"</span>));</span><br><span class="line"></span><br><span class="line">((<span class="keyword">void</span> (*) (<span class="keyword">id</span>, SEL, <span class="built_in">NSString</span> *)) objc_msgSend) (msgSend, sel_registerName(<span class="string">"showName:"</span>), <span class="string">@"Liu Zhong Ning"</span>);</span><br><span class="line"></span><br><span class="line">((<span class="keyword">void</span> (*) (<span class="keyword">id</span>, SEL, <span class="built_in">NSInteger</span>)) objc_msgSend) (msgSend, sel_registerName(<span class="string">"showAge:"</span>), <span class="number">23</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">float</span> f = ((<span class="keyword">float</span> (*) (<span class="keyword">id</span>, SEL)) objc_msgSend_fpret) (msgSend, sel_registerName(<span class="string">"showHeight"</span>));</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"and height is %.2fcm"</span>,f);</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSString</span> *information = ((<span class="built_in">NSString</span>* (*) (<span class="keyword">id</span>, SEL)) objc_msgSend) (msgSend, sel_registerName(<span class="string">"showInformation"</span>));</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,information);</span><br></pre></td></tr></table></figure></p>
<p><em>the end</em></p>
<hr>
<p><strong>ç»“æŸè¯­ï¼šRuntime ç›¸å…³çš„çŸ¥è¯†å°±æ•´ç†äº†è¿™ä¹ˆäº›ï¼Œå¸Œæœ›å¯¹çœ‹åˆ°çš„æœ‹å‹ä»¬æœ‰ç”¨ï¼å¦å¤–å¦‚æœ demo æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œè¿˜çƒ¦è¯·å¤§å®¶å‘ŠçŸ¥ï¼Œä¸€èµ·è¿›æ­¥ï¼è°¢è°¢O(âˆ©_âˆ©)O~! å¦ç¥å¤§å®¶å‘¨æœ«æ„‰å¿«å“ˆï¼</strong></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/15/iOSå¼€å‘ä¹‹ - SDWebImage çš„ä½¿ç”¨/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="åˆ˜æœ‹å¤">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ä»¥æ¢¦ä¸ºé©¬">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/15/iOSå¼€å‘ä¹‹ - SDWebImage çš„ä½¿ç”¨/" itemprop="url">
                  iOSå¼€å‘ä¹‹ - SDWebImage çš„ä½¿ç”¨
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
                
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-15T12:30:20+08:00">2018-04-15</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="http://upload-images.jianshu.io/upload_images/2665449-6e9f0fccaeeca1e8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="SDWebImage"></p>
<blockquote>
<p><a href="https://github.com/rs/SDWebImage" target="_blank" rel="noopener">SDWebImage</a> æ˜¯ä¸€ä¸ªå¼€æºçš„ç¬¬ä¸‰æ–¹åº“ï¼Œåœ¨æˆ‘ä»¬ iOS å¼€å‘ä¸­ç”¨åˆ° SDWebImage çš„åœ°æ–¹æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚åœ¨ tableView ä¸­ï¼Œåœ¨ collectionView ä¸­â€¦â€¦ä¸ç„¶å®ƒä¹Ÿä¸ä¼šé«˜è¾¾ 16000+ è¿™ä¹ˆå¤šçš„ Star äº†ğŸ˜„ã€‚ä¸‹é¢æ˜¯æ€»ç»“çš„ä¸€äº› SDWebImage ç›¸å…³çš„å…·ä½“ç”¨æ³•ã€‚</p>
</blockquote>
<p>é¦–å…ˆç”¨ cocoapods å¯¼å…¥ SDWebImage æ¡†æ¶ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šå®‰è£…ä»¥åŠä½¿ç”¨ cocoapods çš„æ•™ç¨‹ï¼Œåœ¨æ­¤å°±ä¸ç´¯è¿°äº†ï¼Œè¿™ç¯‡æ–‡ç« çš„å†…å®¹æ˜¯åœ¨å¯¼å…¥ SDWebImage åŸºç¡€ä¹‹ä¸Šçš„ï¼Œä¸»è¦æ˜¯æ€»ç»“äº†ä¸€äº› SDWebImage çš„å…·ä½“ç”¨æ³•ã€‚</p>
<ul>
<li><p>ç®€å•ä¸‹è½½å›¾ç‰‡</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">æ–¹å¼ä¸€ï¼š</span><br><span class="line"><span class="comment">// åªä¸‹è½½å›¾ç‰‡</span></span><br><span class="line">[self.imageView <span class="string">sd_setImageWithURL:</span>@<span class="string">"URLåœ°å€"</span>]];</span><br><span class="line"></span><br><span class="line">æ–¹å¼äºŒï¼š</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">ç¬¬ä¸€ä¸ªå‚æ•°:å›¾ç‰‡çš„url</span></span><br><span class="line"><span class="comment">ç¬¬äºŒä¸ªå‚æ•°:å ä½å›¾ç‰‡</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">[self.imageView <span class="string">sd_setImageWithURL:</span>[NSURL <span class="string">URLWithString:</span>@<span class="string">"URLåœ°å€"</span>]</span><br><span class="line"><span class="string">placeholderImage:</span>[UIImage <span class="string">imageNamed:</span> @<span class="string">"å ä½å›¾ç‰‡å"</span>]];</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¸‹è½½æˆåŠŸæˆ–å¤±è´¥ä¹‹ååšçš„äº‹æƒ…</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">æ–¹å¼ä¸€ï¼š</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">ç¬¬ä¸€ä¸ªå‚æ•°:å›¾ç‰‡çš„url</span></span><br><span class="line"><span class="comment">block:ä¸‹è½½æˆåŠŸæˆ–å¤±è´¥ä¹‹åçš„å›è°ƒ</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">[<span class="keyword">self</span>.imageView sd_setImageWithURL:[<span class="built_in">NSURL</span> URLWithString:<span class="string">@"URLåœ°å€"</span>]</span><br><span class="line">completed:^(<span class="built_in">UIImage</span> *image, <span class="built_in">NSError</span> *error, SDImageCacheType cacheType, <span class="built_in">NSURL</span> *imageURL) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"ä¸‹è½½æˆåŠŸæˆ–å¤±è´¥ä¹‹åçš„å›è°ƒ"</span>);</span><br><span class="line">&#125;];</span><br><span class="line">æ–¹å¼äºŒï¼š</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">ç¬¬ä¸€ä¸ªå‚æ•°:å›¾ç‰‡çš„url</span></span><br><span class="line"><span class="comment">ç¬¬äºŒä¸ªå‚æ•°:å ä½å›¾ç‰‡</span></span><br><span class="line"><span class="comment">block:ä¸‹è½½æˆåŠŸæˆ–å¤±è´¥ä¹‹åçš„å›è°ƒ</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">[<span class="keyword">self</span>.imageView sd_setImageWithURL:[<span class="built_in">NSURL</span> URLWithString:<span class="string">@"URLåœ°å€"</span>]</span><br><span class="line">placeholderImage:[<span class="built_in">UIImage</span> imageNamed: <span class="string">@"å ä½å›¾ç‰‡å"</span>]</span><br><span class="line">completed:^(<span class="built_in">UIImage</span> *image, <span class="built_in">NSError</span> *error, SDImageCacheType cacheType, <span class="built_in">NSURL</span> *imageURL) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"ä¸‹è½½æˆåŠŸæˆ–å¤±è´¥ä¹‹åçš„å›è°ƒ"</span>);</span><br><span class="line">&#125;];</span><br><span class="line">æ–¹å¼ä¸‰ï¼š</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">ç¬¬ä¸€ä¸ªå‚æ•°:å›¾ç‰‡çš„url</span></span><br><span class="line"><span class="comment">ç¬¬äºŒä¸ªå‚æ•°:å ä½å›¾ç‰‡</span></span><br><span class="line"><span class="comment">ç¬¬ä¸‰ä¸ªå‚æ•°:ä¸‹è½½å›¾ç‰‡çš„ç­–ç•¥</span></span><br><span class="line"><span class="comment">ç¬¬å››ä¸ªå‚æ•°:progressè¿›åº¦</span></span><br><span class="line"><span class="comment">ç¬¬äº”ä¸ªå‚æ•°:completed ä¸‹è½½å®Œæˆä¹‹åçš„å›è°ƒ</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">[<span class="keyword">self</span>.imageView sd_setImageWithURL:[<span class="built_in">NSURL</span> URLWithString:<span class="string">@"URLåœ°å€"</span>]</span><br><span class="line">placeholderImage:[<span class="built_in">UIImage</span> imageNamed: <span class="string">@"å ä½å›¾ç‰‡å"</span>]</span><br><span class="line">options:SDWebImageRetryFailed</span><br><span class="line">progress:^(<span class="built_in">NSInteger</span> receivedSize, <span class="built_in">NSInteger</span> expectedSize) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"progressè¿›åº¦"</span>);</span><br><span class="line">&#125;</span><br><span class="line">completed:^(<span class="built_in">UIImage</span> *image, <span class="built_in">NSError</span> *error, SDImageCacheType cacheType, <span class="built_in">NSURL</span> *imageURL) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"ä¸‹è½½æˆåŠŸæˆ–å¤±è´¥ä¹‹åçš„å›è°ƒ"</span>);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
</li>
<li><p>å€Ÿç”¨ä¸€ä¸ªæ–¹æ³•ç®€å•çš„ä»‹ç»ä¸€ä¸‹ options ä¸­çš„é€‰é¡¹</p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"><span class="comment">//å¤±è´¥åé‡è¯•</span></span><br><span class="line">SDWebImageRetryFailed = <span class="number">1</span> &lt;&lt; <span class="number">0</span>,</span><br><span class="line"><span class="comment">//UIäº¤äº’æœŸé—´å¼€å§‹ä¸‹è½½ï¼Œå¯¼è‡´å»¶è¿Ÿä¸‹è½½æ¯”å¦‚UIScrollViewå‡é€Ÿã€‚</span></span><br><span class="line">SDWebImageLowPriority = <span class="number">1</span> &lt;&lt; <span class="number">1</span>,</span><br><span class="line"><span class="comment">//åªè¿›è¡Œå†…å­˜ç¼“å­˜</span></span><br><span class="line">SDWebImageCacheMemoryOnly = <span class="number">1</span> &lt;&lt; <span class="number">2</span>,</span><br><span class="line"><span class="comment">//è¿™ä¸ªæ ‡å¿—å¯ä»¥æ¸è¿›å¼ä¸‹è½½,æ˜¾ç¤ºçš„å›¾åƒæ˜¯é€æ­¥åœ¨ä¸‹è½½</span></span><br><span class="line">SDWebImageProgressiveDownload = <span class="number">1</span> &lt;&lt; <span class="number">3</span>,</span><br><span class="line"><span class="comment">//åˆ·æ–°ç¼“å­˜</span></span><br><span class="line">SDWebImageRefreshCached = <span class="number">1</span> &lt;&lt; <span class="number">4</span>,</span><br><span class="line"><span class="comment">//åå°ä¸‹è½½</span></span><br><span class="line">SDWebImageContinueInBackground = <span class="number">1</span> &lt;&lt; <span class="number">5</span>,</span><br><span class="line"><span class="comment">//NSMutableURLRequest.HTTPShouldHandleCookies = YES;</span></span><br><span class="line">SDWebImageHandleCookies = <span class="number">1</span> &lt;&lt; <span class="number">6</span>,</span><br><span class="line"><span class="comment">//å…è®¸ä½¿ç”¨æ— æ•ˆçš„SSLè¯ä¹¦</span></span><br><span class="line"><span class="comment">//SDWebImageAllowInvalidSSLCertificates = 1 &lt;&lt; 7,</span></span><br><span class="line"><span class="comment">//ä¼˜å…ˆä¸‹è½½</span></span><br><span class="line">SDWebImageHighPriority = <span class="number">1</span> &lt;&lt; <span class="number">8</span>,</span><br><span class="line"><span class="comment">//å»¶è¿Ÿå ä½ç¬¦</span></span><br><span class="line">SDWebImageDelayPlaceholder = <span class="number">1</span> &lt;&lt; <span class="number">9</span>,</span><br><span class="line"><span class="comment">//æ”¹å˜åŠ¨ç”»å½¢è±¡</span></span><br><span class="line">SDWebImageTransformAnimatedImage = <span class="number">1</span> &lt;&lt; <span class="number">10</span>,</span><br><span class="line">*/</span><br><span class="line">[self.imageView sd_setImageWithURL:[NSURL URLWithString:@<span class="string">"URLåœ°å€"</span>]</span><br><span class="line">placeholderImage:[UIImage imageNamed: @<span class="string">"å ä½å›¾ç‰‡å"</span>]</span><br><span class="line">options:SDWebImageRetryFailed];</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä½¿ç”¨ SDWebImageManager ä¸‹è½½å›¾ç‰‡</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">SDWebImageManager *imageManager = [SDWebImageManager sharedManager];</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">ç¬¬ä¸€ä¸ªå‚æ•°:å›¾ç‰‡çš„url</span></span><br><span class="line"><span class="comment">ç¬¬äºŒä¸ªå‚æ•°:ä¸‹è½½å›¾ç‰‡çš„(ç­–ç•¥)</span></span><br><span class="line"><span class="comment">ç¬¬ä¸‰ä¸ªå‚æ•°:progressè¿›åº¦</span></span><br><span class="line"><span class="comment">ç¬¬å››ä¸ªå‚æ•°:completed ä¸‹è½½å®Œæˆä¹‹åçš„å›è°ƒ</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">[imageManager downloadImageWithURL:[<span class="built_in">NSURL</span> URLWithString:<span class="string">@"URLåœ°å€"</span>]</span><br><span class="line">options:SDWebImageRetryFailed</span><br><span class="line">progress:^(<span class="built_in">NSInteger</span> receivedSize, <span class="built_in">NSInteger</span> expectedSize) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"progressè¿›åº¦"</span>);</span><br><span class="line">&#125;</span><br><span class="line">completed:^(<span class="built_in">UIImage</span> *image, <span class="built_in">NSError</span> *error, SDImageCacheType cacheType, <span class="built_in">BOOL</span> finished, <span class="built_in">NSURL</span> *imageURL) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"ä¸‹è½½æˆåŠŸæˆ–å¤±è´¥ä¹‹åçš„å›è°ƒ"</span>);</span><br><span class="line"><span class="keyword">if</span> (image) &#123;</span><br><span class="line"><span class="keyword">self</span>.image = image;</span><br><span class="line">&#125;</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä½¿ç”¨ SDWebImageDownloader ä¸‹è½½å›¾ç‰‡</p>
</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">SDWebImageDownloader *imageDownloader = [SDWebImageDownloader sharedDownloader];</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">ç¬¬ä¸€ä¸ªå‚æ•°:å›¾ç‰‡çš„url</span></span><br><span class="line"><span class="comment">ç¬¬äºŒä¸ªå‚æ•°:ä¸‹è½½å›¾ç‰‡çš„ç­–ç•¥</span></span><br><span class="line"><span class="comment">ç¬¬ä¸‰ä¸ªå‚æ•°:progressBlock è¿›åº¦</span></span><br><span class="line"><span class="comment">ç¬¬å››ä¸ªå‚æ•°:completedBlock ä¸‹è½½å®Œæˆä¹‹åçš„å›è°ƒ</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">[imageDownloader downloadImageWithURL:[<span class="built_in">NSURL</span> URLWithString:<span class="string">@"URLåœ°å€"</span>]</span><br><span class="line">options:SDWebImageDownloaderLowPriority</span><br><span class="line">progress:^(<span class="built_in">NSInteger</span> receivedSize, <span class="built_in">NSInteger</span> expectedSize) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"progressè¿›åº¦"</span>);</span><br><span class="line">&#125;</span><br><span class="line">completed:^(<span class="built_in">UIImage</span> *image, <span class="built_in">NSData</span> *data, <span class="built_in">NSError</span> *error, <span class="built_in">BOOL</span> finished) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"ä¸‹è½½æˆåŠŸæˆ–å¤±è´¥ä¹‹åçš„å›è°ƒ"</span>);</span><br><span class="line"><span class="keyword">if</span> (image) &#123;</span><br><span class="line"><span class="keyword">self</span>.image = image;</span><br><span class="line">&#125;</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<ul>
<li>å†…å­˜è­¦å‘Šæ—¶è°ƒç”¨</li>
</ul>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å½“ç¨‹åºæ”¶åˆ°å†…å­˜è­¦å‘Šæ—¶ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•</span></span><br><span class="line">- (<span class="keyword">void</span>)didReceiveMemoryWarning &#123;</span><br><span class="line">[<span class="meta">super didReceiveMemoryWarning</span>];</span><br><span class="line"><span class="comment">// æ¸…é™¤ç¼“å­˜</span></span><br><span class="line">[<span class="meta">[SDWebImageManager sharedManager</span>].imageCache clearDisk]; <span class="comment">// clean:åˆ é™¤è¿‡æœŸç¼“å­˜</span></span><br><span class="line">[<span class="meta">[SDWebImageManager sharedManager</span>].imageCache cleanDisk]; <span class="comment">// clear:ç›´æ¥åˆ é™¤ç„¶åé‡æ–°åˆ›å»º</span></span><br><span class="line"><span class="comment">// å–æ¶ˆä¸‹è½½</span></span><br><span class="line">[<span class="meta">[SDWebImageManager sharedManager</span>] cancelAll];</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å…¶å®ƒä¸€äº›å¾ˆæœ‰ç”¨çš„æ–¹æ³•</li>
</ul>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å–æ¶ˆæ‰å½“å‰æ‰€æœ‰çš„ä¸‹è½½</span></span><br><span class="line"><span class="selector-tag">-</span> (void)<span class="selector-tag">cancelAll</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ£€æŸ¥æ˜¯å¦æœ‰å›¾ç‰‡åœ¨ä¸‹è½½</span></span><br><span class="line"><span class="selector-tag">-</span> (BOOL)<span class="selector-tag">isRunning</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†å›¾ç‰‡å­˜å…¥cacheçš„æ–¹æ³•</span></span><br><span class="line"><span class="selector-tag">-</span> (void)<span class="selector-tag">saveImageToCache</span><span class="selector-pseudo">:(UIImage</span> *)<span class="selector-tag">image</span> <span class="selector-tag">forURL</span><span class="selector-pseudo">:(NSURL</span> *)<span class="selector-tag">url</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šè¿‡å›¾ç‰‡çš„urlåˆ¤æ–­å…¶æ˜¯å¦å·²ç»å­˜åœ¨</span></span><br><span class="line"><span class="selector-tag">-</span> (BOOL)<span class="selector-tag">cachedImageExistsForURL</span><span class="selector-pseudo">:(NSURL</span> *)<span class="selector-tag">url</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ£€æµ‹ä¸€ä¸ªimageæ˜¯å¦å·²ç»è¢«ç¼“å­˜åˆ°ç£ç›˜(æ˜¯å¦å­˜ä¸”ä»…å­˜åœ¨diské‡Œ).</span></span><br><span class="line"><span class="selector-tag">-</span> (BOOL)<span class="selector-tag">diskImageExistsForURL</span><span class="selector-pseudo">:(NSURL</span> *)<span class="selector-tag">url</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœæ£€æµ‹åˆ°å›¾ç‰‡å·²ç»è¢«ç¼“å­˜,é‚£ä¹ˆæ‰§è¡Œå›è°ƒblock</span></span><br><span class="line"><span class="selector-tag">-</span> (void)<span class="selector-tag">cachedImageExistsForURL</span><span class="selector-pseudo">:(NSURL</span> *)<span class="selector-tag">url</span></span><br><span class="line"><span class="selector-tag">completion</span><span class="selector-pseudo">:(SDWebImageCheckCacheCompletionBlock)completionBlock</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœæ£€æµ‹åˆ°å›¾ç‰‡å·²ç»åœ¨ç£ç›˜ä¸­,é‚£ä¹ˆæ‰§è¡Œå›è°ƒblock</span></span><br><span class="line"><span class="selector-tag">-</span> (void)<span class="selector-tag">diskImageExistsForURL</span><span class="selector-pseudo">:(NSURL</span> *)<span class="selector-tag">url</span></span><br><span class="line"><span class="selector-tag">completion</span><span class="selector-pseudo">:(SDWebImageCheckCacheCompletionBlock)completionBlock</span>;</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šæ˜¯å…³äº SDWebImage çš„ä¸€äº›ç”¨æ³•æ€»ç»“ï¼Œä»¥åå†ç”¨åˆ°å…¶å®ƒçš„äº†ï¼Œä¼šå†æ¥è¡¥å……ã€‚å¦å¤–å¦‚æœæœ‰å†™é”™çš„åœ°æ–¹ï¼Œæ¬¢è¿æœ‹å‹ä»¬æŒ‡æ­£ï¼è°¢è°¢ğŸ˜Šï¼</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/15/iOSå¼€å‘ä¹‹ - WKWebView VS UIWebView/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="åˆ˜æœ‹å¤">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ä»¥æ¢¦ä¸ºé©¬">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/15/iOSå¼€å‘ä¹‹ - WKWebView VS UIWebView/" itemprop="url">
                  iOSå¼€å‘ä¹‹ - WKWebView VS UIWebView
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
                
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-15T12:30:20+08:00">2018-04-15</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>WKWebViewæ˜¯è‹¹æœåœ¨ iOS 8 ä¸­æ¨å‡ºçš„æ–°æ¡†æ¶ï¼Œç›¸æ¯”UIWebViewæ¥è¯´ï¼ŒWKWebView æ€§èƒ½å¥½ï¼Œé€Ÿåº¦å¿«ï¼Œå†…å­˜å°ï¼ŒåŠŸèƒ½å¤šï¼Œä¸”æ”¯æŒäº†æ›´å¤šçš„ HTML5 ç‰¹æ€§â€¦â€¦å› æ­¤æœ¬å°ç™½ç¦ä¸ä½â€œè¯±æƒ‘â€åˆ©ç”¨äº†ä¸€æ™šä¸Šçš„æ—¶é—´ï¼Œæ•´ç†äº†ä¸€äº›å…³äº WKWebView çš„èµ„æ–™ï¼Œä¸å¤§å®¶åˆ†äº«ä¸‹ï¼åœ¨è¯´ WKWebView ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆè¯´è¯´ä»–çš„è€å¤§å“¥ UIWebView ï¼ï¼ï¼</p>
</blockquote>
<p>UIWebView æ˜¯è‹¹æœåœ¨ iOS 2 ä¹‹åæ¨å‡ºçš„ï¼Œç”±äºèµ„æ ¼æ¯”è¾ƒâ€œè€â€ï¼Œå¤§å®¶å¯¹ UIWebView åº”è¯¥ä¹Ÿä¸ä¼šé™Œç”Ÿï¼Œè¿™é‡Œç›´æ¥ä¸Šä»£ç ï¼š</p>
<h3 id="1-UIWebView-åŸºæœ¬ä½¿ç”¨"><a href="#1-UIWebView-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="1.UIWebView åŸºæœ¬ä½¿ç”¨"></a>1.UIWebView åŸºæœ¬ä½¿ç”¨</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºwebview</span></span><br><span class="line"><span class="built_in">UIWebView</span> *webView = [[<span class="built_in">UIWebView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">20</span>, NNWidth, NNHeight - <span class="number">20</span>)];</span><br><span class="line"><span class="comment">// ç½‘ç»œè¯·æ±‚</span></span><br><span class="line"><span class="built_in">NSURLRequest</span> *request =[<span class="built_in">NSURLRequest</span> requestWithURL:[<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://www.baidu.com"</span>]];</span><br><span class="line"><span class="comment">// åŠ è½½ç½‘é¡µ</span></span><br><span class="line">[webView loadRequest:request];</span><br><span class="line"><span class="comment">// æ·»åŠ åˆ°ç•Œé¢</span></span><br><span class="line">[<span class="keyword">self</span>.view addSubview:webView];</span><br></pre></td></tr></table></figure>
<h3 id="2-UIWebView-å¸¸ç”¨æ–¹æ³•"><a href="#2-UIWebView-å¸¸ç”¨æ–¹æ³•" class="headerlink" title="2.UIWebView å¸¸ç”¨æ–¹æ³•"></a>2.UIWebView å¸¸ç”¨æ–¹æ³•</h3><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">webView reload</span>]; <span class="comment">// åˆ·æ–°</span></span><br><span class="line">[<span class="meta">webView stopLoading</span>]; <span class="comment">// åœæ­¢åŠ è½½</span></span><br><span class="line">[<span class="meta">webView goBack</span>]; <span class="comment">// åé€€</span></span><br><span class="line">[<span class="meta">webView goForward</span>]; <span class="comment">// å‰è¿›</span></span><br><span class="line">[<span class="meta">webView canGoBack</span>]; <span class="comment">// æ˜¯å¦å¯ä»¥åé€€</span></span><br><span class="line">[<span class="meta">webView canGoForward</span>]; <span class="comment">// æ˜¯å¦å¯ä»¥å‘å‰</span></span><br><span class="line">[<span class="meta">webView isLoading</span>]; <span class="comment">// æ˜¯å¦æ­£åœ¨åŠ è½½</span></span><br></pre></td></tr></table></figure>
<h3 id="3-UIWebView-ç›¸å…³ä»£ç†åè®®"><a href="#3-UIWebView-ç›¸å…³ä»£ç†åè®®" class="headerlink" title="3.UIWebView ç›¸å…³ä»£ç†åè®®"></a>3.UIWebView ç›¸å…³ä»£ç†åè®®</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#pragma mark - UIWebViewDelegate</span></span><br><span class="line"><span class="comment">/// æ˜¯å¦å…è®¸åŠ è½½ç½‘é¡µ</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)webView:(<span class="built_in">UIWebView</span> *)webView shouldStartLoadWithRequest:(<span class="built_in">NSURLRequest</span> *)request navigationType:(<span class="built_in">UIWebViewNavigationType</span>)navigationType &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"å…è®¸åŠ è½½ç½‘é¡µ"</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// å¼€å§‹åŠ è½½ç½‘é¡µæ—¶è°ƒç”¨</span></span><br><span class="line">- (<span class="keyword">void</span>)webViewDidStartLoad:(<span class="built_in">UIWebView</span> *)webView &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"å¼€å§‹åŠ è½½ç½‘é¡µ"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/// ç½‘é¡µåŠ è½½å®Œæˆæ—¶è°ƒç”¨</span></span><br><span class="line">- (<span class="keyword">void</span>)webViewDidFinishLoad:(<span class="built_in">UIWebView</span> *)webView &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"ç½‘é¡µåŠ è½½å®Œæˆ"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// ç½‘é¡µåŠ è½½é”™è¯¯æ—¶è°ƒç”¨</span></span><br><span class="line">- (<span class="keyword">void</span>)webView:(<span class="built_in">UIWebView</span> *)webView didFailLoadWithError:(<span class="built_in">NSError</span> *)error &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"ç½‘é¡µåŠ è½½é”™è¯¯æ—¶è°ƒç”¨"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="è¿™é‡Œæ˜¯-UIWebView-çš„æ•ˆæœå›¾ï¼ï¼ï¼"><a href="#è¿™é‡Œæ˜¯-UIWebView-çš„æ•ˆæœå›¾ï¼ï¼ï¼" class="headerlink" title="è¿™é‡Œæ˜¯ UIWebView çš„æ•ˆæœå›¾ï¼ï¼ï¼"></a>è¿™é‡Œæ˜¯ UIWebView çš„æ•ˆæœå›¾ï¼ï¼ï¼</h3><p><img src="http://upload-images.jianshu.io/upload_images/2665449-ab410b93f7c4d753.gif?imageMogr2/auto-orient/strip" alt="UIWebViewåŠ è½½ç½‘é¡µ"><br><img src="http://upload-images.jianshu.io/upload_images/2665449-14ead660659b5a2b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä»£ç†æ–¹æ³•è¾“å‡ºçš„é¡ºåº"></p>
<h3 id="å› ä¸ºä¸»è¦æƒ³ä¸å¤§å®¶åˆ†äº«çš„æ˜¯-WKWebViewï¼Œæ‰€ä»¥å¯¹-UIWebView-çš„ä»‹ç»å°±åˆ°æ­¤ä¸ºæ­¢äº†ã€‚æ¥ä¸‹æ¥çš„-WKWebView-æ‰æ˜¯ä»Šæ™šçš„ä¸»è§’ï¼ï¼ï¼"><a href="#å› ä¸ºä¸»è¦æƒ³ä¸å¤§å®¶åˆ†äº«çš„æ˜¯-WKWebViewï¼Œæ‰€ä»¥å¯¹-UIWebView-çš„ä»‹ç»å°±åˆ°æ­¤ä¸ºæ­¢äº†ã€‚æ¥ä¸‹æ¥çš„-WKWebView-æ‰æ˜¯ä»Šæ™šçš„ä¸»è§’ï¼ï¼ï¼" class="headerlink" title="å› ä¸ºä¸»è¦æƒ³ä¸å¤§å®¶åˆ†äº«çš„æ˜¯ WKWebViewï¼Œæ‰€ä»¥å¯¹ UIWebView çš„ä»‹ç»å°±åˆ°æ­¤ä¸ºæ­¢äº†ã€‚æ¥ä¸‹æ¥çš„ WKWebView æ‰æ˜¯ä»Šæ™šçš„ä¸»è§’ï¼ï¼ï¼"></a>å› ä¸ºä¸»è¦æƒ³ä¸å¤§å®¶åˆ†äº«çš„æ˜¯ WKWebViewï¼Œæ‰€ä»¥å¯¹ UIWebView çš„ä»‹ç»å°±åˆ°æ­¤ä¸ºæ­¢äº†ã€‚æ¥ä¸‹æ¥çš„ WKWebView æ‰æ˜¯ä»Šæ™šçš„ä¸»è§’ï¼ï¼ï¼</h3><hr>
<p><strong>ä¾ç„¶æ˜¯å…ˆä»‹ç» WKWebView çš„åŸºæœ¬ä½¿ç”¨</strong></p>
<h3 id="1-WKWebView-åŸºæœ¬ä½¿ç”¨"><a href="#1-WKWebView-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="1. WKWebView åŸºæœ¬ä½¿ç”¨"></a>1. WKWebView åŸºæœ¬ä½¿ç”¨</h3><blockquote>
<p>è¿™é‡ŒåŠ ä¸€ä¸ªä¸ç”¨æç¤ºçš„æç¤ºï¼šWKWebView å’Œ UIWebview çš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•ç›¸ç±»ä¼¼ï¼Œä½†æ˜¯éœ€è¦å¯¼å…¥å¤´æ–‡ä»¶ #import &lt;WebKit/WebKit.h&gt;ï¼Œå…¶å®ƒæ­¥éª¤å¦‚ä¸‹</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºwebview</span></span><br><span class="line"><span class="built_in">WKWebView</span> *webView = [[<span class="built_in">WKWebView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">20</span>, NNWidth, NNHeight - <span class="number">20</span>)];</span><br><span class="line"><span class="comment">// åˆ›å»ºè¯·æ±‚</span></span><br><span class="line"><span class="built_in">NSURLRequest</span> *request =[<span class="built_in">NSURLRequest</span> requestWithURL:[<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://www.baidu.com"</span>]];</span><br><span class="line"><span class="comment">// åŠ è½½ç½‘é¡µ</span></span><br><span class="line">[webView loadRequest:request];</span><br><span class="line"><span class="comment">// å°†webViewæ·»åŠ åˆ°ç•Œé¢</span></span><br><span class="line">[<span class="keyword">self</span>.view addSubview:webView];</span><br></pre></td></tr></table></figure>
<p>ps:è¿™é‡Œå°±ä¸å†è¡¥å……æ•ˆæœå›¾äº†ï¼Œé™¤äº†é€Ÿåº¦å†…å­˜ä¼˜äº UIWebViewï¼Œæ˜¾ç¤ºçš„æ•ˆæœå·®ä¸å¤šã€‚ã€‚ã€‚</p>
<h3 id="2-WKWebView-åŠ è½½æ–‡ä»¶"><a href="#2-WKWebView-åŠ è½½æ–‡ä»¶" class="headerlink" title="2. WKWebView åŠ è½½æ–‡ä»¶"></a>2. WKWebView åŠ è½½æ–‡ä»¶</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºwebview</span></span><br><span class="line"><span class="built_in">WKWebView</span> *webView = [[<span class="built_in">WKWebView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">20</span>, NNWidth, NNHeight - <span class="number">20</span>)];</span><br><span class="line"><span class="comment">// åˆ›å»ºurl(å¯ä»¥éšä¾¿ä»æ¡Œé¢æ‹‰å¼ å›¾ç‰‡)</span></span><br><span class="line"><span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> fileURLWithPath:<span class="string">@"/Users/ios/Desktop/å›¾ç‰‡/90416596477f347431a929dc73b9f404.jpg"</span>];</span><br><span class="line"><span class="comment">// åŠ è½½æ–‡ä»¶</span></span><br><span class="line">[webView loadFileURL:url allowingReadAccessToURL:url];</span><br><span class="line"><span class="comment">// æœ€åå°†webViewæ·»åŠ åˆ°ç•Œé¢</span></span><br><span class="line">[<span class="keyword">self</span>.view addSubview:webView];</span><br></pre></td></tr></table></figure>
<h4 id="è¿™é‡Œæ˜¯åŠ è½½æ–‡ä»¶æ•ˆæœå›¾ï¼"><a href="#è¿™é‡Œæ˜¯åŠ è½½æ–‡ä»¶æ•ˆæœå›¾ï¼" class="headerlink" title="è¿™é‡Œæ˜¯åŠ è½½æ–‡ä»¶æ•ˆæœå›¾ï¼"></a>è¿™é‡Œæ˜¯åŠ è½½æ–‡ä»¶æ•ˆæœå›¾ï¼</h4><p><img src="http://upload-images.jianshu.io/upload_images/2665449-026af846596935f2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="åŠ è½½æœ¬åœ°å›¾ç‰‡"></p>
<h3 id="3-WKWebView-ä¸-JS-ä»£ç äº¤äº’"><a href="#3-WKWebView-ä¸-JS-ä»£ç äº¤äº’" class="headerlink" title="3. WKWebView ä¸ JS ä»£ç äº¤äº’"></a>3. WKWebView ä¸ JS ä»£ç äº¤äº’</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å›¾ç‰‡ç¼©æ”¾çš„ JS ä»£ç </span></span><br><span class="line"><span class="built_in">NSString</span> *JSImage = <span class="string">@"var count = document.images.length;for (var i = 0; i &lt; count; i++) &#123;var image = document.images[i];image.style.width=375;&#125;;window.alert('æ‰¾åˆ°' + count + 'å¼ å›¾');"</span>;</span><br><span class="line"><span class="comment">// åˆå§‹åŒ– WKUserScript</span></span><br><span class="line"><span class="built_in">WKUserScript</span> *script = [[<span class="built_in">WKUserScript</span> alloc] initWithSource:JSImage injectionTime:<span class="built_in">WKUserScriptInjectionTimeAtDocumentEnd</span> forMainFrameOnly:<span class="literal">YES</span>];</span><br><span class="line"><span class="comment">// åˆå§‹åŒ–WKWebViewConfiguration</span></span><br><span class="line"><span class="built_in">WKWebViewConfiguration</span> *configuration = [[<span class="built_in">WKWebViewConfiguration</span> alloc] init];</span><br><span class="line">[configuration.userContentController addUserScript:script];</span><br><span class="line">_webView = [[<span class="built_in">WKWebView</span> alloc] initWithFrame:<span class="keyword">self</span>.view.bounds configuration:configuration];</span><br><span class="line"><span class="comment">// è¿™é‡Œéœ€è¦ä»ç½‘ä¸Šæ‰¾åˆ°ä¸€å¼ å›¾ç‰‡çš„åœ°å€</span></span><br><span class="line">[_webView loadHTMLString:<span class="string">@"&lt;head&gt;&lt;/head&gt;![](http://upload-images.jianshu.io/upload_images/2665449-f109bc70619e2a92.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)"</span>baseURL:<span class="literal">nil</span>];</span><br><span class="line">[<span class="keyword">self</span>.view addSubview:_webView];</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-311830759271b58f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä¸ JS äº¤äº’æ•ˆæœå›¾"></p>
<h3 id="4-WKWebView-å¸¸ç”¨çš„ä»£ç†åè®®"><a href="#4-WKWebView-å¸¸ç”¨çš„ä»£ç†åè®®" class="headerlink" title="4. WKWebView å¸¸ç”¨çš„ä»£ç†åè®®"></a>4. WKWebView å¸¸ç”¨çš„ä»£ç†åè®®</h3><p><em>WKWebView çš„ä»£ç†æ–¹æ³•è¿˜æ˜¯è›®æœ‰è¶£çš„ï¼Œå¤§å®¶å¯ä»¥è¯•ä¸‹å“ˆï¼</em></p>
<h4 id="4-1-WKNavigationDelegate-åè®®"><a href="#4-1-WKNavigationDelegate-åè®®" class="headerlink" title="4.1 WKNavigationDelegate åè®®"></a>4.1 WKNavigationDelegate åè®®</h4><p>è¿™é‡Œç®€å•ç½—åˆ—äº†å‡ ä¸ªå¸¸ç”¨çš„æ–¹æ³•ã€‚ä»¥ä¸‹å››ä¸ªä¸ UIWebView ä¸­çš„æ–¹æ³•ç›¸åŒï¼š<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#pragma</span> <span class="selector-tag">mark</span> <span class="selector-tag">-</span> <span class="selector-tag">WKNavigationDelegate</span></span><br><span class="line"><span class="comment">// é¡µé¢å¼€å§‹åŠ è½½æ—¶è°ƒç”¨</span></span><br><span class="line"><span class="selector-tag">-</span> (void)<span class="selector-tag">webView</span><span class="selector-pseudo">:(WKWebView</span> *)<span class="selector-tag">webView</span> <span class="selector-tag">didStartProvisionalNavigation</span><span class="selector-pseudo">:(WKNavigation</span> *)<span class="selector-tag">navigation</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å†…å®¹å¼€å§‹è¿”å›æ—¶è°ƒç”¨</span></span><br><span class="line"><span class="selector-tag">-</span> (void)<span class="selector-tag">webView</span><span class="selector-pseudo">:(WKWebView</span> *)<span class="selector-tag">webView</span> <span class="selector-tag">didCommitNavigation</span><span class="selector-pseudo">:(WKNavigation</span> *)<span class="selector-tag">navigation</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// é¡µé¢åŠ è½½å®Œæˆæ—¶è°ƒç”¨</span></span><br><span class="line"><span class="selector-tag">-</span> (void)<span class="selector-tag">webView</span><span class="selector-pseudo">:(WKWebView</span> *)<span class="selector-tag">webView</span> <span class="selector-tag">didFinishNavigation</span><span class="selector-pseudo">:(WKNavigation</span> *)<span class="selector-tag">navigation</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// é¡µé¢åŠ è½½å¤±è´¥æ—¶è°ƒç”¨</span></span><br><span class="line"><span class="selector-tag">-</span> (void)<span class="selector-tag">webView</span><span class="selector-pseudo">:(WKWebView</span> *)<span class="selector-tag">webView</span> <span class="selector-tag">didFailProvisionalNavigation</span><span class="selector-pseudo">:(WKNavigation</span> *)<span class="selector-tag">navigation</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ–°å¢çš„ä¸‰ä¸ªä»£ç†æ–¹æ³•:<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// è¿™ä¸ªæ–¹æ³•æ˜¯æœåŠ¡å™¨é‡å®šå‘æ—¶è°ƒç”¨ï¼Œå³ æ¥æ”¶åˆ°æœåŠ¡å™¨è·³è½¬è¯·æ±‚ä¹‹åè°ƒç”¨</span></span><br><span class="line"><span class="selector-tag">-</span> (void)<span class="selector-tag">webView</span><span class="selector-pseudo">:(WKWebView</span> *)<span class="selector-tag">webView</span> <span class="selector-tag">didReceiveServerRedirectForProvisionalNavigation</span><span class="selector-pseudo">:(WKNavigation</span> *)<span class="selector-tag">navigation</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åœ¨æ”¶åˆ°å“åº”åï¼Œå†³å®šæ˜¯å¦è·³è½¬</span></span><br><span class="line"><span class="selector-tag">-</span> (void)<span class="selector-tag">webView</span><span class="selector-pseudo">:(WKWebView</span> *)<span class="selector-tag">webView</span> <span class="selector-tag">decidePolicyForNavigationResponse</span><span class="selector-pseudo">:(WKNavigationResponse</span> *)<span class="selector-tag">navigationResponse</span> <span class="selector-tag">decisionHandler</span><span class="selector-pseudo">:(void</span> (^)(WKNavigationResponsePolicy))<span class="selector-tag">decisionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åœ¨å‘é€è¯·æ±‚ä¹‹å‰ï¼Œå†³å®šæ˜¯å¦è·³è½¬</span></span><br><span class="line"><span class="selector-tag">-</span> (void)<span class="selector-tag">webView</span><span class="selector-pseudo">:(WKWebView</span> *)<span class="selector-tag">webView</span> <span class="selector-tag">decidePolicyForNavigationAction</span><span class="selector-pseudo">:(WKNavigationAction</span> *)<span class="selector-tag">navigationAction</span> <span class="selector-tag">decisionHandler</span><span class="selector-pseudo">:(void</span> (^)(WKNavigationActionPolicy))<span class="selector-tag">decisionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="4-2-WKUIDelegate-åè®®"><a href="#4-2-WKUIDelegate-åè®®" class="headerlink" title="4.2 WKUIDelegate åè®®"></a>4.2 WKUIDelegate åè®®</h4><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#pragma</span> <span class="selector-tag">mark</span> <span class="selector-tag">-</span> <span class="selector-tag">WKUIDelegate</span></span><br><span class="line"><span class="comment">/// åˆ›å»ºä¸€ä¸ªæ–°çš„WebView</span></span><br><span class="line"><span class="selector-tag">-</span> (WKWebView *)<span class="selector-tag">webView</span><span class="selector-pseudo">:(WKWebView</span> *)<span class="selector-tag">webView</span> <span class="selector-tag">createWebViewWithConfiguration</span><span class="selector-pseudo">:(WKWebViewConfiguration</span> *)<span class="selector-tag">configuration</span> <span class="selector-tag">forNavigationAction</span><span class="selector-pseudo">:(WKNavigationAction</span> *)<span class="selector-tag">navigationAction</span> <span class="selector-tag">windowFeatures</span><span class="selector-pseudo">:(WKWindowFeatures</span> *)<span class="selector-tag">windowFeatures</span> &#123;</span><br><span class="line"><span class="selector-tag">return</span> <span class="selector-tag">nil</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*  webç•Œé¢ä¸­æœ‰å¼¹å‡ºè­¦å‘Šæ¡†æ—¶è°ƒç”¨</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*  @param webView           å®ç°è¯¥ä»£ç†çš„webview</span></span><br><span class="line"><span class="comment">*  @param message           è­¦å‘Šæ¡†ä¸­çš„å†…å®¹</span></span><br><span class="line"><span class="comment">*  @param frame             ä¸»çª—å£</span></span><br><span class="line"><span class="comment">*  @param completionHandler è­¦å‘Šæ¡†æ¶ˆå¤±è°ƒç”¨</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="selector-tag">-</span> (void)<span class="selector-tag">webView</span><span class="selector-pseudo">:(WKWebView</span> *)<span class="selector-tag">webView</span> <span class="selector-tag">runJavaScriptAlertPanelWithMessage</span><span class="selector-pseudo">:(NSString</span> *)<span class="selector-tag">message</span> <span class="selector-tag">initiatedByFrame</span><span class="selector-pseudo">:(void</span> (^)())<span class="selector-tag">completionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// è¾“å…¥æ¡†</span></span><br><span class="line"><span class="selector-tag">-</span> (void)<span class="selector-tag">webView</span><span class="selector-pseudo">:(WKWebView</span> *)<span class="selector-tag">webView</span> <span class="selector-tag">runJavaScriptTextInputPanelWithPrompt</span><span class="selector-pseudo">:(NSString</span> *)<span class="selector-tag">prompt</span> <span class="selector-tag">defaultText</span><span class="selector-pseudo">:(nullable</span> <span class="selector-tag">NSString</span> *)<span class="selector-tag">defaultText</span> <span class="selector-tag">initiatedByFrame</span><span class="selector-pseudo">:(WKFrameInfo</span> *)<span class="selector-tag">frame</span> <span class="selector-tag">completionHandler</span><span class="selector-pseudo">:(void</span> (^)(NSString * __nullable result))<span class="selector-tag">completionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/// ç¡®è®¤æ¡†</span></span><br><span class="line"><span class="selector-tag">-</span> (void)<span class="selector-tag">webView</span><span class="selector-pseudo">:(WKWebView</span> *)<span class="selector-tag">webView</span> <span class="selector-tag">runJavaScriptConfirmPanelWithMessage</span><span class="selector-pseudo">:(NSString</span> *)<span class="selector-tag">message</span> <span class="selector-tag">initiatedByFrame</span><span class="selector-pseudo">:(WKFrameInfo</span> *)<span class="selector-tag">frame</span> <span class="selector-tag">completionHandler</span><span class="selector-pseudo">:(void</span> (^)(BOOL result))<span class="selector-tag">completionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/// è­¦å‘Šæ¡†</span></span><br><span class="line"><span class="selector-tag">-</span> (void)<span class="selector-tag">webView</span><span class="selector-pseudo">:(WKWebView</span> *)<span class="selector-tag">webView</span> <span class="selector-tag">runJavaScriptAlertPanelWithMessage</span><span class="selector-pseudo">:(NSString</span> *)<span class="selector-tag">message</span> <span class="selector-tag">initiatedByFrame</span><span class="selector-pseudo">:(WKFrameInfo</span> *)<span class="selector-tag">frame</span> <span class="selector-tag">completionHandler</span><span class="selector-pseudo">:(void</span> (^)(void))<span class="selector-tag">completionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-å¦å¤–æœé›†äº†ä¸€äº›-WKWebView-å¸¸ç”¨çš„å±æ€§ï¼š"><a href="#5-å¦å¤–æœé›†äº†ä¸€äº›-WKWebView-å¸¸ç”¨çš„å±æ€§ï¼š" class="headerlink" title="5.å¦å¤–æœé›†äº†ä¸€äº› WKWebView å¸¸ç”¨çš„å±æ€§ï¼š"></a>5.å¦å¤–æœé›†äº†ä¸€äº› WKWebView å¸¸ç”¨çš„å±æ€§ï¼š</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">â€¢    <span class="string">WKBackForwardListItem:</span> webviewä¸­åé€€åˆ—è¡¨é‡Œçš„æŸä¸€ä¸ªç½‘é¡µã€‚</span><br><span class="line">â€¢    <span class="string">WKFrameInfo:</span> åŒ…å«ä¸€ä¸ªç½‘é¡µçš„å¸ƒå±€ä¿¡æ¯ã€‚</span><br><span class="line">â€¢    <span class="string">WKNavigation:</span> åŒ…å«ä¸€ä¸ªç½‘é¡µçš„åŠ è½½è¿›åº¦ä¿¡æ¯ã€‚</span><br><span class="line">â€¢    <span class="string">WKPreferences:</span> æ¦‚æ‹¬ä¸€ä¸ª webview çš„åå¥½è®¾ç½®ã€‚</span><br><span class="line">â€¢    <span class="string">WKProcessPool:</span> è¡¨ç¤ºä¸€ä¸ª web å†…å®¹åŠ è½½æ± ã€‚</span><br><span class="line">â€¢    <span class="string">WKScriptMessage:</span> åŒ…å«ç½‘é¡µå‘å‡ºçš„ä¿¡æ¯ã€‚</span><br><span class="line">â€¢    <span class="string">WKUserScript:</span>è¡¨ç¤ºå¯ä»¥è¢«ç½‘é¡µæ¥å—çš„ç”¨æˆ·è„šæœ¬ã€‚</span><br><span class="line">â€¢    <span class="string">WKWebViewConfiguration:</span> åˆå§‹åŒ– webview çš„è®¾ç½®ã€‚</span><br><span class="line">â€¢    <span class="string">WKWindowFeatures:</span> æŒ‡å®šåŠ è½½æ–°ç½‘é¡µæ—¶çš„çª—å£å±æ€§ã€‚</span><br><span class="line">â€¢    <span class="string">WKScriptMessageHandler:</span> æä¾›ä»ç½‘é¡µä¸­æ”¶æ¶ˆæ¯çš„å›è°ƒæ–¹æ³•ã€‚</span><br></pre></td></tr></table></figure>
<p>å°å°¾å·´:æ­£åƒå¼€å¤´è¯´çš„é‚£æ ·ï¼Œ WKWebView ç›¸æ¯”UIWebViewæ¥è¯´æ€§èƒ½å¥½ï¼Œé€Ÿåº¦å¿«ï¼Œå†…å­˜å°ï¼ŒåŠŸèƒ½å¤šâ€¦â€¦ä½†ç°åœ¨å¼€å‘ä¸­æ™®éç”¨çš„è¿˜æ˜¯ UIWebViewï¼Œè¿™æ˜¯å› ä¸ºå¤§å¤šæ•°Appéœ€è¦æ”¯æŒiOS7åŠä»¥ä¸Šçš„ç‰ˆæœ¬ã€‚ä½†è‹¹æœä¹‹æ‰€ä»¥æ¨å‡º WKWebView å°±æ˜¯ä¸ºäº†å¼¥è¡¥ UIWebView çš„ç§ç§ä¸è¶³ï¼Œé€æ¸å–ä»£ UIWebViewï¼Œç›¸ä¿¡ä¸ä¹…çš„å°†æ¥ï¼Œç½‘é¡µä¼šæˆä¸º WKWebView çš„å¤©ä¸‹ï¼</p>
<p><em>ä»Šå¤©å°±ç®€å•çš„å†™åˆ°è¿™é‡Œï¼Œä»¥åå¦‚æœç”¨åˆ°å…¶å®ƒçš„äº†ï¼Œå†å’Œå¤§å®¶åˆ†äº«ğŸ˜„!</em></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/15/iOSå¼€å‘ä¹‹ - åˆ·æ–°æ¡†æ¶ MJRefresh çš„ä½¿ç”¨/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="åˆ˜æœ‹å¤">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ä»¥æ¢¦ä¸ºé©¬">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/15/iOSå¼€å‘ä¹‹ - åˆ·æ–°æ¡†æ¶ MJRefresh çš„ä½¿ç”¨/" itemprop="url">
                  iOSå¼€å‘ä¹‹ - åˆ·æ–°æ¡†æ¶ MJRefresh çš„ä½¿ç”¨
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
                
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-15T12:30:20+08:00">2018-04-15</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="http://upload-images.jianshu.io/upload_images/2665449-9e9c86ec592c3c2f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="MJRefresh"></p>
<blockquote>
<p>ä¸‹æ‹‰åˆ·æ–°æ§ä»¶ç›®å‰æ¯”è¾ƒç«çš„æœ‰å¥½å‡ ç§ï¼Œæ­¤å‰ç”¨è¿‡<a href="https://github.com/CoderMJLee/MJRefresh/blob/master/README.md" target="_blank" rel="noopener">MJRefresh</a> å’Œ<a href="https://github.com/samvermette/SVPullToRefresh" target="_blank" rel="noopener"> SVPullToRefresh</a>ï¼Œç›¸å¯¹è€Œè¨€ï¼Œè¿˜æ˜¯è§‰å¾— MJRefresh æ›´å¥½ç”¨ï¼å› æ­¤æŠ½äº†äº›æ—¶é—´æ•´ç†äº† MJRefresh çš„ç”¨æ³•ã€‚ä»¥ä¸‹æ˜¯æ–‡ç« å†…å®¹ã€‚ã€‚ã€‚</p>
</blockquote>
<h1 id="ã€æ–‡ç« ç›®å½•ã€‘"><a href="#ã€æ–‡ç« ç›®å½•ã€‘" class="headerlink" title="ã€æ–‡ç« ç›®å½•ã€‘"></a>ã€æ–‡ç« ç›®å½•ã€‘</h1><h2 id="ä¸€ã€ç±»ç»“æ„å›¾"><a href="#ä¸€ã€ç±»ç»“æ„å›¾" class="headerlink" title="ä¸€ã€ç±»ç»“æ„å›¾"></a>ä¸€ã€ç±»ç»“æ„å›¾</h2><ul>
<li>MJRefreshComponent.h</li>
<li>MJRefreshHeader.h</li>
<li>MJRefreshFooter.h</li>
<li>MJRefreshAutoFooter.h</li>
</ul>
<h2 id="äºŒã€å‚è€ƒä¾‹å­"><a href="#äºŒã€å‚è€ƒä¾‹å­" class="headerlink" title="äºŒã€å‚è€ƒä¾‹å­"></a>äºŒã€å‚è€ƒä¾‹å­</h2><ul>
<li>ä¸‹æ‹‰åˆ·æ–°01-é»˜è®¤</li>
<li>ä¸‹æ‹‰åˆ·æ–°02-åŠ¨ç”»å›¾ç‰‡</li>
<li>ä¸‹æ‹‰åˆ·æ–°03-éšè—æ—¶é—´</li>
<li>ä¸‹æ‹‰åˆ·æ–°04-éšè—çŠ¶æ€å’Œæ—¶é—´</li>
<li>ä¸‹æ‹‰åˆ·æ–°05-è‡ªå®šä¹‰æ–‡å­—</li>
<li>ä¸‹æ‹‰åˆ·æ–°06-è‡ªå®šä¹‰åˆ·æ–°æ§ä»¶</li>
<li>ä¸Šæ‹‰åˆ·æ–°01-é»˜è®¤</li>
<li>ä¸Šæ‹‰åˆ·æ–°02-åŠ¨ç”»å›¾ç‰‡</li>
<li>ä¸Šæ‹‰åˆ·æ–°03-éšè—åˆ·æ–°çŠ¶æ€çš„æ–‡å­—</li>
<li>ä¸Šæ‹‰åˆ·æ–°04-å…¨éƒ¨åŠ è½½å®Œæ¯•</li>
<li>ä¸Šæ‹‰åˆ·æ–°05-è‡ªå®šä¹‰æ–‡å­—</li>
<li>ä¸Šæ‹‰åˆ·æ–°06-åŠ è½½åéšè—</li>
<li>ä¸Šæ‹‰åˆ·æ–°07-è‡ªåŠ¨å›å¼¹çš„ä¸Šæ‹‰01</li>
<li>ä¸Šæ‹‰åˆ·æ–°08-è‡ªåŠ¨å›å¼¹çš„ä¸Šæ‹‰02</li>
<li>ä¸Šæ‹‰åˆ·æ–°09-è‡ªå®šä¹‰åˆ·æ–°æ§ä»¶(è‡ªåŠ¨åˆ·æ–°)</li>
<li>ä¸Šæ‹‰åˆ·æ–°10-è‡ªå®šä¹‰åˆ·æ–°æ§ä»¶(è‡ªåŠ¨å›å¼¹)</li>
<li>UICollectionView01-ä¸Šä¸‹æ‹‰åˆ·æ–°</li>
<li>UIWebView01-ä¸‹æ‹‰åˆ·æ–°</li>
</ul>
<h1 id="ã€æ–‡ç« å†…å®¹ã€‘"><a href="#ã€æ–‡ç« å†…å®¹ã€‘" class="headerlink" title="ã€æ–‡ç« å†…å®¹ã€‘"></a>ã€æ–‡ç« å†…å®¹ã€‘</h1><h2 id="1-ç±»ç»“æ„å›¾"><a href="#1-ç±»ç»“æ„å›¾" class="headerlink" title="1.ç±»ç»“æ„å›¾"></a>1.ç±»ç»“æ„å›¾</h2><p><img src="http://upload-images.jianshu.io/upload_images/2665449-4a80291bb05b5283.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç±»ç»“æ„å›¾"></p>
<h3 id="MJRefreshComponent-h"><a href="#MJRefreshComponent-h" class="headerlink" title="MJRefreshComponent.h"></a>MJRefreshComponent.h</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** åˆ·æ–°æ§ä»¶çš„åŸºç±» */</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MJRefreshComponent</span> : <span class="title">UIView</span></span></span><br><span class="line"><span class="meta">#pragma mark - åˆ·æ–°çŠ¶æ€æ§åˆ¶</span></span><br><span class="line"><span class="comment">/** è¿›å…¥åˆ·æ–°çŠ¶æ€ */</span></span><br><span class="line">- (<span class="keyword">void</span>)beginRefreshing;</span><br><span class="line"><span class="comment">/** ç»“æŸåˆ·æ–°çŠ¶æ€ */</span></span><br><span class="line">- (<span class="keyword">void</span>)endRefreshing;</span><br><span class="line"><span class="comment">/** æ˜¯å¦æ­£åœ¨åˆ·æ–° */</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)isRefreshing;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - å…¶å®ƒ</span></span><br><span class="line"><span class="comment">/** æ ¹æ®æ‹–æ‹½æ¯”ä¾‹è‡ªåŠ¨åˆ‡æ¢é€æ˜åº¦ */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>, <span class="keyword">getter</span>=isAutomaticallyChangeAlpha) <span class="built_in">BOOL</span> automaticallyChangeAlpha;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="MJRefreshHeader-h"><a href="#MJRefreshHeader-h" class="headerlink" title="MJRefreshHeader.h"></a>MJRefreshHeader.h</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MJRefreshHeader</span> : <span class="title">MJRefreshComponent</span></span></span><br><span class="line"><span class="comment">/** åˆ›å»º header */</span></span><br><span class="line">+ (<span class="keyword">instancetype</span>)headerWithRefreshingBlock:(MJRefreshComponentRefreshingBlock)refreshingBlock;</span><br><span class="line"><span class="comment">/** åˆ›å»º header */</span></span><br><span class="line">+ (<span class="keyword">instancetype</span>)headerWithRefreshingTarget:(<span class="keyword">id</span>)target refreshingAction:(SEL)action;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** è¿™ä¸ª key ç”¨æ¥å­˜å‚¨ä¸Šä¸€æ¬¡ä¸‹æ‹‰åˆ·æ–°æˆåŠŸçš„æ—¶é—´ */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">copy</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSString</span> *lastUpdatedTimeKey;</span><br><span class="line"><span class="comment">/** ä¸Šä¸€æ¬¡ä¸‹æ‹‰åˆ·æ–°æˆåŠŸçš„æ—¶é—´ */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">NSDate</span> *lastUpdatedTime;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** å¿½ç•¥å¤šå°‘ scrollView çš„ contentInset çš„é¡¶éƒ¨ */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="built_in">CGFloat</span> ignoredScrollViewContentInsetTop;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="MJRefreshFooter-h"><a href="#MJRefreshFooter-h" class="headerlink" title="MJRefreshFooter.h"></a>MJRefreshFooter.h</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MJRefreshFooter</span> : <span class="title">MJRefreshComponent</span></span></span><br><span class="line"><span class="comment">/** åˆ›å»º footer */</span></span><br><span class="line">+ (<span class="keyword">instancetype</span>)footerWithRefreshingBlock:(MJRefreshComponentRefreshingBlock)refreshingBlock;</span><br><span class="line"><span class="comment">/** åˆ›å»º footer */</span></span><br><span class="line">+ (<span class="keyword">instancetype</span>)footerWithRefreshingTarget:(<span class="keyword">id</span>)target refreshingAction:(SEL)action;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** æç¤ºæ²¡æœ‰æ›´å¤šçš„æ•°æ® */</span></span><br><span class="line">- (<span class="keyword">void</span>)noticeNoMoreData;</span><br><span class="line"><span class="comment">/** é‡ç½®æ²¡æœ‰æ›´å¤šçš„æ•°æ®ï¼ˆæ¶ˆé™¤æ²¡æœ‰æ›´å¤šæ•°æ®çš„çŠ¶æ€ï¼‰ */</span></span><br><span class="line">- (<span class="keyword">void</span>)resetNoMoreData;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** å¿½ç•¥å¤šå°‘ scrollView çš„ contentInset çš„åº•éƒ¨*/</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="built_in">CGFloat</span> ignoredScrollViewContentInsetBottom;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** è‡ªåŠ¨æ ¹æ®æœ‰æ— æ•°æ®æ¥æ˜¾ç¤ºå’Œéšè— */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="built_in">BOOL</span> automaticallyHidden;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="MJRefreshAutoFooter-h"><a href="#MJRefreshAutoFooter-h" class="headerlink" title="MJRefreshAutoFooter.h"></a>MJRefreshAutoFooter.h</h3><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@interface</span> <span class="attribute">MJRefreshAutoFooter </span>: MJRefreshFooter</span><br><span class="line"><span class="comment">/** æ˜¯å¦è‡ªåŠ¨åˆ·æ–°(é»˜è®¤ä¸º YES) */</span></span><br><span class="line"><span class="variable">@property</span> (assign, nonatomic, getter=isAutomaticallyRefresh) BOOL automaticallyRefresh;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** å½“åº•éƒ¨æ§ä»¶å‡ºç°å¤šå°‘æ—¶å°±è‡ªåŠ¨åˆ·æ–°(é»˜è®¤ä¸º1.0ï¼Œä¹Ÿå°±æ˜¯åº•éƒ¨æ§ä»¶å®Œå…¨å‡ºç°æ—¶ï¼Œæ‰ä¼šè‡ªåŠ¨åˆ·æ–°) */</span></span><br><span class="line"><span class="variable">@property</span> (assign, nonatomic) CGFloat appearencePercentTriggerAutoRefresh;</span><br><span class="line"><span class="variable">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-å‚è€ƒä¾‹å­"><a href="#2-å‚è€ƒä¾‹å­" class="headerlink" title="2.å‚è€ƒä¾‹å­"></a>2.å‚è€ƒä¾‹å­</h2><p>ps: å¯ä»¥ä¸‹è½½ <a href="https://github.com/CoderMJLee/MJRefresh" target="_blank" rel="noopener">MJRefresh</a>è¯•è¯•<br><img src="http://upload-images.jianshu.io/upload_images/2665449-9bfe1621e9aea9f6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="MJRefresh æ¼”ç¤º"></p>
<h3 id="ä¸‹æ‹‰åˆ·æ–°01-é»˜è®¤"><a href="#ä¸‹æ‹‰åˆ·æ–°01-é»˜è®¤" class="headerlink" title="ä¸‹æ‹‰åˆ·æ–°01-é»˜è®¤"></a>ä¸‹æ‹‰åˆ·æ–°01-é»˜è®¤</h3><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">self</span>.<span class="built_in">table</span>View.mj_header = [MJRefreshNormalHeader headerWithRefreshingBlock:^&#123;</span><br><span class="line">// è¿›å…¥åˆ·æ–°çŠ¶æ€åä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸ª<span class="built_in">block</span></span><br><span class="line">&#125;];</span><br><span class="line">// æˆ–</span><br><span class="line">// è®¾ç½®å›è°ƒï¼ˆä¸€æ—¦è¿›å…¥åˆ·æ–°çŠ¶æ€ï¼Œå°±è°ƒç”¨ target çš„ actionï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨ <span class="literal">self</span> çš„ <span class="built_in">load</span>NewData æ–¹æ³•ï¼‰</span><br><span class="line"><span class="literal">self</span>.<span class="built_in">table</span>View.mj_header = [MJRefreshNormalHeader headerWithRefreshingTarget:<span class="literal">self</span> refreshingAction:@selector(<span class="built_in">load</span>NewData)];</span><br><span class="line">// é©¬ä¸Šè¿›å…¥åˆ·æ–°çŠ¶æ€</span><br><span class="line">[<span class="literal">self</span>.<span class="built_in">table</span>View.mj_header beginRefreshing];</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-a3bfaa0e6bfbc461.gif?imageMogr2/auto-orient/strip" alt="ä¸‹æ‹‰åˆ·æ–°01-é»˜è®¤"></p>
<h3 id="ä¸‹æ‹‰åˆ·æ–°02-åŠ¨ç”»å›¾ç‰‡"><a href="#ä¸‹æ‹‰åˆ·æ–°02-åŠ¨ç”»å›¾ç‰‡" class="headerlink" title="ä¸‹æ‹‰åˆ·æ–°02-åŠ¨ç”»å›¾ç‰‡"></a>ä¸‹æ‹‰åˆ·æ–°02-åŠ¨ç”»å›¾ç‰‡</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®å›è°ƒï¼ˆä¸€æ—¦è¿›å…¥åˆ·æ–°çŠ¶æ€ï¼Œå°±è°ƒç”¨ targett çš„ actionï¼Œå³è°ƒç”¨ self çš„ loadNewData æ–¹æ³•ï¼‰</span></span><br><span class="line">MJRefreshGifHeader *header = [MJRefreshGifHeader <span class="string">headerWithRefreshingTarget:</span>self <span class="string">refreshingAction:</span><span class="meta">@selector</span>(loadNewData)];</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®æ™®é€šçŠ¶æ€çš„åŠ¨ç”»å›¾ç‰‡</span></span><br><span class="line">NSArray *idleImages = @[@<span class="string">"å›¾ç‰‡1"</span>, @<span class="string">"å›¾ç‰‡2"</span>, @<span class="string">"å›¾ç‰‡3"</span>];</span><br><span class="line">[header <span class="string">setImages:</span>idleImages <span class="string">forState:</span>MJRefreshStateIdle];</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®å³å°†åˆ·æ–°çŠ¶æ€çš„åŠ¨ç”»å›¾ç‰‡ï¼ˆä¸€æ¾å¼€å°±ä¼šåˆ·æ–°çš„çŠ¶æ€ï¼‰</span></span><br><span class="line">NSArray *pullingImages = @[@<span class="string">"å›¾ç‰‡1"</span>, @<span class="string">"å›¾ç‰‡2"</span>, @<span class="string">"å›¾ç‰‡3"</span>];</span><br><span class="line">[header <span class="string">setImages:</span>pullingImages <span class="string">forState:</span>MJRefreshStatePulling];</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®æ­£åœ¨åˆ·æ–°çŠ¶æ€çš„åŠ¨ç”»å›¾ç‰‡</span></span><br><span class="line">NSArray *refreshingImages = @[@<span class="string">"å›¾ç‰‡1"</span>, @<span class="string">"å›¾ç‰‡2"</span>, @<span class="string">"å›¾ç‰‡3"</span>];</span><br><span class="line">[header <span class="string">setImages:</span>refreshingImages <span class="string">forState:</span>MJRefreshStateRefreshing];</span><br><span class="line"><span class="comment">// è®¾ç½® header</span></span><br><span class="line">self.tableView.mj_header = header;</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-392f24b00061ea83.gif?imageMogr2/auto-orient/strip" alt="ä¸‹æ‹‰åˆ·æ–°02-åŠ¨ç”»å›¾ç‰‡"></p>
<h3 id="ä¸‹æ‹‰åˆ·æ–°03-éšè—æ—¶é—´"><a href="#ä¸‹æ‹‰åˆ·æ–°03-éšè—æ—¶é—´" class="headerlink" title="ä¸‹æ‹‰åˆ·æ–°03-éšè—æ—¶é—´"></a>ä¸‹æ‹‰åˆ·æ–°03-éšè—æ—¶é—´</h3><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// éšè—æ—¶é—´</span></span><br><span class="line">header.lastUpdatedTimeLabel.hidden = <span class="keyword">YES</span>;</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-a3c38c436477cacc.gif?imageMogr2/auto-orient/strip" alt="ä¸‹æ‹‰åˆ·æ–°03-éšè—æ—¶é—´"></p>
<h3 id="ä¸‹æ‹‰åˆ·æ–°04-éšè—çŠ¶æ€å’Œæ—¶é—´"><a href="#ä¸‹æ‹‰åˆ·æ–°04-éšè—çŠ¶æ€å’Œæ—¶é—´" class="headerlink" title="ä¸‹æ‹‰åˆ·æ–°04-éšè—çŠ¶æ€å’Œæ—¶é—´"></a>ä¸‹æ‹‰åˆ·æ–°04-éšè—çŠ¶æ€å’Œæ—¶é—´</h3><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// éšè—æ—¶é—´</span><br><span class="line">header.lastUpdatedTimeLabel.hidden = YES;</span><br><span class="line"></span><br><span class="line">// éšè—çŠ¶æ€</span><br><span class="line">header.<span class="keyword">state</span>Label.hidden = YES;</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-bea00ff6a76a81fd.gif?imageMogr2/auto-orient/strip" alt="ä¸‹æ‹‰åˆ·æ–°04-éšè—çŠ¶æ€å’Œæ—¶é—´"></p>
<h3 id="ä¸‹æ‹‰åˆ·æ–°05-è‡ªå®šä¹‰æ–‡å­—"><a href="#ä¸‹æ‹‰åˆ·æ–°05-è‡ªå®šä¹‰æ–‡å­—" class="headerlink" title="ä¸‹æ‹‰åˆ·æ–°05-è‡ªå®šä¹‰æ–‡å­—"></a>ä¸‹æ‹‰åˆ·æ–°05-è‡ªå®šä¹‰æ–‡å­—</h3><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// è®¾ç½®æ–‡å­—</span><br><span class="line">[header <span class="built_in">set</span>Title:@<span class="string">"Pull down to refresh"</span> <span class="keyword">for</span>State:MJRefreshStateIdle];</span><br><span class="line">[header <span class="built_in">set</span>Title:@<span class="string">"Release to refresh"</span> <span class="keyword">for</span>State:MJRefreshStatePulling];</span><br><span class="line">[header <span class="built_in">set</span>Title:@<span class="string">"Loading ..."</span> <span class="keyword">for</span>State:MJRefreshStateRefreshing];</span><br><span class="line"></span><br><span class="line">// è®¾ç½®å­—ä½“</span><br><span class="line">header.<span class="keyword">state</span>Label.font = [UIFont systemFontOfSize:<span class="number">15</span>];</span><br><span class="line">header.lastUpdatedTimeLabel.font = [UIFont systemFontOfSize:<span class="number">14</span>];</span><br><span class="line"></span><br><span class="line">// è®¾ç½®é¢œè‰²</span><br><span class="line">header.<span class="keyword">state</span>Label.textColor = [UIColor redColor];</span><br><span class="line">header.lastUpdatedTimeLabel.textColor = [UIColor blueColor];</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-ad9e5a170567e3bb.gif?imageMogr2/auto-orient/strip" alt="ä¸‹æ‹‰åˆ·æ–°05-è‡ªå®šä¹‰æ–‡å­—"></p>
<h3 id="ä¸‹æ‹‰åˆ·æ–°06-è‡ªå®šä¹‰åˆ·æ–°æ§ä»¶"><a href="#ä¸‹æ‹‰åˆ·æ–°06-è‡ªå®šä¹‰åˆ·æ–°æ§ä»¶" class="headerlink" title="ä¸‹æ‹‰åˆ·æ–°06-è‡ªå®šä¹‰åˆ·æ–°æ§ä»¶"></a>ä¸‹æ‹‰åˆ·æ–°06-è‡ªå®šä¹‰åˆ·æ–°æ§ä»¶</h3><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">self</span>.tableView.mj_header = [MJDIYHeader <span class="symbol">headerWithRefreshingTarget:</span><span class="keyword">self</span> <span class="symbol">refreshingAction:</span><span class="variable">@selector</span>(loadNewData)];</span><br><span class="line">/<span class="regexp">/ å…·ä½“å®ç°å‚è€ƒ MJDIYHeader.h å’Œ MJDIYHeader.m</span></span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-02fca65a8c891905.gif?imageMogr2/auto-orient/strip" alt="ä¸‹æ‹‰åˆ·æ–°06-è‡ªå®šä¹‰åˆ·æ–°æ§ä»¶"></p>
<h3 id="ä¸Šæ‹‰åˆ·æ–°01-é»˜è®¤"><a href="#ä¸Šæ‹‰åˆ·æ–°01-é»˜è®¤" class="headerlink" title="ä¸Šæ‹‰åˆ·æ–°01-é»˜è®¤"></a>ä¸Šæ‹‰åˆ·æ–°01-é»˜è®¤</h3><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">self</span>.<span class="built_in">table</span>View.mj_footer = [MJRefreshAutoNormalFooter footerWithRefreshingBlock:^&#123;</span><br><span class="line">// è¿›å…¥åˆ·æ–°çŠ¶æ€åä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸ª <span class="built_in">block</span></span><br><span class="line">&#125;];</span><br><span class="line">// æˆ–</span><br><span class="line">// è®¾ç½®å›è°ƒï¼ˆä¸€æ—¦è¿›å…¥åˆ·æ–°çŠ¶æ€ï¼Œå°±è°ƒç”¨ target çš„ actionï¼Œå³è°ƒç”¨ <span class="literal">self</span> çš„ <span class="built_in">load</span>MoreData æ–¹æ³•ï¼‰</span><br><span class="line"><span class="literal">self</span>.<span class="built_in">table</span>View.mj_footer = [MJRefreshAutoNormalFooter footerWithRefreshingTarget:<span class="literal">self</span> refreshingAction:@selector(<span class="built_in">load</span>MoreData)];</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-475e06e1f29fb149.gif?imageMogr2/auto-orient/strip" alt="ä¸Šæ‹‰åˆ·æ–°01-é»˜è®¤"></p>
<h3 id="ä¸Šæ‹‰åˆ·æ–°02-åŠ¨ç”»å›¾ç‰‡"><a href="#ä¸Šæ‹‰åˆ·æ–°02-åŠ¨ç”»å›¾ç‰‡" class="headerlink" title="ä¸Šæ‹‰åˆ·æ–°02-åŠ¨ç”»å›¾ç‰‡"></a>ä¸Šæ‹‰åˆ·æ–°02-åŠ¨ç”»å›¾ç‰‡</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®å›è°ƒï¼ˆä¸€æ—¦è¿›å…¥åˆ·æ–°çŠ¶æ€ï¼Œå°±è°ƒç”¨ target çš„ actionï¼Œå³è°ƒç”¨ self çš„ loadMoreData æ–¹æ³•ï¼‰</span></span><br><span class="line">MJRefreshAutoGifFooter *footer = [MJRefreshAutoGifFooter <span class="string">footerWithRefreshingTarget:</span>self <span class="string">refreshingAction:</span><span class="meta">@selector</span>(loadMoreData)];</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®åˆ·æ–°å›¾ç‰‡</span></span><br><span class="line">NSArray *refreshingImages = @[@<span class="string">"å›¾ç‰‡1"</span>, @<span class="string">"å›¾ç‰‡2"</span>, @<span class="string">"å›¾ç‰‡3"</span>];</span><br><span class="line">[footer <span class="string">setImages:</span>refreshingImages <span class="string">forState:</span>MJRefreshStateRefreshing];</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®å°¾éƒ¨</span></span><br><span class="line">self.tableView.mj_footer = footer;</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-15a83363eff10b1e.gif?imageMogr2/auto-orient/strip" alt="ä¸Šæ‹‰åˆ·æ–°02-åŠ¨ç”»å›¾ç‰‡"></p>
<h3 id="ä¸Šæ‹‰åˆ·æ–°03-éšè—åˆ·æ–°çŠ¶æ€çš„æ–‡å­—"><a href="#ä¸Šæ‹‰åˆ·æ–°03-éšè—åˆ·æ–°çŠ¶æ€çš„æ–‡å­—" class="headerlink" title="ä¸Šæ‹‰åˆ·æ–°03-éšè—åˆ·æ–°çŠ¶æ€çš„æ–‡å­—"></a>ä¸Šæ‹‰åˆ·æ–°03-éšè—åˆ·æ–°çŠ¶æ€çš„æ–‡å­—</h3><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// éšè—åˆ·æ–°çŠ¶æ€çš„æ–‡å­—</span><br><span class="line">footer.refreshingTitleHidden = YES;</span><br><span class="line">// å¦‚æœæ²¡æœ‰ä¸Šé¢çš„æ–¹æ³•ï¼Œå°±ç”¨footer.<span class="keyword">state</span>Label.hidden = YES;</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-7dcd46bd73d0423f.gif?imageMogr2/auto-orient/strip" alt="ä¸Šæ‹‰åˆ·æ–°03-éšè—åˆ·æ–°çŠ¶æ€çš„æ–‡å­—"></p>
<h3 id="ä¸Šæ‹‰åˆ·æ–°04-å…¨éƒ¨åŠ è½½å®Œæ¯•"><a href="#ä¸Šæ‹‰åˆ·æ–°04-å…¨éƒ¨åŠ è½½å®Œæ¯•" class="headerlink" title="ä¸Šæ‹‰åˆ·æ–°04-å…¨éƒ¨åŠ è½½å®Œæ¯•"></a>ä¸Šæ‹‰åˆ·æ–°04-å…¨éƒ¨åŠ è½½å®Œæ¯•</h3><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å˜ä¸ºæ²¡æœ‰æ›´å¤šæ•°æ®çš„çŠ¶æ€</span></span><br><span class="line">[<span class="meta">footer endRefreshingWithNoMoreData</span>];</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-3f0e9a88feb33219.gif?imageMogr2/auto-orient/strip" alt="ä¸Šæ‹‰åˆ·æ–°04-å…¨éƒ¨åŠ è½½å®Œæ¯•"></p>
<h3 id="ä¸Šæ‹‰åˆ·æ–°05-è‡ªå®šä¹‰æ–‡å­—"><a href="#ä¸Šæ‹‰åˆ·æ–°05-è‡ªå®šä¹‰æ–‡å­—" class="headerlink" title="ä¸Šæ‹‰åˆ·æ–°05-è‡ªå®šä¹‰æ–‡å­—"></a>ä¸Šæ‹‰åˆ·æ–°05-è‡ªå®šä¹‰æ–‡å­—</h3><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// è®¾ç½®æ–‡å­—</span><br><span class="line">[footer <span class="built_in">set</span>Title:@<span class="string">"Click or drag up to refresh"</span> <span class="keyword">for</span>State:MJRefreshStateIdle];</span><br><span class="line">[footer <span class="built_in">set</span>Title:@<span class="string">"Loading more ..."</span> <span class="keyword">for</span>State:MJRefreshStateRefreshing];</span><br><span class="line">[footer <span class="built_in">set</span>Title:@<span class="string">"No more data"</span> <span class="keyword">for</span>State:MJRefreshStateNoMoreData];</span><br><span class="line"></span><br><span class="line">// è®¾ç½®å­—ä½“</span><br><span class="line">footer.<span class="keyword">state</span>Label.font = [UIFont systemFontOfSize:<span class="number">17</span>];</span><br><span class="line"></span><br><span class="line">// è®¾ç½®é¢œè‰²</span><br><span class="line">footer.<span class="keyword">state</span>Label.textColor = [UIColor blueColor];</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-f9383ff9ab48a6b2.gif?imageMogr2/auto-orient/strip" alt="ä¸Šæ‹‰åˆ·æ–°05-è‡ªå®šä¹‰æ–‡å­—"></p>
<h3 id="ä¸Šæ‹‰åˆ·æ–°06-åŠ è½½åéšè—"><a href="#ä¸Šæ‹‰åˆ·æ–°06-åŠ è½½åéšè—" class="headerlink" title="ä¸Šæ‹‰åˆ·æ–°06-åŠ è½½åéšè—"></a>ä¸Šæ‹‰åˆ·æ–°06-åŠ è½½åéšè—</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// éšè—å½“å‰çš„ä¸Šæ‹‰åˆ·æ–°æ§ä»¶</span></span><br><span class="line"><span class="keyword">self</span>.tableView.mj_footer.hidden = <span class="literal">YES</span>;</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-44824bc808564096.gif?imageMogr2/auto-orient/strip" alt="ä¸Šæ‹‰åˆ·æ–°06-åŠ è½½åéšè—"></p>
<h3 id="ä¸Šæ‹‰åˆ·æ–°07-è‡ªåŠ¨å›å¼¹çš„ä¸Šæ‹‰01"><a href="#ä¸Šæ‹‰åˆ·æ–°07-è‡ªåŠ¨å›å¼¹çš„ä¸Šæ‹‰01" class="headerlink" title="ä¸Šæ‹‰åˆ·æ–°07-è‡ªåŠ¨å›å¼¹çš„ä¸Šæ‹‰01"></a>ä¸Šæ‹‰åˆ·æ–°07-è‡ªåŠ¨å›å¼¹çš„ä¸Šæ‹‰01</h3><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">self</span>.<span class="built_in">table</span>View.mj_footer = [MJRefreshBackNormalFooter footerWithRefreshingTarget:<span class="literal">self</span> refreshingAction:@selector(<span class="built_in">load</span>MoreData)];</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-ab778a9f00a22a4f.gif?imageMogr2/auto-orient/strip" alt="ä¸Šæ‹‰åˆ·æ–°07-è‡ªåŠ¨å›å¼¹çš„ä¸Šæ‹‰01"></p>
<h3 id="ä¸Šæ‹‰åˆ·æ–°08-è‡ªåŠ¨å›å¼¹çš„ä¸Šæ‹‰02"><a href="#ä¸Šæ‹‰åˆ·æ–°08-è‡ªåŠ¨å›å¼¹çš„ä¸Šæ‹‰02" class="headerlink" title="ä¸Šæ‹‰åˆ·æ–°08-è‡ªåŠ¨å›å¼¹çš„ä¸Šæ‹‰02"></a>ä¸Šæ‹‰åˆ·æ–°08-è‡ªåŠ¨å›å¼¹çš„ä¸Šæ‹‰02</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">MJRefreshBackGifFooter *footer = [MJRefreshBackGifFooter <span class="string">footerWithRefreshingTarget:</span>self <span class="string">refreshingAction:</span><span class="meta">@selector</span>(loadMoreData)];</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®æ™®é€šçŠ¶æ€çš„åŠ¨ç”»å›¾ç‰‡</span></span><br><span class="line">NSArray *idleImages = @[@<span class="string">"å›¾ç‰‡1"</span>, @<span class="string">"å›¾ç‰‡2"</span>, @<span class="string">"å›¾ç‰‡3"</span>];</span><br><span class="line">[footer <span class="string">setImages:</span>idleImages <span class="string">forState:</span>MJRefreshStateIdle];</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®å³å°†åˆ·æ–°çŠ¶æ€çš„åŠ¨ç”»å›¾ç‰‡ï¼ˆä¸€æ¾å¼€å°±ä¼šåˆ·æ–°çš„çŠ¶æ€ï¼‰</span></span><br><span class="line">NSArray *pullingImages = @[@<span class="string">"å›¾ç‰‡1"</span>, @<span class="string">"å›¾ç‰‡2"</span>, @<span class="string">"å›¾ç‰‡3"</span>];</span><br><span class="line"></span><br><span class="line">[footer <span class="string">setImages:</span>pullingImages <span class="string">forState:</span>MJRefreshStatePulling];</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®æ­£åœ¨åˆ·æ–°çŠ¶æ€çš„åŠ¨ç”»å›¾ç‰‡</span></span><br><span class="line">NSArray *refreshingImages = @[@<span class="string">"å›¾ç‰‡1"</span>, @<span class="string">"å›¾ç‰‡2"</span>, @<span class="string">"å›¾ç‰‡3"</span>];</span><br><span class="line">[footer <span class="string">setImages:</span>refreshingImages <span class="string">forState:</span>MJRefreshStateRefreshing];</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®å°¾éƒ¨</span></span><br><span class="line">self.tableView.mj_footer = footer;</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-7ff75c5dc70d3d33.gif?imageMogr2/auto-orient/strip" alt="ä¸Šæ‹‰åˆ·æ–°08-è‡ªåŠ¨å›å¼¹çš„ä¸Šæ‹‰02"></p>
<h3 id="ä¸Šæ‹‰åˆ·æ–°09-è‡ªå®šä¹‰åˆ·æ–°æ§ä»¶-è‡ªåŠ¨åˆ·æ–°"><a href="#ä¸Šæ‹‰åˆ·æ–°09-è‡ªå®šä¹‰åˆ·æ–°æ§ä»¶-è‡ªåŠ¨åˆ·æ–°" class="headerlink" title="ä¸Šæ‹‰åˆ·æ–°09-è‡ªå®šä¹‰åˆ·æ–°æ§ä»¶(è‡ªåŠ¨åˆ·æ–°)"></a>ä¸Šæ‹‰åˆ·æ–°09-è‡ªå®šä¹‰åˆ·æ–°æ§ä»¶(è‡ªåŠ¨åˆ·æ–°)</h3><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">self</span>.tableView.mj_footer = [MJDIYAutoFooter <span class="symbol">footerWithRefreshingTarget:</span><span class="keyword">self</span> <span class="symbol">refreshingAction:</span><span class="variable">@selector</span>(loadMoreData)];</span><br><span class="line">/<span class="regexp">/ å…·ä½“å®ç°å‚è€ƒMJDIYAutoFooter.hå’ŒMJDIYAutoFooter.m</span></span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-504544818173e40a.gif?imageMogr2/auto-orient/strip" alt="ä¸Šæ‹‰åˆ·æ–°09-è‡ªå®šä¹‰åˆ·æ–°æ§ä»¶(è‡ªåŠ¨åˆ·æ–°)"></p>
<h3 id="ä¸Šæ‹‰åˆ·æ–°10-è‡ªå®šä¹‰åˆ·æ–°æ§ä»¶-è‡ªåŠ¨å›å¼¹"><a href="#ä¸Šæ‹‰åˆ·æ–°10-è‡ªå®šä¹‰åˆ·æ–°æ§ä»¶-è‡ªåŠ¨å›å¼¹" class="headerlink" title="ä¸Šæ‹‰åˆ·æ–°10-è‡ªå®šä¹‰åˆ·æ–°æ§ä»¶(è‡ªåŠ¨å›å¼¹)"></a>ä¸Šæ‹‰åˆ·æ–°10-è‡ªå®šä¹‰åˆ·æ–°æ§ä»¶(è‡ªåŠ¨å›å¼¹)</h3><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">self</span>.tableView.mj_footer = [MJDIYBackFooter <span class="symbol">footerWithRefreshingTarget:</span><span class="keyword">self</span> <span class="symbol">refreshingAction:</span><span class="variable">@selector</span>(loadMoreData)];</span><br><span class="line">/<span class="regexp">/ å…·ä½“å®ç°å‚è€ƒMJDIYBackFooter.hå’ŒMJDIYBackFooter.m</span></span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-39f29fe70a310b80.gif?imageMogr2/auto-orient/strip" alt="ä¸Šæ‹‰åˆ·æ–°10-è‡ªå®šä¹‰åˆ·æ–°æ§ä»¶(è‡ªåŠ¨å›å¼¹)"></p>
<h3 id="UICollectionView01-ä¸Šä¸‹æ‹‰åˆ·æ–°"><a href="#UICollectionView01-ä¸Šä¸‹æ‹‰åˆ·æ–°" class="headerlink" title="UICollectionView01-ä¸Šä¸‹æ‹‰åˆ·æ–°"></a>UICollectionView01-ä¸Šä¸‹æ‹‰åˆ·æ–°</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸‹æ‹‰åˆ·æ–°</span></span><br><span class="line">self.collectionView.mj_header = [MJRefreshNormalHeader <span class="string">headerWithRefreshingBlock:</span>^&#123;</span><br><span class="line"><span class="comment">// è¿›å…¥åˆ·æ–°çŠ¶æ€åä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸ªblock</span></span><br><span class="line">&#125;];</span><br><span class="line"><span class="comment">// ä¸Šæ‹‰åˆ·æ–°</span></span><br><span class="line">self.collectionView.mj_footer = [MJRefreshAutoNormalFooter <span class="string">footerWithRefreshingBlock:</span>^&#123;</span><br><span class="line"><span class="comment">// è¿›å…¥åˆ·æ–°çŠ¶æ€åä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸ªblock</span></span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-0d4fd9a97ffb9513.gif?imageMogr2/auto-orient/strip" alt="UICollectionView01-ä¸Šä¸‹æ‹‰åˆ·æ–°"></p>
<h3 id="UIWebView01-ä¸‹æ‹‰åˆ·æ–°"><a href="#UIWebView01-ä¸‹æ‹‰åˆ·æ–°" class="headerlink" title="UIWebView01-ä¸‹æ‹‰åˆ·æ–°"></a>UIWebView01-ä¸‹æ‹‰åˆ·æ–°</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ·»åŠ ä¸‹æ‹‰åˆ·æ–°æ§ä»¶</span></span><br><span class="line">self.webView.scrollView.mj_header = [MJRefreshNormalHeader <span class="string">headerWithRefreshingBlock:</span>^&#123;</span><br><span class="line"><span class="comment">// è¿›å…¥åˆ·æ–°çŠ¶æ€åä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸ªblock</span></span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-ee3c092adb2b9561.gif?imageMogr2/auto-orient/strip" alt="UIWebView01-ä¸‹æ‹‰åˆ·æ–°"></p>
<ul>
<li><em>over</em><br>ä»¥ä¸Šæ˜¯ MJRefresh çš„å…·ä½“ç”¨æ³•ï¼Œæœ‰å…´è¶£çš„æœ‹å‹è¿˜å¯ä»¥å‚è€ƒä¸‹<a href="https://github.com/CoderMJLee/MJRefresh/blob/master/README.md" target="_blank" rel="noopener">MJRefresh/README.md</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/15/iOSå¼€å‘ä¹‹ - å¤šçº¿ç¨‹/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="åˆ˜æœ‹å¤">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ä»¥æ¢¦ä¸ºé©¬">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/15/iOSå¼€å‘ä¹‹ - å¤šçº¿ç¨‹/" itemprop="url">
                  iOSå¼€å‘ä¹‹ - å¤šçº¿ç¨‹
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
                
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-15T12:30:20+08:00">2018-04-15</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="http://upload-images.jianshu.io/upload_images/2665449-72633919539a5942.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="iOSå¼€å‘ä¹‹ ï¼ å¤šçº¿ç¨‹"></p>
<blockquote>
<p>æœ€è¿‘åˆ©ç”¨æ™šä¸Šçš„ç©ºé—²æ—¶é—´ï¼Œæ•´ç†äº†ä¸€ä¸‹å¤šçº¿ç¨‹ç›¸å…³çš„çŸ¥è¯†ï¼Œå‡ ç»æ›´æ”¹ï¼Œå°±å˜æˆä½ ç°åœ¨çœ‹åˆ°çš„æ¨¡æ ·äº†ï¼ˆå¦‚æœ‰å¤±è¯¯ä¹‹å¤„ï¼Œè¿˜è¯·ä¸åèµæ•™ï¼‰ã€‚æŠŠå¤šçº¿ç¨‹ç›¸å…³çš„çŸ¥è¯†æ€»ç»“åœ¨è¿™é‡Œï¼Œåªå¸Œæœ›å¯¹çœ‹åˆ°çš„æœ‹å‹ä»¬æœ‰æ‰€å¸®åŠ©ï¼æ–‡ç« æœ‰äº›é•¿ï¼Œæ¶µç›–çš„çŸ¥è¯†ç‚¹ä¹Ÿæ¯”è¾ƒå¤šï¼Œå¸Œæœ›æœ‹å‹ä»¬èƒ½å¤Ÿè€å¿ƒè¯»å®Œå“ˆï¼æˆ‘ä»¬è¿™ç¯‡æ–‡ç« ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ¨¡å—ï¼š</p>
</blockquote>
<ul>
<li><strong>ï¼ˆä¸€ï¼‰iOSå¼€å‘ä¹‹å¤šçº¿ç¨‹ åŸºç¡€çŸ¥è¯†</strong></li>
<li><strong>ï¼ˆäºŒï¼‰iOSå¼€å‘ä¹‹å¤šçº¿ç¨‹ NSThread</strong></li>
<li><strong>ï¼ˆä¸‰ï¼‰iOSå¼€å‘ä¹‹å¤šçº¿ç¨‹ NSOperation</strong></li>
<li><strong>ï¼ˆå››ï¼‰iOSå¼€å‘ä¹‹å¤šçº¿ç¨‹ GCD</strong></li>
<li><strong>ï¼ˆäº”ï¼‰iOSå¼€å‘ä¹‹å¤šçº¿ç¨‹ çº¿ç¨‹é—´çš„é€šä¿¡</strong></li>
</ul>
<p><em>ä¸‹é¢æˆ‘ä»¬å¼€å§‹äº†è§£ iOS å¤šçº¿ç¨‹çš„åŸºç¡€çŸ¥è¯†ï¼Œå¦‚æœåœ¨æ­¤ä¹‹å‰å¯¹å¤šçº¿ç¨‹å·²ç»æœ‰æ‰€äº†è§£çš„æœ‹å‹ï¼Œå¤§å¯è·³è¿‡è¿™ä¸€éƒ¨åˆ†ï¼Œç›´æ¥çœ‹åè¾¹ä¸‰ç§å¤šçº¿ç¨‹ç¼–ç¨‹çš„ demo å³å¯ï¼</em></p>
<h2 id="ï¼ˆä¸€ï¼‰iOS-å¼€å‘ä¹‹å¤šçº¿ç¨‹-åŸºç¡€çŸ¥è¯†"><a href="#ï¼ˆä¸€ï¼‰iOS-å¼€å‘ä¹‹å¤šçº¿ç¨‹-åŸºç¡€çŸ¥è¯†" class="headerlink" title="ï¼ˆä¸€ï¼‰iOS å¼€å‘ä¹‹å¤šçº¿ç¨‹ åŸºç¡€çŸ¥è¯†"></a>ï¼ˆä¸€ï¼‰iOS å¼€å‘ä¹‹å¤šçº¿ç¨‹ åŸºç¡€çŸ¥è¯†</h2><h3 id="1-å¤šçº¿ç¨‹ç®€ä»‹"><a href="#1-å¤šçº¿ç¨‹ç®€ä»‹" class="headerlink" title="1.å¤šçº¿ç¨‹ç®€ä»‹:"></a>1.å¤šçº¿ç¨‹ç®€ä»‹:</h3><p>ä¸€ä¸ªè¿›ç¨‹è¦æƒ³æ‰§è¡Œä»»åŠ¡, å¿…é¡»å¾—æœ‰çº¿ç¨‹(æ¯ä¸ªè¿›ç¨‹è‡³å°‘è¦æœ‰ä¸€æ¡çº¿ç¨‹), çº¿ç¨‹æ˜¯è¿›ç¨‹çš„åŸºæœ¬æ‰§è¡Œå•å…ƒ, ä¸€ä¸ªè¿›ç¨‹ï¼ˆç¨‹åºï¼‰çš„æ‰€æœ‰ä»»åŠ¡éƒ½åœ¨çº¿ç¨‹ä¸­æ‰§è¡Œ.</p>
<h3 id="2-å¤šçº¿ç¨‹çš„åŸç†"><a href="#2-å¤šçº¿ç¨‹çš„åŸç†" class="headerlink" title="2.å¤šçº¿ç¨‹çš„åŸç†:"></a>2.å¤šçº¿ç¨‹çš„åŸç†:</h3><p>åŒä¸€æ—¶é—´, CPU åªèƒ½å¤„ç†ä¸€æ¡çº¿ç¨‹,åªæœ‰ä¸€æ¡çº¿ç¨‹åœ¨å·¥ä½œ.<br>å¤šçº¿ç¨‹å¹¶å‘(åŒæ—¶)æ‰§è¡Œ, å…¶å®æ˜¯ CPU å¿«é€Ÿåœ°åœ¨å¤šæ¡çº¿ç¨‹ä¹‹é—´è°ƒåº¦.<br>å¦‚æœ CPU è°ƒåº¦çº¿ç¨‹çš„æ—¶é—´è¶³å¤Ÿå¿«,å°±é€ æˆäº†å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„å‡è±¡.</p>
<h3 id="3-å¤šçº¿ç¨‹çš„ä¼˜ç¼ºç‚¹"><a href="#3-å¤šçº¿ç¨‹çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="3.å¤šçº¿ç¨‹çš„ä¼˜ç¼ºç‚¹:"></a>3.å¤šçº¿ç¨‹çš„ä¼˜ç¼ºç‚¹:</h3><h4 id="å¤šçº¿ç¨‹çš„ä¼˜ç‚¹"><a href="#å¤šçº¿ç¨‹çš„ä¼˜ç‚¹" class="headerlink" title="å¤šçº¿ç¨‹çš„ä¼˜ç‚¹:"></a>å¤šçº¿ç¨‹çš„ä¼˜ç‚¹:</h4><p>èƒ½é€‚å½“æé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡.<br>èƒ½é€‚å½“æé«˜èµ„æºåˆ©ç”¨ç‡(CPUã€å†…å­˜åˆ©ç”¨ç‡).</p>
<h4 id="å¤šçº¿ç¨‹çš„ç¼ºç‚¹"><a href="#å¤šçº¿ç¨‹çš„ç¼ºç‚¹" class="headerlink" title="å¤šçº¿ç¨‹çš„ç¼ºç‚¹:"></a>å¤šçº¿ç¨‹çš„ç¼ºç‚¹:</h4><p>å¼€å¯çº¿ç¨‹éœ€è¦å ç”¨ä¸€å®šçš„å†…å­˜ç©ºé—´(é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸»çº¿ç¨‹å ç”¨1Mï¼Œå­çº¿ç¨‹å ç”¨512KB),å¦‚æœå¼€å¯å¤§é‡çš„çº¿ç¨‹,ä¼šå ç”¨å¤§é‡çš„å†…å­˜ç©ºé—´,é™ä½ç¨‹åºçš„æ€§èƒ½.</p>
<h3 id="4-å¤šçº¿ç¨‹åœ¨-iOS-å¼€å‘ä¸­çš„åº”ç”¨"><a href="#4-å¤šçº¿ç¨‹åœ¨-iOS-å¼€å‘ä¸­çš„åº”ç”¨" class="headerlink" title="4.å¤šçº¿ç¨‹åœ¨ iOS å¼€å‘ä¸­çš„åº”ç”¨:"></a>4.å¤šçº¿ç¨‹åœ¨ iOS å¼€å‘ä¸­çš„åº”ç”¨:</h3><p>ä¸»çº¿ç¨‹:ä¸€ä¸ª iOS ç¨‹åºè¿è¡Œåï¼Œé»˜è®¤ä¼šå¼€å¯1æ¡çº¿ç¨‹ï¼Œç§°ä¸ºâ€œä¸»çº¿ç¨‹â€æˆ–â€œ UI çº¿ç¨‹â€.<br>ä¸»çº¿ç¨‹çš„ä¸»è¦ä½œç”¨:åˆ·æ–° UI ç•Œé¢ã€å¤„ç† UI äº‹ä»¶(æ¯”å¦‚ç‚¹å‡»äº‹ä»¶ã€æ»šåŠ¨äº‹ä»¶ã€æ‹–æ‹½äº‹ä»¶ç­‰).</p>
<h3 id="5-iOS-ä¸­ä¸‰ç§å¤šçº¿ç¨‹ç¼–ç¨‹çš„æŠ€æœ¯ï¼Œåˆ†åˆ«æ˜¯ï¼š"><a href="#5-iOS-ä¸­ä¸‰ç§å¤šçº¿ç¨‹ç¼–ç¨‹çš„æŠ€æœ¯ï¼Œåˆ†åˆ«æ˜¯ï¼š" class="headerlink" title="5.iOS ä¸­ä¸‰ç§å¤šçº¿ç¨‹ç¼–ç¨‹çš„æŠ€æœ¯ï¼Œåˆ†åˆ«æ˜¯ï¼š"></a>5.iOS ä¸­ä¸‰ç§å¤šçº¿ç¨‹ç¼–ç¨‹çš„æŠ€æœ¯ï¼Œåˆ†åˆ«æ˜¯ï¼š</h3><h4 id="ï¼ˆä¸€ï¼‰NSThread"><a href="#ï¼ˆä¸€ï¼‰NSThread" class="headerlink" title="ï¼ˆä¸€ï¼‰NSThread"></a>ï¼ˆä¸€ï¼‰NSThread</h4><h4 id="ï¼ˆäºŒï¼‰Cocoa-NSOperation"><a href="#ï¼ˆäºŒï¼‰Cocoa-NSOperation" class="headerlink" title="ï¼ˆäºŒï¼‰Cocoa NSOperation"></a>ï¼ˆäºŒï¼‰Cocoa NSOperation</h4><h4 id="ï¼ˆä¸‰ï¼‰GCDï¼ˆå…¨ç§°ï¼šGrand-Central-Dispatchï¼‰"><a href="#ï¼ˆä¸‰ï¼‰GCDï¼ˆå…¨ç§°ï¼šGrand-Central-Dispatchï¼‰" class="headerlink" title="ï¼ˆä¸‰ï¼‰GCDï¼ˆå…¨ç§°ï¼šGrand Central Dispatchï¼‰"></a>ï¼ˆä¸‰ï¼‰GCDï¼ˆå…¨ç§°ï¼šGrand Central Dispatchï¼‰</h4><p>è¿™ä¸‰ç§ç¼–ç¨‹æ–¹å¼ä»ä¸Šåˆ°ä¸‹ï¼ŒæŠ½è±¡åº¦å±‚æ¬¡æ˜¯ä»ä½åˆ°é«˜çš„ï¼ŒæŠ½è±¡åº¦è¶Šé«˜çš„ä½¿ç”¨è¶Šç®€å•ï¼Œä¹Ÿæ˜¯Appleæœ€æ¨èä½¿ç”¨çš„ã€‚</p>
<h4 id="ä¸‰ç§æ–¹å¼çš„ä¼˜ç¼ºç‚¹ä»‹ç»ï¼š"><a href="#ä¸‰ç§æ–¹å¼çš„ä¼˜ç¼ºç‚¹ä»‹ç»ï¼š" class="headerlink" title="ä¸‰ç§æ–¹å¼çš„ä¼˜ç¼ºç‚¹ä»‹ç»ï¼š"></a>ä¸‰ç§æ–¹å¼çš„ä¼˜ç¼ºç‚¹ä»‹ç»ï¼š</h4><h5 id="NSThread"><a href="#NSThread" class="headerlink" title="NSThread:"></a>NSThread:</h5><p>ä¼˜ç‚¹ï¼šNSThread æ¯”å…¶ä»–ä¸¤ä¸ªè½»é‡çº§<br>ç¼ºç‚¹ï¼šéœ€è¦è‡ªå·±ç®¡ç†çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼Œçº¿ç¨‹åŒæ­¥ã€‚çº¿ç¨‹åŒæ­¥å¯¹æ•°æ®çš„åŠ é”ä¼šæœ‰ä¸€å®šçš„ç³»ç»Ÿå¼€é”€ã€‚</p>
<h5 id="Cocoa-NSOperation"><a href="#Cocoa-NSOperation" class="headerlink" title="Cocoa NSOperation"></a>Cocoa NSOperation</h5><p>ä¼˜ç‚¹ï¼šä¸éœ€è¦å…³å¿ƒçº¿ç¨‹ç®¡ç†ï¼Œæ•°æ®åŒæ­¥çš„äº‹æƒ…ï¼Œå¯ä»¥æŠŠç²¾åŠ›æ”¾åœ¨è‡ªå·±éœ€è¦æ‰§è¡Œçš„æ“ä½œä¸Šã€‚<br>Cocoa operation ç›¸å…³çš„ç±»æ˜¯ NSOperation ï¼ŒNSOperationQueueã€‚<br>NSOperationæ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œä½¿ç”¨å®ƒå¿…é¡»ç”¨å®ƒçš„å­ç±»ï¼Œå¯ä»¥å®ç°å®ƒæˆ–è€…ä½¿ç”¨å®ƒå®šä¹‰å¥½çš„ä¸¤ä¸ªå­ç±»ï¼šNSInvocationOperation å’Œ NSBlockOperationã€‚<br>åˆ›å»ºNSOperationå­ç±»çš„å¯¹è±¡ï¼ŒæŠŠå¯¹è±¡æ·»åŠ åˆ°NSOperationQueueé˜Ÿåˆ—é‡Œæ‰§è¡Œã€‚</p>
<h5 id="GCD"><a href="#GCD" class="headerlink" title="GCD"></a>GCD</h5><p>Grand Central Dispatch (GCD)æ˜¯Appleå¼€å‘çš„ä¸€ä¸ªå¤šæ ¸ç¼–ç¨‹çš„è§£å†³æ–¹æ³•ã€‚åœ¨iOS4.0å¼€å§‹ä¹‹åæ‰èƒ½ä½¿ç”¨ã€‚GCDæ˜¯ä¸€ä¸ªæ›¿ä»£è¯¸å¦‚NSThread, NSOperationQueue, NSInvocationOperationç­‰æŠ€æœ¯çš„å¾ˆé«˜æ•ˆå’Œå¼ºå¤§çš„æŠ€æœ¯ã€‚</p>
<hr>
<p><em>å¯¹ iOS åŸºç¡€çŸ¥è¯†æœ‰äº†ä¸€å®šäº†è§£ä¹‹åï¼Œä¸‹è¾¹æˆ‘ä»¬å¼€å§‹çœ‹å¤šçº¿ç¨‹ç›¸å…³çš„ä¸€äº› demoï¼Œ å»ºè®®æœ‹å‹ä»¬è¯•è¯•ä¸‹è¾¹çš„ demoï¼Œè¿™æ ·æ›´æ–¹ä¾¿ç†è§£ï¼å¦‚æœ‰ç–‘é—®ï¼Œæˆ–å‘ç°æŸäº› demo å†™çš„æœ‰è¯¯ï¼Œè¿˜è¯·æœ‹å‹ä»¬å‘ŠçŸ¥ï¼</em></p>
<p><strong>ä¸‹è¾¹æˆ‘ä»¬å¼€å§‹äº†è§£NSThreadï¼ŒNSThread å…¶å®ç”¨çš„çœŸä¸å¤šï¼Œä¸»è¦è¿˜æ˜¯ç”¨å¦å¤–ä¸¤ç§ï¼Œä¸è¿‡ä½œä¸º iOS å¼€å‘è€…ï¼Œè¿˜æ˜¯åº”è¯¥å¯¹å®ƒæœ‰äº›äº†è§£çš„ï¼Œä¸‹è¾¹æ˜¯ NSThread ç›¸å…³çš„ demo ï¼</strong></p>
<h2 id="ï¼ˆäºŒï¼‰iOS-å¼€å‘ä¹‹å¤šçº¿ç¨‹-NSThread"><a href="#ï¼ˆäºŒï¼‰iOS-å¼€å‘ä¹‹å¤šçº¿ç¨‹-NSThread" class="headerlink" title="ï¼ˆäºŒï¼‰iOS å¼€å‘ä¹‹å¤šçº¿ç¨‹ NSThread"></a>ï¼ˆäºŒï¼‰iOS å¼€å‘ä¹‹å¤šçº¿ç¨‹ NSThread</h2><h3 id="ä¸€ã€NSThread-åˆå§‹åŒ–"><a href="#ä¸€ã€NSThread-åˆå§‹åŒ–" class="headerlink" title="ä¸€ã€NSThread åˆå§‹åŒ–"></a>ä¸€ã€NSThread åˆå§‹åŒ–</h3><h4 id="1-åŠ¨æ€æ–¹æ³•"><a href="#1-åŠ¨æ€æ–¹æ³•" class="headerlink" title="1.åŠ¨æ€æ–¹æ³•"></a>1.åŠ¨æ€æ–¹æ³•</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">id</span>)initWithTarget:(<span class="keyword">id</span>)target selector:(SEL)selector object:(<span class="keyword">id</span>)argument</span><br><span class="line"><span class="comment">// åˆå§‹åŒ–çº¿ç¨‹</span></span><br><span class="line"><span class="built_in">NSThread</span>* thread = [[<span class="built_in">NSThread</span> alloc] initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(doSomething:)object:<span class="literal">nil</span>];</span><br><span class="line"><span class="comment">// çº¿ç¨‹åå­—</span></span><br><span class="line">thread.name = <span class="string">@"MYThread"</span>;</span><br><span class="line"><span class="comment">// å¯åŠ¨çº¿ç¨‹</span></span><br><span class="line">[thread start];</span><br></pre></td></tr></table></figure>
<h4 id="2-é™æ€æ–¹æ³•"><a href="#2-é™æ€æ–¹æ³•" class="headerlink" title="2.é™æ€æ–¹æ³•"></a>2.é™æ€æ–¹æ³•</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="keyword">void</span>)detachNewThreadSelector:(SEL)aSelector toTarget:(<span class="keyword">id</span>)aTarget withObject:(<span class="keyword">id</span>)anArgument</span><br><span class="line">[<span class="built_in">NSThread</span> detachNewThreadSelector:<span class="keyword">@selector</span>(doSomething:) toTarget:<span class="keyword">self</span> withObject:<span class="literal">nil</span>];</span><br><span class="line"><span class="comment">// è°ƒç”¨å®Œæ¯•åï¼Œä¼šé©¬ä¸Šåˆ›å»ºå¹¶å¼€å¯æ–°çº¿ç¨‹</span></span><br></pre></td></tr></table></figure>
<h4 id="3-éšå¼åˆ›å»ºçº¿ç¨‹çš„æ–¹æ³•ï¼š"><a href="#3-éšå¼åˆ›å»ºçº¿ç¨‹çš„æ–¹æ³•ï¼š" class="headerlink" title="3.éšå¼åˆ›å»ºçº¿ç¨‹çš„æ–¹æ³•ï¼š"></a>3.éšå¼åˆ›å»ºçº¿ç¨‹çš„æ–¹æ³•ï¼š</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)performSelectorInBackground:(SEL)aSelector withObject:(<span class="keyword">id</span>)arg;</span><br><span class="line">[<span class="keyword">self</span> performSelectorInBackground:<span class="keyword">@selector</span>(run) withObject:<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p><strong>æç¤ºæœ‹å‹ä»¬ä¸€ä¸‹:ç¬¬ä¸€ç§æ–¹å¼ä¼šç›´æ¥åˆ›å»ºçº¿ç¨‹å¹¶ä¸”å¼€å§‹è¿è¡Œçº¿ç¨‹ï¼Œç¬¬äºŒç§æ–¹å¼æ˜¯å…ˆåˆ›å»ºçº¿ç¨‹å¯¹è±¡ï¼Œç„¶åå†è¿è¡Œçº¿ç¨‹æ“ä½œï¼Œåœ¨è¿è¡Œçº¿ç¨‹æ“ä½œå‰å¯ä»¥è®¾ç½®çº¿ç¨‹çš„ä¼˜å…ˆçº§ç­‰çº¿ç¨‹ä¿¡æ¯</strong></p>
<h3 id="äºŒã€çº¿ç¨‹é—´çš„é€šä¿¡"><a href="#äºŒã€çº¿ç¨‹é—´çš„é€šä¿¡" class="headerlink" title="äºŒã€çº¿ç¨‹é—´çš„é€šä¿¡"></a>äºŒã€çº¿ç¨‹é—´çš„é€šä¿¡</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œæ“ä½œ</span></span><br><span class="line">[<span class="keyword">self</span> performSelectorOnMainThread:<span class="keyword">@selector</span>(run) withObject:<span class="literal">nil</span> waitUntilDone:<span class="literal">YES</span>];</span><br><span class="line"><span class="comment">//åœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œæ“ä½œ</span></span><br><span class="line">[<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(run) withObject:<span class="literal">nil</span>];</span><br><span class="line"><span class="comment">//åœ¨æŒ‡å®šçº¿ç¨‹ä¸Šæ‰§è¡Œæ“ä½œ</span></span><br><span class="line">[<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(run) onThread:thread withObject:<span class="literal">nil</span> waitUntilDone:<span class="literal">YES</span>];</span><br></pre></td></tr></table></figure>
<h3 id="ä¸‰ã€ä¸€äº›ç®€å•æ–¹æ³•"><a href="#ä¸‰ã€ä¸€äº›ç®€å•æ–¹æ³•" class="headerlink" title="ä¸‰ã€ä¸€äº›ç®€å•æ–¹æ³•"></a>ä¸‰ã€ä¸€äº›ç®€å•æ–¹æ³•</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è·å–å½“å‰çº¿ç¨‹</span></span><br><span class="line"><span class="built_in">NSThread</span> *thread = [<span class="built_in">NSThread</span> currentThread];</span><br><span class="line"><span class="comment">//è·å–ä¸»çº¿ç¨‹</span></span><br><span class="line"><span class="built_in">NSThread</span> *main = [<span class="built_in">NSThread</span> mainThread];</span><br><span class="line"><span class="comment">//ç¡çœ ï¼Œç›¸å½“äºæš‚åœ</span></span><br><span class="line">[<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">3</span>];</span><br></pre></td></tr></table></figure>
<hr>
<p><em>NSThread  å°±è¯´åˆ°è¿™ï¼Œä¸€èµ·å†çœ‹ä¸‹NSOperationï¼Œ NSOperation åœ¨å¼€å‘ä¸­ç”¨çš„è¿˜æ˜¯æŒºå¤šçš„ï¼Œè™½ç„¶è‹¹æœå»ºè®®ä½¿ç”¨ GCD ï¼Œä½†ä¾ç„¶æœ‰å¼€å‘è€…è§‰å¾— NSOperation  æ¯” GCD æ›´å¥½ç”¨ï¼ä»è€…è§ä»æ™ºè€…è§æ™ºå§ï¼æœ¬å°ç™½è§‰å¾—å¦‚æœèƒ½æŒæ¡è¿˜æ˜¯éƒ½æŒæ¡çš„å¥½ï¼</em></p>
<h2 id="ï¼ˆä¸‰ï¼‰iOSå¼€å‘ä¹‹å¤šçº¿ç¨‹-NSOperation"><a href="#ï¼ˆä¸‰ï¼‰iOSå¼€å‘ä¹‹å¤šçº¿ç¨‹-NSOperation" class="headerlink" title="ï¼ˆä¸‰ï¼‰iOSå¼€å‘ä¹‹å¤šçº¿ç¨‹ NSOperation"></a>ï¼ˆä¸‰ï¼‰iOSå¼€å‘ä¹‹å¤šçº¿ç¨‹ NSOperation</h2><h3 id="ä¸€ã€åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼"><a href="#ä¸€ã€åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼" class="headerlink" title="ä¸€ã€åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼"></a>ä¸€ã€åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼</h3><p>ä½¿ç”¨NSOperationåˆ›å»ºçº¿ç¨‹çš„æ–¹å¼æœ‰3ç§:</p>
<p>ï¼ˆ1ï¼‰NSInvocationOperation æ–¹å¼<br>ï¼ˆ2ï¼‰NSBlockOperation æ–¹å¼<br>ï¼ˆ3ï¼‰è‡ªå®šä¹‰å­ç±»ç»§æ‰¿NSOperation,å®ç°å†…éƒ¨ç›¸åº”çš„â½…æ³•</p>
<p>ä¸‹é¢æ˜¯è¿™ä¸‰ç§æ–¹å¼åˆ›å»ºçº¿ç¨‹çš„å…·ä½“æ–¹æ³•ï¼š</p>
<h4 id="1-NSInvocationOperation"><a href="#1-NSInvocationOperation" class="headerlink" title="1.NSInvocationOperation"></a>1.NSInvocationOperation</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)invocationOperation</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//åˆ›å»ºNSInvocationOperationå¯¹è±¡</span></span><br><span class="line"><span class="built_in">NSInvocationOperation</span> *operation = [[<span class="built_in">NSInvocationOperation</span> alloc] initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(run) object:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¼€å§‹æ‰§è¡Œæ“ä½œ</span></span><br><span class="line">[operation start];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ä¸€æ—¦æ‰§è¡Œæ“ä½œ,å°±ä¼šè°ƒç”¨targetçš„runæ–¹æ³•</span></span><br></pre></td></tr></table></figure>
<p>æç¤º:é»˜è®¤æƒ…å†µä¸‹,è°ƒç”¨äº†startæ–¹æ³•åå¹¶ä¸ä¼šå¼€ä¸€æ¡æ–°çº¿ç¨‹å»æ‰§è¡Œæ“ä½œ,åªæœ‰å°†NSOperationæ”¾åˆ°ä¸€ä¸ªNSOperationQueueä¸­,æ‰ä¼šå¼‚æ­¥æ‰§è¡Œæ“ä½œ.</p>
<h4 id="2-NSBlockOperation"><a href="#2-NSBlockOperation" class="headerlink" title="2.NSBlockOperation"></a>2.NSBlockOperation</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)blockOperation</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//åˆ›å»ºNSBlockOperationå¯¹è±¡</span></span><br><span class="line"><span class="built_in">NSBlockOperation</span> *operation = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^&#123;</span><br><span class="line"><span class="comment">// ä¸»çº¿ç¨‹</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"1---%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;];</span><br><span class="line"><span class="comment">// æ·»åŠ ä»»åŠ¡(åœ¨å­çº¿ç¨‹æ‰§è¡Œ)</span></span><br><span class="line">[operation addExecutionBlock:^&#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"2---%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;];</span><br><span class="line">[operation addExecutionBlock:^&#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"3---%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;];</span><br><span class="line"><span class="comment">//å¼€å¯æ‰§è¡Œæ“ä½œ</span></span><br><span class="line">[operation start];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æç¤º:åªè¦NSBlockOperationå°è£…çš„æ“ä½œæ•° &gt; 1,å°±ä¼šå¼‚æ­¥æ‰§è¡Œæ“ä½œ</p>
<h4 id="3-è‡ªå®šä¹‰å­ç±»ç»§æ‰¿è‡ªNSOperation"><a href="#3-è‡ªå®šä¹‰å­ç±»ç»§æ‰¿è‡ªNSOperation" class="headerlink" title="3.è‡ªå®šä¹‰å­ç±»ç»§æ‰¿è‡ªNSOperation"></a>3.è‡ªå®šä¹‰å­ç±»ç»§æ‰¿è‡ªNSOperation</h4><p>è‡ªå®šä¹‰NSOperationå­ç±»éœ€è¦é‡å†™ - (void)mainæ–¹æ³•</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)main</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// æ–°å»ºä¸€ä¸ªè‡ªåŠ¨é‡Šæ”¾æ± ï¼Œå¦‚æœæ˜¯å¼‚æ­¥æ‰§è¡Œæ“ä½œï¼Œé‚£ä¹ˆå°†æ— æ³•è®¿é—®åˆ°ä¸»çº¿ç¨‹çš„è‡ªåŠ¨é‡Šæ”¾æ± </span></span><br><span class="line"><span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i&lt;<span class="number">100</span>; i++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"1 - %ld - %@"</span>, i, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ£€æµ‹æ“ä½œæ˜¯å¦è¢«å–æ¶ˆ,å¯¹å–æ¶ˆåšå‡ºå“åº”</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">self</span>.isCancelled) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i&lt;<span class="number">100</span>; i++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"2 - %ld - %@"</span>, i, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">self</span>.isCancelled) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i&lt;<span class="number">100</span>; i++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"3 - %ld - %@"</span>, i, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">self</span>.isCancelled) <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="äºŒã€NSOperationQueueçš„åº”ç”¨"><a href="#äºŒã€NSOperationQueueçš„åº”ç”¨" class="headerlink" title="äºŒã€NSOperationQueueçš„åº”ç”¨"></a>äºŒã€NSOperationQueueçš„åº”ç”¨</h3><p>ä¸€ä¸ªNSOperationå¯¹è±¡å¯ä»¥é€šè¿‡è°ƒç”¨startæ–¹æ³•æ¥æ‰§è¡Œä»»åŠ¡,é»˜è®¤æ˜¯åŒæ­¥æ‰§è¡Œçš„.ä¹Ÿå¯ä»¥å°†NSOperationæ·»åŠ åˆ°ä¸€ä¸ªNSOperationQueueä¸­å»æ‰§è¡Œ,è€Œä¸”æ˜¯å¼‚æ­¥æ‰§è¡Œçš„.</p>
<h4 id="1-NSOperationQueueç®€å•åˆ›å»º"><a href="#1-NSOperationQueueç®€å•åˆ›å»º" class="headerlink" title="1.NSOperationQueueç®€å•åˆ›å»º"></a>1.NSOperationQueueç®€å•åˆ›å»º</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç¬¬ä¸€ç§æ–¹å¼</span></span><br><span class="line">- (<span class="keyword">void</span>)operationQueue</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// åˆ›å»ºNSOperationQueueé˜Ÿåˆ—</span></span><br><span class="line"><span class="built_in">NSOperationQueue</span> *queue = [[<span class="built_in">NSOperationQueue</span> alloc] init];</span><br><span class="line"><span class="comment">// åˆ›å»ºNSInvocationOperationå¯¹è±¡</span></span><br><span class="line"><span class="built_in">NSInvocationOperation</span> *operation1 = [[<span class="built_in">NSInvocationOperation</span> alloc] initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(run1) object:<span class="literal">nil</span>];</span><br><span class="line"><span class="built_in">NSInvocationOperation</span> *operation2 = [[<span class="built_in">NSInvocationOperation</span> alloc] initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(run2) object:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºNSBlockOperationå¯¹è±¡</span></span><br><span class="line"><span class="built_in">NSBlockOperation</span> *operation3 = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^&#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"1 --- %@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;];</span><br><span class="line">[operation3 addExecutionBlock:^&#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"2 --- %@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;];</span><br><span class="line"><span class="built_in">NSBlockOperation</span> *operation4 = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^&#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"3 --- %@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;];</span><br><span class="line"><span class="comment">// æ·»åŠ ä»»åŠ¡åˆ°é˜Ÿåˆ—ä¸­</span></span><br><span class="line">[queue addOperation:operation1];</span><br><span class="line">[queue addOperation:operation2];</span><br><span class="line">[queue addOperation:operation3];</span><br><span class="line">[queue addOperation:operation4];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¬¬äºŒç§æ–¹å¼</span></span><br><span class="line">- (<span class="keyword">void</span>)operationQueue2</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// åˆ›å»ºNSOperationQueueé˜Ÿåˆ—</span></span><br><span class="line"><span class="built_in">NSOperationQueue</span> *queue = [[<span class="built_in">NSOperationQueue</span> alloc] init];</span><br><span class="line">[queue addOperationWithBlock:^&#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"1 --- %@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;];</span><br><span class="line">[queue addOperationWithBlock:^&#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"2 --- %@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-NSOperationä¸­çš„æ“ä½œä¾èµ–"><a href="#2-NSOperationä¸­çš„æ“ä½œä¾èµ–" class="headerlink" title="2.NSOperationä¸­çš„æ“ä½œä¾èµ–"></a>2.NSOperationä¸­çš„æ“ä½œä¾èµ–</h4><p>NSOperationä¹‹é—´å¯ä»¥è®¾ç½®ä¾èµ–æ¥ä¿è¯æ‰§è¡Œé¡ºåº,æ¯”å¦‚ä¸€å®šè¦è®©æ“ä½œAæ‰§è¡Œå®Œå,æ‰èƒ½æ‰§è¡Œæ“ä½œB,å¯ä»¥è¿™ä¹ˆå†™[operationB addDependency:operationA]; // æ“ä½œBä¾èµ–äºæ“ä½œoperationA,å¦å¤–,é€šè¿‡removeDependencyæ–¹æ³•å¯ä»¥åˆ é™¤ä¾èµ–å¯¹è±¡.</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#pragma mark - ä¾èµ–æ“ä½œè°ƒæ•´æ‰§è¡Œé¡ºåº</span></span><br><span class="line">- (<span class="keyword">void</span>)<span class="built_in">NSOperationTest1</span> &#123;</span><br><span class="line"><span class="built_in">NSOperationQueue</span> *queue = [[<span class="built_in">NSOperationQueue</span> alloc] init];</span><br><span class="line"><span class="built_in">NSBlockOperation</span> *op1 = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^&#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"~~1~~%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;];</span><br><span class="line"><span class="built_in">NSBlockOperation</span> *op2 = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"~~2~~%@~~%d~~"</span>, [<span class="built_in">NSThread</span> currentThread], i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;];</span><br><span class="line"><span class="built_in">NSBlockOperation</span> *op3 = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^&#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"~~3~~%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;];</span><br><span class="line">[op2 addExecutionBlock:^&#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"~~4~~%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;];</span><br><span class="line">op3.completionBlock = ^&#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"~~5~~%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// è®¾ç½®ä¾èµ–</span></span><br><span class="line">[op1 addDependency:op2];</span><br><span class="line">[op1 addDependency:op3];</span><br><span class="line">[queue addOperation:op1];</span><br><span class="line">[queue addOperation:op2];</span><br><span class="line">[queue addOperation:op3];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-çº¿ç¨‹é—´çš„é€šä¿¡"><a href="#3-çº¿ç¨‹é—´çš„é€šä¿¡" class="headerlink" title="3.çº¿ç¨‹é—´çš„é€šä¿¡"></a>3.çº¿ç¨‹é—´çš„é€šä¿¡</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#pragma mark - NSOperationå®ç°çº¿ç¨‹é—´çš„é€šä¿¡</span></span><br><span class="line">- (<span class="keyword">void</span>)<span class="built_in">NSOperationTest2</span> &#123;</span><br><span class="line">[[[<span class="built_in">NSOperationQueue</span> alloc] init] addOperationWithBlock:^&#123;</span><br><span class="line"><span class="built_in">NSData</span> *data = [<span class="built_in">NSData</span> dataWithContentsOfURL:[<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://img.lanrentuku.com/img/allimg/1310/13822295641903.jpg"</span>]];</span><br><span class="line"></span><br><span class="line"><span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageWithData:data];</span><br><span class="line"></span><br><span class="line">[[<span class="built_in">NSOperationQueue</span> mainQueue] addOperationWithBlock:^&#123;</span><br><span class="line"><span class="keyword">self</span>.imageview.image = image;</span><br><span class="line">&#125;];</span><br><span class="line">&#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ä¸‰ã€ä¸€äº›ç®€å•æ–¹æ³•-1"><a href="#ä¸‰ã€ä¸€äº›ç®€å•æ–¹æ³•-1" class="headerlink" title="ä¸‰ã€ä¸€äº›ç®€å•æ–¹æ³•"></a>ä¸‰ã€ä¸€äº›ç®€å•æ–¹æ³•</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å–æ¶ˆå•ä¸ªæ“ä½œ</span></span><br><span class="line">[operation cancel];</span><br><span class="line"><span class="comment">// å–æ¶ˆqueueä¸­æ‰€æœ‰çš„æ“ä½œ</span></span><br><span class="line">[queue cancelAllOperations];</span><br><span class="line"><span class="comment">//è®¾ç½®é˜Ÿåˆ—çš„æœ€å¤§å¹¶å‘æ“ä½œæ•°é‡</span></span><br><span class="line">queue.maxConcurrentOperationCount = <span class="number">1</span>;</span><br><span class="line"><span class="comment">// ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œç­‰åˆ°æŸä¸ªoperationæ‰§è¡Œå®Œæ¯•</span></span><br><span class="line">[operation waitUntilFinished];</span><br><span class="line"><span class="comment">// é˜»å¡å½“å‰çº¿ç¨‹ï¼Œç­‰å¾…queueçš„æ‰€æœ‰æ“ä½œæ‰§è¡Œå®Œæ¯•</span></span><br><span class="line">[queue waitUntilAllOperationsAreFinished];</span><br><span class="line"><span class="comment">// æš‚åœqueue YESä»£è¡¨æš‚åœé˜Ÿåˆ—,NOä»£è¡¨æ¢å¤é˜Ÿåˆ—</span></span><br><span class="line">[queue setSuspended:<span class="literal">YES</span>];</span><br></pre></td></tr></table></figure>
<hr>
<p><em>NSOperation å¸¸ç”¨çš„åŸºæœ¬ä¸Šä¹Ÿå°±ä¸Šé¢é‚£äº›äº†ã€‚ã€‚ã€‚GCD å°±ä¸ç”¨å¤šè¯´äº†ï¼Œè€ä¸œå®¶è‹¹æœæ¨èçš„ï¼Œä¸è¿‡æˆ‘å´è§‰å¾—åå­—å¤ªé•¿~~~ï¼Œä¸€å¼€å§‹æ€»æ˜¯è®°ä¸ä½ï¼Œå¤šæ•²å°±å¥½äº†ï¼æ‰€æœ‰ç¼–ç¨‹è¯­è¨€å¤§æ¦‚éƒ½æœ‰è¿™ä¹ˆä¸€ä¸ªç»æ‹›O(âˆ©_âˆ©)Oï¼</em></p>
<h2 id="ï¼ˆå››ï¼‰iOSå¼€å‘ä¹‹å¤šçº¿ç¨‹-GCD"><a href="#ï¼ˆå››ï¼‰iOSå¼€å‘ä¹‹å¤šçº¿ç¨‹-GCD" class="headerlink" title="ï¼ˆå››ï¼‰iOSå¼€å‘ä¹‹å¤šçº¿ç¨‹ GCD"></a>ï¼ˆå››ï¼‰iOSå¼€å‘ä¹‹å¤šçº¿ç¨‹ GCD</h2><h3 id="ä¸€ã€GCD-æœ¯è¯­"><a href="#ä¸€ã€GCD-æœ¯è¯­" class="headerlink" title="ä¸€ã€GCD æœ¯è¯­"></a>ä¸€ã€GCD æœ¯è¯­</h3><p>è¦ç†è§£GCD ï¼Œæˆ‘ä»¬å…ˆæ¥ç†Ÿæ‚‰ä¸çº¿ç¨‹å’Œå¹¶å‘ç›¸å…³çš„å‡ ä¸ªæ¦‚å¿µã€‚</p>
<h4 id="1-Serial-vs-Concurrent-ä¸²è¡Œ-vs-å¹¶å‘"><a href="#1-Serial-vs-Concurrent-ä¸²è¡Œ-vs-å¹¶å‘" class="headerlink" title="1.Serial vs. Concurrent ä¸²è¡Œ vs. å¹¶å‘"></a>1.Serial vs. Concurrent ä¸²è¡Œ vs. å¹¶å‘</h4><p>ä»»åŠ¡ä¸²è¡Œæ‰§è¡Œå°±æ˜¯æ¯æ¬¡åªæœ‰ä¸€ä¸ªä»»åŠ¡è¢«æ‰§è¡Œï¼Œä»»åŠ¡å¹¶å‘æ‰§è¡Œå°±æ˜¯åœ¨åŒä¸€æ—¶é—´å¯ä»¥æœ‰å¤šä¸ªä»»åŠ¡è¢«æ‰§è¡Œã€‚</p>
<h4 id="2-åŒæ­¥ï¼ˆSynchronousï¼‰ä¸å¼‚æ­¥ï¼ˆAsynchronousï¼‰"><a href="#2-åŒæ­¥ï¼ˆSynchronousï¼‰ä¸å¼‚æ­¥ï¼ˆAsynchronousï¼‰" class="headerlink" title="2.åŒæ­¥ï¼ˆSynchronousï¼‰ä¸å¼‚æ­¥ï¼ˆAsynchronousï¼‰"></a>2.åŒæ­¥ï¼ˆSynchronousï¼‰ä¸å¼‚æ­¥ï¼ˆAsynchronousï¼‰</h4><p>åŒæ­¥ï¼Œæ„å‘³ç€åœ¨å½“å‰çº¿ç¨‹ä¸­æ‰§è¡Œä»»åŠ¡ï¼Œä¸å…·å¤‡å¼€å¯æ–°çš„çº¿ç¨‹çš„èƒ½åŠ›ã€‚<br>å¼‚æ­¥ï¼Œåœ¨æ–°çš„çº¿ç¨‹ä¸­æ‰§è¡Œä»»åŠ¡ï¼Œå…·å¤‡å¼€å¯æ–°çš„çº¿ç¨‹çš„èƒ½åŠ›ã€‚</p>
<h4 id="3-ä¸´ç•ŒåŒºï¼ˆCritical-Sectionï¼‰"><a href="#3-ä¸´ç•ŒåŒºï¼ˆCritical-Sectionï¼‰" class="headerlink" title="3.ä¸´ç•ŒåŒºï¼ˆCritical Sectionï¼‰"></a>3.ä¸´ç•ŒåŒºï¼ˆCritical Sectionï¼‰</h4><p>å°±æ˜¯ä¸€æ®µä»£ç ä¸èƒ½è¢«å¹¶å‘æ‰§è¡Œï¼Œå³ä¸¤ä¸ªçº¿ç¨‹ä¸èƒ½åŒæ—¶æ‰§è¡Œè¿™æ®µä»£ç ã€‚</p>
<h4 id="4-æ­»é”ï¼ˆDeadlockï¼‰"><a href="#4-æ­»é”ï¼ˆDeadlockï¼‰" class="headerlink" title="4.æ­»é”ï¼ˆDeadlockï¼‰"></a>4.æ­»é”ï¼ˆDeadlockï¼‰</h4><p>åœæ­¢ç­‰å¾…äº‹æƒ…çš„çº¿ç¨‹ä¼šå¯¼è‡´å¤šä¸ªçº¿ç¨‹ç›¸äº’ç»´æŒç­‰å¾…ï¼Œå³æ­»é”ã€‚</p>
<h4 id="5-Thread-Safe-çº¿ç¨‹å®‰å…¨"><a href="#5-Thread-Safe-çº¿ç¨‹å®‰å…¨" class="headerlink" title="5.Thread Safe çº¿ç¨‹å®‰å…¨"></a>5.Thread Safe çº¿ç¨‹å®‰å…¨</h4><p>çº¿ç¨‹å®‰å…¨çš„ä»£ç èƒ½åœ¨å¤šçº¿ç¨‹æˆ–å¹¶å‘ä»»åŠ¡ä¸­è¢«å®‰å…¨çš„è°ƒç”¨ï¼Œè€Œä¸ä¼šå¯¼è‡´ä»»ä½•é—®é¢˜ï¼ˆæ•°æ®æŸåï¼Œå´©æºƒç­‰ï¼‰ã€‚</p>
<h4 id="6-Queues-é˜Ÿåˆ—"><a href="#6-Queues-é˜Ÿåˆ—" class="headerlink" title="6.Queues é˜Ÿåˆ—"></a>6.Queues é˜Ÿåˆ—</h4><p>GCD æä¾›æœ‰ dispatch queues æ¥å¤„ç†ä»£ç å—ï¼Œè¿™äº›é˜Ÿåˆ—ç®¡ç†ä½ æä¾›ç»™ GCD çš„ä»»åŠ¡å¹¶ç”¨ FIFO é¡ºåºæ‰§è¡Œè¿™äº›ä»»åŠ¡ã€‚</p>
<h3 id="äºŒã€ä»£ç æ¼”ç¤º"><a href="#äºŒã€ä»£ç æ¼”ç¤º" class="headerlink" title="äºŒã€ä»£ç æ¼”ç¤º"></a>äºŒã€ä»£ç æ¼”ç¤º</h3><h3 id="1ã€dispatch-async-å¼‚æ­¥å‡½æ•°"><a href="#1ã€dispatch-async-å¼‚æ­¥å‡½æ•°" class="headerlink" title="1ã€dispatch_async(å¼‚æ­¥å‡½æ•°)"></a>1ã€dispatch_async(å¼‚æ­¥å‡½æ•°)</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¼‚æ­¥å‡½æ•° + å¹¶å‘é˜Ÿåˆ—:å¯ä»¥åŒæ—¶å¼€å¯å¤šæ¡çº¿ç¨‹,ä»»åŠ¡æ˜¯å¹¶è¡Œçš„</span></span><br><span class="line"><span class="comment">// 1.åˆ›å»ºå¹¶å‘é˜Ÿåˆ—</span></span><br><span class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</span><br><span class="line"><span class="comment">//2.å°†ä»»åŠ¡åŠ å…¥é˜Ÿåˆ—</span></span><br><span class="line"><span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span> ; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%ld~~~~1~~~~%@"</span>, i, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%ld~~~2~~~%@"</span>, i, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%ld~~~~3~~~~%@"</span>, i, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//å¼‚æ­¥å‡½æ•° + ä¸²è¡Œé˜Ÿåˆ—:ä¼šå¼€å¯æ–°çš„çº¿ç¨‹ï¼Œä½†æ˜¯ä»»åŠ¡æ˜¯ä¸²è¡Œçš„ï¼Œæ‰§è¡Œå®Œä¸€ä¸ªä»»åŠ¡ï¼Œå†æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡</span></span><br><span class="line"><span class="comment">// 1.åˆ›å»ºä¸²è¡Œé˜Ÿåˆ—</span></span><br><span class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_queue_create(<span class="string">"YMWM"</span>, DISPATCH_QUEUE_SERIAL);</span><br><span class="line"><span class="comment">// 2.å°†ä»»åŠ¡åŠ å…¥é˜Ÿåˆ—</span></span><br><span class="line"><span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span> ; i ++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"1~~~%@~~~~~%ld"</span>, [<span class="built_in">NSThread</span> currentThread], i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"2~~~%@~~~~~%ld"</span>, [<span class="built_in">NSThread</span> currentThread], i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"2~~~%@~~~~~%ld"</span>, [<span class="built_in">NSThread</span> currentThread], i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="2ã€dispatch-sync-åŒæ­¥å‡½æ•°"><a href="#2ã€dispatch-sync-åŒæ­¥å‡½æ•°" class="headerlink" title="2ã€dispatch_sync(åŒæ­¥å‡½æ•°)"></a>2ã€dispatch_sync(åŒæ­¥å‡½æ•°)</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åŒæ­¥å‡½æ•° + å¹¶å‘é˜Ÿåˆ—:ä¸ä¼šå¼€å¯æ–°çš„çº¿ç¨‹</span></span><br><span class="line"><span class="comment">// 1.è·å¾—å…¨å±€çš„å¹¶å‘é˜Ÿåˆ—</span></span><br><span class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// 2.å°†ä»»åŠ¡åŠ å…¥é˜Ÿåˆ—</span></span><br><span class="line"><span class="built_in">dispatch_sync</span>(queue, ^&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"1~~~%@~~~~~%ld"</span>, [<span class="built_in">NSThread</span> currentThread], i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_sync</span>(queue, ^&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"2~~~%@~~~~~%ld"</span>, [<span class="built_in">NSThread</span> currentThread], i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_sync</span>(queue, ^&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"3~~~%@~~~~~%ld"</span>, [<span class="built_in">NSThread</span> currentThread], i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//åŒæ­¥å‡½æ•° + ä¸²è¡Œé˜Ÿåˆ—:ä¸ä¼šå¼€å¯æ–°çš„çº¿ç¨‹</span></span><br><span class="line"><span class="comment">// 1.åˆ›å»ºä¸²è¡Œé˜Ÿåˆ—</span></span><br><span class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_queue_create(<span class="string">"YMWM"</span>, DISPATCH_QUEUE_SERIAL);</span><br><span class="line"><span class="comment">// 2.å°†ä»»åŠ¡åŠ å…¥é˜Ÿåˆ—</span></span><br><span class="line"><span class="built_in">dispatch_sync</span>(queue, ^&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"1~~~%@~~~~~%ld"</span>, [<span class="built_in">NSThread</span> currentThread], i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_sync</span>(queue, ^&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"2~~~%@~~~~~%ld"</span>, [<span class="built_in">NSThread</span> currentThread], i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_sync</span>(queue, ^&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"3~~~%@~~~~~%ld"</span>, [<span class="built_in">NSThread</span> currentThread], i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="3-ä¸¤è€…åœ¨ä¸»é˜Ÿåˆ—ä¸­çš„åº”ç”¨"><a href="#3-ä¸¤è€…åœ¨ä¸»é˜Ÿåˆ—ä¸­çš„åº”ç”¨" class="headerlink" title="3.ä¸¤è€…åœ¨ä¸»é˜Ÿåˆ—ä¸­çš„åº”ç”¨"></a>3.ä¸¤è€…åœ¨ä¸»é˜Ÿåˆ—ä¸­çš„åº”ç”¨</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¼‚æ­¥å‡½æ•° + ä¸»é˜Ÿåˆ—ï¼šåªåœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œä»»åŠ¡</span></span><br><span class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_get_main_queue();</span><br><span class="line"><span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"1~~~%@~~~~~%ld"</span>, [<span class="built_in">NSThread</span> currentThread], i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"2~~~%@~~~~~%ld"</span>, [<span class="built_in">NSThread</span> currentThread], i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"3~~~%@~~~~~%ld"</span>, [<span class="built_in">NSThread</span> currentThread], i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//åŒæ­¥å‡½æ•° + ä¸»é˜Ÿåˆ—ï¼šæ­»å¾ªç¯</span></span><br><span class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_get_main_queue();</span><br><span class="line"><span class="built_in">dispatch_sync</span>(queue, ^&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"1~~~%@~~~~~%ld"</span>, [<span class="built_in">NSThread</span> currentThread], i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_sync</span>(queue, ^&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"1~~~%@~~~~~%ld"</span>, [<span class="built_in">NSThread</span> currentThread], i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_sync</span>(queue, ^&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"1~~~%@~~~~~%ld"</span>, [<span class="built_in">NSThread</span> currentThread], i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="4ã€dispatch-group-asyncçš„ä½¿ç”¨"><a href="#4ã€dispatch-group-asyncçš„ä½¿ç”¨" class="headerlink" title="4ã€dispatch_group_asyncçš„ä½¿ç”¨"></a>4ã€dispatch_group_asyncçš„ä½¿ç”¨</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—ç»„</span></span><br><span class="line">dispatch_group_t group = dispatch_group_create();</span><br><span class="line">dispatch_group_async(group, queue, ^&#123;</span><br><span class="line"><span class="comment">//æ·»åŠ æ“ä½œ...</span></span><br><span class="line">[<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">1</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"1%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;);</span><br><span class="line">dispatch_group_async(group, queue, ^&#123;</span><br><span class="line"><span class="comment">//æ·»åŠ æ“ä½œ...</span></span><br><span class="line">[<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">1</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"2%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;);</span><br><span class="line">dispatch_group_async(group, queue, ^&#123;</span><br><span class="line"><span class="comment">//æ·»åŠ æ“ä½œ...</span></span><br><span class="line">[<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">1</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"3%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// å›åˆ°ä¸»çº¿ç¨‹</span></span><br><span class="line">dispatch_group_notify(group, dispatch_get_main_queue(), ^&#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"å›åˆ°ä¸»çº¿ç¨‹åˆ·æ–°UI"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="5ã€dispatch-barrier-asyncçš„ä½¿ç”¨"><a href="#5ã€dispatch-barrier-asyncçš„ä½¿ç”¨" class="headerlink" title="5ã€dispatch_barrier_asyncçš„ä½¿ç”¨"></a>5ã€dispatch_barrier_asyncçš„ä½¿ç”¨</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_queue_create(<span class="string">"YMWM"</span>, DISPATCH_QUEUE_CONCURRENT);</span><br><span class="line"><span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">[<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">.5</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"1%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">[<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">.5</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"2%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;);</span><br><span class="line">dispatch_barrier_async(queue, ^&#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"barrier --- %@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">[<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">.5</span>];</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"3%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"4%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="6ã€dispatch-applyçš„ä½¿ç”¨"><a href="#6ã€dispatch-applyçš„ä½¿ç”¨" class="headerlink" title="6ã€dispatch_applyçš„ä½¿ç”¨"></a>6ã€dispatch_applyçš„ä½¿ç”¨</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ‰§è¡ŒæŸä¸ªä»£ç ç‰‡æ®µ10æ¬¡</span></span><br><span class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</span><br><span class="line">dispatch_apply(<span class="number">10</span>, queue, ^(size_t index) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="7ã€dispatch-once-tçš„ä½¿ç”¨"><a href="#7ã€dispatch-once-tçš„ä½¿ç”¨" class="headerlink" title="7ã€dispatch_once_tçš„ä½¿ç”¨"></a>7ã€dispatch_once_tçš„ä½¿ç”¨</h4><p>ç¬¬ä¸€ä¸ªå‚æ•°predicateï¼Œè¯¥å‚æ•°æ˜¯æ£€æŸ¥åé¢ç¬¬äºŒä¸ªå‚æ•°æ‰€ä»£è¡¨çš„ä»£ç å—æ˜¯å¦è¢«è°ƒç”¨çš„è°“è¯ï¼Œç¬¬äºŒä¸ªå‚æ•°åˆ™æ˜¯åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡çš„ä»£ç å—<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</span><br><span class="line"><span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h4 id="8-dispatch-afterçš„ä½¿ç”¨"><a href="#8-dispatch-afterçš„ä½¿ç”¨" class="headerlink" title="8.dispatch_afterçš„ä½¿ç”¨"></a>8.dispatch_afterçš„ä½¿ç”¨</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"-------"</span>);</span><br><span class="line"><span class="comment">//å»¶è¿Ÿæ‰§è¡Œï¼Œè¾ƒä¸ºç²¾ç¡®</span></span><br><span class="line">dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">2.0</span> * <span class="built_in">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"~~~~~~"</span>);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="9-çº¿ç¨‹é—´çš„é€šä¿¡"><a href="#9-çº¿ç¨‹é—´çš„é€šä¿¡" class="headerlink" title="9.çº¿ç¨‹é—´çš„é€šä¿¡"></a>9.çº¿ç¨‹é—´çš„é€šä¿¡</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#pragma mark - GCD-çº¿ç¨‹é—´çš„é€šä¿¡</span></span><br><span class="line">- (<span class="keyword">void</span>)downloadImage &#123;</span><br><span class="line"><span class="built_in">NSData</span> *data = [<span class="built_in">NSData</span> dataWithContentsOfURL:[<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://img.lanrentuku.com/img/allimg/1310/13822295641903.jpg"</span>]];</span><br><span class="line"></span><br><span class="line"><span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageWithData:data];</span><br><span class="line"></span><br><span class="line"><span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">self</span>.imageview.image = image;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="10-æ–‡ä»¶å‰ªåˆ‡"><a href="#10-æ–‡ä»¶å‰ªåˆ‡" class="headerlink" title="10.æ–‡ä»¶å‰ªåˆ‡"></a>10.æ–‡ä»¶å‰ªåˆ‡</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç¬¬ä¸€ç§æ–¹å¼</span></span><br><span class="line"><span class="comment">//å°†æ–‡ä»¶ä»fromå‰ªåˆ‡è‡³to</span></span><br><span class="line"><span class="built_in">NSString</span> *from = <span class="string">@"/Users/iOS/Desktop/Test"</span>;</span><br><span class="line"><span class="built_in">NSString</span> *to = <span class="string">@"/Users/iOS/Desktop/test1"</span>;</span><br><span class="line"><span class="built_in">NSFileManager</span> *mgr = [<span class="built_in">NSFileManager</span> defaultManager];</span><br><span class="line"><span class="built_in">NSArray</span> *subpaths = [mgr subpathsAtPath:from];</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSString</span> *subpath <span class="keyword">in</span> subpaths) &#123;</span><br><span class="line"><span class="built_in">NSString</span> *fromFullpath = [from stringByAppendingPathComponent:subpath];</span><br><span class="line"><span class="built_in">NSString</span> *toFullpath = [to stringByAppendingPathComponent:subpath];</span><br><span class="line"><span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</span><br><span class="line"><span class="comment">//å‰ªåˆ‡</span></span><br><span class="line">[mgr moveItemAtPath:fromFullpath toPath:toFullpath error:<span class="literal">nil</span>];</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ç¬¬äºŒç§æ–¹å¼</span></span><br><span class="line"><span class="comment">//å°†æ–‡ä»¶ä»fromå‰ªåˆ‡è‡³to</span></span><br><span class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</span><br><span class="line"><span class="built_in">NSString</span> *from = <span class="string">@"/Users/iOS/Desktop/Test"</span>;</span><br><span class="line"><span class="built_in">NSString</span> *to = <span class="string">@"/Users/iOS/Desktop/test1"</span>;</span><br><span class="line"><span class="built_in">NSFileManager</span> *mag = [<span class="built_in">NSFileManager</span> defaultManager];</span><br><span class="line"><span class="built_in">NSArray</span> *subpaths = [mag subpathsAtPath:from];</span><br><span class="line">dispatch_apply(subpaths.count, queue, ^(size_t index) &#123;</span><br><span class="line"><span class="built_in">NSString</span> *subpath = subpaths[index];</span><br><span class="line"><span class="built_in">NSString</span> *fromFullpath = [from stringByAppendingPathComponent:subpath];</span><br><span class="line"><span class="built_in">NSString</span> *toFullpath = [to stringByAppendingPathComponent:subpath];</span><br><span class="line"><span class="comment">//        å‰ªåˆ‡</span></span><br><span class="line">[mag moveItemAtPath:fromFullpath toPath:toFullpath error:<span class="literal">nil</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@~~~~~~%@"</span>, [<span class="built_in">NSThread</span> currentThread], subpath);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="ä¸‰ã€GCDä¸éGCDå®ç°å•ç²’è®¾è®¡æ¨¡å¼"><a href="#ä¸‰ã€GCDä¸éGCDå®ç°å•ç²’è®¾è®¡æ¨¡å¼" class="headerlink" title="ä¸‰ã€GCDä¸éGCDå®ç°å•ç²’è®¾è®¡æ¨¡å¼"></a>ä¸‰ã€GCDä¸éGCDå®ç°å•ç²’è®¾è®¡æ¨¡å¼</h3><h4 id="1-GCDå®ç°è®¾è®¡æ¨¡å¼"><a href="#1-GCDå®ç°è®¾è®¡æ¨¡å¼" class="headerlink" title="1.GCDå®ç°è®¾è®¡æ¨¡å¼"></a>1.GCDå®ç°è®¾è®¡æ¨¡å¼</h4><p>ç±»çš„.hæ–‡ä»¶<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">PKPerson</span> : <span class="title">NSObject</span></span></span><br><span class="line">+ (<span class="keyword">instancetype</span>)sharedCar;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure></p>
<p>ç±»çš„.mæ–‡ä»¶<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">PKPerson</span>() &lt;<span class="title">NSCopying</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">PKPerson</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®ä¾‹å˜é‡ï¼Œå½“å‰ç±»</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">id</span> _instance;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é‡å†™allocWithZoneæ–¹æ³•</span></span><br><span class="line">+ (<span class="keyword">instancetype</span>)allocWithZone:(<span class="keyword">struct</span> _NSZone *)zone&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯¥æ–¹æ³•æ•´ä¸ªåº”ç”¨ç¨‹åºåªè°ƒç”¨ä¸€æ¬¡</span></span><br><span class="line"><span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</span><br><span class="line">_instance = [<span class="keyword">super</span> allocWithZone:zone];</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">return</span> _instance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">instancetype</span>)sharedInstance&#123;</span><br><span class="line"><span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</span><br><span class="line"><span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</span><br><span class="line">_instance = [[<span class="keyword">self</span> alloc] init];</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">return</span> _instance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¿è¯æ¯å¤åˆ¶ä¸€ä¸ªå¯¹è±¡ä¹Ÿæ˜¯åŒä¸€å†…å­˜ç©ºé—´</span></span><br><span class="line">- (<span class="keyword">id</span>)copyWithZone:(<span class="built_in">NSZone</span> *)zone&#123;</span><br><span class="line"><span class="keyword">return</span> _instance;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure></p>
<h4 id="2-å®å®šä¹‰å°è£…GCDå•ç²’è®¾è®¡æ¨¡å¼"><a href="#2-å®å®šä¹‰å°è£…GCDå•ç²’è®¾è®¡æ¨¡å¼" class="headerlink" title="2.å®å®šä¹‰å°è£…GCDå•ç²’è®¾è®¡æ¨¡å¼"></a>2.å®å®šä¹‰å°è£…GCDå•ç²’è®¾è®¡æ¨¡å¼</h4><p>é€šå¸¸å½“å¤šä¸ªç±»ä¹‹é—´æœ‰ç›¸åŒçš„å±æ€§å’Œæ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬ä¼šè€ƒè™‘å°†ç›¸åŒçš„éƒ¨åˆ†æŠ½å–å‡ºæ¥ï¼Œå°è£…åˆ°çˆ¶ç±»ä¸­ï¼Œä½†å•ç²’æ¨¡å¼ä¸å¯ä»¥è¿™æ ·åšï¼Œå› ä¸ºå•ç²’æ¨¡å¼é‡‡ç”¨ç»§æ‰¿æ–¹å¼çš„è¯ï¼Œæ‰€æœ‰çš„ç±»ä¼šå…±äº«ä¸€ä»½å†…å­˜ã€‚æ‰€ä»¥ä¸€èˆ¬é‡‡å–å®å®šä¹‰å°è£…GCDå•ç²’è®¾è®¡æ¨¡å¼ã€‚æ³¨æ„ï¼Œæ¯è¡Œçš„ç»“å°¾éœ€è¦æ·»åŠ  â€œ\â€ã€‚<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .hæ–‡ä»¶</span></span><br><span class="line"><span class="meta">#define PKSingletonH + (instancetype)sharedInstance;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// .mæ–‡ä»¶</span></span><br><span class="line"><span class="meta">#define PKSingletonH \</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">id</span> _instace; \</span><br><span class="line">\</span><br><span class="line">+ (<span class="keyword">instancetype</span>)allocWithZone:(<span class="keyword">struct</span> _NSZone *)zone \</span><br><span class="line">&#123; \</span><br><span class="line"><span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken; \</span><br><span class="line"><span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123; \</span><br><span class="line">_instace = [<span class="keyword">super</span> allocWithZone:zone]; \</span><br><span class="line">&#125;); \</span><br><span class="line"><span class="keyword">return</span> _instace; \</span><br><span class="line">&#125; \</span><br><span class="line">\</span><br><span class="line">+ (<span class="keyword">instancetype</span>)sharedInstance \</span><br><span class="line">&#123; \</span><br><span class="line"><span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken; \</span><br><span class="line"><span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123; \</span><br><span class="line">_instace = [[<span class="keyword">self</span> alloc] init]; \</span><br><span class="line">&#125;); \</span><br><span class="line"><span class="keyword">return</span> _instace; \</span><br><span class="line">&#125; \</span><br><span class="line">\</span><br><span class="line">- (<span class="keyword">id</span>)copyWithZone:(<span class="built_in">NSZone</span> *)zone \</span><br><span class="line">&#123; \</span><br><span class="line"><span class="keyword">return</span> _instace; \</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="3-éGCDå®ç°è®¾è®¡æ¨¡å¼"><a href="#3-éGCDå®ç°è®¾è®¡æ¨¡å¼" class="headerlink" title="3.éGCDå®ç°è®¾è®¡æ¨¡å¼"></a>3.éGCDå®ç°è®¾è®¡æ¨¡å¼</h4><p>ç±»çš„.hæ–‡ä»¶</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">PKPerson</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">instancetype</span>)sharedInstance;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>ç±»çš„.mæ–‡ä»¶<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"PKPerson.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">PKPerson</span>()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">PKPerson</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">id</span> _instance;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">instancetype</span>)allocWithZone:(<span class="keyword">struct</span> _NSZone *)zone</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// åŒæ­¥é”ï¼Œé˜²æ­¢å¤šçº¿ç¨‹åŒæ—¶è¿›å…¥</span></span><br><span class="line"><span class="keyword">@synchronized</span>(<span class="keyword">self</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (_instance == <span class="literal">nil</span>) &#123;</span><br><span class="line">_instance = [<span class="keyword">super</span> allocWithZone:zone];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> _instance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">instancetype</span>)sharedInstance</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">@synchronized</span>(<span class="keyword">self</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (_instance == <span class="literal">nil</span>) &#123;</span><br><span class="line">_instance = [[<span class="keyword">self</span> alloc] init];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> _instance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>)copyWithZone:(<span class="built_in">NSZone</span> *)zone</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> _instance;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure></p>
<h3 id="å››ã€GCDå®šæ—¶å™¨"><a href="#å››ã€GCDå®šæ—¶å™¨" class="headerlink" title="å››ã€GCDå®šæ—¶å™¨"></a>å››ã€GCDå®šæ—¶å™¨</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="comment">/** å®šæ—¶å™¨(è¿™é‡Œä¸ç”¨å¸¦*ï¼Œå› ä¸ºdispatch_source_tå°±æ˜¯ä¸ªç±»ï¼Œå†…éƒ¨å·²ç»åŒ…å«äº†*) */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) dispatch_source_t timer;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span> *)touches withEvent:(<span class="built_in">UIEvent</span> *)event</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// è·å¾—é˜Ÿåˆ—</span></span><br><span class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_get_main_queue();</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨(dispatch_source_tæœ¬è´¨è¿˜æ˜¯ä¸ªOCå¯¹è±¡)</span></span><br><span class="line"><span class="keyword">self</span>.timer = dispatch_source_create(DISPATCH_SOURCE_TYPE_TIMER, <span class="number">0</span>, <span class="number">0</span>, queue);</span><br><span class="line"></span><br><span class="line"><span class="comment">// GCDçš„æ—¶é—´å‚æ•°ä¸€èˆ¬æ˜¯çº³ç§’ï¼ˆ1ç§’ == 10çš„9æ¬¡æ–¹çº³ç§’ï¼‰</span></span><br><span class="line">dispatch_time_t start = dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">1.0</span> * <span class="built_in">NSEC_PER_SEC</span>));</span><br><span class="line">uint64_t interval = (uint64_t)(<span class="number">1.0</span> * <span class="built_in">NSEC_PER_SEC</span>);</span><br><span class="line">dispatch_source_set_timer(<span class="keyword">self</span>.timer, start, interval, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®å›è°ƒ</span></span><br><span class="line">dispatch_source_set_event_handler(<span class="keyword">self</span>.timer, ^&#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"------%@-------"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯åŠ¨å®šæ—¶å™¨</span></span><br><span class="line">dispatch_resume(<span class="keyword">self</span>.timer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p><em>ä¸‰ç§å¤šçº¿ç¨‹ç¼–ç¨‹éƒ½è¯´å®Œäº†ï¼Œä»£ç æœ‰äº›å¤šï¼Œä¸è¿‡å¸Œæœ›æœ‹å‹ä»¬æœ‰æ‰€æ”¶è·ï¼Œå¦å¤–å†è¡¥å……ä¸€äº›å…³äºçº¿ç¨‹é—´é€šä¿¡çš„ã€‚ã€‚ã€‚</em></p>
<h2 id="ï¼ˆäº”ï¼‰iOSå¼€å‘ä¹‹å¤šçº¿ç¨‹-çº¿ç¨‹é—´çš„é€šä¿¡"><a href="#ï¼ˆäº”ï¼‰iOSå¼€å‘ä¹‹å¤šçº¿ç¨‹-çº¿ç¨‹é—´çš„é€šä¿¡" class="headerlink" title="ï¼ˆäº”ï¼‰iOSå¼€å‘ä¹‹å¤šçº¿ç¨‹ çº¿ç¨‹é—´çš„é€šä¿¡"></a>ï¼ˆäº”ï¼‰iOSå¼€å‘ä¹‹å¤šçº¿ç¨‹ çº¿ç¨‹é—´çš„é€šä¿¡</h2><h3 id="ä¸€ã€ç®€å•ä»‹ç»"><a href="#ä¸€ã€ç®€å•ä»‹ç»" class="headerlink" title="ä¸€ã€ç®€å•ä»‹ç»"></a>ä¸€ã€ç®€å•ä»‹ç»</h3><p>åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œçº¿ç¨‹å¾€å¾€ä¸æ˜¯å­¤ç«‹å­˜åœ¨çš„ï¼Œå¤šä¸ªçº¿ç¨‹ä¹‹é—´éœ€è¦ç»å¸¸è¿›è¡Œé€šä¿¡ã€‚ä»¥ä¸‹æ˜¯çº¿ç¨‹ä¹‹é—´è¿›è¡Œé€šä¿¡çš„æ–¹æ³•:</p>
<h3 id="äºŒã€å¸¸ç”¨æ–¹æ³•"><a href="#äºŒã€å¸¸ç”¨æ–¹æ³•" class="headerlink" title="äºŒã€å¸¸ç”¨æ–¹æ³•:"></a>äºŒã€å¸¸ç”¨æ–¹æ³•:</h3><h4 id="ä»£ç 1-performSelector"><a href="#ä»£ç 1-performSelector" class="headerlink" title="ä»£ç 1:performSelector"></a>ä»£ç 1:performSelector</h4><p>performSelectorå¸¸ç”¨æ–¹æ³•çš„å¸¸ç”¨æ–¹æ³•ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§:<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œæ“ä½œ</span></span><br><span class="line">[<span class="keyword">self</span> performSelectorOnMainThread:<span class="keyword">@selector</span>(run) withObject:<span class="literal">nil</span> waitUntilDone:<span class="literal">YES</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//åœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œæ“ä½œ</span></span><br><span class="line">[<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(run) withObject:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//åœ¨æŒ‡å®šçº¿ç¨‹ä¸Šæ‰§è¡Œæ“ä½œ</span></span><br><span class="line">[<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(run) onThread:thread withObject:<span class="literal">nil</span> waitUntilDone:<span class="literal">YES</span>];</span><br></pre></td></tr></table></figure></p>
<p>å…·ä½“ä»£ç :<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç‚¹å‡»å±å¹•å¼€å§‹æ‰§è¡Œä»¥ä¸‹æ–¹æ³•</span></span><br><span class="line">- (<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span> *)touches withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</span><br><span class="line">[<span class="keyword">self</span> performSelectorInBackground:<span class="keyword">@selector</span>(download) withObject:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)download</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// å›¾ç‰‡çš„ç½‘ç»œè·¯å¾„</span></span><br><span class="line"><span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://img.lanrentuku.com/img/allimg/1310/13822295641903.jpg"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ ¹æ®åœ°å€åŠ è½½å›¾ç‰‡</span></span><br><span class="line"><span class="built_in">NSData</span> *data = [<span class="built_in">NSData</span> dataWithContentsOfURL:url]; <span class="comment">//è€—æ—¶æ“ä½œ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”Ÿæˆå›¾ç‰‡</span></span><br><span class="line"><span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageWithData:data];</span><br><span class="line"></span><br><span class="line"><span class="comment">// å›åˆ°ä¸»çº¿ç¨‹ï¼Œåˆ·æ–°UIç•Œé¢</span></span><br><span class="line"><span class="comment">//æ–¹å¼ä¸€</span></span><br><span class="line">[<span class="keyword">self</span>.imageView performSelector:<span class="keyword">@selector</span>(setImage:) onThread:[<span class="built_in">NSThread</span> mainThread] withObject:image waitUntilDone:<span class="literal">NO</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ–¹å¼äºŒ</span></span><br><span class="line"><span class="comment">//    [self.imageView performSelectorOnMainThread:@selector(setImage:) withObject:image waitUntilDone:NO];</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ–¹å¼ä¸‰</span></span><br><span class="line"><span class="comment">//    [self performSelectorOnMainThread:@selector(showImage:) withObject:image waitUntilDone:NO];</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ˜¾ç¤ºå›¾ç‰‡(å¦‚æœperformSelectorè°ƒç”¨çš„æ˜¯setImage:æ–¹æ³•ï¼Œä¼šç›´æ¥è°ƒç”¨ç³»ç»Ÿçš„æ–¹æ³•)</span></span><br><span class="line"><span class="comment">//- (void)showImage:(UIImage *)image</span></span><br><span class="line"><span class="comment">//&#123;</span></span><br><span class="line"><span class="comment">//    self.imageView.image = image;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br></pre></td></tr></table></figure></p>
<h4 id="ä»£ç 2-NSOperationQueueæ–¹å¼"><a href="#ä»£ç 2-NSOperationQueueæ–¹å¼" class="headerlink" title="ä»£ç 2:NSOperationQueueæ–¹å¼"></a>ä»£ç 2:NSOperationQueueæ–¹å¼</h4><p>ä¸€ä¸ªNSOperationå¯¹è±¡å¯ä»¥é€šè¿‡è°ƒç”¨startæ–¹æ³•æ¥æ‰§è¡Œä»»åŠ¡,é»˜è®¤æ˜¯åŒæ­¥æ‰§è¡Œçš„.ä¹Ÿå¯ä»¥å°†NSOperationæ·»åŠ åˆ°ä¸€ä¸ªNSOperationQueueä¸­å»æ‰§è¡Œ,è€Œä¸”æ˜¯å¼‚æ­¥æ‰§è¡Œçš„.</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#pragma mark - NSOperationå®ç°çº¿ç¨‹é—´çš„é€šä¿¡</span></span><br><span class="line">- (<span class="keyword">void</span>)<span class="built_in">NSOperationTest</span> &#123;</span><br><span class="line">[[[<span class="built_in">NSOperationQueue</span> alloc] init] addOperationWithBlock:^&#123;</span><br><span class="line"><span class="built_in">NSData</span> *data = [<span class="built_in">NSData</span> dataWithContentsOfURL:[<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://img.lanrentuku.com/img/allimg/1310/13822295641903.jpg"</span>]];</span><br><span class="line"><span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageWithData:data];</span><br><span class="line">[[<span class="built_in">NSOperationQueue</span> mainQueue] addOperationWithBlock:^&#123;</span><br><span class="line"><span class="keyword">self</span>.imageView.image = image;</span><br><span class="line">&#125;];</span><br><span class="line">&#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="ä»£ç 3-GCDæ–¹å¼"><a href="#ä»£ç 3-GCDæ–¹å¼" class="headerlink" title="ä»£ç 3:GCDæ–¹å¼"></a>ä»£ç 3:GCDæ–¹å¼</h4><p>GCDï¼Œå…¨ç§°Grand Central Dispathï¼Œæ˜¯è‹¹æœå¼€å‘çš„ä¸€ç§æ”¯æŒå¹¶è¡Œæ“ä½œçš„æœºåˆ¶ã€‚å®ƒçš„ä¸»è¦éƒ¨ä»¶æ˜¯ä¸€ä¸ªFIFOé˜Ÿåˆ—å’Œä¸€ä¸ªçº¿ç¨‹æ± ï¼Œå‰è€…ç”¨æ¥æ·»åŠ ä»»åŠ¡ï¼Œåè€…ç”¨æ¥æ‰§è¡Œä»»åŠ¡ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å›¾ç‰‡çš„ç½‘ç»œè·¯å¾„</span></span><br><span class="line"><span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://img.lanrentuku.com/img/allimg/1310/13822295641903.jpg"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŠ è½½å›¾ç‰‡</span></span><br><span class="line"><span class="built_in">NSData</span> *data = [<span class="built_in">NSData</span> dataWithContentsOfURL:url];</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”Ÿæˆå›¾ç‰‡</span></span><br><span class="line"><span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageWithData:data];</span><br><span class="line"></span><br><span class="line"><span class="comment">// å›åˆ°ä¸»çº¿ç¨‹æ˜¾ç¤ºå›¾ç‰‡</span></span><br><span class="line"><span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line"><span class="keyword">self</span>.imageView.image = image;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="ä¸‰ã€NSPortæ–¹æ³•"><a href="#ä¸‰ã€NSPortæ–¹æ³•" class="headerlink" title="ä¸‰ã€NSPortæ–¹æ³•:"></a>ä¸‰ã€NSPortæ–¹æ³•:</h3><p>NSPortæœ‰3ä¸ªå­ç±»ï¼ŒNSSocketPortã€NSMessagePortã€NSMachPortï¼Œä½†åœ¨iOSä¸‹åªæœ‰NSMachPortå¯ç”¨ã€‚ä»£ç å¦‚ä¸‹:</p>
<p>UIViewControllerä¸­çš„ä»£ç :</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MyPort.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> () &lt;<span class="title">NSPortDelegate</span>&gt;</span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">[<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"><span class="comment">//åˆ›å»ºä¸»çº¿ç¨‹çš„port</span></span><br><span class="line"><span class="built_in">NSPort</span> *myPort = [<span class="built_in">NSPort</span> port];</span><br><span class="line"></span><br><span class="line"><span class="comment">//è®¾ç½®ä»£ç†</span></span><br><span class="line">myPort.delegate = <span class="keyword">self</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æŠŠportåŠ å…¥runloop</span></span><br><span class="line">[[<span class="built_in">NSRunLoop</span> currentRunLoop] addPort:myPort forMode:<span class="built_in">NSDefaultRunLoopMode</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯åŠ¨å­çº¿ç¨‹,å¹¶ä¼ å…¥ä¸»çº¿ç¨‹çš„port</span></span><br><span class="line">MyPort *work = [[MyPort alloc] init];</span><br><span class="line"></span><br><span class="line">[<span class="built_in">NSThread</span> detachNewThreadSelector:<span class="keyword">@selector</span>(launchThreadWithPort:)</span><br><span class="line">toTarget:work</span><br><span class="line">withObject:myPort];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)handlePortMessage:(<span class="built_in">NSMessagePort</span>*)message&#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"å·²æ¥åˆ°å­çº¿ç¨‹çš„æ¶ˆæ¯ --- %@"</span>, message);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>MyPortä¸­çš„ä»£ç :</p>
<p>.hæ–‡ä»¶:<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MyPort</span> : <span class="title">NSPort</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure></p>
<p>.mæ–‡ä»¶:<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"MyPort.h"</span></span></span><br><span class="line"><span class="meta">#define PKMessage 10</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MyPort</span> ()&lt;<span class="title">NSMachPortDelegate</span>&gt; </span>&#123;</span><br><span class="line"><span class="built_in">NSPort</span> *firstPort;</span><br><span class="line"><span class="built_in">NSPort</span> *secondPort;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">MyPort</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)launchThreadWithPort:(<span class="built_in">NSPort</span> *)port &#123;</span><br><span class="line"><span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ¥æ”¶ä¸»çº¿ç¨‹ä¼ å…¥çš„port</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//è®¾ç½®å­çº¿ç¨‹åå­—</span></span><br><span class="line">[[<span class="built_in">NSThread</span> currentThread] setName:<span class="string">@"MyThread"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¼€å¯runloop</span></span><br><span class="line">[[<span class="built_in">NSRunLoop</span> currentRunLoop] run];</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ›å»ºè‡ªå·±port</span></span><br><span class="line">secondPort = [<span class="built_in">NSPort</span> port];</span><br><span class="line">secondPort.delegate = <span class="keyword">self</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å°†è‡ªå·±çš„portæ·»åŠ åˆ°runloop,é˜²æ­¢runloopæ‰§è¡Œå®Œæ¯•ä¹‹åé€€å‡º,æ¥æ”¶ä¸»çº¿ç¨‹å‘é€è¿‡æ¥çš„portæ¶ˆæ¯</span></span><br><span class="line">[[<span class="built_in">NSRunLoop</span> currentRunLoop] addPort:secondPort forMode:<span class="built_in">NSDefaultRunLoopMode</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®Œæˆå‘ä¸»çº¿ç¨‹å‘é€æ¶ˆæ¯</span></span><br><span class="line">[<span class="keyword">self</span> sendPortMessage];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*   å®Œæˆå‘ä¸»çº¿ç¨‹å‘é€æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">- (<span class="keyword">void</span>)sendPortMessage &#123;</span><br><span class="line"><span class="comment">//å‘é€æ¶ˆæ¯åˆ°ä¸»çº¿ç¨‹</span></span><br><span class="line">[firstPort sendBeforeDate:[<span class="built_in">NSDate</span> date]</span><br><span class="line">msgid:PKMessage</span><br><span class="line">components:<span class="literal">nil</span></span><br><span class="line">from:secondPort</span><br><span class="line">reserved:<span class="number">0</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æç¤º:é€šå¸¸æ¥è¯´, NSPortå¯ä»¥åšçš„äº‹æƒ…é€šè¿‡performSelectorä¹ŸåŒæ ·å¯ä»¥æå®šï¼Œå› æ­¤çº¿ç¨‹é—´é€šä¿¡å®Œå…¨å¯ä»¥é€šè¿‡performSelectoræ¥å®ç°ã€‚<br><strong><end></end></strong></p>
<hr>
<p><strong>ç»“æŸè¯­ï¼šä»¥ä¸Šæ˜¯å¤šçº¿ç¨‹ç›¸å…³çš„çŸ¥è¯†æ€»ç»“ï¼Œæœ¬äººä¹Ÿæ˜¯å°ç™½çº§åˆ«ï¼Œå¦‚æœæœ‰å†™é”™çš„åœ°æ–¹ï¼Œè¿˜è¯·æœ‹å‹ä»¬èƒ½å¤ŸæŒ‡å‡ºæ¥ï¼Œè°¢è°¢ï¼</strong></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/15/iOSå¼€å‘ä¹‹ - å¥½ç©çš„å¯Œæ–‡æœ¬/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="åˆ˜æœ‹å¤">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ä»¥æ¢¦ä¸ºé©¬">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/15/iOSå¼€å‘ä¹‹ - å¥½ç©çš„å¯Œæ–‡æœ¬/" itemprop="url">
                  iOSå¼€å‘ä¹‹ - å¥½ç©çš„å¯Œæ–‡æœ¬
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
                
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-15T12:30:20+08:00">2018-04-15</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>å‘¨æœ«é—²ç€æ²¡äº‹ï¼Œå°±æƒ³ç€ä¸å¦‚æŠŠé‚£äº›å®¹æ˜“é—å¿˜çš„çŸ¥è¯†ç‚¹æ•´ç†ä¸€ä¸‹ï¼Œä¸€æ¥å¯ä»¥è®©æœ‰éœ€è¦çš„æœ‹å‹å°‘èµ°å¼¯è·¯ï¼ŒäºŒæ¥è‡ªå·±ä»¥åå†å¿˜è®°çš„æ—¶å€™ä¹Ÿå¯ä»¥å›å¤´çœ‹çœ‹â€¦â€¦ä½† iOS ä¸­å°å†·æ˜“å¿˜çš„çŸ¥è¯†ç‚¹å®åœ¨å¤ªå¤šäº†ï¼Œä¸çŸ¥é“è¯¥ä»å“ªé‡Œå¼€å§‹æ•´ç†ï¼Œâ€œç™¾æ— èŠèµ–â€é€›äº†ä¸‹æ·˜å®ï¼Œå‘ç°é‡Œé¢å¥½å¤šéƒ½æ˜¯å¯Œæ–‡æœ¬ï¼Œå°±æƒ³ç€ä¸ºä»€ä¹ˆä¸ä»å¯Œæ–‡æœ¬å¼€å§‹å‘¢ï¼Ÿåæ­£é—²ç€ä¹Ÿæ˜¯é—²ç€â€¦â€¦äºæ˜¯å°±æœ‰äº†ä¸‹é¢è¿™äº›ä¸œè¥¿ï¼Œå¸Œæœ›å¯ä»¥å¸®åˆ°çœ‹åˆ°çš„ç›†å‹ä»¬ï¼</p>
<ul>
<li>å…ˆå†™ä¸€ä¸ªå°å¼•å­<blockquote>
<p>åœ¨é¡¹ç›®ä¸­ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬éƒ½éœ€è¦æŠŠæ–‡å­—è®¾ç½®æˆå€¾æ–œã€åŠ ç²—ã€åŠ ä¸‹åˆ’çº¿ã€åŠ åˆ é™¤çº¿ã€åŠ é˜´å½±ç­‰ç­‰çŠ¶æ€ï¼Œå°±æ¯”å¦‚ä¸‹é¢è¿™å¼ å›¾ï¼š<br><img src="http://upload-images.jianshu.io/upload_images/2665449-efaea7b3b4c215d4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä¸æ˜¯æ‰“å¹¿å‘Šå“¦"></p>
</blockquote>
</li>
</ul>
<p>ä½†å¦‚æœæˆ‘ä»¬åªæ˜¯ç®€å•çš„è®¾ç½®å­—ä½“<br><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">self.textView<span class="meta">.text</span> = @<span class="string">"å¾ˆå¥½ç©çš„å¯Œæ–‡æœ¬"</span><span class="comment">;</span></span><br></pre></td></tr></table></figure></p>
<p>æ˜¾ç¤ºå‡ºæ¥å¤§æ¦‚æ˜¯è¿™ä¸ªæ ·å­æ»´ï¼š<br><img src="http://upload-images.jianshu.io/upload_images/2665449-ab7fd6348e681a88.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ™®é€šæ–‡æœ¬"></p>
<p>ä¸ºäº†è®©æ–‡å­—å˜çš„å¥½çœ‹ä¸€äº›ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°è¯•ä¸€ä¸‹å¯Œæ–‡æœ¬ï¼</p>
<ul>
<li>æ”¹å˜å­—ä½“é¢œè‰²</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSMutableAttributedString</span> *string = [[<span class="built_in">NSMutableAttributedString</span> alloc] initWithString:<span class="string">@"å¾ˆå¥½ç©çš„å¯Œæ–‡æœ¬"</span>];</span><br><span class="line"></span><br><span class="line">[string addAttribute:<span class="built_in">NSForegroundColorAttributeName</span> value:[<span class="built_in">UIColor</span> blueColor] range:<span class="built_in">NSMakeRange</span>(<span class="number">1</span>, <span class="number">2</span>)];</span><br><span class="line">[string addAttribute:<span class="built_in">NSForegroundColorAttributeName</span> value:[<span class="built_in">UIColor</span> redColor] range:<span class="built_in">NSMakeRange</span>(<span class="number">3</span>, <span class="number">1</span>)];</span><br><span class="line">[string addAttribute:<span class="built_in">NSForegroundColorAttributeName</span> value:[<span class="built_in">UIColor</span> blueColor] range:<span class="built_in">NSMakeRange</span>(<span class="number">4</span>, <span class="number">3</span>)];</span><br><span class="line"><span class="keyword">self</span>.textView.attributedText = string;</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-9ab05decdf730650.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ”¹å˜å­—ä½“é¢œè‰²"></p>
<ul>
<li>æ”¹å˜å­—ä½“å¤§å°</li>
</ul>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">NSMutableAttributedString *string = [[NSMutableAttributedString alloc] <span class="string">initWithString:</span>@<span class="string">"å¾ˆå¥½ç©çš„å¯Œæ–‡æœ¬"</span>];</span><br><span class="line">[string <span class="string">addAttribute:</span>NSFontAttributeName <span class="string">value:</span>[UIFont <span class="string">systemFontOfSize:</span><span class="number">20</span>] <span class="string">range:</span>NSMakeRange(<span class="number">1</span>, <span class="number">2</span>)];</span><br><span class="line">[string <span class="string">addAttribute:</span>NSFontAttributeName <span class="string">value:</span>[UIFont <span class="string">systemFontOfSize:</span><span class="number">30</span>] <span class="string">range:</span>NSMakeRange(<span class="number">4</span>, <span class="number">3</span>)];</span><br><span class="line">self.textView.attributedText = string;</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-c85ab447f29b3333.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ”¹å˜å­—ä½“å¤§å°"></p>
<ul>
<li>ç»™æ–‡å­—æ·»åŠ èƒŒæ™¯è‰²<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSMutableAttributedString</span> *string = [[<span class="built_in">NSMutableAttributedString</span> alloc] initWithString:<span class="string">@"å¾ˆå¥½ç©çš„å¯Œæ–‡æœ¬"</span>];</span><br><span class="line">[string addAttribute:<span class="built_in">NSBackgroundColorAttributeName</span> value:[<span class="built_in">UIColor</span> cyanColor] range:<span class="built_in">NSMakeRange</span>(<span class="number">1</span>, <span class="number">2</span>)];</span><br><span class="line">[string addAttribute:<span class="built_in">NSBackgroundColorAttributeName</span> value:[<span class="built_in">UIColor</span> yellowColor] range:<span class="built_in">NSMakeRange</span>(<span class="number">4</span>, <span class="number">3</span>)];</span><br><span class="line"><span class="keyword">self</span>.textView.attributedText = string;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-5b3beb42cba98ef1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç»™æ–‡å­—æ·»åŠ èƒŒæ™¯è‰²"></p>
<ul>
<li>ç»™æ–‡å­—è®¾ç½®é—´è·<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSMutableAttributedString</span> *string = [[<span class="built_in">NSMutableAttributedString</span> alloc] initWithString:<span class="string">@"å¾ˆå¥½ç©çš„å¯Œæ–‡æœ¬"</span>];</span><br><span class="line">[string addAttribute:<span class="built_in">NSKernAttributeName</span> value:@(<span class="number">20</span>) range:<span class="built_in">NSMakeRange</span>(<span class="number">0</span>, <span class="number">6</span>)];</span><br><span class="line"><span class="keyword">self</span>.textView.attributedText = string;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-faf5af7f1000d40e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç»™æ–‡å­—è®¾ç½®é—´è·"></p>
<ul>
<li>å­—ä½“å€¾æ–œ<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSMutableAttributedString</span> *string = [[<span class="built_in">NSMutableAttributedString</span> alloc] initWithString:<span class="string">@"å¾ˆå¥½ç©çš„å¯Œæ–‡æœ¬"</span>];</span><br><span class="line">[string addAttribute:<span class="built_in">NSObliquenessAttributeName</span> value:@(<span class="number">0.5</span>) range:<span class="built_in">NSMakeRange</span>(<span class="number">0</span>, <span class="number">7</span>)];</span><br><span class="line"><span class="keyword">self</span>.textView.attributedText = string;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-84144fae563a02fd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å­—ä½“å€¾æ–œ"></p>
<ul>
<li>å­—ä½“åŠ ç²—<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSMutableAttributedString</span> *string = [[<span class="built_in">NSMutableAttributedString</span> alloc] initWithString:<span class="string">@"å¾ˆå¥½ç©çš„å¯Œæ–‡æœ¬"</span>];</span><br><span class="line">[string addAttribute:<span class="built_in">NSExpansionAttributeName</span> value:@(<span class="number">0.5</span>) range:<span class="built_in">NSMakeRange</span>(<span class="number">4</span>, <span class="number">3</span>)];</span><br><span class="line"><span class="keyword">self</span>.textView.attributedText = string;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-1a4c2b74f132931e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å­—ä½“åŠ ç²—"></p>
<ul>
<li>åŠ ä¸‹åˆ’çº¿å¹¶è®¾ç½®ä¸‹åˆ’çº¿é¢œè‰²<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSMutableAttributedString</span> *string = [[<span class="built_in">NSMutableAttributedString</span> alloc] initWithString:<span class="string">@"å¾ˆå¥½ç©çš„å¯Œæ–‡æœ¬"</span>];</span><br><span class="line">[string addAttribute:<span class="built_in">NSUnderlineStyleAttributeName</span> value:@(<span class="number">1</span>) range:<span class="built_in">NSMakeRange</span>(<span class="number">4</span>, <span class="number">3</span>)];</span><br><span class="line">[string addAttribute:<span class="built_in">NSUnderlineColorAttributeName</span> value:[<span class="built_in">UIColor</span> blueColor] range:<span class="built_in">NSMakeRange</span>(<span class="number">4</span>, <span class="number">3</span>)];</span><br><span class="line"><span class="keyword">self</span>.textView.attributedText = string;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-54fdb333b29af0a2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="åŠ ä¸‹åˆ’çº¿å¹¶è®¾ç½®ä¸‹åˆ’çº¿é¢œè‰²"></p>
<ul>
<li>åŠ åˆ é™¤çº¿å¹¶è®¾ç½®åˆ é™¤çº¿é¢œè‰²<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSMutableAttributedString</span> *string = [[<span class="built_in">NSMutableAttributedString</span> alloc] initWithString:<span class="string">@"åŸä»·666ğŸ’°ï¼Œç°ä»·åªè¦66ğŸ’°ï¼"</span>];</span><br><span class="line">[string addAttribute:<span class="built_in">NSStrikethroughStyleAttributeName</span> value:@(<span class="number">1</span>) range:<span class="built_in">NSMakeRange</span>(<span class="number">2</span>, <span class="number">3</span>)];</span><br><span class="line">[string addAttribute:<span class="built_in">NSStrikethroughColorAttributeName</span> value:[<span class="built_in">UIColor</span> blueColor] range:<span class="built_in">NSMakeRange</span>(<span class="number">2</span>, <span class="number">3</span>)];</span><br><span class="line"><span class="keyword">self</span>.textView.attributedText = string;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-7660641928dfc070.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="åŠ åˆ é™¤çº¿å¹¶è®¾ç½®åˆ é™¤çº¿é¢œè‰²"></p>
<ul>
<li>è®¾ç½®æ–‡å­—æ–¹å‘<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">NSMutableAttributedString *string = [[NSMutableAttributedString alloc] <span class="string">initWithString:</span>@<span class="string">"å¾ˆå¥½ç©çš„å¯Œæ–‡æœ¬"</span>];</span><br><span class="line">[string <span class="string">addAttribute:</span>NSVerticalGlyphFormAttributeName <span class="string">value:</span>@(<span class="number">1</span>) <span class="string">range:</span>NSMakeRange(<span class="number">0</span>, <span class="number">7</span>)];</span><br><span class="line">[string <span class="string">addAttribute:</span>NSWritingDirectionAttributeName <span class="string">value:</span>@[@(<span class="number">2</span>),@(<span class="number">3</span>)] <span class="string">range:</span>NSMakeRange(<span class="number">0</span>, <span class="number">7</span>)];</span><br><span class="line">self.textView.attributedText = string;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-3e892743a9f112f5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è®¾ç½®æ–‡å­—æ–¹å‘"></p>
<ul>
<li>ç»™æ–‡å­—æ·»åŠ é˜´å½±<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">NSMutableAttributedString *string = [[NSMutableAttributedString alloc] initWithString:@<span class="string">"å¾ˆå¥½ç©çš„å¯Œæ–‡æœ¬"</span>]<span class="comment">;</span></span><br><span class="line">NSShadow *<span class="keyword">shadow </span>= [[NSShadow alloc]init]<span class="comment">;</span></span><br><span class="line"><span class="keyword">shadow.shadowOffset </span>= CGSizeMake(<span class="number">5</span>, <span class="number">5</span>)<span class="comment">;</span></span><br><span class="line"><span class="keyword">shadow.shadowColor </span>= [UIColor <span class="keyword">blueColor];</span></span><br><span class="line"><span class="keyword">shadow.shadowBlurRadius </span>= <span class="number">1</span><span class="comment">;</span></span><br><span class="line">[string <span class="keyword">addAttribute:NSShadowAttributeName </span>value:<span class="keyword">shadow </span>range:NSMakeRange(<span class="number">4</span>, <span class="number">3</span>)]<span class="comment">;</span></span><br><span class="line">self.textView.attributedText = string<span class="comment">;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-8f882d994febb18b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç»™æ–‡å­—æ·»åŠ é˜´å½±"></p>
<ul>
<li>å›¾æ–‡æ··æ’</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSMutableAttributedString</span> *string = [[<span class="built_in">NSMutableAttributedString</span> alloc] initWithString:<span class="string">@"å¾ˆå¥½ç©çš„å¯Œæ–‡æœ¬"</span>];</span><br><span class="line"><span class="comment">// åˆ›å»ºå›¾ç‰‡å›¾ç‰‡é™„ä»¶</span></span><br><span class="line"><span class="built_in">NSTextAttachment</span> *attach = [[<span class="built_in">NSTextAttachment</span> alloc] init];</span><br><span class="line">attach.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"1.jpg"</span>];</span><br><span class="line">attach.bounds = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">20</span>, <span class="number">20</span>);</span><br><span class="line"><span class="built_in">NSAttributedString</span> *attachString = [<span class="built_in">NSAttributedString</span> attributedStringWithAttachment:attach];</span><br><span class="line">[string appendAttributedString:attachString];</span><br><span class="line"><span class="keyword">self</span>.textView.attributedText = string;</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-27adc1a27e0637ee.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å›¾æ–‡æ··æ’"></p>
<ul>
<li>æ–‡å­—åç§»<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">NSMutableAttributedString *string = [[NSMutableAttributedString alloc] <span class="string">initWithString:</span>@<span class="string">"å¾ˆå¥½ç©çš„å¯Œæ–‡æœ¬"</span>];</span><br><span class="line">[string <span class="string">addAttribute:</span>NSBaselineOffsetAttributeName <span class="string">value:</span>@(<span class="number">10</span>) <span class="string">range:</span>NSMakeRange(<span class="number">0</span>, <span class="number">1</span>)];</span><br><span class="line">[string <span class="string">addAttribute:</span>NSBaselineOffsetAttributeName <span class="string">value:</span>@(<span class="number">20</span>) <span class="string">range:</span>NSMakeRange(<span class="number">1</span>, <span class="number">1</span>)];</span><br><span class="line">[string <span class="string">addAttribute:</span>NSBaselineOffsetAttributeName <span class="string">value:</span>@(<span class="number">30</span>) <span class="string">range:</span>NSMakeRange(<span class="number">2</span>, <span class="number">1</span>)];</span><br><span class="line">[string <span class="string">addAttribute:</span>NSBaselineOffsetAttributeName <span class="string">value:</span>@(<span class="number">40</span>) <span class="string">range:</span>NSMakeRange(<span class="number">3</span>, <span class="number">1</span>)];</span><br><span class="line">[string <span class="string">addAttribute:</span>NSBaselineOffsetAttributeName <span class="string">value:</span>@(<span class="number">50</span>) <span class="string">range:</span>NSMakeRange(<span class="number">4</span>, <span class="number">3</span>)];</span><br><span class="line">self.textView.attributedText = string;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-4e0d6a0908bfb1e7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ–‡å­—åç§»"></p>
<p>ä»¥ä¸Šæ˜¯å¯¹ iOS ä¸­å¯Œæ–‡æœ¬ç›¸å…³çš„çŸ¥è¯†åšçš„ä¸€äº›æ•´ç†ï¼Œå¦‚æœæœ‰ç²—å¿ƒå†™é”™çš„åœ°æ–¹ï¼Œè¿˜è¯·æœ‹å‹ä»¬æŒ‡å‡ºï¼å¦‚æœè¿˜æœ‰é—æ¼çš„åœ°æ–¹ï¼Œä»¥åç¢°åˆ°äº†å†æ¥è¡¥å……ã€‚ã€‚ã€‚</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/15/iOSå¼€å‘ä¹‹ - å¾®ä¿¡æ”¯ä»˜/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="åˆ˜æœ‹å¤">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ä»¥æ¢¦ä¸ºé©¬">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/15/iOSå¼€å‘ä¹‹ - å¾®ä¿¡æ”¯ä»˜/" itemprop="url">
                  iOSå¼€å‘ä¹‹ - å¾®ä¿¡æ”¯ä»˜
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
                
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-15T12:30:20+08:00">2018-04-15</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="http://upload-images.jianshu.io/upload_images/2665449-0d0a74ab4c5830ac.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="iOSå¼€å‘ä¹‹ - å¾®ä¿¡æ”¯ä»˜"></p>
<blockquote>
<p>ä½œä¸º iOS å¼€å‘è€…ï¼Œæ”¯ä»˜æ— ç–‘æ˜¯å¾ˆé‡è¦çš„ï¼Œç‰¹åˆ«æ˜¯è¿™ä¸¤å¹´å‡ ä¹åˆ°å¤„éƒ½æ˜¯å¾®ä¿¡æ”¯ä»˜ã€æ”¯ä»˜å®æ”¯ä»˜ã€‚ç›¸æ¯”æ”¯ä»˜å®æ”¯ä»˜ï¼Œè§‰å¾—å¾®ä¿¡æ”¯ä»˜è¿˜ç®—ç®€å•ï¼Œä½†è¿˜æ˜¯å»ºè®®é¢„å…ˆçœ‹ä¸‹<a href="https://pay.weixin.qq.com/wiki/doc/api/app/app.php?chapter=9_1" target="_blank" rel="noopener">æ–‡æ¡£</a>ã€‚å¼€å§‹è¯´æ–‡ç« çš„å†…å®¹å§ï¼Œè¿™ç¯‡æ–‡ç« ä¸»è¦åˆ†ä¸ºå››ä¸ªéƒ¨åˆ†ï¼šåˆ›å»ºåº”ç”¨ã€äº†è§£æ”¯ä»˜çš„æµç¨‹ã€é›†æˆå¾®ä¿¡SDKï¼Œæœ€åæ˜¯å®ç°æ”¯ä»˜çš„demoã€‚</p>
</blockquote>
<ul>
<li><strong>ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºåº”ç”¨</strong></li>
</ul>
<p><em>é€šå¸¸æ¥è¯´æ³¨å†ŒAPPè¿™æ ·çš„äº‹æƒ…æ˜¯éƒ¨é—¨ç»ç†åšçš„ï¼Œæ‰€ä»¥è¿™ä¸€æ­¥ä¹Ÿå¯ä»¥å¿½ç•¥ï½ï½ï½</em></p>
<p>åœ¨ <a href="https://open.weixin.qq.com/cgi-bin/index?t=home/index&amp;lang=zh_CN&amp;token=0ebf4697e5671e8567a5c5f4682a4c6cb0fcaa92" target="_blank" rel="noopener">å¾®ä¿¡å¼€æ”¾å¹³å°</a> çš„ç®¡ç†ä¸­å¿ƒ <a href="https://open.weixin.qq.com/cgi-bin/frame?t=home/app_tmpl&amp;lang=zh_CN" target="_blank" rel="noopener">åˆ›å»ºä¸€ä¸ªåº”ç”¨ã€‚</a>æ­¤åº”ç”¨å®˜æ–¹ç§°ä¸ƒæ—¥å†…å®¡æ ¸é€šè¿‡ï¼Œä¸€èˆ¬éƒ½æ˜¯ä¸‰å››å¤©ï¼è€Œå…³äºå¡«å†™ç»è¥ä¿¡æ¯ã€å¡«å†™å•†æˆ·ä¿¡æ¯ã€å¡«å†™å¯¹å…¬å¸å·ä¿¡æ¯åœ¨è¿™é‡Œå°±å¿½ç•¥ä¸å†™äº†ã€‚æœ‰å…´è¶£çš„æœ‹å‹å¯ä»¥äº†è§£ä¸‹<a href="http://494075592.blog.51cto.com/10682677/1701260" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a>ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-723d6f42f6b41ba2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="åˆ›å»ºåº”ç”¨"></p>
<ul>
<li><strong>ç¬¬äºŒæ­¥ï¼šäº†è§£æ”¯ä»˜çš„æµç¨‹</strong></li>
</ul>
<p>å¦‚æœåšè¿‡å…¶å®ƒæ”¯ä»˜ï¼Œå°±ä¼šå‘ç°è¿™äº›æµç¨‹å…¶å®éƒ½å·®ä¸å¤šï¼Œå°±åƒæˆ‘ä»¬å¹³æ—¶ç”¨æ‰‹æœºæ”¯ä»˜ä¹°ä¸œè¥¿ä¸€æ ·ã€‚ä¸‹è¾¹çš„æµç¨‹ä¸¤åˆ†é’Ÿå¤§æ¦‚å°±èƒ½è¯»å®Œï¼Œå¾ˆå®¹æ˜“ç†è§£ï¼</p>
<p>1&gt; ç”¨æˆ·ä½¿ç”¨ APP å®¢æˆ·ç«¯ï¼Œé€‰æ‹©å•†å“ä¸‹å•ã€‚<br>2&gt; APP å®¢æˆ·ç«¯å°†ç”¨æˆ·çš„å•†å“æ•°æ®ä¼ ç»™å•†æˆ·æœåŠ¡å™¨ï¼Œè¯·æ±‚ç”Ÿæˆæ”¯ä»˜è®¢å•ã€‚<br>3&gt; å•†æˆ·åå°è°ƒç”¨ç»Ÿä¸€ä¸‹å• API å‘å¾®ä¿¡çš„æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œå¾®ä¿¡æœåŠ¡å™¨ç”Ÿæˆé¢„ä»˜å•ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ª prepay_id è¿”å›ç»™å•†æˆ·åå°ã€‚<br>4&gt; å•†æˆ·åå°å°†è¿™ä¸ª prepay_id è¿”å›ç»™å•†æˆ·å®¢æˆ·ç«¯ã€‚<br>5&gt; ç”¨æˆ·ç‚¹å‡»ç¡®è®¤æ”¯ä»˜ï¼Œè¿™æ—¶å€™å•†æˆ·å®¢æˆ·ç«¯è°ƒç”¨ SDK æ‰“å¼€å¾®ä¿¡å®¢æˆ·ç«¯ï¼Œè¿›è¡Œå¾®ä¿¡æ”¯ä»˜ã€‚<br>6&gt; å¾®ä¿¡å®¢æˆ·ç«¯å‘å¾®ä¿¡æœåŠ¡å™¨å‘èµ·æ”¯ä»˜è¯·æ±‚å¹¶è¿”å›æ”¯ä»˜ç»“æœï¼ˆä»–ä»¬ä¹‹é—´äº¤äº’ç”¨çš„å°±æ˜¯prepay_idè¿™ä¸ªå‚æ•°ï¼Œå¾®ä¿¡çš„æœåŠ¡å™¨è¦éªŒè¯å¾®ä¿¡å®¢æˆ·ç«¯ä¼ è¿‡å»çš„å‚æ•°æ˜¯å¦è·Ÿç¬¬ä¸‰æ­¥ä¸­ç”Ÿæˆçš„é‚£ä¸ªidä¸€è‡´ï¼‰ã€‚<br>7&gt; ç”¨æˆ·è¾“å…¥æ”¯ä»˜å¯†ç åï¼Œå¾®ä¿¡å®¢æˆ·ç«¯æäº¤æ”¯ä»˜æˆæƒï¼Œè·Ÿå¾®ä¿¡æœåŠ¡å™¨äº¤äº’ï¼Œå®Œæˆæ”¯ä»˜<br>8&gt; å¾®ä¿¡æœåŠ¡å™¨ç»™å¾®ä¿¡å®¢æˆ·ç«¯å‘é€æ”¯ä»˜ç»“æœæç¤ºï¼Œå¹¶å¼‚æ­¥ç»™å•†æˆ·æœåŠ¡å™¨å‘é€æ”¯ä»˜ç»“æœé€šçŸ¥ã€‚<br>9&gt; å•†æˆ·å®¢æˆ·ç«¯é€šè¿‡æ”¯ä»˜ç»“æœå›è°ƒæ¥å£æŸ¥è¯¢æ”¯ä»˜ç»“æœï¼Œå¹¶å‘åå°æ£€æŸ¥æ”¯ä»˜ç»“æœæ˜¯å¦æ­£ç¡®ï¼Œåå°è¿”å›æ”¯ä»˜ç»“æœã€‚<br>10&gt; å•†æˆ·å®¢æˆ·ç«¯æ˜¾ç¤ºæ”¯ä»˜ç»“æœï¼Œå®Œæˆè®¢å•ï¼Œå‘è´§ã€‚</p>
<ul>
<li><strong>ç¬¬ä¸‰æ­¥ï¼šé›†æˆSDK</strong></li>
</ul>
<p>å…¶å®ä¸¥æ ¼æ¥è¯´ï¼Œè¿™ä¸€æ­¥æ‰æ˜¯å¾®ä¿¡æ”¯ä»˜çš„çœŸæ­£å¼€å§‹ã€‚é¦–å…ˆæˆ‘ä»¬åº”è¯¥ä¸‹è½½ <a href="https://open.weixin.qq.com/cgi-bin/showdocument?action=dir_list&amp;t=resource/res_list&amp;verify=1&amp;id=open1419319164&amp;lang=zh_CN" target="_blank" rel="noopener">å¾®ä¿¡SDK</a>ï¼Œå¦‚æœ‰éœ€è¦ï¼Œè¿˜å¯æŠŠ<a href="https://pay.weixin.qq.com/wiki/doc/api/app/app.php?chapter=11_1_" target="_blank" rel="noopener">ã€å¾®ä¿¡æ”¯ä»˜ã€‘APPæ”¯ä»˜ç¤ºä¾‹</a>ä¸‹è½½ä¸‹æ¥çœ‹çœ‹ã€‚ä¸‹é¢æ˜¯é›†æˆ SDK çš„å…·ä½“æ­¥éª¤ï¼š</p>
<p>1.æŠŠä¸‹è½½å¥½çš„ SDK å¯¼å…¥å·¥ç¨‹ï¼ˆå¦‚ä¸‹å›¾ï¼‰ï¼ˆæˆ‘ä¸‹çš„æ˜¯OpenSDK1.7.4ç‰ˆæœ¬ï¼‰</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-a0dfa21d98e8d045.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æŠŠä¸‹è½½å¥½çš„ SDK å¯¼å…¥å·¥ç¨‹"></p>
<p>2.å¯¼å…¥å¾®ä¿¡æ”¯ä»˜SDKä¾èµ–åº“ï¼ˆå¦‚ä¸‹å›¾ï¼‰</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-f4bd0524a4a2d18f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å¯¼å…¥å¾®ä¿¡æ”¯ä»˜SDKä¾èµ–åº“"></p>
<p>3.è®¾ç½®URL Scheme<br>åœ¨æ³¨å†Œå¾®ä¿¡å¹³å°APPçš„æ—¶å€™ï¼Œä¼šç»™ä¸€ä¸ªå”¯ä¸€è¯†åˆ«æ ‡è¯†ç¬¦ï¼ˆAPPIDï¼‰,éœ€è¦å¡«å†™åœ¨å·¥ç¨‹ä¸­ã€‚ï¼ˆå¦‚ä¸‹å›¾ï¼‰</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-8c7b570a18293fc3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è®¾ç½®URL Scheme"></p>
<hr>
<p><em>é…ç½®å¥½ä¸Šè¿°å‚æ•°åå°±å¯ä»¥å†™ä»£ç äº†ï½ï½ï½</em></p>
<ul>
<li><strong>ç¬¬å››éƒ¨ï¼šä»£ç </strong></li>
</ul>
<p>ä»£ç åˆ†ä¸ºä»¥ä¸‹æ­¥éª¤ï¼š</p>
<p>1.åœ¨ Appdelegate ä¸­æ³¨å†Œå¾®ä¿¡ APPID<br>è¿™æ˜¯é¦–å…ˆè¦åšçš„äº‹æƒ…ã€‚<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (BOOL)<span class="string">application:</span>(UIApplication *)application <span class="string">didFinishLaunchingWithOptions:</span>(NSDictionary *)launchOptions &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘å¾®ä¿¡ç»ˆç«¯æ³¨å†ŒID</span></span><br><span class="line">[WXApi <span class="string">registerApp:</span>@<span class="string">"wx0f8d5e0eadd2d4b7"</span> <span class="string">withDescription:</span>@<span class="string">"demo test"</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> YES;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>2.è·å–å¾®ä¿¡æ”¯ä»˜æ‰€å¿…è¦çš„å‚æ•°<br>æ¥ç€ï¼Œåœ¨å¾®ä¿¡æ”¯ä»˜çš„.mæ–‡ä»¶ä¸­è·å–å¾®ä¿¡æ”¯ä»˜æ‰€å¿…è¦çš„å‚æ•°ã€‚ä¸ºäº†æé«˜æ•°æ®å®‰å…¨æ€§ï¼Œä¸‹å•ã€ç­¾åç­‰æ“ä½œä¸€èˆ¬éƒ½æ˜¯åœ¨åå°å®Œæˆçš„ï¼Œå› æ­¤ä»¥ä¸‹è¿™äº›å‚æ•°åå°ä¼šç»™æˆ‘ä»¬ã€‚æˆ‘ä»¬ä¸»è¦å¾—çŸ¥é“è¿™äº›å‚æ•°å¦‚ä½•è®¾ç½®ï¼š<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‘èµ·å¾®ä¿¡æ”¯ä»˜ï¼Œè®¾ç½®å‚æ•°</span></span><br><span class="line">PayReq *request   = [[PayReq alloc] init];  <span class="comment">// åˆ›å»ºæ”¯ä»˜å¯¹è±¡</span></span><br><span class="line">request.openID = <span class="string">@""</span>; <span class="comment">// ç”±ç”¨æˆ·å¾®ä¿¡å·å’ŒAppIDç»„æˆçš„å”¯ä¸€æ ‡è¯†</span></span><br><span class="line">request.partnerId = <span class="string">@""</span>; <span class="comment">// å•†å®¶ID</span></span><br><span class="line">request.prepayId  = <span class="string">@""</span>; <span class="comment">// é¢„æ”¯ä»˜è®¢å•ID</span></span><br><span class="line">request.package   = <span class="string">@"Sign=WXPay"</span>; <span class="comment">// æ•°æ®å’Œç­¾å</span></span><br><span class="line">request.nonceStr  = <span class="string">@""</span>; <span class="comment">// éšæœºç¼–ç </span></span><br><span class="line"><span class="built_in">NSDate</span> *date = [<span class="built_in">NSDate</span> date];</span><br><span class="line"><span class="built_in">NSString</span> * timeSp = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%ld"</span>, (<span class="keyword">long</span>)[date timeIntervalSince1970]];</span><br><span class="line"><span class="built_in">UInt32</span> timeStamp = [timeSp intValue];</span><br><span class="line">request.timeStamp = timeStamp; <span class="comment">// æ—¶é—´æˆ³</span></span><br><span class="line">request.sign = <span class="string">@""</span>; <span class="comment">// ç­¾åï¼Œç­¾åä¸€èˆ¬éƒ½ä¼šåŠ å¯†</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å‘é€è¯·æ±‚åˆ°å¾®ä¿¡ï¼Œç­‰å¾…å¾®ä¿¡è¿”å› onResp</span></span><br><span class="line">[WXApi sendReq:request];</span><br></pre></td></tr></table></figure></p>
<p>3.å¾®ä¿¡æ”¯ä»˜å›è°ƒ<br>æœ€åè¦åœ¨Appdelegate.mæ–‡ä»¶ä¸­æ·»åŠ å¾®ä¿¡æ”¯ä»˜ç»“æœ onResp å›è°ƒæ–¹æ³•<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ¤æ–­å‘èµ·çš„è¯·æ±‚æ˜¯å¦ä¸ºå¾®ä¿¡æ”¯ä»˜ï¼Œå¦‚æœæ˜¯å°±å›è°ƒ</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)application:(<span class="built_in">UIApplication</span> *)app openURL:(<span class="built_in">NSURL</span> *)url options:(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *,<span class="keyword">id</span>&gt; *)options &#123;</span><br><span class="line"><span class="keyword">return</span> [WXApi handleOpenURL:url delegate:<span class="keyword">self</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - WXApiDelegate</span></span><br><span class="line"><span class="comment">// å¾®ä¿¡æ”¯ä»˜ç»“æœå›è°ƒæ–¹æ³•</span></span><br><span class="line">- (<span class="keyword">void</span>)onResp:(BaseResp *)resp &#123;</span><br><span class="line"><span class="built_in">NSString</span> *payResoult = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%d"</span>, resp.errCode];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>([resp isKindOfClass:[PayResp <span class="keyword">class</span>]])&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">WXSuccess           = 0,    æˆåŠŸ</span></span><br><span class="line"><span class="comment">WXErrCodeCommon     = -1,    æ™®é€šé”™è¯¯ç±»å‹</span></span><br><span class="line"><span class="comment">WXErrCodeUserCancel = -2,    ç”¨æˆ·ç‚¹å‡»å–æ¶ˆå¹¶è¿”å›</span></span><br><span class="line"><span class="comment">WXErrCodeSentFail   = -3,    å‘é€å¤±è´¥</span></span><br><span class="line"><span class="comment">WXErrCodeAuthDeny   = -4,    æˆæƒå¤±è´¥</span></span><br><span class="line"><span class="comment">WXErrCodeUnsupport  = -5,    å¾®ä¿¡ä¸æ”¯æŒ</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">//æ”¯ä»˜è¿”å›ç»“æœï¼Œå®é™…æ”¯ä»˜ç»“æœéœ€è¦å»å¾®ä¿¡æœåŠ¡å™¨ç«¯æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">switch</span> (resp.errCode) &#123;</span><br><span class="line"><span class="keyword">case</span> WXSuccess:</span><br><span class="line">payResoult = <span class="string">@"æ”¯ä»˜æˆåŠŸ"</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> WXErrCodeCommon:</span><br><span class="line">payResoult = <span class="string">@"æ”¯ä»˜å¤±è´¥"</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> WXErrCodeUserCancel:</span><br><span class="line">payResoult = <span class="string">@"ç”¨æˆ·ç‚¹å‡»å–æ¶ˆå¹¶è¿”å›"</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="comment">// é”™è¯¯ç  ä»¥åŠ é”™è¯¯æç¤ºå­—ç¬¦ä¸²</span></span><br><span class="line">payResoult = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"æ”¯ä»˜ç»“æœï¼šå¤±è´¥ï¼retcode = %d, retstr = %@"</span>, resp.errCode,resp.errStr];</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr>
<p>ç»“æŸè¯­ï¼šåœ¨å¼€å‘ä¸­ï¼Œå¾®ä¿¡æ”¯ä»˜å¸¸å¸¸ä¸å…¶å®ƒæŠ€æœ¯é…åˆä½¿ç”¨ï¼Œæ¯”å¦‚MD5åŠ å¯†ï¼ŒAFNç­‰ç­‰ã€‚æœ‰ç©ºé—²çš„è¯ä¼šä¸€ä¸€æ•´ç†å‡ºæ¥ä¸å¤§å®¶åˆ†äº«ï¼å¦å¤–æ–‡ç« å†™çš„å¦‚æœæœ‰ä»€ä¹ˆé”™è¯¯ï¼Œè¿˜è¯·å¤§å®¶æŒ‡å‡ºæ¥ï¼Œè°¢è°¢å¤§å®¶ï¼</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">åˆ˜æœ‹å¤</p>
              <p class="site-description motion-element" itemprop="description">iOS ä¿®ç‚¼ä¸­...</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives">
                
                    <span class="site-state-item-count">10</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              

              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">åˆ˜æœ‹å¤</span>

  

  
</div>




  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Muse</a> v6.1.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.1.0"></script>



  



	





  





  










  





  

  

  

  

  
  

  

  

  

  

</body>
</html>
