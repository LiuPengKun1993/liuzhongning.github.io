<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.1.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.1.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.1.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.1.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.1.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.1.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="iOS 修炼中...">
<meta property="og:type" content="website">
<meta property="og:title" content="以梦为马">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="以梦为马">
<meta property="og:description" content="iOS 修炼中...">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="以梦为马">
<meta name="twitter:description" content="iOS 修炼中...">






  <link rel="canonical" href="http://yoursite.com/page/2/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>以梦为马</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">以梦为马</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">谨以此纪念岁月</p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>




<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-主页">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />主页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-归档">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/15/iOS开发 - 圆形验证码(或密码)输入框的封装/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="刘朋坤">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="以梦为马">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/15/iOS开发 - 圆形验证码(或密码)输入框的封装/" itemprop="url">
                  iOS开发 - 圆形验证码(或密码)输入框的封装
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
                
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-15T12:30:20+08:00">2018-04-15</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>项目中用到了圆形验证码输入框，输入框之间要求有一定的距离，UI图如下：</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-7b41dd80189fc084.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="UI图"></p>
<ul>
<li>上面的UI图主要有以下几个要求：</li>
<li>输入框为圆形</li>
<li>输入框之间有适当距离</li>
<li>输入框颜色在输入文本时有变化</li>
</ul>
<p>刚开始想着用固定的几个 UITextField 实现，但转念一想，用 UITextField 实现有点麻烦（输入框多的话，它们之间的响应事件不太容易控制，需要来回变换），于是开始想其它办法，最后用了以下的思路：</p>
<ul>
<li>创建一个 UITextField，用  UILabel 显示 UITextField 上输入的数字，需要监听文本的输入，同时对 UILabel 进行一些操作，再用 block 将输入的文本传出来。</li>
</ul>
<h5 id="封装的圆形输入框主要实现了以下功能：输入框的数量、距离、颜色、大小等都可以自行设定，用起来也很方便，只需以下几行代码即可："><a href="#封装的圆形输入框主要实现了以下功能：输入框的数量、距离、颜色、大小等都可以自行设定，用起来也很方便，只需以下几行代码即可：" class="headerlink" title="封装的圆形输入框主要实现了以下功能：输入框的数量、距离、颜色、大小等都可以自行设定，用起来也很方便，只需以下几行代码即可："></a>封装的圆形输入框主要实现了以下功能：输入框的数量、距离、颜色、大小等都可以自行设定，用起来也很方便，只需以下几行代码即可：</h5><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">NNValidationCodeView *view = [[NNValidationCodeView alloc] initWithFrame:CGRectMake(<span class="number">80</span>, <span class="number">100</span>, <span class="number">300</span>, <span class="number">45</span>) <span class="keyword">andLabelCount:4 </span><span class="keyword">andLabelDistance:10];</span></span><br><span class="line"><span class="keyword">[self.view </span><span class="keyword">addSubview:view];</span></span><br><span class="line"><span class="keyword">view.changedColor </span>= [UIColor yellowColor]<span class="comment">;</span></span><br><span class="line">view.codeBlock = ^(NSString *codeString) &#123;</span><br><span class="line">NSLog(@<span class="string">"验证码:%@"</span>, codeString)<span class="comment">;</span></span><br><span class="line">&#125;<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>这是 demo 的效果图：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-a1ab2114dbc942f9.gif?imageMogr2/auto-orient/strip" alt="效果图1"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-7d2566ca5c78135b.gif?imageMogr2/auto-orient/strip" alt="效果图2"></p>
<p>由于代码很容易看懂，另外代码中也写了注释，因此这里不再对项目做过多的陈述，这是 <a href="https://github.com/liuzhongning/NNValidationCodeView" target="_blank" rel="noopener">demo地址</a>，需要的话可以拿去借鉴，<strong>有什么不足之处希望能留下宝贵意见或建议！</strong></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/15/iOS开发 - 极光推送中生产证书和开发证书的生成/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="刘朋坤">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="以梦为马">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/15/iOS开发 - 极光推送中生产证书和开发证书的生成/" itemprop="url">
                  iOS开发 - 极光推送中生产证书和开发证书的生成
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
                
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-15T12:30:20+08:00">2018-04-15</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>项目中用到了 <a href="https://www.jiguang.cn/push?source=bdjj#B_vid=1350498826687775136" target="_blank" rel="noopener">极光推送</a>，这里记录下极光推送中生产证书和开发证书的生成过程。</p>
</blockquote>
<p>推送设置中需要配置生产证书以及开发证书~~<br><img src="http://upload-images.jianshu.io/upload_images/2665449-f6e129813e38c4b6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="极光推送中生产证书和开发证书的生成"></p>
<h3 id="1-开发证书生成步骤"><a href="#1-开发证书生成步骤" class="headerlink" title="1.开发证书生成步骤"></a>1.开发证书生成步骤</h3><ul>
<li>登录 <a href="https://developer.apple.com/account/#/overview/82W2K9C6T2" target="_blank" rel="noopener">苹果开发者中心</a>，点击 <strong>Certificates, IDs &amp; Profiles</strong></li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-b6de1efe8a9bc32d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="开发证书生成步骤1"></p>
<ul>
<li>点击 <strong>Development</strong>，并选择 <strong>Apple Push Notification service SSL (Sandbox)</strong>，接着点击下边的 <strong>Continue</strong> 按钮</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-140d40d381467beb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="开发证书生成步骤2"></p>
<ul>
<li>来到 <strong>App ID</strong> 这个界面之后，继续点击下边的 <strong>Continue</strong> 按钮</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-69cf10ec6fcb88c3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="开发证书生成步骤3"></p>
<ul>
<li>这里的说明是让我们生成一个 <strong>CSR 文件</strong>，继续点击 <strong>Continue</strong> 按钮</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-c02bbf6bb568e09f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="开发证书生成步骤4"></p>
<ul>
<li><p>这个界面需要上传 CSR 文件，上传 CSR 证书之后继续点击 <strong>Continue</strong> 按钮（ <strong>CSR 文件</strong> 生成很简单，后面会提一下）<br><img src="http://upload-images.jianshu.io/upload_images/2665449-1bc222f798021465.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="开发证书生成步骤5"></p>
</li>
<li><p>点击 <strong>Continue</strong> 按钮之后，就会出现下面这个界面，直接点击 <strong>Download</strong> ，然后双击下载的证书，安装到钥匙串里。<br><img src="http://upload-images.jianshu.io/upload_images/2665449-0bb19655f5e19139.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="开发证书生成步骤6"></p>
</li>
</ul>
<h5 id="1-1-CSR-文件生成步骤"><a href="#1-1-CSR-文件生成步骤" class="headerlink" title="1.1 CSR 文件生成步骤"></a>1.1 CSR 文件生成步骤</h5><ul>
<li>首先打开电脑上的钥匙串，点击 <strong>从证书颁发机构请求证书</strong>，如下图所示：</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-153b4345af65eb1a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="生成 CSR 文件步骤1"></p>
<ul>
<li>填写用户邮箱地址以及 CA 电子邮件地址，将请求改为“存储到磁盘”，点击 <strong>继续</strong>，接着点击 <strong>存储</strong> 即可。<br><img src="http://upload-images.jianshu.io/upload_images/2665449-b6141e6c50613449.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="生成 CSR 文件步骤2"></li>
</ul>
<h3 id="2-生产证书生成步骤"><a href="#2-生产证书生成步骤" class="headerlink" title="2.生产证书生成步骤"></a>2.生产证书生成步骤</h3><ul>
<li>生产证书的生成和开发证书的生成类似，先选择 <strong>Production</strong> ，点击“加号”后选择 <strong>Production</strong> 中的 <strong> Apple Push Notification service SSL (Sandbox &amp; Production)</strong> 这一栏，接着点击 <strong>Continue</strong> 按钮</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-a8554f4b0b579a2a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="生产证书生成步骤1"></p>
<ul>
<li>来到 <strong>App ID</strong> 这个界面之后，继续点击下边的 <strong>Continue</strong> 按钮</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-721072f3f4f498bb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="生产证书生成步骤2"></p>
<ul>
<li>然后依然会让上传一个 <strong>CSR 文件</strong>， 不再累述。生产证书生成后，下载安装到钥匙串中即可。</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-7dda501137bad5df.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="生产证书生成步骤3"></p>
<h3 id="3-导出-p12-文件"><a href="#3-导出-p12-文件" class="headerlink" title="3. 导出 p12 文件"></a>3. 导出 <strong>p12</strong> 文件</h3><ul>
<li><p>选中刚刚安装的生产证书和开发证书，然后导出~<br><img src="http://upload-images.jianshu.io/upload_images/2665449-7b1b25481edad0e1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="导出 **p12** 文件步骤1"></p>
</li>
<li><p>文件格式为 <strong>个人信息交换(.p12)</strong><br><img src="http://upload-images.jianshu.io/upload_images/2665449-cf0e2374a4886415.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="导出 **p12** 文件步骤2"></p>
</li>
<li><p>接着设置下密码<br><img src="http://upload-images.jianshu.io/upload_images/2665449-8c590c020fed9efe.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="导出 **p12** 文件步骤3"></p>
</li>
</ul>
<h5 id="最后将两个p12文件上传到极光推送上，就OK了！"><a href="#最后将两个p12文件上传到极光推送上，就OK了！" class="headerlink" title="最后将两个p12文件上传到极光推送上，就OK了！"></a>最后将两个p12文件上传到极光推送上，就OK了！</h5><p><img src="http://upload-images.jianshu.io/upload_images/2665449-d8d78f18c48bcf0c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="极光推送中生产证书和开发证书的生成"></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/15/iOS开发 - 链式编程思想/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="刘朋坤">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="以梦为马">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/15/iOS开发 - 链式编程思想/" itemprop="url">
                  iOS开发 - 链式编程思想
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
                
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-15T12:30:20+08:00">2018-04-15</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>因为有 Masory 以及 Snapkit 这些知名开源库的存在，相信很多 iOS 开发者对链式编程都不会太陌生，先来看下面这句代码：</p>
</blockquote>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="name">imageView</span> mas_makeConstraints:^(<span class="name">MASConstraintMaker</span> *make) &#123;</span><br><span class="line">make.top.bottom.left.right.equalTo(<span class="name">self.view</span>).insets(<span class="name">UIEdgeInsetsMake</span>(<span class="name">250</span>, <span class="number">100</span>, <span class="number">250</span>, <span class="number">100</span>))<span class="comment">;</span></span><br><span class="line">&#125;]<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>这句代码就属于链式编程，而且 Masonry 框架本身也是通过链式语法对 NSLayoutConstraints 进行的封装。对 Masonry 感兴趣的童鞋可以读读这篇文章 <a href="http://www.jianshu.com/p/2fe9568fd3f5" target="_blank" rel="noopener">iOS开发之源码解析 - Masonry</a>。</p>
<h4 id="链式编程思想："><a href="#链式编程思想：" class="headerlink" title="链式编程思想："></a>链式编程思想：</h4><p>所谓链式编程就是通过点（.）将多个操作链接在一起成为一句代码，使代码更加紧凑，也提高了代码的可读性（如上面那句代码）。</p>
<h4 id="链式编程特点："><a href="#链式编程特点：" class="headerlink" title="链式编程特点："></a>链式编程特点：</h4><ul>
<li>方法的返回值是 block，block 中必须有一个返回值，通常返回它本身，也可以是处理后的数据或对象。</li>
<li>返回值中的 block 具备两个功能，第一：可以作为类的属性被’点’出来。第二：可以当作函数直接调用。</li>
<li>通常会通过调用一个函数来给属性赋值，在函数内部封装赋值的语句，也可以加入一些判断逻辑等。</li>
</ul>
<h4 id="链式编程练习"><a href="#链式编程练习" class="headerlink" title="链式编程练习"></a>链式编程练习</h4><p>我这里写了一个 UILabel 的扩展类用来练习链式编程，叫做 <code>UILabel+NNCategory</code>。利用这个分类创建 UILabel，并为其设置<code>frame，text，font，textColor，backgroundColor</code>等属性，代码如下：</p>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="name">UILabel</span> addToView:self.view createLabel:^(<span class="name">UILabel</span> *label) &#123;</span><br><span class="line">label.nn_frame(<span class="name">50</span>, <span class="number">200</span>, <span class="number">300</span>, <span class="number">100</span>).nn_text(<span class="name">@</span><span class="string">"NNTreasure"</span>).nn_fontSize(<span class="name">50</span>).nn_textColor([<span class="name">UIColor</span> redColor]).nn_backgroundColorRGB(<span class="name">224</span>, <span class="number">224</span>, <span class="number">224</span>, <span class="number">1</span>).nn_textAlignment(<span class="name">NSTextAlignmentCenter</span>)<span class="comment">;</span></span><br><span class="line">&#125;]<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>细心观察上面的代码，我们可以猜出 <code>nn_frame()</code>，<code>nn_text()</code>，<code>nn_fontSize()</code> 这些都是属性，不过为什么它们后面都带有括号呢？这是<strong>因为这些属性都是 <code>block</code> 类型</strong>。那么为什么它们可以点出来呢？即为什么可以 <code>label.nn_frame().nn_text().nn_fontSize()</code> 这么用？简单来说，就是<strong>因为这些 <code>block</code> 类型的属性都带有返回值</strong>！</p>
<p>下面是分类 <code>UILabel+NNCategory</code> 的详细实现过程</p>
<ul>
<li>在 UILabel+NNCategory.h 中声明一些属性</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>, <span class="keyword">readonly</span>) <span class="built_in">UILabel</span> *(^nn_text)(<span class="built_in">NSString</span> *);</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>, <span class="keyword">readonly</span>) <span class="built_in">UILabel</span> *(^nn_frame)(<span class="built_in">CGFloat</span>, <span class="built_in">CGFloat</span>, <span class="built_in">CGFloat</span>, <span class="built_in">CGFloat</span>);</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>, <span class="keyword">readonly</span>) <span class="built_in">UILabel</span> *(^nn_attributedText)(<span class="built_in">NSAttributedString</span> *);</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>, <span class="keyword">readonly</span>) <span class="built_in">UILabel</span> *(^nn_textAlignment)(<span class="built_in">NSTextAlignment</span>);</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>, <span class="keyword">readonly</span>) <span class="built_in">UILabel</span> *(^nn_textColor)(<span class="built_in">UIColor</span> *);</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>, <span class="keyword">readonly</span>) <span class="built_in">UILabel</span> *(^nn_textColorRGB)(<span class="built_in">CGFloat</span>, <span class="built_in">CGFloat</span>, <span class="built_in">CGFloat</span>, <span class="built_in">CGFloat</span>);</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>, <span class="keyword">readonly</span>) <span class="built_in">UILabel</span> *(^nn_backgroundColor)(<span class="built_in">UIColor</span> *);</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>, <span class="keyword">readonly</span>) <span class="built_in">UILabel</span> *(^nn_backgroundColorRGB)(<span class="built_in">CGFloat</span>, <span class="built_in">CGFloat</span>, <span class="built_in">CGFloat</span>, <span class="built_in">CGFloat</span>);</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>, <span class="keyword">readonly</span>) <span class="built_in">UILabel</span> *(^nn_highlightTextColor)(<span class="built_in">UIColor</span> *);</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>, <span class="keyword">readonly</span>) <span class="built_in">UILabel</span> *(^nn_highlight)(<span class="built_in">BOOL</span>);</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>, <span class="keyword">readonly</span>) <span class="built_in">UILabel</span> *(^nn_enable)(<span class="built_in">BOOL</span>);</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>, <span class="keyword">readonly</span>) <span class="built_in">UILabel</span> *(^nn_font)(<span class="built_in">UIFont</span> *);</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>, <span class="keyword">readonly</span>) <span class="built_in">UILabel</span> *(^nn_fontSize)(<span class="built_in">NSInteger</span>);</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>, <span class="keyword">readonly</span>) <span class="built_in">UILabel</span> *(^nn_shadowColor)(<span class="built_in">UIColor</span> *);</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>, <span class="keyword">readonly</span>) <span class="built_in">UILabel</span> *(^nn_shadowOffset)(<span class="built_in">CGSize</span>);</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>, <span class="keyword">readonly</span>) <span class="built_in">UILabel</span> *(^nn_lineBreakMode)(<span class="built_in">NSLineBreakMode</span>);</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>, <span class="keyword">readonly</span>) <span class="built_in">UILabel</span> *(^nn_numberOfLine)(<span class="built_in">NSInteger</span>);</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>, <span class="keyword">readonly</span>) <span class="built_in">UILabel</span> *(^nn_adjustsFontSizeToFitWidth)(<span class="built_in">BOOL</span>);</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>, <span class="keyword">readonly</span>) <span class="built_in">UILabel</span> *(^nn_baselineAdjust)(<span class="built_in">UIBaselineAdjustment</span>);</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>, <span class="keyword">readonly</span>) <span class="built_in">UILabel</span> *(^nn_drawText)(<span class="built_in">CGRect</span>);</span><br></pre></td></tr></table></figure>
<p>我们在 UILabel 分类里面声明了这些属性，所以接下来只要是 UILabel 类型都可以点出来这些属性。这里也可以看出这些属性都是 <code>block</code> 类型。我们抽出一句代码简单说明一下：<code>@property (nonatomic, copy, readonly) UILabel *(^nn_text)(NSString *);</code>，这句代码声明了一个 block(^) 原型，名字叫做 nn_text，包含了一个 NSString 类型的参数，返回值是 UILabel 类型。</p>
<ul>
<li>在 UILabel+NNCategory.m 中实现</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">UILabel</span> *(^)(<span class="built_in">NSString</span> *))nn_text &#123;</span><br><span class="line"><span class="keyword">return</span> ^(<span class="built_in">NSString</span> *text) &#123;</span><br><span class="line"><span class="keyword">self</span>.text = text;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UILabel</span> *(^)(<span class="built_in">CGFloat</span>, <span class="built_in">CGFloat</span>, <span class="built_in">CGFloat</span>, <span class="built_in">CGFloat</span>))nn_frame &#123;</span><br><span class="line"><span class="keyword">return</span> ^(<span class="built_in">CGFloat</span> X, <span class="built_in">CGFloat</span> Y, <span class="built_in">CGFloat</span> W, <span class="built_in">CGFloat</span> H) &#123;</span><br><span class="line"><span class="keyword">self</span>.frame = <span class="built_in">CGRectMake</span>(X, Y, W, H);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UILabel</span> *(^)(<span class="built_in">NSAttributedString</span> *))nn_attributedText &#123;</span><br><span class="line"><span class="keyword">return</span> ^(<span class="built_in">NSAttributedString</span> *attributedText) &#123;</span><br><span class="line"><span class="keyword">self</span>.attributedText = attributedText;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UILabel</span> *(^)(<span class="built_in">NSTextAlignment</span>))nn_textAlignment &#123;</span><br><span class="line"><span class="keyword">return</span> ^(<span class="built_in">NSTextAlignment</span> textAlignment) &#123;</span><br><span class="line"><span class="keyword">self</span>.textAlignment = textAlignment;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UILabel</span> *(^)(<span class="built_in">UIColor</span> *))nn_textColor &#123;</span><br><span class="line"><span class="keyword">return</span> ^(<span class="built_in">UIColor</span> *textColor) &#123;</span><br><span class="line"><span class="keyword">self</span>.textColor = textColor;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UILabel</span> *(^)(<span class="built_in">CGFloat</span>, <span class="built_in">CGFloat</span>, <span class="built_in">CGFloat</span>, <span class="built_in">CGFloat</span>))nn_textColorRGB &#123;</span><br><span class="line"><span class="keyword">return</span> ^(<span class="built_in">CGFloat</span> r, <span class="built_in">CGFloat</span> g, <span class="built_in">CGFloat</span> b, <span class="built_in">CGFloat</span> a)&#123;</span><br><span class="line"><span class="keyword">self</span>.textColor = [<span class="built_in">UIColor</span> colorWithRed:r / <span class="number">255.0</span> green:g / <span class="number">255.0</span> blue:g / <span class="number">255.0</span> alpha:a];</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UILabel</span> *(^)(<span class="built_in">UIColor</span> *))nn_backgroundColor &#123;</span><br><span class="line"><span class="keyword">return</span> ^(<span class="built_in">UIColor</span> *backgroundColor) &#123;</span><br><span class="line"><span class="keyword">self</span>.backgroundColor = backgroundColor;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UILabel</span> *(^)(<span class="built_in">CGFloat</span>, <span class="built_in">CGFloat</span>, <span class="built_in">CGFloat</span>, <span class="built_in">CGFloat</span>))nn_backgroundColorRGB &#123;</span><br><span class="line"><span class="keyword">return</span> ^(<span class="built_in">CGFloat</span> r, <span class="built_in">CGFloat</span> g, <span class="built_in">CGFloat</span> b, <span class="built_in">CGFloat</span> a) &#123;</span><br><span class="line"><span class="keyword">self</span>.backgroundColor = [<span class="built_in">UIColor</span> colorWithRed:r / <span class="number">255.0</span> green:g / <span class="number">255.0</span> blue:g / <span class="number">255.0</span> alpha:a];</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UILabel</span> *(^)(<span class="built_in">UIColor</span> *))nn_highlightTextColor &#123;</span><br><span class="line"><span class="keyword">return</span> ^(<span class="built_in">UIColor</span> *color) &#123;</span><br><span class="line"><span class="keyword">self</span>.highlightedTextColor = color;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UILabel</span> *(^)(<span class="built_in">BOOL</span>))nn_highlight &#123;</span><br><span class="line"><span class="keyword">return</span> ^(<span class="built_in">BOOL</span> isHighlighted) &#123;</span><br><span class="line"><span class="keyword">self</span>.highlighted = isHighlighted;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UILabel</span> *(^)(<span class="built_in">BOOL</span>))nn_enable &#123;</span><br><span class="line"><span class="keyword">return</span> ^(<span class="built_in">BOOL</span> isEnabled) &#123;</span><br><span class="line"><span class="keyword">self</span>.enabled = isEnabled;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UILabel</span> *(^)(<span class="built_in">UIFont</span> *))nn_font &#123;</span><br><span class="line"><span class="keyword">return</span> ^(<span class="built_in">UIFont</span> *font) &#123;</span><br><span class="line"><span class="keyword">self</span>.font = font;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UILabel</span> *(^)(<span class="built_in">NSInteger</span>))nn_fontSize &#123;</span><br><span class="line"><span class="keyword">return</span> ^(<span class="built_in">NSInteger</span> size) &#123;</span><br><span class="line"><span class="keyword">self</span>.font = [<span class="built_in">UIFont</span> systemFontOfSize:size];</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UILabel</span> *(^)(<span class="built_in">UIColor</span> *))nn_shadowColor &#123;</span><br><span class="line"><span class="keyword">return</span> ^(<span class="built_in">UIColor</span> *shadowColor) &#123;</span><br><span class="line"><span class="keyword">self</span>.shadowColor = shadowColor;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UILabel</span> *(^)(<span class="built_in">CGSize</span>))nn_shadowOffset &#123;</span><br><span class="line"><span class="keyword">return</span> ^(<span class="built_in">CGSize</span> size) &#123;</span><br><span class="line"><span class="keyword">self</span>.shadowOffset = size;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UILabel</span> *(^)(<span class="built_in">NSLineBreakMode</span>))nn_lineBreakMode &#123;</span><br><span class="line"><span class="keyword">return</span> ^(<span class="built_in">NSLineBreakMode</span> mode) &#123;</span><br><span class="line"><span class="keyword">self</span>.lineBreakMode = mode;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UILabel</span> *(^)(<span class="built_in">NSInteger</span>))nn_numberOfLine &#123;</span><br><span class="line"><span class="keyword">return</span> ^(<span class="built_in">NSInteger</span> number) &#123;</span><br><span class="line"><span class="keyword">self</span>.numberOfLines = number;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UILabel</span> *(^)(<span class="built_in">BOOL</span>))nn_adjustsFontSizeToFitWidth &#123;</span><br><span class="line"><span class="keyword">return</span> ^(<span class="built_in">BOOL</span> b) &#123;</span><br><span class="line"><span class="keyword">self</span>.adjustsFontSizeToFitWidth = b;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UILabel</span> *(^)(<span class="built_in">UIBaselineAdjustment</span>))nn_baselineAdjust &#123;</span><br><span class="line"><span class="keyword">return</span> ^(<span class="built_in">UIBaselineAdjustment</span> adjustment) &#123;</span><br><span class="line"><span class="keyword">self</span>.baselineAdjustment = adjustment;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UILabel</span> *(^)(<span class="built_in">CGRect</span>))nn_drawText &#123;</span><br><span class="line"><span class="keyword">return</span> ^(<span class="built_in">CGRect</span> rect) &#123;</span><br><span class="line">[<span class="keyword">self</span> drawTextInRect:rect];</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>UILabel+NNCategory.m</code> 中的这些是 <code>UILabel+NNCategory.h</code> 文件中属性的 getter 方法。我们抽出一个简单说明一下</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">UILabel</span> *(^)(<span class="built_in">NSString</span> *))nn_text &#123;</span><br><span class="line"><span class="comment">// 返回临时变量的 block</span></span><br><span class="line"><span class="keyword">return</span> ^(<span class="built_in">NSString</span> *text) &#123;</span><br><span class="line"><span class="comment">// block 执行的一些功能</span></span><br><span class="line"><span class="keyword">self</span>.text = text;</span><br><span class="line"><span class="comment">// block 执行完毕的返回值</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个属性的类型是 block，具体是 <code>UILabel *(^nn_text)(NSString *)</code> 类型，需要说明的是，我们用 block 并不是为了返回 block 对象本身，而是为了在 block 内部执行一些操作，所以我们在属性的 getter 方法中首先返回一个临时的 block 对象，主要是为了在 block 内部返回 UILabel 类型的对象。具体请看上面代码块中的一些注释。</p>
<p><strong>这时我们还需要定义一个方法方便外界调用，这个方法主要有两个功能，第一是用来创建 UILabel ，第二是为其“点”出各种属性。</strong></p>
<ul>
<li>在 UILabel+NNCategory.h 中声明一个方法</li>
</ul>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+ (instance<span class="keyword">type</span>)addToView:(<span class="type">UIView</span> *)superView createLabel:(void(^)(<span class="type">UILabel</span> *label))block;</span><br></pre></td></tr></table></figure>
<p>这里是模仿 Masonry，我们通常用 Masonry 加约束时首先会调用这个方法：<code>- (NSArray *)mas_makeConstraints:(void(^)(MASConstraintMaker *make))block</code>，</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSArray</span> *)mas_makeConstraints:(<span class="keyword">void</span>(^)(MASConstraintMaker *))block &#123;</span><br><span class="line"><span class="keyword">self</span>.translatesAutoresizingMaskIntoConstraints = <span class="literal">NO</span>;</span><br><span class="line">MASConstraintMaker *constraintMaker = [[MASConstraintMaker alloc] initWithView:<span class="keyword">self</span>];</span><br><span class="line">block(constraintMaker);</span><br><span class="line"><span class="keyword">return</span> [constraintMaker install];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们用 Masonry 加约束时调用这个方法，是因为 Masonry 在这个方法内部早已做好一些所需要的操作。所以接下来我们也要在 UILabel+NNCategory.m 中做些事情。</p>
<ul>
<li>在 UILabel+NNCategory.m 中实现这个方法</li>
</ul>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+ (instancetype)addToView:(UIView *)superView createLabel:(void(^)(UILabel *<span class="keyword">label</span><span class="bash">))block &#123;</span></span><br><span class="line"><span class="bash">// 创建 UILabel</span></span><br><span class="line"><span class="bash">UILabel *label = [[UILabel alloc] init];</span></span><br><span class="line"><span class="bash">// 把 UILabel 添加到传过来的 superView 上</span></span><br><span class="line"><span class="bash">[superView addSubview:label];</span></span><br><span class="line"><span class="bash">// 通过 block 进行回调</span></span><br><span class="line"><span class="bash"><span class="keyword">if</span> (block) block(label);</span></span><br><span class="line"><span class="bash"><span class="built_in">return</span> label;</span></span><br><span class="line"><span class="bash">&#125;</span></span><br></pre></td></tr></table></figure>
<p>上面这个方法首先初始化一个 UILabel 对象，接着把 UILabel 添加到传过来的 superView 上，然后对 block 进行回调，执行 block，把外界对 UILabel 设置的属性添加上去，最后返回 UILabel 对象。</p>
<hr>
<p>这就是一些简单的链式编程思维，外界调用的时候只需如下代码即可：</p>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="name">UILabel</span> addToView:self.view createLabel:^(<span class="name">UILabel</span> *label) &#123;</span><br><span class="line">label.nn_frame(<span class="name">50</span>, <span class="number">200</span>, <span class="number">300</span>, <span class="number">100</span>).nn_text(<span class="name">@</span><span class="string">"NNTreasure"</span>).nn_fontSize(<span class="name">50</span>).nn_textColor([<span class="name">UIColor</span> redColor]).nn_backgroundColorRGB(<span class="name">224</span>, <span class="number">224</span>, <span class="number">224</span>, <span class="number">1</span>).nn_textAlignment(<span class="name">NSTextAlignmentCenter</span>)<span class="comment">;</span></span><br><span class="line">&#125;]<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>效果图如下：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-98cb658222344c24.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="链式编程"></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/15/iOS开发 - 随机图片验证码封装/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="刘朋坤">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="以梦为马">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/15/iOS开发 - 随机图片验证码封装/" itemprop="url">
                  iOS开发 - 随机图片验证码封装
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
                
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-15T12:30:20+08:00">2018-04-15</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>在 iOS 开发中，为了防止短信验证码的恶意获取，注册时需要图片验证，比如某共享单车 APP 在注册时就用了图片验证码，如下图：</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-d30ea33f4234f341.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<ul>
<li>图片验证码封装思路：<br>第一眼看到图片验证码，可能会觉得图片验证码是由 UIImage 实现的，但事实上明显不是，这里简单说下图片验证码封装思路。</li>
<li>首先要有一个数组，里面包含 1-9、a-z 这些字符</li>
<li>在 UIView 上显示这些字符</li>
<li><p>同时在 UIView 上绘制干扰线</p>
</li>
<li><p>效果图</p>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-c0eae594816bb189.gif?imageMogr2/auto-orient/strip" alt="图片验证码效果图"></p>
<hr>
<ul>
<li>用法</li>
</ul>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">_testView</span> = [[NNValidationView alloc] initWithFrame:CGRectMake((<span class="keyword">self.view.frame.size.width </span>- <span class="number">100</span>) / <span class="number">2</span>, <span class="number">200</span>, <span class="number">100</span>, <span class="number">40</span>) <span class="keyword">andCharCount:4 </span><span class="keyword">andLineCount:4];</span></span><br><span class="line"><span class="keyword">[self.view </span><span class="keyword">addSubview:_testView];</span></span><br></pre></td></tr></table></figure>
<p><strong>以上两行代码便可以实现图片验证码，其中 charCount 和 lineCount 分别指显示的字符串数量以及干扰线的数量。<br>另外我们还需要知道图片验证码上的字符串，可以用下边这个 block 获取：</strong></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">__<span class="keyword">weak</span> <span class="keyword">typeof</span>(<span class="keyword">self</span>) weakSelf = <span class="keyword">self</span>;</span><br><span class="line"><span class="comment">/// 返回验证码数字</span></span><br><span class="line">_testView.changeValidationCodeBlock = ^(<span class="keyword">void</span>)&#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"验证码被点击了：%@"</span>, weakSelf.testView.charString);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>打印效果如下</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-68d27043ca1c73a3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="获取验证码数字"></p>
<ul>
<li>核心代码</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#pragma mark - 绘制界面</span></span><br><span class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect &#123;</span><br><span class="line">[<span class="keyword">super</span> drawRect:rect];</span><br><span class="line"><span class="keyword">self</span>.backgroundColor = NNRandomColor;</span><br><span class="line"><span class="built_in">CGFloat</span> rectWidth = rect.size.width;</span><br><span class="line"><span class="built_in">CGFloat</span> rectHeight = rect.size.height;</span><br><span class="line"><span class="built_in">CGFloat</span> pointX, pointY;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSString</span> *text = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@"</span>,<span class="keyword">self</span>.charString];</span><br><span class="line"><span class="built_in">NSInteger</span> charWidth = rectWidth / text.length - <span class="number">15</span>;</span><br><span class="line"><span class="built_in">NSInteger</span> charHeight = rectHeight - <span class="number">25</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 依次绘制文字</span></span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; text.length; i++) &#123;</span><br><span class="line"><span class="comment">// 文字X坐标</span></span><br><span class="line">pointX = arc4random() % charWidth + rectWidth / text.length * i;</span><br><span class="line"><span class="comment">// 文字Y坐标</span></span><br><span class="line">pointY = arc4random() % charHeight;</span><br><span class="line"><span class="keyword">unichar</span> charC = [text characterAtIndex:i];</span><br><span class="line"><span class="built_in">NSString</span> *textC = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%C"</span>, charC];</span><br><span class="line"></span><br><span class="line">[textC drawAtPoint:<span class="built_in">CGPointMake</span>(pointX, pointY) withAttributes:@&#123;<span class="built_in">NSFontAttributeName</span>:[<span class="built_in">UIFont</span> systemFontOfSize:arc4random() % <span class="number">10</span> + <span class="number">15</span>]&#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取上下文</span></span><br><span class="line"><span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line"><span class="comment">// 设置线宽</span></span><br><span class="line"><span class="built_in">CGContextSetLineWidth</span>(context, <span class="number">1.0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 依次绘制直线</span></span><br><span class="line"><span class="keyword">for</span>(<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; <span class="keyword">self</span>.lineCount; i++) &#123;</span><br><span class="line"><span class="comment">// 设置线的颜色</span></span><br><span class="line"><span class="built_in">CGContextSetStrokeColorWithColor</span>(context, NNRandomColor.CGColor);</span><br><span class="line"><span class="comment">// 设置线的起点</span></span><br><span class="line">pointX = arc4random() % (<span class="built_in">NSInteger</span>)rectWidth;</span><br><span class="line">pointY = arc4random() % (<span class="built_in">NSInteger</span>)rectHeight;</span><br><span class="line"><span class="built_in">CGContextMoveToPoint</span>(context, pointX, pointY);</span><br><span class="line"><span class="comment">// 设置线的终点</span></span><br><span class="line">pointX = arc4random() % (<span class="built_in">NSInteger</span>)rectWidth;</span><br><span class="line">pointY = arc4random() % (<span class="built_in">NSInteger</span>)rectHeight;</span><br><span class="line"><span class="built_in">CGContextAddLineToPoint</span>(context, pointX, pointY);</span><br><span class="line"><span class="comment">// 绘画路径</span></span><br><span class="line"><span class="built_in">CGContextStrokePath</span>(context);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>代码中写了注释，因此这里不再详细解释，需要看全部代码的童鞋可以点击下边的链接，有疑问或有建议的话欢迎讨论。</strong></p>
<p><a href="https://github.com/liuzhongning/NNValidationView/tree/master" target="_blank" rel="noopener">demo 地址：NNValidationView</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/15/iOS开发之 - AFNetworking - 上传、下载、网络监听/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="刘朋坤">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="以梦为马">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/15/iOS开发之 - AFNetworking - 上传、下载、网络监听/" itemprop="url">
                  iOS开发之 - AFNetworking - 上传、下载、网络监听
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
                
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-15T12:30:20+08:00">2018-04-15</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>这一篇是接着上一篇总结的，如果有朋友需要了解网络请求的内容，可以<a href="http://www.jianshu.com/p/d23f4f913af1" target="_blank" rel="noopener">到这里</a>。和上篇一样，先说下这篇文章的大概内容，以便朋友们能够快速找到自己需要的。这篇文章主要介绍了 AFNetworking 的三个很广泛的应用：上传、下载以及网络监听。如果有朋友想了解苹果自带的 NSURLSession 相关的上传与下载，可以<a href="http://www.jianshu.com/p/be94889824d9" target="_blank" rel="noopener">到这里</a>。接下来是使用 AFNetworking 上传、下载以及网络监听的 demo.</p>
<h2 id="一、上传："><a href="#一、上传：" class="headerlink" title="一、上传："></a>一、上传：</h2><p>这里介绍了 AFN 的两种上传方式：</p>
<p>1.通过工程中的文件上传<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建管理者对象</span></span><br><span class="line">AFHTTPSessionManager *sessionManager = [AFHTTPSessionManager manager];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 请求参数</span></span><br><span class="line"><span class="built_in">NSString</span> *urlStr = <span class="string">@" "</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSDictionary</span> *dic = @&#123;<span class="string">@" "</span> : <span class="string">@" "</span>,<span class="string">@" "</span> : <span class="string">@" "</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发送 post 请求，上传一张图片</span></span><br><span class="line">[sessionManager POST:urlStr parameters:dic constructingBodyWithBlock:^(<span class="keyword">id</span>&lt;AFMultipartFormData&gt;  _Nonnull formData) &#123;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSString</span> *filePath = [[<span class="built_in">NSBundle</span> mainBundle] pathForResource:<span class="string">@"a.jpg"</span> ofType:<span class="literal">nil</span>];</span><br><span class="line"><span class="built_in">NSData</span> *imgData = [<span class="built_in">NSData</span> dataWithContentsOfFile:filePath];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将图片数据拼接，进行上传</span></span><br><span class="line">[formData appendPartWithFileData:imgData name:<span class="string">@"pic"</span> fileName:<span class="string">@"filename"</span> mimeType:<span class="string">@"image/jpg"</span>];</span><br><span class="line"></span><br><span class="line">&#125; progress:^(<span class="built_in">NSProgress</span> * _Nonnull uploadProgress) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取上传的进度</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%.2f"</span>,uploadProgress.fractionCompleted);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,[<span class="built_in">NSThread</span> currentThread]); <span class="comment">//子线程</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125; success:^(<span class="built_in">NSURLSessionDataTask</span> * _Nonnull task, <span class="keyword">id</span>  _Nullable responseObject) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 请求成功</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"请求成功：%@"</span>,responseObject);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,[<span class="built_in">NSThread</span> currentThread]); <span class="comment">//主线程</span></span><br><span class="line"></span><br><span class="line">&#125; failure:^(<span class="built_in">NSURLSessionDataTask</span> * _Nullable task, <span class="built_in">NSError</span> * _Nonnull error) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 请求失败</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"请求失败：%@"</span>,error);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure></p>
<p>2.根据URL路径上传<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建管理者对象</span></span><br><span class="line">AFHTTPSessionManager *sessionManager = [AFHTTPSessionManager manager];</span><br><span class="line"></span><br><span class="line">[sessionManager <span class="string">POST:</span>@<span class="string">" "</span> <span class="string">parameters:</span>@&#123;@<span class="string">" "</span> : @<span class="string">" "</span>&#125; <span class="string">constructingBodyWithBlock:</span>^(id&lt;AFMultipartFormData&gt; formData) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在block中设置需要上传的文件</span></span><br><span class="line">[formData <span class="string">appendPartWithFileURL:</span>[NSURL <span class="string">fileURLWithPath:</span>@<span class="string">"文件路径"</span>] <span class="string">name:</span>@<span class="string">"file"</span> <span class="string">error:</span>nil];</span><br><span class="line"></span><br><span class="line">&#125; <span class="string">success:</span>^(NSURLSessionDataTask *task, id responseObject) &#123;</span><br><span class="line"></span><br><span class="line">NSLog(@<span class="string">"成功：%@"</span>, responseObject);</span><br><span class="line"></span><br><span class="line">&#125; <span class="string">failure:</span>^(NSURLSessionDataTask *task, NSError *error) &#123;</span><br><span class="line">NSLog(@<span class="string">"失败：%@"</span>, error);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure></p>
<h2 id="二、下载"><a href="#二、下载" class="headerlink" title="二、下载"></a>二、下载</h2><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建管理者对象</span></span><br><span class="line">AFHTTPSessionManager *manager = [AFHTTPSessionManager manager];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 确定请求的URL地址</span></span><br><span class="line"><span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@" "</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建请求对象</span></span><br><span class="line"><span class="built_in">NSURLRequest</span> *request = [<span class="built_in">NSURLRequest</span> requestWithURL:url];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 下载文件</span></span><br><span class="line"><span class="built_in">NSURLSessionDownloadTask</span> *task = [manager downloadTaskWithRequest:request progress:^(<span class="built_in">NSProgress</span> * _Nonnull downloadProgress) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// block会实时调用</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%.2f"</span>,downloadProgress.fractionCompleted);</span><br><span class="line"></span><br><span class="line">&#125; destination:^<span class="built_in">NSURL</span> * _Nonnull(<span class="built_in">NSURL</span> * _Nonnull targetPath, <span class="built_in">NSURLResponse</span> * _Nonnull response) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NSHomeDirectory()可以得到应用程序目录的路径</span></span><br><span class="line"><span class="comment">// 返回一个URL存储文件</span></span><br><span class="line"><span class="built_in">NSString</span> *filePath = [<span class="built_in">NSHomeDirectory</span>() stringByAppendingPathComponent:<span class="string">@"Documents/***.mp3"</span>];</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> fileURLWithPath:filePath];</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> url;</span><br><span class="line"></span><br><span class="line">&#125; completionHandler:^(<span class="built_in">NSURLResponse</span> * _Nonnull response, <span class="built_in">NSURL</span> * _Nullable filePath, <span class="built_in">NSError</span> * _Nullable error) &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (error) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"下载失败 ~~~ %@"</span>,error);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"下载成功"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 开始下载任务</span></span><br><span class="line">[task resume];</span><br></pre></td></tr></table></figure>
<h2 id="三、网络监听（监听手机网络的不同状态）"><a href="#三、网络监听（监听手机网络的不同状态）" class="headerlink" title="三、网络监听（监听手机网络的不同状态）"></a>三、网络监听（监听手机网络的不同状态）</h2><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获得网络监控的管理者</span></span><br><span class="line">AFNetworkReachabilityManager *manager = [AFNetworkReachabilityManager manager];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 只要网络环境发生变化，就会调用此 block</span></span><br><span class="line">[manager <span class="string">setReachabilityStatusChangeBlock:</span>^(AFNetworkReachabilityStatus status) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 枚举里面的四个状态</span></span><br><span class="line"><span class="comment">AFNetworkReachabilityStatusUnknown          = -1,  未知</span></span><br><span class="line"><span class="comment">AFNetworkReachabilityStatusNotReachable     = 0,   不可用</span></span><br><span class="line"><span class="comment">AFNetworkReachabilityStatusReachableViaWWAN = 1,   手机自带网络</span></span><br><span class="line"><span class="comment">AFNetworkReachabilityStatusReachableViaWiFi = 2,   wifi</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> (status) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">AFNetworkReachabilityStatusUnknown:</span></span><br><span class="line">NSLog(@<span class="string">"未知"</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="string">AFNetworkReachabilityStatusNotReachable:</span></span><br><span class="line">NSLog(@<span class="string">"不可用"</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="string">AFNetworkReachabilityStatusReachableViaWWAN:</span></span><br><span class="line">NSLog(@<span class="string">"手机自带网络"</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="string">AFNetworkReachabilityStatusReachableViaWiFi:</span></span><br><span class="line">NSLog(@<span class="string">"Wifi"</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="string">default:</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 开始监听</span></span><br><span class="line">[manager startMonitoring];</span><br></pre></td></tr></table></figure>
<p>这是今天做的一些关于 AFNetworking 的总结，如果有错误或疏忽的地方，希望大家能够指出！谢谢大家！！！</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/15/iOS开发之 - AFNetworking - 网络请求/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="刘朋坤">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="以梦为马">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/15/iOS开发之 - AFNetworking - 网络请求/" itemprop="url">
                  iOS开发之 - AFNetworking - 网络请求
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
                
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-15T12:30:20+08:00">2018-04-15</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>最近一直很忙也没有时间写博客，今天正好有点空闲时间，所以就对 <a href="https://github.com/AFNetworking/AFNetworking/" target="_blank" rel="noopener">AFNetworking</a> 做了一些简单的总结，特地记录下来，以便遇到的朋友们看看！！！</p>
</blockquote>
<p>先说下这篇文章的大概内容，以便朋友们能够快速找到自己需要的。这篇文章主要介绍了三种网络请求的渠道，第一种是通过苹果自带的 NSURLSession 请求网络；第二种是通过 AFNetworking2.x 请求网络；最后一种是通过 AFNetworking3.0 请求网络。下边是这三种网络请求渠道的 demo.</p>
<h2 id="一、苹果自带的请求网络方法："><a href="#一、苹果自带的请求网络方法：" class="headerlink" title="一、苹果自带的请求网络方法："></a>一、苹果自带的请求网络方法：</h2><p>这里介绍了三种，GET 请求、POST 请求、代理方式请求。</p>
<p>1.GET 请求:<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获得 NSURLSession 对象</span></span><br><span class="line"><span class="built_in">NSURLSession</span> *session =  [<span class="built_in">NSURLSession</span> sessionWithConfiguration:[<span class="built_in">NSURLSessionConfiguration</span> defaultSessionConfiguration] delegate:<span class="literal">nil</span> delegateQueue:[<span class="built_in">NSOperationQueue</span> mainQueue]];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建任务</span></span><br><span class="line"><span class="built_in">NSURLSessionDataTask</span> *dataTask = [session dataTaskWithRequest:[<span class="built_in">NSURLRequest</span> requestWithURL:[<span class="built_in">NSURL</span> URLWithString:<span class="string">@" "</span>]] completionHandler:^(<span class="built_in">NSData</span> * _Nullable data, <span class="built_in">NSURLResponse</span> * _Nullable response, <span class="built_in">NSError</span> * _Nullable error) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"data ~~~ %@ ~~~ response ~~~ %@ ~~~ error~~~ %@"</span>, data, response , error);</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动任务</span></span><br><span class="line">[dataTask resume];</span><br></pre></td></tr></table></figure></p>
<p>2.POST 请求:<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获得NSURLSession对象</span></span><br><span class="line"><span class="built_in">NSURLSession</span> *session = [<span class="built_in">NSURLSession</span> sharedSession];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建请求</span></span><br><span class="line"><span class="built_in">NSMutableURLRequest</span> *request = [<span class="built_in">NSMutableURLRequest</span> requestWithURL:[<span class="built_in">NSURL</span> URLWithString:<span class="string">@" "</span>]];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置请求方法</span></span><br><span class="line">request.HTTPMethod = <span class="string">@"POST"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置请求体</span></span><br><span class="line">request.HTTPBody = [<span class="string">@" "</span> dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建任务</span></span><br><span class="line"><span class="built_in">NSURLSessionDataTask</span> *task = [session dataTaskWithRequest:request completionHandler:^(<span class="built_in">NSData</span> *data, <span class="built_in">NSURLResponse</span> *response, <span class="built_in">NSError</span> *error) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"data ~~~ %@ ~~~ response ~~~ %@ ~~~ error~~~ %@"</span>, data, response , error);</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动任务</span></span><br><span class="line">[task resume];</span><br></pre></td></tr></table></figure></p>
<p>3.代理:NSURLSessionDataDelegate<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">[<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSMutableURLRequest</span> *request = [<span class="built_in">NSMutableURLRequest</span> requestWithURL:[<span class="built_in">NSURL</span> URLWithString:<span class="string">@" "</span>]];</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSURLSession</span> *session = [<span class="built_in">NSURLSession</span> sessionWithConfiguration:[<span class="built_in">NSURLSessionConfiguration</span> defaultSessionConfiguration] delegate:<span class="keyword">self</span> delegateQueue:[<span class="built_in">NSOperationQueue</span> mainQueue]];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果创建task时，有block，代理会失效</span></span><br><span class="line"><span class="built_in">NSURLSessionDataTask</span> *task = [session dataTaskWithRequest:request];</span><br><span class="line"></span><br><span class="line">[task resume];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - NSURLSessionDataDelegate</span></span><br><span class="line"><span class="meta">#pragma mark - 接收到响应头调用的协议方法</span></span><br><span class="line">- (<span class="keyword">void</span>)URLSession:(<span class="built_in">NSURLSession</span> *)session dataTask:(<span class="built_in">NSURLSessionDataTask</span> *)dataTask</span><br><span class="line">didReceiveResponse:(<span class="built_in">NSURLResponse</span> *)response</span><br><span class="line">completionHandler:(<span class="keyword">void</span> (^)(<span class="built_in">NSURLSessionResponseDisposition</span> disposition))completionHandler &#123;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSHTTPURLResponse</span> *httpRes = (<span class="built_in">NSHTTPURLResponse</span> *)response;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,httpRes.allHeaderFields);</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过设置 completionHandler, Block 可以设置后面的响应体中的数据是否继续发送,默认是不发送</span></span><br><span class="line">completionHandler(<span class="built_in">NSURLSessionResponseAllow</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 数据请求完成后，调用的协议方法，data是响应体中的数据</span></span><br><span class="line">- (<span class="keyword">void</span>)URLSession:(<span class="built_in">NSURLSession</span> *)session dataTask:(<span class="built_in">NSURLSessionDataTask</span> *)dataTask</span><br><span class="line">didReceiveData:(<span class="built_in">NSData</span> *)data &#123;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 不管请求成功还是失败，最终都会调用此方法</span></span><br><span class="line">- (<span class="keyword">void</span>)URLSession:(<span class="built_in">NSURLSession</span> *)session task:(<span class="built_in">NSURLSessionTask</span> *)task didCompleteWithError:(<span class="built_in">NSError</span> *)error &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (error) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"请求失败"</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"请求成功"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="二、AFNetworking2-x"><a href="#二、AFNetworking2-x" class="headerlink" title="二、AFNetworking2.x"></a>二、AFNetworking2.x</h2><p>1.GET 请求<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">AFHTTPRequestOperationManager *operationManager = [AFHTTPRequestOperationManager manager];</span><br><span class="line"></span><br><span class="line">[operationManager GET:<span class="string">@" "</span> parameters:<span class="literal">nil</span></span><br><span class="line">success:^(AFHTTPRequestOperation *operation, <span class="keyword">id</span> responseObject) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"请求成功"</span>);</span><br><span class="line">&#125; failure:^(AFHTTPRequestOperation *operation, <span class="built_in">NSError</span> *error) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"请求失败"</span>);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure></p>
<p>2.POST 请求</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">AFHTTPRequestOperationManager *operationManager = [AFHTTPRequestOperationManager manager];</span><br><span class="line"></span><br><span class="line">[operationManager POST:<span class="string">@" "</span> parameters:<span class="literal">nil</span></span><br><span class="line">success:^(AFHTTPRequestOperation *operation, <span class="keyword">id</span> responseObject) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"请求成功"</span>);</span><br><span class="line">&#125; failure:^(AFHTTPRequestOperation *operation, <span class="built_in">NSError</span> *error) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"请求失败"</span>);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<h2 id="三、AFNetworking3-0"><a href="#三、AFNetworking3-0" class="headerlink" title="三、AFNetworking3.0"></a>三、AFNetworking3.0</h2><p>1.GET 请求</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">AFHTTPSessionManager *sessionManager = [AFHTTPSessionManager manager];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解析服务器返回的JSON数据</span></span><br><span class="line"><span class="comment">//        [AFJSONResponseSerializer serializer];</span></span><br><span class="line"><span class="comment">// 解析服务器返回的XML数据</span></span><br><span class="line"><span class="comment">//        [AFXMLParserResponseSerializer serializer];</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 参数1: 请求的网址</span></span><br><span class="line"><span class="comment">// 参数2: 参数</span></span><br><span class="line"><span class="comment">// 参数3: 当前的进度</span></span><br><span class="line"><span class="comment">// 参数4: 请求成功</span></span><br><span class="line"><span class="comment">// 参数5: 请求失败</span></span><br><span class="line">[sessionManager GET:<span class="string">@" "</span> parameters:<span class="literal">nil</span> progress:^(<span class="built_in">NSProgress</span> * _Nonnull downloadProgress) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"进度"</span>);</span><br><span class="line">&#125; success:^(<span class="built_in">NSURLSessionDataTask</span> * _Nonnull task, <span class="keyword">id</span>  _Nullable responseObject) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"请求成功"</span>);</span><br><span class="line">&#125; failure:^(<span class="built_in">NSURLSessionDataTask</span> * _Nullable task, <span class="built_in">NSError</span> * _Nonnull error) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"请求失败"</span>);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<p>2.POST 请求<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建管理者对象</span></span><br><span class="line">AFHTTPSessionManager *sessionManager = [AFHTTPSessionManager manager];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置请求参数</span></span><br><span class="line"><span class="built_in">NSString</span> *urlStr = <span class="string">@" "</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 需要设置 body 体</span></span><br><span class="line"><span class="built_in">NSDictionary</span> *dic = @&#123;<span class="string">@" "</span> : <span class="string">@" "</span>,<span class="string">@" "</span> : <span class="string">@" "</span>&#125;;</span><br><span class="line"></span><br><span class="line">[sessionManager POST:urlStr parameters:dic progress:^(<span class="built_in">NSProgress</span> * _Nonnull downloadProgress) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"进度"</span>);</span><br><span class="line">&#125; success:^(<span class="built_in">NSURLSessionDataTask</span> * _Nonnull task, <span class="keyword">id</span>  _Nullable responseObject) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"请求成功"</span>);</span><br><span class="line">&#125; failure:^(<span class="built_in">NSURLSessionDataTask</span> * _Nullable task, <span class="built_in">NSError</span> * _Nonnull error) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"请求失败"</span>);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure></p>
<p>上面的一些代码都是基础性代码，因此也没怎么做注释，如果有疑问的话可以私信交流…另外代码有什么问题的话也希望大家能够指出！谢谢大家！</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/15/iOS开发之 - CADisplayLink 实现酷炫动画/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="刘朋坤">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="以梦为马">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/15/iOS开发之 - CADisplayLink 实现酷炫动画/" itemprop="url">
                  iOS开发之 - CADisplayLink 实现酷炫动画
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
                
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-15T12:30:20+08:00">2018-04-15</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>偶然发现了一个好玩的类， CADisplayLink，出于好奇所以就尝试了一下，用 CADisplayLink 做了个类似云飘的效果。由于对 CADisplayLink 的认识还比较浅，如果哪里写的不正确，还请各位大大能够指出来！看效果图先，<del>就是有点丑</del>，😂</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-da509b22ab7071c0.gif?imageMogr2/auto-orient/strip" alt="ning.gif"></p>
<ul>
<li>核心代码如下：</li>
</ul>
<h4 id="一、创建-CADisplayLink，添加事件，绑定-Runloop。"><a href="#一、创建-CADisplayLink，添加事件，绑定-Runloop。" class="headerlink" title="一、创建 CADisplayLink，添加事件，绑定 Runloop。"></a>一、创建 CADisplayLink，添加事件，绑定 Runloop。</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建 CADisplayLink</span></span><br><span class="line">- (<span class="built_in">CADisplayLink</span> *)displayLink &#123;</span><br><span class="line"><span class="keyword">if</span> (!_displayLink) &#123;</span><br><span class="line">_displayLink = [<span class="built_in">CADisplayLink</span> displayLinkWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(makeCloud)];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当把 CADisplayLink 对象添加到 Runloop 中后，selector就能被周期性调用</span></span><br><span class="line">[<span class="keyword">self</span>.displayLink addToRunLoop:[<span class="built_in">NSRunLoop</span> mainRunLoop] forMode:<span class="built_in">NSRunLoopCommonModes</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> _displayLink;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 周期调用的方法</span></span><br><span class="line">- (<span class="keyword">void</span>)makeCloud &#123;</span><br><span class="line"><span class="keyword">self</span>.cloudOffsetX += <span class="keyword">self</span>.cloudSpeed;</span><br><span class="line"></span><br><span class="line">[<span class="keyword">self</span> cloudLayerName:<span class="keyword">self</span>.firstCloudLayer];</span><br><span class="line">[<span class="keyword">self</span> cloudLayerName:<span class="keyword">self</span>.secondCloudLayer];</span><br><span class="line">[<span class="keyword">self</span> cloudLayerName:<span class="keyword">self</span>.thirdCloudLayer];</span><br><span class="line">[<span class="keyword">self</span> cloudLayerName:<span class="keyword">self</span>.fourthCloudLayer];</span><br><span class="line">[<span class="keyword">self</span> cloudLayerName:<span class="keyword">self</span>.fifthCloudLayer];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="二、配置参数，加载图层"><a href="#二、配置参数，加载图层" class="headerlink" title="二、配置参数，加载图层"></a>二、配置参数，加载图层</h4> <figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> <span class="built_in">self</span>.cloudWidth = <span class="built_in">self</span>.frame.size.width;            <span class="comment">// 云彩宽度</span></span><br><span class="line"> <span class="built_in">self</span>.cloudColor = RGBA(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.3</span>);         <span class="comment">// 云彩颜色</span></span><br><span class="line"> <span class="built_in">self</span>.cloudSpeed = <span class="number">0.05</span> / M_PI;                      <span class="comment">// 云彩飘动的速度</span></span><br><span class="line"> <span class="built_in">self</span>.cloudPointY = <span class="number">100</span>;                             <span class="comment">// 云彩Y坐标</span></span><br><span class="line"> <span class="built_in">self</span>.cloudOffsetX = <span class="number">0</span>;                              <span class="comment">// 云彩位移X</span></span><br><span class="line"> <span class="built_in">self</span>.cloudAmplitude = <span class="number">30</span>;                           <span class="comment">// 振幅大小</span></span><br><span class="line"> <span class="built_in">self</span>.cloudCycle =  <span class="number">1.03</span> * M_PI / <span class="built_in">self</span>.cloudWidth;   <span class="comment">// 周期大小</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">// 添加图层</span></span><br><span class="line"> <span class="meta">[</span><span class="built_in">self</span>.layer addSublayer:<span class="built_in">self</span>.firstCloudLayer<span class="meta">]</span>;</span><br><span class="line"> <span class="meta">[</span><span class="built_in">self</span>.layer addSublayer:<span class="built_in">self</span>.secondCloudLayer<span class="meta">]</span>;</span><br><span class="line"> <span class="meta">[</span><span class="built_in">self</span>.layer addSublayer:<span class="built_in">self</span>.thirdCloudLayer<span class="meta">]</span>;</span><br><span class="line"> <span class="meta">[</span><span class="built_in">self</span>.layer addSublayer:<span class="built_in">self</span>.fourthCloudLayer<span class="meta">]</span>;</span><br><span class="line"> <span class="meta">[</span><span class="built_in">self</span>.layer addSublayer:<span class="built_in">self</span>.fifthCloudLayer<span class="meta">]</span>;</span><br></pre></td></tr></table></figure>
<h4 id="三、创建-CAShapeLayer-动画"><a href="#三、创建-CAShapeLayer-动画" class="headerlink" title="三、创建 CAShapeLayer 动画"></a>三、创建 CAShapeLayer 动画</h4> <figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 五个图层动画</span></span><br><span class="line"> - (<span class="keyword">void</span>)cloudLayerName:(<span class="built_in">CAShapeLayer</span> *)cloudLayerName &#123;</span><br><span class="line"> <span class="comment">// 创建一个Path句柄</span></span><br><span class="line"> <span class="built_in">CGMutablePathRef</span> path = <span class="built_in">CGPathCreateMutable</span>();</span><br><span class="line"> <span class="built_in">CGFloat</span> y = <span class="keyword">self</span>.cloudPointY;</span><br><span class="line"> <span class="comment">// 初始化该path到一个初始点</span></span><br><span class="line"> <span class="built_in">CGPathMoveToPoint</span>(path, <span class="literal">nil</span>, <span class="number">0</span>, y);</span><br><span class="line"> <span class="keyword">for</span> (<span class="keyword">float</span> x = <span class="number">0.0</span>f; x &lt;= <span class="keyword">self</span>.cloudWidth; x++) &#123;</span><br><span class="line"> <span class="keyword">if</span> (cloudLayerName == <span class="keyword">self</span>.firstCloudLayer) &#123;</span><br><span class="line"> <span class="comment">// 云彩的 Y 值</span></span><br><span class="line"> y = <span class="keyword">self</span>.cloudAmplitude * sin(<span class="keyword">self</span>.cloudCycle * x + <span class="keyword">self</span>.cloudOffsetX - <span class="number">10</span>) + <span class="keyword">self</span>.cloudPointY + <span class="number">10</span>;</span><br><span class="line"> &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cloudLayerName == <span class="keyword">self</span>.secondCloudLayer) &#123;</span><br><span class="line"> y = (<span class="keyword">self</span>.cloudAmplitude + <span class="number">15</span>) * sin(<span class="keyword">self</span>.cloudCycle * x + <span class="keyword">self</span>.cloudOffsetX ) + <span class="keyword">self</span>.cloudPointY ;</span><br><span class="line"> &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cloudLayerName == <span class="keyword">self</span>.thirdCloudLayer) &#123;</span><br><span class="line"> y = (<span class="keyword">self</span>.cloudAmplitude + <span class="number">30</span>)* sin(<span class="keyword">self</span>.cloudCycle * x + <span class="keyword">self</span>.cloudOffsetX + <span class="number">20</span>) + <span class="keyword">self</span>.cloudPointY + <span class="number">10</span>;</span><br><span class="line"> &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cloudLayerName == <span class="keyword">self</span>.fourthCloudLayer) &#123;</span><br><span class="line"> y = (<span class="keyword">self</span>.cloudAmplitude + <span class="number">20</span>)* sin(<span class="keyword">self</span>.cloudCycle * x + <span class="keyword">self</span>.cloudOffsetX - <span class="number">20</span>) + <span class="keyword">self</span>.cloudPointY - <span class="number">10</span>;</span><br><span class="line"> &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cloudLayerName == <span class="keyword">self</span>.fifthCloudLayer) &#123;</span><br><span class="line"> y = (<span class="keyword">self</span>.cloudAmplitude + <span class="number">10</span>)* sin(<span class="keyword">self</span>.cloudCycle * x + <span class="keyword">self</span>.cloudOffsetX - <span class="number">10</span>) + <span class="keyword">self</span>.cloudPointY + <span class="number">2</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="comment">// 添加一条直线</span></span><br><span class="line"> <span class="built_in">CGPathAddLineToPoint</span>(path, <span class="literal">nil</span>, x, y);</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> <span class="comment">// 添加一条直线</span></span><br><span class="line"> <span class="built_in">CGPathAddLineToPoint</span>(path, <span class="literal">nil</span>, <span class="keyword">self</span>.cloudWidth, <span class="keyword">self</span>.frame.size.height);</span><br><span class="line"> <span class="comment">// 添加一条直线</span></span><br><span class="line"> <span class="built_in">CGPathAddLineToPoint</span>(path, <span class="literal">nil</span>, <span class="number">0</span>, <span class="keyword">self</span>.frame.size.height);</span><br><span class="line"> <span class="comment">// 关闭该path</span></span><br><span class="line"> <span class="built_in">CGPathCloseSubpath</span>(path);</span><br><span class="line"> cloudLayerName.path = path;</span><br><span class="line"> <span class="comment">// 释放该path</span></span><br><span class="line"> <span class="built_in">CGPathRelease</span>(path);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>推荐几篇和 CADisplayLink 相关的深度好文！</p>
</li>
<li><p><a href="https://developer.apple.com/reference/quartzcore/cadisplaylink" target="_blank" rel="noopener">官方文档</a></p>
</li>
<li><a href="https://zsisme.gitbooks.io/ios-/content/chapter11/frame-timing.html" target="_blank" rel="noopener">iOS 核心动画高级技巧</a></li>
<li><a href="http://kittenyang.com/cadisplaylinkanduibezierpath/" target="_blank" rel="noopener">CADisplayLink 结合 UIBezierPath的神奇妙用</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/15/iOS开发之 - DZNEmptyDataSet 空白页占位图/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="刘朋坤">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="以梦为马">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/15/iOS开发之 - DZNEmptyDataSet 空白页占位图/" itemprop="url">
                  iOS开发之 - DZNEmptyDataSet 空白页占位图
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
                
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-15T12:30:20+08:00">2018-04-15</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>发现了一个很有用的第三方，<a href="https://github.com/dzenbot/DZNEmptyDataSet" target="_blank" rel="noopener">DZNEmptyDataSet</a>，用起来也极其方便，这里给大家分享下！先说下其用途：<code>DZNEmptyDataSet</code> 主要用于 <code>UITableView</code> 以及 <code>UICollectionView</code> 页面空白时展示（据说也可以用于 <code>UIScrollView</code>， 有兴趣的童鞋可以试试）。开发中之所以用占位图，是为了提高用户体验；而为什么选 <code>DZNEmptyDataSet</code> 而不自行设计占位图（做过占位图的童鞋应该会觉得做占位图并不难，但没有对比就没有伤害，你如果试用了 <code>DZNEmptyDataSet</code> ，就会顿悟自己做占位图是多么地繁琐）。坦白说，<code>DZNEmptyDataSet</code> 是一个为了让开发人员“变懒”的第三方（貌似每个第三方都是这样的“宗旨”），接下来我们就一起看下 <code>DZNEmptyDataSet</code> 吧！</p>
</blockquote>
<h3 id="一、先来认识一下-DZNEmptyDataSet"><a href="#一、先来认识一下-DZNEmptyDataSet" class="headerlink" title="一、先来认识一下 DZNEmptyDataSet"></a>一、先来认识一下 DZNEmptyDataSet</h3><ul>
<li>GitHub 地址：<a href="https://github.com/dzenbot/DZNEmptyDataSet" target="_blank" rel="noopener">DZNEmptyDataSet</a></li>
<li>DZNEmptyDataSet 效果图</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-a0171c63c0ebeaa1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="DZNEmptyDataSet效果图1"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-9b7b23c881b34deb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="DZNEmptyDataSet效果图2"></p>
<h3 id="二、用-DZNEmptyDataSet-实现占位图效果"><a href="#二、用-DZNEmptyDataSet-实现占位图效果" class="headerlink" title="二、用 DZNEmptyDataSet 实现占位图效果"></a>二、用 DZNEmptyDataSet 实现占位图效果</h3><p>不得不说，其使用方法极其简单，用 cocoapods 导入可以，直接拖进项目也行。。。接着~~~</p>
<ul>
<li>导入头文件</li>
</ul>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#<span class="keyword">import</span> <span class="string">"UIScrollView+EmptyDataSet.h"</span></span><br></pre></td></tr></table></figure>
<ul>
<li>添加代理协议</li>
</ul>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@interface</span> NNViewController ()<span class="variable">&lt;UITableViewDataSource, DZNEmptyDataSetSource, DZNEmptyDataSetDelegate&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>设置代理协议</li>
</ul>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">_tableView = [[UITableView alloc] initWithFrame:CGRectMake(<span class="number">0</span>, <span class="number">0</span>, NNSCREENWIDTH, NNSCREENHEIGHT) style:UITableViewStylePlain];</span><br><span class="line">[<span class="literal">self</span>.view addSubview:<span class="literal">self</span>.<span class="built_in">table</span>View];</span><br><span class="line"></span><br><span class="line"><span class="literal">self</span>.<span class="built_in">table</span>View.dataSource = <span class="literal">self</span>;</span><br><span class="line"><span class="literal">self</span>.<span class="built_in">table</span>View.emptyDataSetSource = <span class="literal">self</span>;</span><br><span class="line"><span class="literal">self</span>.<span class="built_in">table</span>View.emptyDataSetDelegate = <span class="literal">self</span>;</span><br><span class="line"><span class="literal">self</span>.<span class="built_in">table</span>View.<span class="built_in">table</span>FooterView = [[UIView alloc] init];</span><br></pre></td></tr></table></figure>
<ul>
<li>设置空白页展示图片</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#pragma mark - DZNEmptyDataSetSource</span></span><br><span class="line"><span class="comment">// 返回图片</span></span><br><span class="line">- (<span class="built_in">UIImage</span> *)imageForEmptyDataSet:(<span class="built_in">UIScrollView</span> *)scrollView&#123;</span><br><span class="line"><span class="keyword">return</span> [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"Screenshot_Slack"</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>到这里简单的占位图已经做好了，是不是觉得 so 轻松 so easy！下面是效果图：<br><img src="http://upload-images.jianshu.io/upload_images/2665449-ec13c6b78895b11f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="效果图"></p>
<h3 id="三、接下来是-DZNEmptyDataSet-的其它使用方法"><a href="#三、接下来是-DZNEmptyDataSet-的其它使用方法" class="headerlink" title="三、接下来是 DZNEmptyDataSet 的其它使用方法"></a>三、接下来是 DZNEmptyDataSet 的其它使用方法</h3><p>DZNEmptyDataSet 框架扩展性极强，可以在占位图上添加图片、标题文字、详情文字等等一堆东西，总有一款适合你！下边是一些具体用法及效果图。</p>
<h4 id="3-1-添加标题文字"><a href="#3-1-添加标题文字" class="headerlink" title="3.1 添加标题文字"></a>3.1 添加标题文字</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回标题文字</span></span><br><span class="line">- (<span class="built_in">NSAttributedString</span> *)titleForEmptyDataSet:(<span class="built_in">UIScrollView</span> *)scrollView &#123;</span><br><span class="line"><span class="built_in">NSString</span> *text = <span class="string">@"这是一张空白页"</span>;</span><br><span class="line"><span class="built_in">NSDictionary</span> *attribute = @&#123;<span class="built_in">NSFontAttributeName</span>: [<span class="built_in">UIFont</span> boldSystemFontOfSize:<span class="number">18.0</span>f], <span class="built_in">NSForegroundColorAttributeName</span>: [<span class="built_in">UIColor</span> darkGrayColor]&#125;;</span><br><span class="line"><span class="keyword">return</span> [[<span class="built_in">NSAttributedString</span> alloc] initWithString:text attributes:attribute];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-8d76ca82b929405b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="返回标题文字"></p>
<h4 id="3-2-添加详情文字"><a href="#3-2-添加详情文字" class="headerlink" title="3.2 添加详情文字"></a>3.2 添加详情文字</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回详情文字</span></span><br><span class="line">- (<span class="built_in">NSAttributedString</span> *)descriptionForEmptyDataSet:(<span class="built_in">UIScrollView</span> *)scrollView &#123; <span class="built_in">NSString</span> *text = <span class="string">@"哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈"</span>;</span><br><span class="line"><span class="built_in">NSMutableParagraphStyle</span> *paragraph = [<span class="built_in">NSMutableParagraphStyle</span> new];</span><br><span class="line">paragraph.lineBreakMode = <span class="built_in">NSLineBreakByWordWrapping</span>;</span><br><span class="line">paragraph.alignment = <span class="built_in">NSTextAlignmentCenter</span>;</span><br><span class="line"><span class="built_in">NSDictionary</span> *attribute = @&#123;<span class="built_in">NSFontAttributeName</span>: [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">14.0</span>f], <span class="built_in">NSForegroundColorAttributeName</span>: [<span class="built_in">UIColor</span> lightGrayColor], <span class="built_in">NSParagraphStyleAttributeName</span>: paragraph&#125;;</span><br><span class="line"><span class="keyword">return</span> [[<span class="built_in">NSAttributedString</span> alloc] initWithString:text attributes:attribute];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-f0154c472bfe6c61.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="详情文字"></p>
<h4 id="3-3-添加可以点击的按钮-上面带文字"><a href="#3-3-添加可以点击的按钮-上面带文字" class="headerlink" title="3.3 添加可以点击的按钮 上面带文字"></a>3.3 添加可以点击的按钮 上面带文字</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回可以点击的按钮 上面带文字</span></span><br><span class="line">- (<span class="built_in">NSAttributedString</span> *)buttonTitleForEmptyDataSet:(<span class="built_in">UIScrollView</span> *)scrollView forState:(<span class="built_in">UIControlState</span>)state &#123;</span><br><span class="line"><span class="built_in">NSDictionary</span> *attribute = @&#123;<span class="built_in">NSFontAttributeName</span>: [<span class="built_in">UIFont</span> boldSystemFontOfSize:<span class="number">17.0</span>f]&#125;;</span><br><span class="line"><span class="keyword">return</span> [[<span class="built_in">NSAttributedString</span> alloc] initWithString:<span class="string">@"哈喽"</span> attributes:attribute];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//#pragma mark - DZNEmptyDataSetDelegate</span></span><br><span class="line"><span class="comment">// 处理按钮的点击事件</span></span><br><span class="line">- (<span class="keyword">void</span>)emptyDataSet:(<span class="built_in">UIScrollView</span> *)scrollView didTapButton:(<span class="built_in">UIButton</span> *)button &#123;</span><br><span class="line"><span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"https://www.baidu.com"</span>]];</span><br><span class="line"><span class="keyword">if</span> ([[<span class="built_in">UIApplication</span> sharedApplication] canOpenURL:url]) &#123;</span><br><span class="line">[[<span class="built_in">UIApplication</span> sharedApplication] openURL:url];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-d2ae69bb76fd8299.gif?imageMogr2/auto-orient/strip" alt="可以点击的按钮"></p>
<h4 id="3-4-空白区域点击事件"><a href="#3-4-空白区域点击事件" class="headerlink" title="3.4 空白区域点击事件"></a>3.4 空白区域点击事件</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 空白区域点击事件</span></span><br><span class="line">- (<span class="keyword">void</span>)<span class="string">emptyDataSet:</span>(UIScrollView *)scrollView <span class="string">didTapView:</span>(UIView *)view &#123;</span><br><span class="line">UIAlertView *alert = [[UIAlertView alloc] <span class="string">initWithTitle:</span>@<span class="string">"哈哈"</span> <span class="string">message:</span>@<span class="string">"最近咋样"</span> <span class="string">delegate:</span>nil <span class="string">cancelButtonTitle:</span>@<span class="string">"别点我"</span> <span class="string">otherButtonTitles:</span>@<span class="string">"点我干啥"</span>, nil];</span><br><span class="line">[alert show];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-bc977dd868779f9a.gif?imageMogr2/auto-orient/strip" alt="空白区域点击事件"></p>
<h4 id="3-5-改变标题文字与详情文字的距离"><a href="#3-5-改变标题文字与详情文字的距离" class="headerlink" title="3.5 改变标题文字与详情文字的距离"></a>3.5 改变标题文字与详情文字的距离</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 标题文字与详情文字的距离</span></span><br><span class="line">- (<span class="built_in">CGFloat</span>)spaceHeightForEmptyDataSet:(<span class="built_in">UIScrollView</span> *)scrollView &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">100</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-c7e36364da637b6a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="标题文字与详情文字的距离"></p>
<h4 id="3-6-空白区域的颜色自定义"><a href="#3-6-空白区域的颜色自定义" class="headerlink" title="3.6 空白区域的颜色自定义"></a>3.6 空白区域的颜色自定义</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回空白区域的颜色自定义</span></span><br><span class="line">- (<span class="built_in">UIColor</span> *)backgroundColorForEmptyDataSet:(<span class="built_in">UIScrollView</span> *)scrollView &#123;</span><br><span class="line"><span class="keyword">return</span> [<span class="built_in">UIColor</span> cyanColor];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-e6e70559dd5033fc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="空白区域的颜色自定义"></p>
<h4 id="3-7-标题文字与详情文字同时调整垂直偏移量"><a href="#3-7-标题文字与详情文字同时调整垂直偏移量" class="headerlink" title="3.7 标题文字与详情文字同时调整垂直偏移量"></a>3.7 标题文字与详情文字同时调整垂直偏移量</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 标题文字与详情文字同时调整垂直偏移量</span></span><br><span class="line">- (<span class="built_in">CGFloat</span>)verticalOffsetForEmptyDataSet:(<span class="built_in">UIScrollView</span> *)scrollView &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">-100</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-659f044350373024.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="标题文字与详情文字同时调整垂直偏移量"></p>
<h4 id="3-8-添加动画效果"><a href="#3-8-添加动画效果" class="headerlink" title="3.8 添加动画效果"></a>3.8 添加动画效果</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#pragma mark - DZNEmptyDataSetSource</span></span><br><span class="line"><span class="comment">// 返回图片</span></span><br><span class="line">- (<span class="built_in">UIImage</span> *)imageForEmptyDataSet:(<span class="built_in">UIScrollView</span> *)scrollView&#123;</span><br><span class="line"><span class="keyword">return</span> [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"icon_wwdc"</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">CAAnimation</span> *)imageAnimationForEmptyDataSet:(<span class="built_in">UIScrollView</span> *)scrollView &#123;</span><br><span class="line"><span class="built_in">CABasicAnimation</span> *animation = [<span class="built_in">CABasicAnimation</span> animationWithKeyPath: <span class="string">@"transform"</span>];</span><br><span class="line">animation.fromValue = [<span class="built_in">NSValue</span> valueWithCATransform3D:<span class="built_in">CATransform3DIdentity</span>];</span><br><span class="line">animation.toValue = [<span class="built_in">NSValue</span> valueWithCATransform3D:<span class="built_in">CATransform3DMakeRotation</span>(M_PI_2, <span class="number">0.0</span>, <span class="number">0.0</span>,   <span class="number">1.0</span>)];</span><br><span class="line">animation.duration = <span class="number">0.25</span>;</span><br><span class="line">animation.cumulative = <span class="literal">YES</span>;</span><br><span class="line">animation.repeatCount = MAXFLOAT;</span><br><span class="line"><span class="keyword">return</span> animation;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - DZNEmptyDataSetDelegate</span></span><br><span class="line"><span class="comment">// 图片是否要动画效果，默认NO</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)emptyDataSetShouldAnimateImageView:(<span class="built_in">UIScrollView</span> *)scrollView &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-8a61fbb540b61cfa.gif?imageMogr2/auto-orient/strip" alt="动画效果"></p>
<h4 id="3-9-其它方法"><a href="#3-9-其它方法" class="headerlink" title="3.9 其它方法"></a>3.9 其它方法</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#pragma mark - DZNEmptyDataSetSource</span></span><br><span class="line"><span class="comment">// 返回图片的 tintColor</span></span><br><span class="line">- (<span class="built_in">UIColor</span> *)imageTintColorForEmptyDataSet:(<span class="built_in">UIScrollView</span> *)scrollView &#123;</span><br><span class="line"><span class="keyword">return</span> [<span class="built_in">UIColor</span> yellowColor];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回可点击按钮的 image</span></span><br><span class="line">- (<span class="built_in">UIImage</span> *)buttonImageForEmptyDataSet:(<span class="built_in">UIScrollView</span> *)scrollView forState:(<span class="built_in">UIControlState</span>)state &#123;</span><br><span class="line"><span class="keyword">return</span> [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"icon_wwdc"</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回可点击按钮的 backgroundImage</span></span><br><span class="line">- (<span class="built_in">UIImage</span> *)buttonBackgroundImageForEmptyDataSet:(<span class="built_in">UIScrollView</span> *)scrollView forState:(<span class="built_in">UIControlState</span>)state &#123;</span><br><span class="line"><span class="keyword">return</span> [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"icon_wwdc"</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回自定义 view</span></span><br><span class="line">- (<span class="built_in">UIView</span> *)customViewForEmptyDataSet:(<span class="built_in">UIScrollView</span> *)scrollView &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - DZNEmptyDataSetDelegate</span></span><br><span class="line"><span class="comment">// 是否显示空白页，默认YES</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)emptyDataSetShouldDisplay:(<span class="built_in">UIScrollView</span> *)scrollView &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 是否允许点击，默认YES</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)emptyDataSetShouldAllowTouch:(<span class="built_in">UIScrollView</span> *)scrollView &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 是否允许滚动，默认NO</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)emptyDataSetShouldAllowScroll:(<span class="built_in">UIScrollView</span> *)scrollView &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 图片是否要动画效果，默认NO</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)emptyDataSetShouldAnimateImageView:(<span class="built_in">UIScrollView</span> *)scrollView &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 空白页将要出现</span></span><br><span class="line">- (<span class="keyword">void</span>)emptyDataSetWillAppear:(<span class="built_in">UIScrollView</span> *)scrollView &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 空白页已经出现</span></span><br><span class="line">- (<span class="keyword">void</span>)emptyDataSetDidAppear:(<span class="built_in">UIScrollView</span> *)scrollView &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 空白页将要消失</span></span><br><span class="line">- (<span class="keyword">void</span>)emptyDataSetWillDisappear:(<span class="built_in">UIScrollView</span> *)scrollView &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 空白页已经消失</span></span><br><span class="line">- (<span class="keyword">void</span>)emptyDataSetDidDisappear:(<span class="built_in">UIScrollView</span> *)scrollView &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>——————华丽的分割线——————</p>
<p>小结：本小白只在 UITableView 上试用了 DZNEmptyDataSet 框架。。。公司要求年前再迭代一个版本，时间不太充裕因此没逐一去试。。。哪位大神如果试了 UICollectionView 或 UIScrollView 发现有问题，还请不吝赐教！</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/15/iOS开发之 - MD5加密/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="刘朋坤">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="以梦为马">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/15/iOS开发之 - MD5加密/" itemprop="url">
                  iOS开发之 - MD5加密
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
                
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-15T12:30:20+08:00">2018-04-15</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>MD5（消息摘要算法第五版）是计算机安全领域广泛使用的一种散列函数，用以提供消息的完整性保护。</p>
</blockquote>
<ul>
<li><p>MD5特点：<br>1、压缩性：任意长度的数据，算出的MD5值长度都是固定的。<br>2、容易计算：从原数据计算出MD5值很容易。<br>3、抗修改性：对原数据进行任何改动，哪怕只修改1个字节，所得到的MD5值都有很大区别。<br>4、强抗碰撞：已知原数据和其MD5值，想找到一个具有相同MD5值的数据（即伪造数据）是非常困难的。</p>
</li>
<li><p>事先介绍一个概念，因为下边有用到👇<br>加盐：所谓加盐， 就是在原本需要加密的信息基础上，糅入其它内容salt。</p>
</li>
<li><p>接下来是一些代码的实现，方便起见，这里创建了一个分类NSString+MD5。</p>
</li>
</ul>
<p>分类 NSString+MD5.h 中的代码如下：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NSString</span> (<span class="title">MD5</span>)</span></span><br><span class="line"><span class="comment">/** 直接加密 */</span></span><br><span class="line">- (<span class="built_in">NSString</span> *)MD5_32BIT;</span><br><span class="line"><span class="comment">/** 加盐 */</span></span><br><span class="line">- (<span class="built_in">NSString</span> *)MD5_saltStr:(<span class="built_in">NSString</span> *)saltStr;</span><br><span class="line"><span class="comment">/** 多次加密 */</span></span><br><span class="line">- (<span class="built_in">NSString</span> *)MD5_againStr:(<span class="built_in">NSString</span> *)againStr;</span><br><span class="line"><span class="comment">/** 乱序加密 */</span></span><br><span class="line">- (<span class="built_in">NSString</span> *)MD5_Chaos:(<span class="built_in">NSString</span> *)chaosStr;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>这里是分类 NSString+MD5.m 中的代码，需要导入头文件 #import &lt;CommonCrypto/CommonDigest.h&gt;：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"NSString+MD5.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;CommonCrypto/CommonDigest.h&gt;</span></span></span><br><span class="line"><span class="meta">#define salt @<span class="meta-string">"qwertyuiop"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">NSString</span> (<span class="title">MD5</span>)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 直接加密</span></span><br><span class="line">- (<span class="built_in">NSString</span> *)MD5_32BIT &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *cStr = [<span class="keyword">self</span> UTF8String];</span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> digest[CC_MD5_DIGEST_LENGTH];</span><br><span class="line"></span><br><span class="line">CC_MD5( cStr, (CC_LONG)<span class="keyword">self</span>.length, digest );</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSMutableString</span> *result = [<span class="built_in">NSMutableString</span> stringWithCapacity:CC_MD5_DIGEST_LENGTH * <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; CC_MD5_DIGEST_LENGTH; i++)</span><br><span class="line">[result appendFormat:<span class="string">@"%02X"</span>, digest[i]];</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加盐</span></span><br><span class="line">- (<span class="built_in">NSString</span> *)MD5_saltStr:(<span class="built_in">NSString</span> *)saltStr &#123;</span><br><span class="line"></span><br><span class="line">saltStr = [saltStr stringByAppendingString:salt];</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSString</span> *result =[saltStr MD5_32BIT];</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 多次加密</span></span><br><span class="line">- (<span class="built_in">NSString</span> *)MD5_againStr:(<span class="built_in">NSString</span> *)againStr &#123;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSString</span> *result = [againStr MD5_32BIT];</span><br><span class="line"></span><br><span class="line">result = [result MD5_32BIT];</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 乱序加密</span></span><br><span class="line">- (<span class="built_in">NSString</span> *)MD5_Chaos:(<span class="built_in">NSString</span> *)chaosStr &#123;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSString</span> *result =[chaosStr MD5_32BIT];</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSString</span> *header =[result substringFromIndex:<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSString</span> *footer=[result substringFromIndex:<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">result =[footer stringByAppendingString:header];</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>接着在控制器中调用：<br><figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#<span class="keyword">import</span> <span class="string">"ViewController.h"</span></span><br><span class="line">#<span class="keyword">import</span> <span class="string">"NSString+MD5.h"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@implementation</span> ViewController</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">[<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"></span><br><span class="line">NSString *<span class="built_in">string</span> = @<span class="string">"10.24"</span>;</span><br><span class="line"><span class="comment">// 调用 MD5 加密并打印结果</span></span><br><span class="line">NSLog(@<span class="string">"MD5Result = %@"</span>, [<span class="built_in">string</span> MD5_32BIT]);</span><br><span class="line">NSLog(@<span class="string">"MD5_saltResult = %@"</span>, [<span class="built_in">string</span> MD5_saltStr:<span class="built_in">string</span>]);</span><br><span class="line">NSLog(@<span class="string">"MD5_againResult = %@"</span>, [<span class="built_in">string</span> MD5_againStr:<span class="built_in">string</span>]);</span><br><span class="line">NSLog(@<span class="string">"chaosResult = %@"</span>, [<span class="built_in">string</span> MD5_Chaos:<span class="built_in">string</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这里是打印结果：<br><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2016-10-26</span> <span class="number">08</span>:<span class="number">15:49.616</span> md<span class="number">5[92278</span>:<span class="number">6185546</span>] MD5Result = F7F942B87C2D0B62FC27AD465CF0D05B</span><br><span class="line"><span class="number">2016-10-26</span> <span class="number">08</span>:<span class="number">15:49.616</span> md<span class="number">5[92278</span>:<span class="number">6185546</span>] MD5_saltResult = <span class="number">1</span>C2140C07ADD1E334896D499E8C4968C</span><br><span class="line"><span class="number">2016-10-26</span> <span class="number">08</span>:<span class="number">15:49.617</span> md<span class="number">5[92278</span>:<span class="number">6185546</span>] MD5_againResult = <span class="number">01</span>AE5309B5A8E672AE4D427FE987E06A</span><br><span class="line"><span class="number">2016-10-26</span> <span class="number">08</span>:<span class="number">15:49.617</span> md<span class="number">5[92278</span>:<span class="number">6185546</span>] chaosResult = F942B87C2D0B62FC27AD465CF0D05BF942B87C2D0B62FC27AD465CF0D05B</span><br></pre></td></tr></table></figure></p>
<hr>
<p>总结：大家应该都知道有一个MD5破解网站，名字叫做 <a href="http://www.cmd5.com" target="_blank" rel="noopener">md5在线解密加密</a>，因此我们在使用MD5加密的时候，最好使用多次加密，加盐，乱序加密等，不然会很容易被破解。至于其它加密，等以后用到了会继续整理出来，如果文章有什么不足之处，还请朋友们能过指出来，谢谢大家！</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/15/iOS开发之 - RunLoop/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="刘朋坤">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="以梦为马">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/15/iOS开发之 - RunLoop/" itemprop="url">
                  iOS开发之 - RunLoop
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
                
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-15T12:30:20+08:00">2018-04-15</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="http://upload-images.jianshu.io/upload_images/2665449-4d7042ab55fbe301.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="RunLoop"></p>
<blockquote>
<p>以下是 RunLoop 相关的内容，前半部分是理论知识，后半部分是代码。。。</p>
</blockquote>
<h2 id="一、RunLoop-基础知识"><a href="#一、RunLoop-基础知识" class="headerlink" title="一、RunLoop 基础知识"></a>一、RunLoop 基础知识</h2><h3 id="1-1-RunLoop-简介"><a href="#1-1-RunLoop-简介" class="headerlink" title="1.1 RunLoop  简介"></a>1.1 RunLoop  简介</h3><p>一般来说，一个线程只能执行一个任务，执行完就会退出，如果我们需要一种机制，让线程能随时处理时间但并不退出，那么 RunLoop 就是这样的一个机制。Runloop是事件接收和分发机制的一个实现。所以它实际上是一个对象，这个对象管理了其需要处理的事件和消息。在iOS 系统中，有这样两个对象： NSRunLoop 和 CFRunLoopRef。 NSRunLoop 和 CFRunLoopRef都代表着 RunLoop 对象。</p>
<h3 id="1-2-RunLoop的基本作用"><a href="#1-2-RunLoop的基本作用" class="headerlink" title="1.2 RunLoop的基本作用"></a>1.2 RunLoop的基本作用</h3><p>(1)保持程序的持续运行；<br>(2)处理 App 中的各种事件(比如触摸事件、定时器事件、Selector 事件)；<br>(3)节省 CPU 资源, 提高程序性能。</p>
<h3 id="1-3-RunLoop的使用环境"><a href="#1-3-RunLoop的使用环境" class="headerlink" title="1.3 RunLoop的使用环境"></a>1.3 RunLoop的使用环境</h3><p>仅当在为你的程序创建辅助线程的时候，你才需要显示运行 RunLoop 。对于辅助线程，你需要判断一个 RunLoop 是否是必须的。如果是必须的，那么你要自己配置并启动它，你不需要再任何情况下都去启动一个线程的 RunLoop 。 RunLoop 在你要和线程有更多的交互时才需要，比如以下情况：<br>(1)使用端口或者自定义输入源来和其他线程通信；<br>(2)使用线程的定时器；<br>(3) Cocoa 中使用任何 performSelector 的方法；<br>(4)使线程周期性工作。</p>
<h3 id="1-4-RunLoop工作的特点"><a href="#1-4-RunLoop工作的特点" class="headerlink" title="1.4 RunLoop工作的特点:"></a>1.4 RunLoop工作的特点:</h3><p>(1)当有时间发生时, RunLoop 会根据具体的事件类型通知应用程序作出响应；<br>(2)当没有事件发生时, RunLoop 会进入休眠状态；<br>(3)当事件再次发生时, RunLoop 会被重新唤醒, 处理事件。</p>
<h3 id="1-5-runLoop的内部逻辑"><a href="#1-5-runLoop的内部逻辑" class="headerlink" title="1.5 runLoop的内部逻辑"></a>1.5 runLoop的内部逻辑</h3><p>runLoop其实是一个函数，其内部是一个 do-while 循环，当你调用CFRunLoop() 时，线程就会一直停留在这个循环中；直到超时或被手动停止，该函数才会返回。每次运行 runLoop，线程的 runLoop 会自动处理之前未处理的消息，并通知相关的观察者，具体的顺序如下：<br>(1)通知观察者 runLoop 已经启动；<br>(2)通知观察者处理将要开始的定时器；<br>(3)通知观察者处理即将启动的非基于端口的源；<br>(4)处理非基于端口的源；<br>(5)如果基于端口的源准备好并处于等待状态，立即启动进入步骤⑨；<br>(6)通知观察者线程即将进入休眠；<br>(7)线程处于休眠状态，直到下面的任意的一个事件发生：<br>A.某一时间到达基于端口的源；<br>B.定时器启动；<br>C.runLoop被外部手动唤醒；<br>(8)通知观察者线程刚被唤醒；<br>(9)处理接收到的事件，处理定时器并重启 runLoop，进入步骤2；<br>(10)通知观察者，即将退出 runLoop。</p>
<h3 id="1-6-RunLoop与线程的关系"><a href="#1-6-RunLoop与线程的关系" class="headerlink" title="1.6 RunLoop与线程的关系"></a>1.6 RunLoop与线程的关系</h3><p>(1)每条线程都有唯一的一个与之对应的 RunLoop 对象；<br>(2)主线程的 RunLoop 已经自动创建好了, 子线程的 RunLoop 需要手动创建；<br>(3) RunLoop在第一次获取时创建, 在线程结束时销毁；<br>(4)直线线程与圆形线程：直线线程执行的任务是一条直线；而圆形线程不断循环，直到通过某种方式截止，在 iOS 中，圆形线程就是通过 runLoop 实现的。</p>
<h3 id="1-7-RunLoop对象"><a href="#1-7-RunLoop对象" class="headerlink" title="1.7 RunLoop对象"></a>1.7 RunLoop对象</h3><p>(1) iOS中有2套 API 来访问和使用 RunLoop。<br>Foundation框架 : NSRunLoop；<br>Core Foundation框架: CFRunLoopRef。</p>
<p>(2) NSRunLoop 和 CFRunLoopRef 都代表着 RunLoop 对象 ,它们是等价的，可以互相转换；</p>
<p>(3) NSRunLoop 是基于 CFRunLoopRef 的一层 OC 包装，所以要了解 RunLoop 内部结构，需要多研究 CFRunLoopRef 层面的 API（Core Foundation层面）。</p>
<h3 id="1-8获得-RunLoop-对象"><a href="#1-8获得-RunLoop-对象" class="headerlink" title="1.8获得 RunLoop 对象"></a>1.8获得 RunLoop 对象</h3><p>苹果不允许直接创建RunLoop，它只提供了两个自动获取的函数。<br>(1) Foundation [NSRunLoop currentRunLoop]; //获得当前线程的 RunLoop 对象<br>[NSRunLoop mainRunLoop]; //获得主线程的 RunLoop 对象</p>
<p>(2) Core Foundation<br>CFRunLoopGetCurrent(); //获得当前线程的 RunLoop 对象<br>CFRunLoopGetMain(); //获得主线程的 RunLoop 对象</p>
<h3 id="1-9-相关类"><a href="#1-9-相关类" class="headerlink" title="1.9 相关类:"></a>1.9 相关类:</h3><p>Core Foundation中关于 RunLoop 的 5 个类 ,RunLoop 如果没有这些东西, 会直接退出。<br>(1) CFRunLoopRef<br>(2) CFRunLoopModeRef 该类并没有对外暴露；<br>(3) CFRunLoopSourceRef<br>(4) CFRunLoopTimerRef<br>(5) CFRunLoopObserverRef</p>
<h3 id="1-10-CFRunLoopSourceRef-事件源-输入源"><a href="#1-10-CFRunLoopSourceRef-事件源-输入源" class="headerlink" title="1.10 CFRunLoopSourceRef 事件源(输入源)"></a>1.10 CFRunLoopSourceRef 事件源(输入源)</h3><p>时间产生的地方，source 有两个版本：<br>(1) source0：只包含一个回调，它并不能主动触发事件，使用时，需先调用 CFRunLoopSourceSignal 将这个 source 标记为待处理，后调用 CFRunLoopWakeUp 来唤醒 runLoop，让其处理这个事件；<br>(2) source1：包含一个 mach_port 和一个回调，被用于通过内核和其他线程互发送消息，这种 source 能主动唤醒 runLoop 线程。</p>
<h3 id="1-11-CFRunLoopObserverRef"><a href="#1-11-CFRunLoopObserverRef" class="headerlink" title="1.11 CFRunLoopObserverRef"></a>1.11 CFRunLoopObserverRef</h3><p>CFRunLoopObserverRef是观察者,能够监听 RunLoop 的状态改变,当 RunLoop 的状态发生变化时，观察者就能通过回调接受到这个变化。可以观测的时间点有以下几个：</p>
<p>kCFRunLoopEntry = (1UL &lt;&lt; 0), // 即将进入 Loop</p>
<p>kCFRunLoopBeforeTimers = (1UL &lt;&lt; 1), //即将处理 Timer</p>
<p>kCFRunLoopBeforeSources = (1UL &lt;&lt; 2), //即将处理 Source</p>
<p>kCFRunLoopBeforeWaiting = (1UL &lt;&lt; 5), //即将进入休眠</p>
<p>kCFRunLoopAfterWaiting = (1UL &lt;&lt; 6), //刚从休眠中唤醒</p>
<p>kCFRunLoopExit = (1UL &lt;&lt; 7), //即将退出 Loop</p>
<h3 id="1-12-runLoop的模式"><a href="#1-12-runLoop的模式" class="headerlink" title="1.12 runLoop的模式"></a>1.12 runLoop的模式</h3><p>runLoop 中使用 mode 来指定时间在运行循环中的优先级，系统默认注册了 5 个Mode：<br>(1)NSDefaultRunLoopMode（kCFRunLoopDefaultMode）:默认Mode,通常主线程是在这个Mode下运行；</p>
<p>(2) UITrackingRunLoopMode:界面跟踪Mode,用于 ScrollView 追踪触摸滑动, 保证界面滑动时不受其他 Mode 影响；</p>
<p>(3) UIInitializationRunLoopMode:启动程序后的过渡 mode，启动完成后就不再使用；</p>
<p>(4) GSEventReceiveRunLoopMode:接受系统事件的内部 Mode,通常用不到；</p>
<p>(5)kCFRunLoopCommonModes（NSRunLoopCommonModes）: 这是一个占位用的 Mode ，作为标记 DefaultMode 和CommonMode 用。</p>
<h2 id="二、演示代码"><a href="#二、演示代码" class="headerlink" title="二、演示代码"></a>二、演示代码</h2><h3 id="演示代码一-常驻线程"><a href="#演示代码一-常驻线程" class="headerlink" title="演示代码一:常驻线程"></a>演示代码一:常驻线程</h3><p>控制器.m中的代码:<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">[<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"><span class="keyword">self</span>.thread = [[NNThread alloc] initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(run) object:<span class="literal">nil</span>];</span><br><span class="line">[<span class="keyword">self</span>.thread start];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark -常驻线程方式一</span></span><br><span class="line">- (<span class="keyword">void</span>)run &#123;</span><br><span class="line"><span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line"></span><br><span class="line">[[<span class="built_in">NSRunLoop</span> currentRunLoop] addPort:[<span class="built_in">NSPort</span> port] forMode:<span class="built_in">NSDefaultRunLoopMode</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"-- run -- %@ --"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">[[<span class="built_in">NSRunLoop</span> currentRunLoop] run];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"--不会执行--"</span>); <span class="comment">// 不会执行</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark -常驻线程方式二</span></span><br><span class="line">- (<span class="keyword">void</span>)run1&#123;</span><br><span class="line"><span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">[[<span class="built_in">NSRunLoop</span> currentRunLoop] run];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"-- run1 -- %@ --"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark -常驻线程方式三</span></span><br><span class="line">- (<span class="keyword">void</span>)run2&#123;</span><br><span class="line"><span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">[<span class="built_in">NSTimer</span> scheduledTimerWithTimeInterval:<span class="number">2.0</span> target:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(test) userInfo:<span class="literal">nil</span> repeats:<span class="literal">YES</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"-- run2 -- %@ --"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">[[<span class="built_in">NSRunLoop</span> currentRunLoop] run];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark -在该线程中自定义事件</span></span><br><span class="line">- (<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event&#123;</span><br><span class="line">[<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(test) onThread:<span class="keyword">self</span>.thread withObject:<span class="literal">nil</span> waitUntilDone:<span class="literal">NO</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)test &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"-- test -- %@ --"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>线程子类化:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">"NNThread.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">NNThread</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark -重写了 dealloc 方法,查看线程是否销毁</span></span><br><span class="line">- (<span class="keyword">void</span>)dealloc &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"线程 NNThread 被销毁"</span>); <span class="comment">// 不会打印</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="演示代码二-GCD-定时器"><a href="#演示代码二-GCD-定时器" class="headerlink" title="演示代码二: GCD 定时器:"></a>演示代码二: GCD 定时器:</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#pragma mark - GCD 的 timer</span></span><br><span class="line">- (<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span> *)touches withEvent:(<span class="built_in">UIEvent</span> *)event</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//获得队列</span></span><br><span class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_get_main_queue();</span><br><span class="line"><span class="comment">//创建一个定时器 (dispatch_source_t 本质还是个 OC 对象)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">self</span>.timer =dispatch_source_create(DISPATCH_SOURCE_TYPE_TIMER, <span class="number">0</span>, <span class="number">0</span>, queue);</span><br><span class="line"><span class="comment">// GCD的时间参数，一般是纳秒（1秒== 10的9次方纳秒）</span></span><br><span class="line">dispatch_time_t start = dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">1.0</span> * <span class="built_in">NSEC_PER_SEC</span>));</span><br><span class="line">uint64_t interval = (uint64_t)(<span class="number">1.0</span> * <span class="built_in">NSEC_PER_SEC</span>);</span><br><span class="line">dispatch_source_set_timer(<span class="keyword">self</span>.timer, start, interval, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置回调</span></span><br><span class="line">dispatch_source_set_event_handler(<span class="keyword">self</span>.timer, ^&#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"------ %@ ------"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">count++;</span><br><span class="line"><span class="keyword">if</span> (count == <span class="number">10</span>) &#123;</span><br><span class="line"><span class="comment">//取消定时器</span></span><br><span class="line">dispatch_cancel(<span class="keyword">self</span>.timer);</span><br><span class="line"><span class="keyword">self</span>.timer = <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//启动定时器</span></span><br><span class="line">dispatch_resume(<span class="keyword">self</span>.timer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="演示代码三-观察者"><a href="#演示代码三-观察者" class="headerlink" title="演示代码三:观察者"></a>演示代码三:观察者</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#pragma mark -观察者</span></span><br><span class="line">-(<span class="keyword">void</span>)observerTest&#123;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">CFRunLoopObserverRef是观察者, 能够监听 RunLoop 的状态改变,当 RunLoop 的状态发生变化时，观察者就能通过回调接受到这个变化。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">CFRunLoopObserverRef参数:</span></span><br><span class="line"><span class="comment">第一个参数:分配存储空间</span></span><br><span class="line"><span class="comment">第二个参数:监听状态</span></span><br><span class="line"><span class="comment">第三个参数:是否要持续监听</span></span><br><span class="line"><span class="comment">第四个参数:优先级</span></span><br><span class="line"><span class="comment">第五个参数:回调</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//创建observer</span></span><br><span class="line"><span class="built_in">CFRunLoopObserverRef</span> observer = <span class="built_in">CFRunLoopObserverCreateWithHandler</span>(<span class="built_in">CFAllocatorGetDefault</span>(), kCFRunLoopAllActivities, <span class="literal">YES</span>, <span class="number">0</span>, ^(<span class="built_in">CFRunLoopObserverRef</span> observer, <span class="built_in">CFRunLoopActivity</span> activity) &#123;</span><br><span class="line"><span class="keyword">switch</span> (activity) &#123;</span><br><span class="line"><span class="keyword">case</span> kCFRunLoopEntry:</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"即将进入runloop"</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> kCFRunLoopBeforeTimers:</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"RunLoop即将处理 timer"</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> kCFRunLoopBeforeSources:</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"RunLoop即将处理Sources"</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> kCFRunLoopBeforeWaiting:</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"RunLoop即将进入休眠"</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> kCFRunLoopAfterWaiting:</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"RunLoop刚从休眠中唤醒"</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> kCFRunLoopExit:</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"即将退出RunLoop "</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">RunLoop的模式</span></span><br><span class="line"><span class="comment">1.NSDefaultRunLoopMode（kCFRunLoopDefaultMode）:默认Mode,通常主线程是在这个Mode下运行</span></span><br><span class="line"><span class="comment">2.UITrackingRunLoopMode:界面跟踪 Mode, 用于 ScrollView 追踪触摸滑动, 保证界面滑动时不受其他 Mode 影响</span></span><br><span class="line"><span class="comment">3.UIInitializationRunLoopMode:启动程序后的过渡 mode，启动完成后就不再使用</span></span><br><span class="line"><span class="comment">4.GSEventReceiveRunLoopMode:接受系统事件的内部 Mode,通常用不到</span></span><br><span class="line"><span class="comment">5.kCFRunLoopCommonModes（NSRunLoopCommonModes）: 这是一个占位用的 Mode, 作为标记 DefaultMode 和 CommonMode 用</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">CFRunLoopAddObserver参数:</span></span><br><span class="line"><span class="comment">第一个参数:要监听哪个RunLoop</span></span><br><span class="line"><span class="comment">第二个参数:监听者</span></span><br><span class="line"><span class="comment">第三个参数:要监听RunLoop在哪种运行模式下的状态</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加观察者：监听RunLoop的状态</span></span><br><span class="line"><span class="built_in">CFRunLoopAddObserver</span>(<span class="built_in">CFRunLoopGetCurrent</span>(), observer, kCFRunLoopDefaultMode);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 释放  Observer</span></span><br><span class="line"><span class="built_in">CFRelease</span>(observer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)timerTest</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//调用了 scheduledTimer 返回的定时器，已经自动被添加到当前 RunLoop 中，默认是 NSDefaultRunLoopMode</span></span><br><span class="line"><span class="built_in">NSTimer</span> *timer = [<span class="built_in">NSTimer</span> scheduledTimerWithTimeInterval:<span class="number">2.0</span> target:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(run) userInfo:<span class="literal">nil</span> repeats:<span class="literal">YES</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//修改模式</span></span><br><span class="line">[[<span class="built_in">NSRunLoop</span> currentRunLoop] addTimer:timer forMode:<span class="built_in">NSRunLoopCommonModes</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>end</em></p>
<hr>
<p><strong>结束语：RunLoop 的总结就到此为止了，以后如果想到或遇到新知识点，会再来补充！另外如果文章写的有什么错误，烦请各位能指出来！谢谢大家！</strong></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">刘朋坤</p>
              <p class="site-description motion-element" itemprop="description">iOS 修炼中...</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives">
                
                    <span class="site-state-item-count">44</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              

              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">刘朋坤</span>

  

  
</div>




  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Muse</a> v6.1.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.1.0"></script>



  



	





  





  










  





  

  

  

  

  
  

  

  

  

  

</body>
</html>
