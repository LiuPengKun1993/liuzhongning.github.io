<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.1.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.1.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.1.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.1.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.1.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.1.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="iOS 修炼中...">
<meta property="og:type" content="website">
<meta property="og:title" content="以梦为马">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="以梦为马">
<meta property="og:description" content="iOS 修炼中...">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="以梦为马">
<meta name="twitter:description" content="iOS 修炼中...">






  <link rel="canonical" href="http://yoursite.com/page/3/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>以梦为马</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">以梦为马</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">谨以此纪念岁月</p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>




<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-主页">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />主页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-归档">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/15/iOS开发之 - Runtime/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="刘朋坤">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="以梦为马">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/15/iOS开发之 - Runtime/" itemprop="url">
                  iOS开发之 - Runtime
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
                
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-15T12:30:20+08:00">2018-04-15</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="http://upload-images.jianshu.io/upload_images/2665449-59759f8fb21bb6a9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="iOS开发之 - Runtime"></p>
<blockquote>
<p>想总结 Runtime 不是一天两天了，前几天利用空闲时间已经打好文稿，但觉得还有需要改进的地方，现在已经改过来了，这里贴出来与大家分享下（如果还有什么小问题，还望各位朋友指出来哈）! 下面我们就开始进入运行时 Runtime 的世界吧！</p>
</blockquote>
<h2 id="一、Runtime简介"><a href="#一、Runtime简介" class="headerlink" title="一、Runtime简介"></a>一、Runtime简介</h2><p>Runtime简称运行时，是系统在运行的时候的一些机制，其中最主要的是消息机制。它是一套比较底层的纯 C 语言 API, 属于一个 C 语言库，包含了很多底层的 C 语言 API。我们平时编写的 OC 代码，在程序运行过程时，其实最终都是转成了 Runtime 的 C 语言代码。如下所示:</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// OC代码:</span></span><br><span class="line"><span class="selector-attr">[Person coding]</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//运行时 runtime 会将它转化成 C 语言的代码:</span></span><br><span class="line"><span class="selector-tag">objc_msgSend</span>(Person, <span class="variable">@selector</span>(coding));</span><br></pre></td></tr></table></figure>
<h2 id="二、相关函数"><a href="#二、相关函数" class="headerlink" title="二、相关函数"></a>二、相关函数</h2><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 遍历某个类所有的成员变量</span></span><br><span class="line"><span class="keyword">class</span><span class="number">_</span>copyIvarList</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍历某个类所有的方法</span></span><br><span class="line"><span class="keyword">class</span><span class="number">_</span>copyMethodList</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取指定名称的成员变量</span></span><br><span class="line"><span class="keyword">class</span><span class="number">_</span>getInstanceVariable</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取成员变量名</span></span><br><span class="line">ivar<span class="number">_</span>getName</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取成员变量类型编码</span></span><br><span class="line">ivar<span class="number">_</span>getTypeEncoding</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取某个对象成员变量的值</span></span><br><span class="line"><span class="keyword">object</span><span class="number">_</span>getIvar</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置某个对象成员变量的值</span></span><br><span class="line"><span class="keyword">object</span><span class="number">_</span>setIvar</span><br><span class="line"></span><br><span class="line"><span class="comment">// 给对象发送消息</span></span><br><span class="line">objc<span class="number">_m</span>sgSend</span><br></pre></td></tr></table></figure>
<h2 id="三、相关应用"><a href="#三、相关应用" class="headerlink" title="三、相关应用"></a>三、相关应用</h2><ul>
<li>1.利用Runtime遍历模型对象的所有属性</li>
<li>2.归档与解档</li>
<li>3.字典模型互转(利用 Runtime 遍历模型对象的所有属性, 根据属性名从字典中取出对的值,设置到模型的属性上)</li>
<li>4.动态添加/修改属性、动态添加/修改/替换方法(修改Person的身高体重等；替换 coding 方法为 eating 等)</li>
</ul>
<h2 id="四、演示代码"><a href="#四、演示代码" class="headerlink" title="四、演示代码"></a>四、演示代码</h2><h3 id="演示代码一：遍历对象的属性"><a href="#演示代码一：遍历对象的属性" class="headerlink" title="演示代码一：遍历对象的属性"></a>演示代码一：遍历对象的属性</h3><p>新建一个Person类，继承自NSObject，在.h文件中设置它的属性如下</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NNPerson</span> : <span class="title">NSObject</span> </span>&#123;</span><br><span class="line"><span class="built_in">NSString</span> * _str1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> <span class="built_in">NSString</span> * str2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *str3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSDictionary</span> * dict;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSArray</span> *ary;</span><br></pre></td></tr></table></figure>
<p>在 ViewController 中获取它的属性，代码如下</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;objc/runtime.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"NNPerson.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">[<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取 NNModel 中所有的变量并且输出变量名及类型</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">Ivar * ivars = class_copyIvarList([NNPerson <span class="keyword">class</span>], &amp;count);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">unsigned</span> <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i ++) &#123;</span><br><span class="line">Ivar ivar = ivars[i];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"类型: %s -名字: %s "</span>, ivar_getTypeEncoding(ivar), ivar_getName(ivar));</span><br><span class="line">&#125;</span><br><span class="line">free(ivars);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="演示代码二：归档解档"><a href="#演示代码二：归档解档" class="headerlink" title="演示代码二：归档解档"></a>演示代码二：归档解档</h3><p>新建一个类，继承自 NSObject 。.m中的代码如下：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#pragma mark -归档</span></span><br><span class="line">- (<span class="keyword">void</span>)encodeWithCoder:(<span class="built_in">NSCoder</span> *)aCoder &#123;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//获取类中所有属性</span></span><br><span class="line">Ivar *vars = class_copyIvarList([<span class="keyword">self</span> <span class="keyword">class</span>], &amp;count);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">unsigned</span> <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i ++) &#123;</span><br><span class="line">Ivar var = vars[i];</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *name = ivar_getName(var);</span><br><span class="line"><span class="built_in">NSString</span> *key = [<span class="built_in">NSString</span> stringWithUTF8String:name];</span><br><span class="line"><span class="comment">//利用 KVC 进行取值，根据属性名称获取对应的值</span></span><br><span class="line"><span class="keyword">id</span> value = [<span class="keyword">self</span> valueForKey:key];</span><br><span class="line">[aCoder encodeObject:value forKey:key];</span><br><span class="line">&#125;</span><br><span class="line">free(vars);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark -解档</span></span><br><span class="line">- (<span class="keyword">nullable</span> <span class="keyword">instancetype</span>)initWithCoder:(<span class="built_in">NSCoder</span> *)aDecoder &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//获取类中所有属性</span></span><br><span class="line">Ivar *vars = class_copyIvarList([<span class="keyword">self</span> <span class="keyword">class</span>], &amp;count);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">unsigned</span> <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i ++) &#123;</span><br><span class="line">Ivar var = vars[i];</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *name = ivar_getName(var);</span><br><span class="line"><span class="built_in">NSString</span> *key = [<span class="built_in">NSString</span> stringWithUTF8String:name];</span><br><span class="line"></span><br><span class="line"><span class="comment">//进行解档取值</span></span><br><span class="line"><span class="keyword">id</span> value = [aDecoder decodeObjectForKey:key];</span><br><span class="line"></span><br><span class="line"><span class="comment">//利用 KVC 对属性赋值</span></span><br><span class="line">[<span class="keyword">self</span> setValue:value forKey:key];</span><br><span class="line">&#125;</span><br><span class="line">free(vars);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ViewController中的代码：<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">[<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">LZNArchive *archive = [LZNArchive objectWithKeyValues:<span class="keyword">self</span>.Mydictionary];</span><br><span class="line"><span class="built_in">NSString</span> *path = <span class="built_in">NSSearchPathForDirectoriesInDomains</span>(<span class="built_in">NSDocumentDirectory</span>, <span class="built_in">NSUserDomainMask</span>, <span class="literal">YES</span>).lastObject;</span><br><span class="line">path = [path stringByAppendingPathComponent:<span class="string">@"hello"</span>];</span><br><span class="line">[<span class="built_in">NSKeyedArchiver</span> archiveRootObject:archive toFile:path];</span><br><span class="line">LZNArchive *m = [<span class="built_in">NSKeyedUnarchiver</span> unarchiveObjectWithFile:path];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="演示代码三：字典与模型互转"><a href="#演示代码三：字典与模型互转" class="headerlink" title="演示代码三：字典与模型互转"></a>演示代码三：字典与模型互转</h3><p>首先应导入一个 plist 文件，将文件中的内容读取到字典中；然后新建一个分类如: NSObject+KeyValues<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#pragma mark -字典转模型</span></span><br><span class="line"></span><br><span class="line">+(<span class="keyword">instancetype</span>)objectWithDict:(<span class="built_in">NSDictionary</span> *)dict &#123;</span><br><span class="line"><span class="keyword">id</span> objc = [[<span class="keyword">self</span> alloc] init];</span><br><span class="line"></span><br><span class="line"><span class="comment">//遍历字典中的属性</span></span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSString</span> *key <span class="keyword">in</span> dict.allKeys) &#123;</span><br><span class="line"><span class="keyword">id</span> value = dict[key];</span><br><span class="line">objc_property_t property = class_getProperty(<span class="keyword">self</span>, key.UTF8String);</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">objc_property_attribute_t *attributeList = property_copyAttributeList(property, &amp;count);</span><br><span class="line">objc_property_attribute_t attribute = attributeList[<span class="number">0</span>];</span><br><span class="line"><span class="built_in">NSString</span> *string = [<span class="built_in">NSString</span> stringWithUTF8String:attribute.value];</span><br><span class="line"><span class="keyword">if</span> ([string isEqualToString:<span class="string">@"@\"LZNArchive\""</span>]) &#123;</span><br><span class="line">value = [<span class="keyword">self</span> objectWithDict:value];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//生成 setter 方法，并用 objc_msgSend 调用</span></span><br><span class="line"><span class="built_in">NSString</span> *methodName = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"set%@%@:"</span>,[key substringToIndex:<span class="number">1</span>].uppercaseString,[key substringFromIndex:<span class="number">1</span>]];</span><br><span class="line">SEL <span class="keyword">setter</span> = sel_registerName(methodName.UTF8String);</span><br><span class="line"><span class="keyword">if</span> ([objc respondsToSelector:<span class="keyword">setter</span>]) &#123;</span><br><span class="line">((<span class="keyword">void</span> (*) (<span class="keyword">id</span>,SEL,<span class="keyword">id</span>)) objc_msgSend) (objc,<span class="keyword">setter</span>,value);</span><br><span class="line">&#125;</span><br><span class="line">free(attributeList);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> objc;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark -模型转字典</span></span><br><span class="line">-(<span class="built_in">NSDictionary</span> *)keyValuesWithObject &#123;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">objc_property_t *propertyList = class_copyPropertyList([<span class="keyword">self</span> <span class="keyword">class</span>], &amp;count);</span><br><span class="line"><span class="built_in">NSMutableDictionary</span> *dict = [<span class="built_in">NSMutableDictionary</span> dictionary];</span><br><span class="line"></span><br><span class="line"><span class="comment">//遍历模型中属性</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i ++) &#123;</span><br><span class="line">objc_property_t property = propertyList[i];</span><br><span class="line"></span><br><span class="line"><span class="comment">//生成 getter 方法，并用 objc_msgSend 调用</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *propertyName = property_getName(property);</span><br><span class="line">SEL <span class="keyword">getter</span> = sel_registerName(propertyName);</span><br><span class="line"><span class="keyword">if</span> ([<span class="keyword">self</span> respondsToSelector:<span class="keyword">getter</span>]) &#123;</span><br><span class="line"><span class="keyword">id</span> value = ((<span class="keyword">id</span> (*) (<span class="keyword">id</span>,SEL)) objc_msgSend) (<span class="keyword">self</span>,<span class="keyword">getter</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//判断当前属性</span></span><br><span class="line"><span class="keyword">if</span> ([value isKindOfClass:[<span class="keyword">self</span> <span class="keyword">class</span>]] &amp;&amp; value) &#123;</span><br><span class="line">value = [value keyValuesWithObject];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (value) &#123;</span><br><span class="line"><span class="built_in">NSString</span> *key = [<span class="built_in">NSString</span> stringWithUTF8String:propertyName];</span><br><span class="line">[dict setObject:value forKey:key];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">free(propertyList);</span><br><span class="line"><span class="keyword">return</span> dict;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="演示代码四：objc-msgSend-消息传递"><a href="#演示代码四：objc-msgSend-消息传递" class="headerlink" title="演示代码四：objc_msgSend 消息传递"></a>演示代码四：objc_msgSend 消息传递</h3><p>新建一个类，继承自NSObject，.m中的代码如下:<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)sayHello &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"Hello!"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(<span class="keyword">void</span>)showName:(<span class="built_in">NSString</span> *)name &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"My name is %@"</span>,name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(<span class="keyword">void</span>)showAge:(<span class="built_in">NSInteger</span>)age &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"My age is %ld"</span>, age);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(<span class="keyword">float</span>)showHeight&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">180.0</span>f;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(<span class="built_in">NSString</span> *)showInformation &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">@"Nice to meet you!"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ViewController中的代码:<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">LZN_msgSend *msgSend = [[LZN_msgSend alloc] init];</span><br><span class="line">((<span class="keyword">void</span> (*) (<span class="keyword">id</span>, SEL)) objc_msgSend) (msgSend, sel_registerName(<span class="string">"sayHello"</span>));</span><br><span class="line"></span><br><span class="line">((<span class="keyword">void</span> (*) (<span class="keyword">id</span>, SEL, <span class="built_in">NSString</span> *)) objc_msgSend) (msgSend, sel_registerName(<span class="string">"showName:"</span>), <span class="string">@"Liu Zhong Ning"</span>);</span><br><span class="line"></span><br><span class="line">((<span class="keyword">void</span> (*) (<span class="keyword">id</span>, SEL, <span class="built_in">NSInteger</span>)) objc_msgSend) (msgSend, sel_registerName(<span class="string">"showAge:"</span>), <span class="number">23</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">float</span> f = ((<span class="keyword">float</span> (*) (<span class="keyword">id</span>, SEL)) objc_msgSend_fpret) (msgSend, sel_registerName(<span class="string">"showHeight"</span>));</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"and height is %.2fcm"</span>,f);</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSString</span> *information = ((<span class="built_in">NSString</span>* (*) (<span class="keyword">id</span>, SEL)) objc_msgSend) (msgSend, sel_registerName(<span class="string">"showInformation"</span>));</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,information);</span><br></pre></td></tr></table></figure></p>
<p><em>the end</em></p>
<hr>
<p><strong>结束语：Runtime 相关的知识就整理了这么些，希望对看到的朋友们有用！另外如果 demo 有什么问题，还烦请大家告知，一起进步！谢谢O(∩_∩)O~! 另祝大家周末愉快哈！</strong></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/15/iOS开发之 - SDWebImage 的使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="刘朋坤">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="以梦为马">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/15/iOS开发之 - SDWebImage 的使用/" itemprop="url">
                  iOS开发之 - SDWebImage 的使用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
                
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-15T12:30:20+08:00">2018-04-15</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="http://upload-images.jianshu.io/upload_images/2665449-6e9f0fccaeeca1e8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="SDWebImage"></p>
<blockquote>
<p><a href="https://github.com/rs/SDWebImage" target="_blank" rel="noopener">SDWebImage</a> 是一个开源的第三方库，在我们 iOS 开发中用到 SDWebImage 的地方有很多，比如在 tableView 中，在 collectionView 中……不然它也不会高达 16000+ 这么多的 Star 了😄。下面是总结的一些 SDWebImage 相关的具体用法。</p>
</blockquote>
<p>首先用 cocoapods 导入 SDWebImage 框架，网上有很多安装以及使用 cocoapods 的教程，在此就不累述了，这篇文章的内容是在导入 SDWebImage 基础之上的，主要是总结了一些 SDWebImage 的具体用法。</p>
<ul>
<li><p>简单下载图片</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">方式一：</span><br><span class="line"><span class="comment">// 只下载图片</span></span><br><span class="line">[self.imageView <span class="string">sd_setImageWithURL:</span>@<span class="string">"URL地址"</span>]];</span><br><span class="line"></span><br><span class="line">方式二：</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">第一个参数:图片的url</span></span><br><span class="line"><span class="comment">第二个参数:占位图片</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">[self.imageView <span class="string">sd_setImageWithURL:</span>[NSURL <span class="string">URLWithString:</span>@<span class="string">"URL地址"</span>]</span><br><span class="line"><span class="string">placeholderImage:</span>[UIImage <span class="string">imageNamed:</span> @<span class="string">"占位图片名"</span>]];</span><br></pre></td></tr></table></figure>
</li>
<li><p>下载成功或失败之后做的事情</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">方式一：</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">第一个参数:图片的url</span></span><br><span class="line"><span class="comment">block:下载成功或失败之后的回调</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">[<span class="keyword">self</span>.imageView sd_setImageWithURL:[<span class="built_in">NSURL</span> URLWithString:<span class="string">@"URL地址"</span>]</span><br><span class="line">completed:^(<span class="built_in">UIImage</span> *image, <span class="built_in">NSError</span> *error, SDImageCacheType cacheType, <span class="built_in">NSURL</span> *imageURL) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"下载成功或失败之后的回调"</span>);</span><br><span class="line">&#125;];</span><br><span class="line">方式二：</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">第一个参数:图片的url</span></span><br><span class="line"><span class="comment">第二个参数:占位图片</span></span><br><span class="line"><span class="comment">block:下载成功或失败之后的回调</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">[<span class="keyword">self</span>.imageView sd_setImageWithURL:[<span class="built_in">NSURL</span> URLWithString:<span class="string">@"URL地址"</span>]</span><br><span class="line">placeholderImage:[<span class="built_in">UIImage</span> imageNamed: <span class="string">@"占位图片名"</span>]</span><br><span class="line">completed:^(<span class="built_in">UIImage</span> *image, <span class="built_in">NSError</span> *error, SDImageCacheType cacheType, <span class="built_in">NSURL</span> *imageURL) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"下载成功或失败之后的回调"</span>);</span><br><span class="line">&#125;];</span><br><span class="line">方式三：</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">第一个参数:图片的url</span></span><br><span class="line"><span class="comment">第二个参数:占位图片</span></span><br><span class="line"><span class="comment">第三个参数:下载图片的策略</span></span><br><span class="line"><span class="comment">第四个参数:progress进度</span></span><br><span class="line"><span class="comment">第五个参数:completed 下载完成之后的回调</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">[<span class="keyword">self</span>.imageView sd_setImageWithURL:[<span class="built_in">NSURL</span> URLWithString:<span class="string">@"URL地址"</span>]</span><br><span class="line">placeholderImage:[<span class="built_in">UIImage</span> imageNamed: <span class="string">@"占位图片名"</span>]</span><br><span class="line">options:SDWebImageRetryFailed</span><br><span class="line">progress:^(<span class="built_in">NSInteger</span> receivedSize, <span class="built_in">NSInteger</span> expectedSize) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"progress进度"</span>);</span><br><span class="line">&#125;</span><br><span class="line">completed:^(<span class="built_in">UIImage</span> *image, <span class="built_in">NSError</span> *error, SDImageCacheType cacheType, <span class="built_in">NSURL</span> *imageURL) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"下载成功或失败之后的回调"</span>);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
</li>
<li><p>借用一个方法简单的介绍一下 options 中的选项</p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"><span class="comment">//失败后重试</span></span><br><span class="line">SDWebImageRetryFailed = <span class="number">1</span> &lt;&lt; <span class="number">0</span>,</span><br><span class="line"><span class="comment">//UI交互期间开始下载，导致延迟下载比如UIScrollView减速。</span></span><br><span class="line">SDWebImageLowPriority = <span class="number">1</span> &lt;&lt; <span class="number">1</span>,</span><br><span class="line"><span class="comment">//只进行内存缓存</span></span><br><span class="line">SDWebImageCacheMemoryOnly = <span class="number">1</span> &lt;&lt; <span class="number">2</span>,</span><br><span class="line"><span class="comment">//这个标志可以渐进式下载,显示的图像是逐步在下载</span></span><br><span class="line">SDWebImageProgressiveDownload = <span class="number">1</span> &lt;&lt; <span class="number">3</span>,</span><br><span class="line"><span class="comment">//刷新缓存</span></span><br><span class="line">SDWebImageRefreshCached = <span class="number">1</span> &lt;&lt; <span class="number">4</span>,</span><br><span class="line"><span class="comment">//后台下载</span></span><br><span class="line">SDWebImageContinueInBackground = <span class="number">1</span> &lt;&lt; <span class="number">5</span>,</span><br><span class="line"><span class="comment">//NSMutableURLRequest.HTTPShouldHandleCookies = YES;</span></span><br><span class="line">SDWebImageHandleCookies = <span class="number">1</span> &lt;&lt; <span class="number">6</span>,</span><br><span class="line"><span class="comment">//允许使用无效的SSL证书</span></span><br><span class="line"><span class="comment">//SDWebImageAllowInvalidSSLCertificates = 1 &lt;&lt; 7,</span></span><br><span class="line"><span class="comment">//优先下载</span></span><br><span class="line">SDWebImageHighPriority = <span class="number">1</span> &lt;&lt; <span class="number">8</span>,</span><br><span class="line"><span class="comment">//延迟占位符</span></span><br><span class="line">SDWebImageDelayPlaceholder = <span class="number">1</span> &lt;&lt; <span class="number">9</span>,</span><br><span class="line"><span class="comment">//改变动画形象</span></span><br><span class="line">SDWebImageTransformAnimatedImage = <span class="number">1</span> &lt;&lt; <span class="number">10</span>,</span><br><span class="line">*/</span><br><span class="line">[self.imageView sd_setImageWithURL:[NSURL URLWithString:@<span class="string">"URL地址"</span>]</span><br><span class="line">placeholderImage:[UIImage imageNamed: @<span class="string">"占位图片名"</span>]</span><br><span class="line">options:SDWebImageRetryFailed];</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用 SDWebImageManager 下载图片</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">SDWebImageManager *imageManager = [SDWebImageManager sharedManager];</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">第一个参数:图片的url</span></span><br><span class="line"><span class="comment">第二个参数:下载图片的(策略)</span></span><br><span class="line"><span class="comment">第三个参数:progress进度</span></span><br><span class="line"><span class="comment">第四个参数:completed 下载完成之后的回调</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">[imageManager downloadImageWithURL:[<span class="built_in">NSURL</span> URLWithString:<span class="string">@"URL地址"</span>]</span><br><span class="line">options:SDWebImageRetryFailed</span><br><span class="line">progress:^(<span class="built_in">NSInteger</span> receivedSize, <span class="built_in">NSInteger</span> expectedSize) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"progress进度"</span>);</span><br><span class="line">&#125;</span><br><span class="line">completed:^(<span class="built_in">UIImage</span> *image, <span class="built_in">NSError</span> *error, SDImageCacheType cacheType, <span class="built_in">BOOL</span> finished, <span class="built_in">NSURL</span> *imageURL) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"下载成功或失败之后的回调"</span>);</span><br><span class="line"><span class="keyword">if</span> (image) &#123;</span><br><span class="line"><span class="keyword">self</span>.image = image;</span><br><span class="line">&#125;</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用 SDWebImageDownloader 下载图片</p>
</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">SDWebImageDownloader *imageDownloader = [SDWebImageDownloader sharedDownloader];</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">第一个参数:图片的url</span></span><br><span class="line"><span class="comment">第二个参数:下载图片的策略</span></span><br><span class="line"><span class="comment">第三个参数:progressBlock 进度</span></span><br><span class="line"><span class="comment">第四个参数:completedBlock 下载完成之后的回调</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">[imageDownloader downloadImageWithURL:[<span class="built_in">NSURL</span> URLWithString:<span class="string">@"URL地址"</span>]</span><br><span class="line">options:SDWebImageDownloaderLowPriority</span><br><span class="line">progress:^(<span class="built_in">NSInteger</span> receivedSize, <span class="built_in">NSInteger</span> expectedSize) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"progress进度"</span>);</span><br><span class="line">&#125;</span><br><span class="line">completed:^(<span class="built_in">UIImage</span> *image, <span class="built_in">NSData</span> *data, <span class="built_in">NSError</span> *error, <span class="built_in">BOOL</span> finished) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"下载成功或失败之后的回调"</span>);</span><br><span class="line"><span class="keyword">if</span> (image) &#123;</span><br><span class="line"><span class="keyword">self</span>.image = image;</span><br><span class="line">&#125;</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<ul>
<li>内存警告时调用</li>
</ul>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 当程序收到内存警告时会调用这个方法</span></span><br><span class="line">- (<span class="keyword">void</span>)didReceiveMemoryWarning &#123;</span><br><span class="line">[<span class="meta">super didReceiveMemoryWarning</span>];</span><br><span class="line"><span class="comment">// 清除缓存</span></span><br><span class="line">[<span class="meta">[SDWebImageManager sharedManager</span>].imageCache clearDisk]; <span class="comment">// clean:删除过期缓存</span></span><br><span class="line">[<span class="meta">[SDWebImageManager sharedManager</span>].imageCache cleanDisk]; <span class="comment">// clear:直接删除然后重新创建</span></span><br><span class="line"><span class="comment">// 取消下载</span></span><br><span class="line">[<span class="meta">[SDWebImageManager sharedManager</span>] cancelAll];</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>其它一些很有用的方法</li>
</ul>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 取消掉当前所有的下载</span></span><br><span class="line"><span class="selector-tag">-</span> (void)<span class="selector-tag">cancelAll</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 检查是否有图片在下载</span></span><br><span class="line"><span class="selector-tag">-</span> (BOOL)<span class="selector-tag">isRunning</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将图片存入cache的方法</span></span><br><span class="line"><span class="selector-tag">-</span> (void)<span class="selector-tag">saveImageToCache</span><span class="selector-pseudo">:(UIImage</span> *)<span class="selector-tag">image</span> <span class="selector-tag">forURL</span><span class="selector-pseudo">:(NSURL</span> *)<span class="selector-tag">url</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过图片的url判断其是否已经存在</span></span><br><span class="line"><span class="selector-tag">-</span> (BOOL)<span class="selector-tag">cachedImageExistsForURL</span><span class="selector-pseudo">:(NSURL</span> *)<span class="selector-tag">url</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 检测一个image是否已经被缓存到磁盘(是否存且仅存在disk里).</span></span><br><span class="line"><span class="selector-tag">-</span> (BOOL)<span class="selector-tag">diskImageExistsForURL</span><span class="selector-pseudo">:(NSURL</span> *)<span class="selector-tag">url</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果检测到图片已经被缓存,那么执行回调block</span></span><br><span class="line"><span class="selector-tag">-</span> (void)<span class="selector-tag">cachedImageExistsForURL</span><span class="selector-pseudo">:(NSURL</span> *)<span class="selector-tag">url</span></span><br><span class="line"><span class="selector-tag">completion</span><span class="selector-pseudo">:(SDWebImageCheckCacheCompletionBlock)completionBlock</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果检测到图片已经在磁盘中,那么执行回调block</span></span><br><span class="line"><span class="selector-tag">-</span> (void)<span class="selector-tag">diskImageExistsForURL</span><span class="selector-pseudo">:(NSURL</span> *)<span class="selector-tag">url</span></span><br><span class="line"><span class="selector-tag">completion</span><span class="selector-pseudo">:(SDWebImageCheckCacheCompletionBlock)completionBlock</span>;</span><br></pre></td></tr></table></figure>
<p>以上是关于 SDWebImage 的一些用法总结，以后再用到其它的了，会再来补充。另外如果有写错的地方，欢迎朋友们指正！谢谢😊！</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/15/ 前端笔记 - Webstorm常用快捷键/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="刘朋坤">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="以梦为马">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/15/ 前端笔记 - Webstorm常用快捷键/" itemprop="url">
                  前端笔记 - Webstorm常用快捷键
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
                
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-15T12:30:20+08:00">2018-04-15</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>需要做一些前端的东西，……朋友推荐了 Webstorm 编辑器，据说很不错，在开始码代码之前，想着如果要提高效率，那掌握一些常用的快捷键应该是少不了的，于是就查了一下，整理出来。用的是 Mac 系统，而在 Windows 系统上，command 即 Ctrl。</p>
</blockquote>
<h3 id="一、必备快捷键"><a href="#一、必备快捷键" class="headerlink" title="一、必备快捷键"></a>一、必备快捷键</h3><ul>
<li>command+/：注释当前行</li>
<li>command+Shift+/：当前位置插入注释</li>
<li>command+Alt+/：块注释，并Focus到首行，写注释说明用的</li>
<li>command+Shift+A：选择当前标签前后，修改标签用的</li>
<li>F11：全屏</li>
<li>Shift+F11：全屏免打扰模式，只编辑当前文件</li>
<li>Alt+F3：选择所有相同的词</li>
<li>Alt+.：闭合标签</li>
<li>Alt+Shift+数字：分屏显示</li>
<li>Alt+数字：切换打开第N个文件</li>
<li>Shift+右键拖动：光标多不，用来更改或插入列内容</li>
<li>鼠标的前进后退键可切换Tab文件</li>
<li>按 command，依次点击或选取，可需要编辑的多个位置</li>
<li>按 command+Shift+上下键，可替换行</li>
<li>command+Shift+P：打开命令面板</li>
<li>command+P：搜索项目中的文件</li>
<li>command+G：跳转到第几行</li>
<li>command+W：关闭当前打开文件</li>
<li>command+Shift+W：关闭所有打开文件</li>
<li>command+Shift+V：粘贴并格式化</li>
<li>command+D：选择单词，重复可增加选择下一个相同的单词</li>
<li>command+L：选择行，重复可依次增加选择下一行</li>
<li>command+Shift+L：选择多行</li>
<li>command+Shift+Enter：在当前行前插入新行</li>
<li>command+X：删除当前行</li>
<li>command+M：跳转到对应括号</li>
<li>command+U：软撤销，撤销光标位置</li>
<li>command+J：选择标签内容</li>
<li>command+F：查找内容</li>
<li>command+Shift+F：查找并替换</li>
<li>command+H：替换</li>
<li>command+R：前往 method</li>
<li>command+N：新建窗口</li>
<li>command+K+B：开关侧栏</li>
<li>command+Shift+M：选中当前括号内容，重复可选着括号本身</li>
<li>command+F2：设置/删除标记</li>
</ul>
<h3 id="二、选择类快捷键"><a href="#二、选择类快捷键" class="headerlink" title="二、选择类快捷键"></a>二、选择类快捷键</h3><ul>
<li>command+← 向左单位性地移动光标，快速移动光标。</li>
<li>command+→ 向右单位性地移动光标，快速移动光标。</li>
<li>shift+↑ 向上选中多行。</li>
<li>shift+↓ 向下选中多行。</li>
<li>Shift+← 向左选中文本。</li>
<li>Shift+→ 向右选中文本。</li>
<li>command+Shift+← 向左单位性地选中文本。</li>
<li>command+Shift+→ 向右单位性地选中文本。</li>
<li>command+Shift+↑ 将光标所在行和上一行代码互换（将光标所在行插入到上一行之前）。</li>
<li>command+Shift+↓ 将光标所在行和下一行代码互换（将光标所在行插入到下一行之后）。</li>
<li>command+Alt+↑ 向上添加多行光标，可同时编辑多行。</li>
<li>command+Alt+↓ 向下添加多行光标，可同时编辑多行。</li>
<li>command+D 选中光标所占的文本，继续操作则会选中下一个相同的文本。</li>
<li>Alt+F3 选中文本按下快捷键，即可一次性选择全部的相同文本进行同时编辑。举个栗子：快速选中并更改所有相同的变量名、函数名等。</li>
<li>command+L 选中整行，继续操作则继续选择下一行，效果和 Shift+↓ 效果一样。</li>
<li>command+Shift+L 先选中多行，再按下快捷键，会在每行行尾插入光标，即可同时编辑这些行。</li>
<li>command+Shift+M 选择括号内的内容（继续选择父括号）。举个栗子：快速选中删除函数中的代码，重写函数体代码或重写括号内里的内容。</li>
<li>command+M 光标移动至括号内结束或开始的位置。</li>
<li>command+Enter 在下一行插入新行。举个栗子：即使光标不在行尾，也能快速向下插入一行。</li>
<li>command+Shift+Enter 在上一行插入新行。举个栗子：即使光标不在行首，也能快速向上插入一行。</li>
<li>command+Shift+[ 选中代码，按下快捷键，折叠代码。</li>
<li>command+Shift+] 选中代码，按下快捷键，展开代码。</li>
<li>command+K+0 展开所有折叠代码。</li>
</ul>
<h3 id="三、编辑类快捷键"><a href="#三、编辑类快捷键" class="headerlink" title="三、编辑类快捷键"></a>三、编辑类快捷键</h3><ul>
<li>command+K+K 从光标处开始删除代码至行尾。</li>
<li>command+Shift+K 删除整行。</li>
<li>command+/ 注释单行。</li>
<li>command+Shift+/ 注释多行。</li>
<li>command+J 合并选中的多行代码为一行。举个栗子：将多行格式的CSS属性合并为一行。</li>
<li>command+Shift+D 复制光标所在整行，插入到下一行。</li>
<li>Tab 向右缩进。</li>
<li>Shift+Tab 向左缩进。</li>
<li>command+K+U 转换大写。</li>
<li>command+K+L 转换小写。</li>
<li>command+Z 撤销。</li>
<li>command+Y 恢复撤销。</li>
<li>command+U 软撤销，感觉和 Gtrl+Z 一样。</li>
<li>command+F2 设置书签</li>
<li>command+T 左右字母互换。</li>
<li>F6 单词检测拼写</li>
</ul>
<h3 id="四、搜索类快捷键"><a href="#四、搜索类快捷键" class="headerlink" title="四、搜索类快捷键"></a>四、搜索类快捷键</h3><ul>
<li>command+F 打开底部搜索框，查找关键字。</li>
<li>command+shift+F 在文件夹内查找，与普通编辑器不同的地方是sublime允许添加多个文件夹进行查找，略高端，未研究。</li>
<li>command+P 打开搜索框。举个栗子：1、输入当前项目中的文件名，快速搜索文件，2、输入@和关键字，查找文件中函数名，3、输入：和数字，跳转到文件中该行代码，4、输入#和关键字，查找变量名。</li>
<li>command+G 打开搜索框，自动带：，输入数字跳转到该行代码。举个栗子：在页面代码比较长的文件中快速定位。</li>
<li>command+R 打开搜索框，自动带@，输入关键字，查找文件中的函数名。举个栗子：在函数较多的页面快速查找某个函数。</li>
<li>command+： 打开搜索框，自动带#，输入关键字，查找文件中的变量名、属性名等。</li>
<li>command+Shift+P 打开命令框。场景栗子：打开命名框，输入关键字，调用sublime text或插件的功能，例如使用package安装插件。</li>
<li>Esc 退出光标多行选择，退出搜索框，命令框等。</li>
</ul>
<h3 id="五、显示类快捷键"><a href="#五、显示类快捷键" class="headerlink" title="五、显示类快捷键"></a>五、显示类快捷键</h3><ul>
<li>Alt+Shift+1 窗口分屏，恢复默认1屏（非小键盘的数字）</li>
<li>Alt+Shift+2 左右分屏-2列</li>
<li>Alt+Shift+3 左右分屏-3列</li>
<li>Alt+Shift+4 左右分屏-4列</li>
<li>Alt+Shift+5 等分4屏</li>
<li>Alt+Shift+8 垂直分屏-2屏</li>
<li>Alt+Shift+9 垂直分屏-3屏</li>
<li>Ctrl+K+B 开启/关闭侧边栏。</li>
<li>F11 全屏模式</li>
<li>Shift+F11 免打扰模式</li>
<li>command+Tab 按文件浏览过的顺序，切换当前窗口的标签页。</li>
<li>command+PageDown 向左切换当前窗口的标签页。</li>
<li>command+PageUp 向右切换当前窗口的标签页。</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/15/iOS开发之 - 二维码/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="刘朋坤">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="以梦为马">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/15/iOS开发之 - 二维码/" itemprop="url">
                  iOS开发之 - 二维码
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
                
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-15T12:30:20+08:00">2018-04-15</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>在我们的日常生活中，二维码扫描越来越常见，比如支付宝支付扫描、微信支付扫描、信息获取等等，所以简单的整理了二维码相关的知识，总共分为两部分：生成二维码；扫描二维码。</p>
</blockquote>
<h4 id="一、生成二维码"><a href="#一、生成二维码" class="headerlink" title="一、生成二维码"></a>一、生成二维码</h4><ul>
<li><p>简单的生成二维码，先看效果图<br>如图所示，这个效果不太好，有些模糊<br><img src="http://upload-images.jianshu.io/upload_images/2665449-a0c118e13587ec11.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="简单生成二维码"></p>
</li>
<li><p>生成简单二维码的代码如下：</p>
</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="comment">// 需要导入此框架</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;CoreImage/CoreImage.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIImageView</span> *imageView;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UIImageView</span> *)imageView &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!_imageView) &#123;</span><br><span class="line">_imageView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>, <span class="number">200</span>)];</span><br><span class="line">_imageView.center = <span class="keyword">self</span>.view.center;</span><br><span class="line">[<span class="keyword">self</span>.view addSubview:_imageView];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> _imageView;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">[<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">[<span class="keyword">self</span> creatQRCode];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成二维码</span></span><br><span class="line">- (<span class="keyword">void</span>)creatQRCode &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建二维码滤镜</span></span><br><span class="line"><span class="built_in">CIFilter</span> *filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIQRCodeGenerator"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 恢复滤镜的默认属性</span></span><br><span class="line">[filter setDefaults];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 给过滤器添加数据（纯文本，URL都可以）</span></span><br><span class="line"><span class="comment">//    NSString *dataString = @"http://www.baidu.com";</span></span><br><span class="line"><span class="built_in">NSString</span> *dataString = <span class="string">@"生成二维码"</span>;</span><br><span class="line"><span class="comment">// 将字符串转换成NSData</span></span><br><span class="line"><span class="built_in">NSData</span> *data = [dataString dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置滤镜 inputMessage 数据</span></span><br><span class="line">[filter setValue:data forKeyPath:<span class="string">@"inputMessage"</span>];</span><br><span class="line"></span><br><span class="line"><span class="built_in">CIImage</span> *outputImage = [filter outputImage];</span><br><span class="line"></span><br><span class="line"><span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span>  imageWithCIImage:outputImage];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 把生成的二维码显示在 imageview 上</span></span><br><span class="line"><span class="keyword">self</span>.imageView.image = image;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li>生成清晰二维码</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-d5c8dcae91378594.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="生成清晰二维码"></p>
<ul>
<li>代码如下：</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;CoreImage/CoreImage.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIImageView</span> *imageView;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UIImageView</span> *)imageView &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!_imageView) &#123;</span><br><span class="line">_imageView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>, <span class="number">200</span>)];</span><br><span class="line">_imageView.center = <span class="keyword">self</span>.view.center;</span><br><span class="line">[<span class="keyword">self</span>.view addSubview:_imageView];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> _imageView;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">[<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">[<span class="keyword">self</span> creatQRCode];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成二维码</span></span><br><span class="line">- (<span class="keyword">void</span>)creatQRCode &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建二维码滤镜</span></span><br><span class="line"><span class="built_in">CIFilter</span> *filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIQRCodeGenerator"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 恢复滤镜的默认属性</span></span><br><span class="line">[filter setDefaults];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 给过滤器添加数据（纯文本，URL都可以）</span></span><br><span class="line"><span class="comment">//    NSString *dataString = @"http://www.baidu.com";</span></span><br><span class="line"><span class="built_in">NSString</span> *dataString = <span class="string">@"生成二维码"</span>;</span><br><span class="line"><span class="comment">// 将字符串转换成NSData</span></span><br><span class="line"><span class="built_in">NSData</span> *data = [dataString dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置滤镜 inputMessage 数据</span></span><br><span class="line">[filter setValue:data forKeyPath:<span class="string">@"inputMessage"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取滤镜输出的二维码</span></span><br><span class="line"><span class="built_in">CIImage</span> *outputImage = [filter outputImage];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 显示二维码</span></span><br><span class="line"><span class="keyword">self</span>.imageView.image = [<span class="keyword">self</span> creatClearImageFromCIImage:outputImage withSize:<span class="number">200</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UIImage</span> *)creatClearImageFromCIImage:(<span class="built_in">CIImage</span> *)image withSize:(<span class="built_in">CGFloat</span>) size</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">CGRect</span> extent = <span class="built_in">CGRectIntegral</span>(image.extent);</span><br><span class="line"><span class="built_in">CGFloat</span> scale = MIN(size/<span class="built_in">CGRectGetWidth</span>(extent), size/<span class="built_in">CGRectGetHeight</span>(extent));</span><br><span class="line"></span><br><span class="line">size_t width = <span class="built_in">CGRectGetWidth</span>(extent) * scale;</span><br><span class="line">size_t height = <span class="built_in">CGRectGetHeight</span>(extent) * scale;</span><br><span class="line"><span class="comment">// 创建灰度色调空间</span></span><br><span class="line"><span class="built_in">CGColorSpaceRef</span> colorSpaceRef = <span class="built_in">CGColorSpaceCreateDeviceGray</span>();</span><br><span class="line"><span class="built_in">CGContextRef</span> bitmapRef = <span class="built_in">CGBitmapContextCreate</span>(<span class="literal">nil</span>, width, height, <span class="number">8</span>, <span class="number">0</span>, colorSpaceRef, (<span class="built_in">CGBitmapInfo</span>)kCGImageAlphaNone);</span><br><span class="line"><span class="built_in">CIContext</span> *context = [<span class="built_in">CIContext</span> contextWithOptions:<span class="literal">nil</span>];</span><br><span class="line"><span class="built_in">CGImageRef</span> bitmapImage = [context createCGImage:image fromRect:extent];</span><br><span class="line"><span class="built_in">CGContextSetInterpolationQuality</span>(bitmapRef, kCGInterpolationNone);</span><br><span class="line"><span class="built_in">CGContextScaleCTM</span>(bitmapRef, scale, scale);</span><br><span class="line"><span class="built_in">CGContextDrawImage</span>(bitmapRef, extent, bitmapImage);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 保存图片</span></span><br><span class="line"><span class="built_in">CGImageRef</span> scaledImage = <span class="built_in">CGBitmapContextCreateImage</span>(bitmapRef);</span><br><span class="line"><span class="built_in">CGContextRelease</span>(bitmapRef);</span><br><span class="line"><span class="built_in">CGImageRelease</span>(bitmapImage);</span><br><span class="line"><span class="keyword">return</span> [<span class="built_in">UIImage</span> imageWithCGImage:scaledImage];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="二、扫描二维码"><a href="#二、扫描二维码" class="headerlink" title="二、扫描二维码"></a>二、扫描二维码</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;AVFoundation/AVFoundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> () &lt;<span class="title">AVCaptureMetadataOutputObjectsDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">AVCaptureSession</span> *session;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">AVCaptureVideoPreviewLayer</span> *layer;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">[<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建拍摄会话</span></span><br><span class="line"><span class="keyword">self</span>.session = [[<span class="built_in">AVCaptureSession</span> alloc] init];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加输入设备</span></span><br><span class="line"><span class="built_in">AVCaptureDevice</span> *device = [<span class="built_in">AVCaptureDevice</span> defaultDeviceWithMediaType:<span class="built_in">AVMediaTypeVideo</span>];</span><br><span class="line"><span class="built_in">AVCaptureDeviceInput</span> *input = [<span class="built_in">AVCaptureDeviceInput</span> deviceInputWithDevice:device error:<span class="literal">nil</span>];</span><br><span class="line">[<span class="keyword">self</span>.session addInput:input];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加输出数据</span></span><br><span class="line"><span class="built_in">AVCaptureMetadataOutput</span> *output = [[<span class="built_in">AVCaptureMetadataOutput</span> alloc] init];</span><br><span class="line">[output setMetadataObjectsDelegate:<span class="keyword">self</span> queue:dispatch_get_main_queue()];</span><br><span class="line">[<span class="keyword">self</span>.session addOutput:output];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置输入元数据的类型</span></span><br><span class="line">[output setMetadataObjectTypes:@[<span class="built_in">AVMetadataObjectTypeQRCode</span>]];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加扫描图层</span></span><br><span class="line"><span class="keyword">self</span>.layer = [<span class="built_in">AVCaptureVideoPreviewLayer</span> layerWithSession:<span class="keyword">self</span>.session];</span><br><span class="line"><span class="keyword">self</span>.layer.frame = <span class="keyword">self</span>.view.bounds;</span><br><span class="line">[<span class="keyword">self</span>.view.layer addSublayer:<span class="keyword">self</span>.layer];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动会话</span></span><br><span class="line">[<span class="keyword">self</span>.session startRunning];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 扫描到数据就会执行该代理方法</span></span><br><span class="line">- (<span class="keyword">void</span>)captureOutput:(<span class="built_in">AVCaptureOutput</span> *)captureOutput didOutputMetadataObjects:(<span class="built_in">NSArray</span> *)metadataObjects fromConnection:(<span class="built_in">AVCaptureConnection</span> *)connection</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (metadataObjects.count &gt; <span class="number">0</span>) &#123;</span><br><span class="line"><span class="comment">// 提示：如果需要对url或者文本等信息进行扫描，可以在此进行扩展</span></span><br><span class="line"><span class="built_in">AVMetadataMachineReadableCodeObject</span> *object = [metadataObjects lastObject];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, object.stringValue);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果扫描完成，停止会话</span></span><br><span class="line">[<span class="keyword">self</span>.session stopRunning];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除预览图层</span></span><br><span class="line">[<span class="keyword">self</span>.layer removeFromSuperlayer];</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"没有扫描到数据"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后说几个二维码相关的注意点：</p>
<ul>
<li><p>注意点：<br>二维码都有一定的容错部分，意思就是有部分污损或者破损都没有关系，照常识别。但是也是有限度的，这根据生成时使用的纠错级别而定，可以有7％~30％左右的损坏。</p>
</li>
<li><p>二维码使用基本原则：<br>1、三个角上的“回”及“回”字周围的底色不要动<br>2、中间部分和不带“回”字的一角是可以填图片的（中间最好）<br>3、如果中间有小的“回”字，能不变就不变，能少变就少变<br>4、尽可能放大二维码后再添加图片，不要添加图片后放大<br>5、生成时尽量选择较高的纠错级别</p>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-daf8123ea95c1514.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="二维码"></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/15/iOS开发之 - 内购/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="刘朋坤">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="以梦为马">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/15/iOS开发之 - 内购/" itemprop="url">
                  iOS开发之 - 内购
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
                
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-15T12:30:20+08:00">2018-04-15</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>电商之类的 app 大多用的都是第三方支付（支付宝微信等支付），但是在某种特殊情况之下，我们却不得不使用内购。比如商品是在本 app 中使用和消耗的（游戏币游戏道具等），就一定要用内购，苹果强制的，否则会被拒绝上线。因此作为 iOS 开发者，不光要了解第三方支付，对内购也要有一定的认识！</p>
</blockquote>
<h2 id="一、什么是内购？"><a href="#一、什么是内购？" class="headerlink" title="一、什么是内购？"></a>一、什么是内购？</h2><p>内购是苹果推出的一种支付方式。说白了内购就是苹果获取利润的方式之一。如果我们使用第三方支付，只会支付少量的💰，但使用内购却要支付很多💰💰💰💰💰💰💰💰，要和苹果三七分帐（以前是四六分😢）。</p>
<h2 id="二、内购产品的类别"><a href="#二、内购产品的类别" class="headerlink" title="二、内购产品的类别"></a>二、内购产品的类别</h2><p>官方的注释写的很清楚了，内购有五种产品类别，简介如下：</p>
<ul>
<li>非消耗品（Nonconsumable）<br>指的是在游戏中一次性购买并拥有永久访问权的物品或服务。非消耗品物品可以被用户再次下载，并且能够在用户的所有设备上使用。</li>
<li>消耗品（Consumable）<br>消耗品购买不可被再次下载,根据其特点,消耗品不能在用户的设备之间跨设备使用,除非自定义服务在用户的账号之间共享这些信息。<br><strong>以下三种类别在iBooks中使用，目前iBooks不支持大陆市场</strong></li>
<li>免费订阅（Free subscriptions）</li>
<li>自动续费订阅（Auto-renewing subscriptions）</li>
<li>非自动续费订阅（Nonrenewing subscriptions）</li>
</ul>
<h2 id="三、苹果官方的内购流程"><a href="#三、苹果官方的内购流程" class="headerlink" title="三、苹果官方的内购流程"></a>三、苹果官方的内购流程</h2><p><img src="http://upload-images.jianshu.io/upload_images/2665449-0614b70007393038.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="内购流程"></p>
<ul>
<li>白话文如下⬇️</li>
</ul>
<ol>
<li>程序向服务器发送请求，获得一份产品列表。</li>
<li>服务器返回包含产品标识符的列表。</li>
<li>程序向App Store发送请求，得到产品的信息。</li>
<li>App Store返回产品信息。</li>
<li>程序把返回的产品信息显示给用户（App的store界面）</li>
<li>用户选择某个产品</li>
<li>程序向App Store发送支付请求</li>
<li>App Store处理支付请求并返回交易完成信息。</li>
<li>程序从信息中获得数据，并发送至服务器。</li>
<li>服务器纪录数据，并进行审(我们的)查。</li>
<li>服务器将数据发给App Store来验证该交易的有效性。</li>
<li>App Store对收到的数据进行解析，返回该数据和说明其是否有效的标识。</li>
<li>服务器读取返回的数据，确定用户购买的内容。</li>
<li>服务器将购买的内容传递给程序。</li>
</ol>
<h2 id="四、代码实现"><a href="#四、代码实现" class="headerlink" title="四、代码实现"></a>四、代码实现</h2><p>4.1 项目的Bundle identifier需要与您申请AppID时填写的bundleID一致，不然会无法请求到商品信息。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-4a5e5e9889d10179.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Bundle identifier"></p>
<p>4.2要使用内购,需要导入 StoreKit 依赖库<br><img src="http://upload-images.jianshu.io/upload_images/2665449-c68598a75f514fda.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="入StoreKit"></p>
<p>4.3代码部分<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"UITableController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;StoreKit/StoreKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">UITableController</span> () &lt;<span class="title">SKProductsRequestDelegate</span>, <span class="title">UITableViewDelegate</span>, <span class="title">UITableViewDataSource</span>, <span class="title">SKPaymentTransactionObserver</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/** 所有商品 */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSArray</span> *products;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">UITableController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">[<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"></span><br><span class="line">[<span class="keyword">self</span> requestProducts];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 请求可卖商品</span></span><br><span class="line">- (<span class="keyword">void</span>)requestProducts &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.从服务器请求所有商品的ProductIds</span></span><br><span class="line"><span class="built_in">NSString</span> *filePath = [[<span class="built_in">NSBundle</span> mainBundle] pathForResource:<span class="string">@"iapdemo.plist"</span> ofType:<span class="literal">nil</span>];</span><br><span class="line"><span class="built_in">NSArray</span> *productArray = [<span class="built_in">NSArray</span> arrayWithContentsOfFile:filePath];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.获取productId</span></span><br><span class="line"><span class="built_in">NSArray</span> *productIdArray = [productArray valueForKeyPath:<span class="string">@"productId"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.请求可卖的商品</span></span><br><span class="line"><span class="built_in">NSSet</span> *productIdSet = [<span class="built_in">NSSet</span> setWithArray:productIdArray];</span><br><span class="line"><span class="built_in">SKProductsRequest</span> *request = [[<span class="built_in">SKProductsRequest</span> alloc] initWithProductIdentifiers:productIdSet];</span><br><span class="line">request.delegate = <span class="keyword">self</span>;</span><br><span class="line">[request start];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewWillAppear:(<span class="built_in">BOOL</span>)animated</span><br><span class="line">&#123;</span><br><span class="line">[<span class="keyword">super</span> viewWillAppear:animated];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加观察者</span></span><br><span class="line">[[<span class="built_in">SKPaymentQueue</span> defaultQueue] addTransactionObserver:<span class="keyword">self</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewWillDisappear:(<span class="built_in">BOOL</span>)animated</span><br><span class="line">&#123;</span><br><span class="line">[<span class="keyword">super</span> viewWillDisappear:animated];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 移除观察者</span></span><br><span class="line">[[<span class="built_in">SKPaymentQueue</span> defaultQueue] removeTransactionObserver:<span class="keyword">self</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 实现SKProductsRequest的代理方法</span></span><br><span class="line"><span class="comment">// 请求到可卖商品的结果</span></span><br><span class="line">- (<span class="keyword">void</span>)productsRequest:(<span class="built_in">SKProductsRequest</span> *)request didReceiveResponse:(<span class="built_in">SKProductsResponse</span> *)response</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// 1.展示商品</span></span><br><span class="line"><span class="keyword">self</span>.products = [response.products sortedArrayWithOptions:<span class="built_in">NSSortConcurrent</span> usingComparator:^<span class="built_in">NSComparisonResult</span>(<span class="built_in">SKProduct</span> *obj1, <span class="built_in">SKProduct</span> *obj2) &#123;</span><br><span class="line"><span class="keyword">return</span> [obj1.price compare:obj2.price];</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.刷新表格</span></span><br><span class="line">[<span class="keyword">self</span>.tableView reloadData];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 请求失败</span></span><br><span class="line">- (<span class="keyword">void</span>)request:(<span class="built_in">SKRequest</span> *)request didFailWithError:(<span class="built_in">NSError</span> *)error &#123;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [error localizedDescription]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 请求结束</span></span><br><span class="line">- (<span class="keyword">void</span>)requestDidFinish:(<span class="built_in">SKRequest</span> *)request &#123;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"请求结束"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 实现tableView的数据源和代理方法</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)tableView:(<span class="built_in">UITableView</span> *)tableView numberOfRowsInSection:(<span class="built_in">NSInteger</span>)section</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">self</span>.products.count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">static</span> <span class="built_in">NSString</span> *ID = <span class="string">@"productCellId"</span>;</span><br><span class="line"><span class="built_in">UITableViewCell</span> *cell = [tableView dequeueReusableCellWithIdentifier:ID];</span><br><span class="line"><span class="keyword">if</span> (cell == <span class="literal">nil</span>) &#123;</span><br><span class="line">cell = [[<span class="built_in">UITableViewCell</span> alloc] initWithStyle:<span class="built_in">UITableViewCellStyleSubtitle</span> reuseIdentifier:ID];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.取出模型</span></span><br><span class="line"><span class="built_in">SKProduct</span> *product = <span class="keyword">self</span>.products[indexPath.row];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.给cell设置数据</span></span><br><span class="line">cell.textLabel.text = product.localizedTitle;</span><br><span class="line">cell.detailTextLabel.text = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"价格:%@"</span>, product.price];</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> cell;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)tableView:(<span class="built_in">UITableView</span> *)tableView didSelectRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// 1.取出模型</span></span><br><span class="line"><span class="built_in">SKProduct</span> *product = <span class="keyword">self</span>.products[indexPath.row];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.购买商品</span></span><br><span class="line">[<span class="keyword">self</span> buyProduct:product];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 购买商品</span></span><br><span class="line">- (<span class="keyword">void</span>)buyProduct:(<span class="built_in">SKProduct</span> *)product</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// 1.创建票据</span></span><br><span class="line"><span class="built_in">SKPayment</span> *payment = [<span class="built_in">SKPayment</span> paymentWithProduct:product];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.将票据加入到交易队列中</span></span><br><span class="line">[[<span class="built_in">SKPaymentQueue</span> defaultQueue] addPayment:payment];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 实现SKPaymentQueue的回调方法</span></span><br><span class="line"><span class="comment">// 监听购买结果</span></span><br><span class="line">- (<span class="keyword">void</span>)paymentQueue:(<span class="built_in">SKPaymentQueue</span> *)queue updatedTransactions:(<span class="built_in">NSArray</span> *)transactions</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">SKPaymentTransaction</span> *transation <span class="keyword">in</span> transactions) &#123;</span><br><span class="line"><span class="keyword">switch</span> (transation.transactionState) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="built_in">SKPaymentTransactionStatePurchasing</span>:</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"正在交易"</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="built_in">SKPaymentTransactionStatePurchased</span>:</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"交易成功"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将交易从交易队列中移除, 否则会验证不通过,以下几个都得移除</span></span><br><span class="line">[queue finishTransaction:transation];</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="built_in">SKPaymentTransactionStateFailed</span>:</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"交易失败"</span>);</span><br><span class="line">[queue finishTransaction:transation];</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="built_in">SKPaymentTransactionStateRestored</span>:</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"购买过该商品"</span>);</span><br><span class="line">[queue finishTransaction:transation];</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="built_in">SKPaymentTransactionStateDeferred</span>:</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"未决定"</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)dealloc &#123;</span><br><span class="line"></span><br><span class="line">[[<span class="built_in">SKPaymentQueue</span> defaultQueue] removeTransactionObserver:<span class="keyword">self</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>另外使用这个方法即可恢复购买<br><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[<span class="name">SKPaymentQueue</span> defaultQueue] removeTransactionObserver:self]<span class="comment">;</span></span><br></pre></td></tr></table></figure></p>
<p><strong> <end></end></strong></p>
<hr>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/15/iOS开发之 - 刷新框架 MJRefresh 的使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="刘朋坤">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="以梦为马">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/15/iOS开发之 - 刷新框架 MJRefresh 的使用/" itemprop="url">
                  iOS开发之 - 刷新框架 MJRefresh 的使用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
                
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-15T12:30:20+08:00">2018-04-15</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="http://upload-images.jianshu.io/upload_images/2665449-9e9c86ec592c3c2f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="MJRefresh"></p>
<blockquote>
<p>下拉刷新控件目前比较火的有好几种，此前用过<a href="https://github.com/CoderMJLee/MJRefresh/blob/master/README.md" target="_blank" rel="noopener">MJRefresh</a> 和<a href="https://github.com/samvermette/SVPullToRefresh" target="_blank" rel="noopener"> SVPullToRefresh</a>，相对而言，还是觉得 MJRefresh 更好用！因此抽了些时间整理了 MJRefresh 的用法。以下是文章内容。。。</p>
</blockquote>
<h1 id="【文章目录】"><a href="#【文章目录】" class="headerlink" title="【文章目录】"></a>【文章目录】</h1><h2 id="一、类结构图"><a href="#一、类结构图" class="headerlink" title="一、类结构图"></a>一、类结构图</h2><ul>
<li>MJRefreshComponent.h</li>
<li>MJRefreshHeader.h</li>
<li>MJRefreshFooter.h</li>
<li>MJRefreshAutoFooter.h</li>
</ul>
<h2 id="二、参考例子"><a href="#二、参考例子" class="headerlink" title="二、参考例子"></a>二、参考例子</h2><ul>
<li>下拉刷新01-默认</li>
<li>下拉刷新02-动画图片</li>
<li>下拉刷新03-隐藏时间</li>
<li>下拉刷新04-隐藏状态和时间</li>
<li>下拉刷新05-自定义文字</li>
<li>下拉刷新06-自定义刷新控件</li>
<li>上拉刷新01-默认</li>
<li>上拉刷新02-动画图片</li>
<li>上拉刷新03-隐藏刷新状态的文字</li>
<li>上拉刷新04-全部加载完毕</li>
<li>上拉刷新05-自定义文字</li>
<li>上拉刷新06-加载后隐藏</li>
<li>上拉刷新07-自动回弹的上拉01</li>
<li>上拉刷新08-自动回弹的上拉02</li>
<li>上拉刷新09-自定义刷新控件(自动刷新)</li>
<li>上拉刷新10-自定义刷新控件(自动回弹)</li>
<li>UICollectionView01-上下拉刷新</li>
<li>UIWebView01-下拉刷新</li>
</ul>
<h1 id="【文章内容】"><a href="#【文章内容】" class="headerlink" title="【文章内容】"></a>【文章内容】</h1><h2 id="1-类结构图"><a href="#1-类结构图" class="headerlink" title="1.类结构图"></a>1.类结构图</h2><p><img src="http://upload-images.jianshu.io/upload_images/2665449-4a80291bb05b5283.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="类结构图"></p>
<h3 id="MJRefreshComponent-h"><a href="#MJRefreshComponent-h" class="headerlink" title="MJRefreshComponent.h"></a>MJRefreshComponent.h</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 刷新控件的基类 */</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MJRefreshComponent</span> : <span class="title">UIView</span></span></span><br><span class="line"><span class="meta">#pragma mark - 刷新状态控制</span></span><br><span class="line"><span class="comment">/** 进入刷新状态 */</span></span><br><span class="line">- (<span class="keyword">void</span>)beginRefreshing;</span><br><span class="line"><span class="comment">/** 结束刷新状态 */</span></span><br><span class="line">- (<span class="keyword">void</span>)endRefreshing;</span><br><span class="line"><span class="comment">/** 是否正在刷新 */</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)isRefreshing;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 其它</span></span><br><span class="line"><span class="comment">/** 根据拖拽比例自动切换透明度 */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>, <span class="keyword">getter</span>=isAutomaticallyChangeAlpha) <span class="built_in">BOOL</span> automaticallyChangeAlpha;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="MJRefreshHeader-h"><a href="#MJRefreshHeader-h" class="headerlink" title="MJRefreshHeader.h"></a>MJRefreshHeader.h</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MJRefreshHeader</span> : <span class="title">MJRefreshComponent</span></span></span><br><span class="line"><span class="comment">/** 创建 header */</span></span><br><span class="line">+ (<span class="keyword">instancetype</span>)headerWithRefreshingBlock:(MJRefreshComponentRefreshingBlock)refreshingBlock;</span><br><span class="line"><span class="comment">/** 创建 header */</span></span><br><span class="line">+ (<span class="keyword">instancetype</span>)headerWithRefreshingTarget:(<span class="keyword">id</span>)target refreshingAction:(SEL)action;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 这个 key 用来存储上一次下拉刷新成功的时间 */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">copy</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSString</span> *lastUpdatedTimeKey;</span><br><span class="line"><span class="comment">/** 上一次下拉刷新成功的时间 */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">NSDate</span> *lastUpdatedTime;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 忽略多少 scrollView 的 contentInset 的顶部 */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="built_in">CGFloat</span> ignoredScrollViewContentInsetTop;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="MJRefreshFooter-h"><a href="#MJRefreshFooter-h" class="headerlink" title="MJRefreshFooter.h"></a>MJRefreshFooter.h</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MJRefreshFooter</span> : <span class="title">MJRefreshComponent</span></span></span><br><span class="line"><span class="comment">/** 创建 footer */</span></span><br><span class="line">+ (<span class="keyword">instancetype</span>)footerWithRefreshingBlock:(MJRefreshComponentRefreshingBlock)refreshingBlock;</span><br><span class="line"><span class="comment">/** 创建 footer */</span></span><br><span class="line">+ (<span class="keyword">instancetype</span>)footerWithRefreshingTarget:(<span class="keyword">id</span>)target refreshingAction:(SEL)action;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 提示没有更多的数据 */</span></span><br><span class="line">- (<span class="keyword">void</span>)noticeNoMoreData;</span><br><span class="line"><span class="comment">/** 重置没有更多的数据（消除没有更多数据的状态） */</span></span><br><span class="line">- (<span class="keyword">void</span>)resetNoMoreData;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 忽略多少 scrollView 的 contentInset 的底部*/</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="built_in">CGFloat</span> ignoredScrollViewContentInsetBottom;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 自动根据有无数据来显示和隐藏 */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="built_in">BOOL</span> automaticallyHidden;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="MJRefreshAutoFooter-h"><a href="#MJRefreshAutoFooter-h" class="headerlink" title="MJRefreshAutoFooter.h"></a>MJRefreshAutoFooter.h</h3><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@interface</span> <span class="attribute">MJRefreshAutoFooter </span>: MJRefreshFooter</span><br><span class="line"><span class="comment">/** 是否自动刷新(默认为 YES) */</span></span><br><span class="line"><span class="variable">@property</span> (assign, nonatomic, getter=isAutomaticallyRefresh) BOOL automaticallyRefresh;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 当底部控件出现多少时就自动刷新(默认为1.0，也就是底部控件完全出现时，才会自动刷新) */</span></span><br><span class="line"><span class="variable">@property</span> (assign, nonatomic) CGFloat appearencePercentTriggerAutoRefresh;</span><br><span class="line"><span class="variable">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-参考例子"><a href="#2-参考例子" class="headerlink" title="2.参考例子"></a>2.参考例子</h2><p>ps: 可以下载 <a href="https://github.com/CoderMJLee/MJRefresh" target="_blank" rel="noopener">MJRefresh</a>试试<br><img src="http://upload-images.jianshu.io/upload_images/2665449-9bfe1621e9aea9f6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="MJRefresh 演示"></p>
<h3 id="下拉刷新01-默认"><a href="#下拉刷新01-默认" class="headerlink" title="下拉刷新01-默认"></a>下拉刷新01-默认</h3><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">self</span>.<span class="built_in">table</span>View.mj_header = [MJRefreshNormalHeader headerWithRefreshingBlock:^&#123;</span><br><span class="line">// 进入刷新状态后会自动调用这个<span class="built_in">block</span></span><br><span class="line">&#125;];</span><br><span class="line">// 或</span><br><span class="line">// 设置回调（一旦进入刷新状态，就调用 target 的 action，也就是调用 <span class="literal">self</span> 的 <span class="built_in">load</span>NewData 方法）</span><br><span class="line"><span class="literal">self</span>.<span class="built_in">table</span>View.mj_header = [MJRefreshNormalHeader headerWithRefreshingTarget:<span class="literal">self</span> refreshingAction:@selector(<span class="built_in">load</span>NewData)];</span><br><span class="line">// 马上进入刷新状态</span><br><span class="line">[<span class="literal">self</span>.<span class="built_in">table</span>View.mj_header beginRefreshing];</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-a3bfaa0e6bfbc461.gif?imageMogr2/auto-orient/strip" alt="下拉刷新01-默认"></p>
<h3 id="下拉刷新02-动画图片"><a href="#下拉刷新02-动画图片" class="headerlink" title="下拉刷新02-动画图片"></a>下拉刷新02-动画图片</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置回调（一旦进入刷新状态，就调用 targett 的 action，即调用 self 的 loadNewData 方法）</span></span><br><span class="line">MJRefreshGifHeader *header = [MJRefreshGifHeader <span class="string">headerWithRefreshingTarget:</span>self <span class="string">refreshingAction:</span><span class="meta">@selector</span>(loadNewData)];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置普通状态的动画图片</span></span><br><span class="line">NSArray *idleImages = @[@<span class="string">"图片1"</span>, @<span class="string">"图片2"</span>, @<span class="string">"图片3"</span>];</span><br><span class="line">[header <span class="string">setImages:</span>idleImages <span class="string">forState:</span>MJRefreshStateIdle];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置即将刷新状态的动画图片（一松开就会刷新的状态）</span></span><br><span class="line">NSArray *pullingImages = @[@<span class="string">"图片1"</span>, @<span class="string">"图片2"</span>, @<span class="string">"图片3"</span>];</span><br><span class="line">[header <span class="string">setImages:</span>pullingImages <span class="string">forState:</span>MJRefreshStatePulling];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置正在刷新状态的动画图片</span></span><br><span class="line">NSArray *refreshingImages = @[@<span class="string">"图片1"</span>, @<span class="string">"图片2"</span>, @<span class="string">"图片3"</span>];</span><br><span class="line">[header <span class="string">setImages:</span>refreshingImages <span class="string">forState:</span>MJRefreshStateRefreshing];</span><br><span class="line"><span class="comment">// 设置 header</span></span><br><span class="line">self.tableView.mj_header = header;</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-392f24b00061ea83.gif?imageMogr2/auto-orient/strip" alt="下拉刷新02-动画图片"></p>
<h3 id="下拉刷新03-隐藏时间"><a href="#下拉刷新03-隐藏时间" class="headerlink" title="下拉刷新03-隐藏时间"></a>下拉刷新03-隐藏时间</h3><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 隐藏时间</span></span><br><span class="line">header.lastUpdatedTimeLabel.hidden = <span class="keyword">YES</span>;</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-a3c38c436477cacc.gif?imageMogr2/auto-orient/strip" alt="下拉刷新03-隐藏时间"></p>
<h3 id="下拉刷新04-隐藏状态和时间"><a href="#下拉刷新04-隐藏状态和时间" class="headerlink" title="下拉刷新04-隐藏状态和时间"></a>下拉刷新04-隐藏状态和时间</h3><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 隐藏时间</span><br><span class="line">header.lastUpdatedTimeLabel.hidden = YES;</span><br><span class="line"></span><br><span class="line">// 隐藏状态</span><br><span class="line">header.<span class="keyword">state</span>Label.hidden = YES;</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-bea00ff6a76a81fd.gif?imageMogr2/auto-orient/strip" alt="下拉刷新04-隐藏状态和时间"></p>
<h3 id="下拉刷新05-自定义文字"><a href="#下拉刷新05-自定义文字" class="headerlink" title="下拉刷新05-自定义文字"></a>下拉刷新05-自定义文字</h3><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// 设置文字</span><br><span class="line">[header <span class="built_in">set</span>Title:@<span class="string">"Pull down to refresh"</span> <span class="keyword">for</span>State:MJRefreshStateIdle];</span><br><span class="line">[header <span class="built_in">set</span>Title:@<span class="string">"Release to refresh"</span> <span class="keyword">for</span>State:MJRefreshStatePulling];</span><br><span class="line">[header <span class="built_in">set</span>Title:@<span class="string">"Loading ..."</span> <span class="keyword">for</span>State:MJRefreshStateRefreshing];</span><br><span class="line"></span><br><span class="line">// 设置字体</span><br><span class="line">header.<span class="keyword">state</span>Label.font = [UIFont systemFontOfSize:<span class="number">15</span>];</span><br><span class="line">header.lastUpdatedTimeLabel.font = [UIFont systemFontOfSize:<span class="number">14</span>];</span><br><span class="line"></span><br><span class="line">// 设置颜色</span><br><span class="line">header.<span class="keyword">state</span>Label.textColor = [UIColor redColor];</span><br><span class="line">header.lastUpdatedTimeLabel.textColor = [UIColor blueColor];</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-ad9e5a170567e3bb.gif?imageMogr2/auto-orient/strip" alt="下拉刷新05-自定义文字"></p>
<h3 id="下拉刷新06-自定义刷新控件"><a href="#下拉刷新06-自定义刷新控件" class="headerlink" title="下拉刷新06-自定义刷新控件"></a>下拉刷新06-自定义刷新控件</h3><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">self</span>.tableView.mj_header = [MJDIYHeader <span class="symbol">headerWithRefreshingTarget:</span><span class="keyword">self</span> <span class="symbol">refreshingAction:</span><span class="variable">@selector</span>(loadNewData)];</span><br><span class="line">/<span class="regexp">/ 具体实现参考 MJDIYHeader.h 和 MJDIYHeader.m</span></span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-02fca65a8c891905.gif?imageMogr2/auto-orient/strip" alt="下拉刷新06-自定义刷新控件"></p>
<h3 id="上拉刷新01-默认"><a href="#上拉刷新01-默认" class="headerlink" title="上拉刷新01-默认"></a>上拉刷新01-默认</h3><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">self</span>.<span class="built_in">table</span>View.mj_footer = [MJRefreshAutoNormalFooter footerWithRefreshingBlock:^&#123;</span><br><span class="line">// 进入刷新状态后会自动调用这个 <span class="built_in">block</span></span><br><span class="line">&#125;];</span><br><span class="line">// 或</span><br><span class="line">// 设置回调（一旦进入刷新状态，就调用 target 的 action，即调用 <span class="literal">self</span> 的 <span class="built_in">load</span>MoreData 方法）</span><br><span class="line"><span class="literal">self</span>.<span class="built_in">table</span>View.mj_footer = [MJRefreshAutoNormalFooter footerWithRefreshingTarget:<span class="literal">self</span> refreshingAction:@selector(<span class="built_in">load</span>MoreData)];</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-475e06e1f29fb149.gif?imageMogr2/auto-orient/strip" alt="上拉刷新01-默认"></p>
<h3 id="上拉刷新02-动画图片"><a href="#上拉刷新02-动画图片" class="headerlink" title="上拉刷新02-动画图片"></a>上拉刷新02-动画图片</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 设置回调（一旦进入刷新状态，就调用 target 的 action，即调用 self 的 loadMoreData 方法）</span></span><br><span class="line">MJRefreshAutoGifFooter *footer = [MJRefreshAutoGifFooter <span class="string">footerWithRefreshingTarget:</span>self <span class="string">refreshingAction:</span><span class="meta">@selector</span>(loadMoreData)];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置刷新图片</span></span><br><span class="line">NSArray *refreshingImages = @[@<span class="string">"图片1"</span>, @<span class="string">"图片2"</span>, @<span class="string">"图片3"</span>];</span><br><span class="line">[footer <span class="string">setImages:</span>refreshingImages <span class="string">forState:</span>MJRefreshStateRefreshing];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置尾部</span></span><br><span class="line">self.tableView.mj_footer = footer;</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-15a83363eff10b1e.gif?imageMogr2/auto-orient/strip" alt="上拉刷新02-动画图片"></p>
<h3 id="上拉刷新03-隐藏刷新状态的文字"><a href="#上拉刷新03-隐藏刷新状态的文字" class="headerlink" title="上拉刷新03-隐藏刷新状态的文字"></a>上拉刷新03-隐藏刷新状态的文字</h3><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// 隐藏刷新状态的文字</span><br><span class="line">footer.refreshingTitleHidden = YES;</span><br><span class="line">// 如果没有上面的方法，就用footer.<span class="keyword">state</span>Label.hidden = YES;</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-7dcd46bd73d0423f.gif?imageMogr2/auto-orient/strip" alt="上拉刷新03-隐藏刷新状态的文字"></p>
<h3 id="上拉刷新04-全部加载完毕"><a href="#上拉刷新04-全部加载完毕" class="headerlink" title="上拉刷新04-全部加载完毕"></a>上拉刷新04-全部加载完毕</h3><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 变为没有更多数据的状态</span></span><br><span class="line">[<span class="meta">footer endRefreshingWithNoMoreData</span>];</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-3f0e9a88feb33219.gif?imageMogr2/auto-orient/strip" alt="上拉刷新04-全部加载完毕"></p>
<h3 id="上拉刷新05-自定义文字"><a href="#上拉刷新05-自定义文字" class="headerlink" title="上拉刷新05-自定义文字"></a>上拉刷新05-自定义文字</h3><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// 设置文字</span><br><span class="line">[footer <span class="built_in">set</span>Title:@<span class="string">"Click or drag up to refresh"</span> <span class="keyword">for</span>State:MJRefreshStateIdle];</span><br><span class="line">[footer <span class="built_in">set</span>Title:@<span class="string">"Loading more ..."</span> <span class="keyword">for</span>State:MJRefreshStateRefreshing];</span><br><span class="line">[footer <span class="built_in">set</span>Title:@<span class="string">"No more data"</span> <span class="keyword">for</span>State:MJRefreshStateNoMoreData];</span><br><span class="line"></span><br><span class="line">// 设置字体</span><br><span class="line">footer.<span class="keyword">state</span>Label.font = [UIFont systemFontOfSize:<span class="number">17</span>];</span><br><span class="line"></span><br><span class="line">// 设置颜色</span><br><span class="line">footer.<span class="keyword">state</span>Label.textColor = [UIColor blueColor];</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-f9383ff9ab48a6b2.gif?imageMogr2/auto-orient/strip" alt="上拉刷新05-自定义文字"></p>
<h3 id="上拉刷新06-加载后隐藏"><a href="#上拉刷新06-加载后隐藏" class="headerlink" title="上拉刷新06-加载后隐藏"></a>上拉刷新06-加载后隐藏</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 隐藏当前的上拉刷新控件</span></span><br><span class="line"><span class="keyword">self</span>.tableView.mj_footer.hidden = <span class="literal">YES</span>;</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-44824bc808564096.gif?imageMogr2/auto-orient/strip" alt="上拉刷新06-加载后隐藏"></p>
<h3 id="上拉刷新07-自动回弹的上拉01"><a href="#上拉刷新07-自动回弹的上拉01" class="headerlink" title="上拉刷新07-自动回弹的上拉01"></a>上拉刷新07-自动回弹的上拉01</h3><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">self</span>.<span class="built_in">table</span>View.mj_footer = [MJRefreshBackNormalFooter footerWithRefreshingTarget:<span class="literal">self</span> refreshingAction:@selector(<span class="built_in">load</span>MoreData)];</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-ab778a9f00a22a4f.gif?imageMogr2/auto-orient/strip" alt="上拉刷新07-自动回弹的上拉01"></p>
<h3 id="上拉刷新08-自动回弹的上拉02"><a href="#上拉刷新08-自动回弹的上拉02" class="headerlink" title="上拉刷新08-自动回弹的上拉02"></a>上拉刷新08-自动回弹的上拉02</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">MJRefreshBackGifFooter *footer = [MJRefreshBackGifFooter <span class="string">footerWithRefreshingTarget:</span>self <span class="string">refreshingAction:</span><span class="meta">@selector</span>(loadMoreData)];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置普通状态的动画图片</span></span><br><span class="line">NSArray *idleImages = @[@<span class="string">"图片1"</span>, @<span class="string">"图片2"</span>, @<span class="string">"图片3"</span>];</span><br><span class="line">[footer <span class="string">setImages:</span>idleImages <span class="string">forState:</span>MJRefreshStateIdle];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置即将刷新状态的动画图片（一松开就会刷新的状态）</span></span><br><span class="line">NSArray *pullingImages = @[@<span class="string">"图片1"</span>, @<span class="string">"图片2"</span>, @<span class="string">"图片3"</span>];</span><br><span class="line"></span><br><span class="line">[footer <span class="string">setImages:</span>pullingImages <span class="string">forState:</span>MJRefreshStatePulling];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置正在刷新状态的动画图片</span></span><br><span class="line">NSArray *refreshingImages = @[@<span class="string">"图片1"</span>, @<span class="string">"图片2"</span>, @<span class="string">"图片3"</span>];</span><br><span class="line">[footer <span class="string">setImages:</span>refreshingImages <span class="string">forState:</span>MJRefreshStateRefreshing];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置尾部</span></span><br><span class="line">self.tableView.mj_footer = footer;</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-7ff75c5dc70d3d33.gif?imageMogr2/auto-orient/strip" alt="上拉刷新08-自动回弹的上拉02"></p>
<h3 id="上拉刷新09-自定义刷新控件-自动刷新"><a href="#上拉刷新09-自定义刷新控件-自动刷新" class="headerlink" title="上拉刷新09-自定义刷新控件(自动刷新)"></a>上拉刷新09-自定义刷新控件(自动刷新)</h3><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">self</span>.tableView.mj_footer = [MJDIYAutoFooter <span class="symbol">footerWithRefreshingTarget:</span><span class="keyword">self</span> <span class="symbol">refreshingAction:</span><span class="variable">@selector</span>(loadMoreData)];</span><br><span class="line">/<span class="regexp">/ 具体实现参考MJDIYAutoFooter.h和MJDIYAutoFooter.m</span></span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-504544818173e40a.gif?imageMogr2/auto-orient/strip" alt="上拉刷新09-自定义刷新控件(自动刷新)"></p>
<h3 id="上拉刷新10-自定义刷新控件-自动回弹"><a href="#上拉刷新10-自定义刷新控件-自动回弹" class="headerlink" title="上拉刷新10-自定义刷新控件(自动回弹)"></a>上拉刷新10-自定义刷新控件(自动回弹)</h3><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">self</span>.tableView.mj_footer = [MJDIYBackFooter <span class="symbol">footerWithRefreshingTarget:</span><span class="keyword">self</span> <span class="symbol">refreshingAction:</span><span class="variable">@selector</span>(loadMoreData)];</span><br><span class="line">/<span class="regexp">/ 具体实现参考MJDIYBackFooter.h和MJDIYBackFooter.m</span></span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-39f29fe70a310b80.gif?imageMogr2/auto-orient/strip" alt="上拉刷新10-自定义刷新控件(自动回弹)"></p>
<h3 id="UICollectionView01-上下拉刷新"><a href="#UICollectionView01-上下拉刷新" class="headerlink" title="UICollectionView01-上下拉刷新"></a>UICollectionView01-上下拉刷新</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 下拉刷新</span></span><br><span class="line">self.collectionView.mj_header = [MJRefreshNormalHeader <span class="string">headerWithRefreshingBlock:</span>^&#123;</span><br><span class="line"><span class="comment">// 进入刷新状态后会自动调用这个block</span></span><br><span class="line">&#125;];</span><br><span class="line"><span class="comment">// 上拉刷新</span></span><br><span class="line">self.collectionView.mj_footer = [MJRefreshAutoNormalFooter <span class="string">footerWithRefreshingBlock:</span>^&#123;</span><br><span class="line"><span class="comment">// 进入刷新状态后会自动调用这个block</span></span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-0d4fd9a97ffb9513.gif?imageMogr2/auto-orient/strip" alt="UICollectionView01-上下拉刷新"></p>
<h3 id="UIWebView01-下拉刷新"><a href="#UIWebView01-下拉刷新" class="headerlink" title="UIWebView01-下拉刷新"></a>UIWebView01-下拉刷新</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加下拉刷新控件</span></span><br><span class="line">self.webView.scrollView.mj_header = [MJRefreshNormalHeader <span class="string">headerWithRefreshingBlock:</span>^&#123;</span><br><span class="line"><span class="comment">// 进入刷新状态后会自动调用这个block</span></span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-ee3c092adb2b9561.gif?imageMogr2/auto-orient/strip" alt="UIWebView01-下拉刷新"></p>
<ul>
<li><em>over</em><br>以上是 MJRefresh 的具体用法，有兴趣的朋友还可以参考下<a href="https://github.com/CoderMJLee/MJRefresh/blob/master/README.md" target="_blank" rel="noopener">MJRefresh/README.md</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/15/iOS开发之 - 好玩的富文本/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="刘朋坤">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="以梦为马">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/15/iOS开发之 - 好玩的富文本/" itemprop="url">
                  iOS开发之 - 好玩的富文本
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
                
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-15T12:30:20+08:00">2018-04-15</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>周末闲着没事，就想着不如把那些容易遗忘的知识点整理一下，一来可以让有需要的朋友少走弯路，二来自己以后再忘记的时候也可以回头看看……但 iOS 中小冷易忘的知识点实在太多了，不知道该从哪里开始整理，“百无聊赖”逛了下淘宝，发现里面好多都是富文本，就想着为什么不从富文本开始呢？反正闲着也是闲着……于是就有了下面这些东西，希望可以帮到看到的盆友们！</p>
<ul>
<li>先写一个小引子<blockquote>
<p>在项目中，很多时候我们都需要把文字设置成倾斜、加粗、加下划线、加删除线、加阴影等等状态，就比如下面这张图：<br><img src="http://upload-images.jianshu.io/upload_images/2665449-efaea7b3b4c215d4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="不是打广告哦"></p>
</blockquote>
</li>
</ul>
<p>但如果我们只是简单的设置字体<br><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">self.textView<span class="meta">.text</span> = @<span class="string">"很好玩的富文本"</span><span class="comment">;</span></span><br></pre></td></tr></table></figure></p>
<p>显示出来大概是这个样子滴：<br><img src="http://upload-images.jianshu.io/upload_images/2665449-ab7fd6348e681a88.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="普通文本"></p>
<p>为了让文字变的好看一些，接下来我们尝试一下富文本！</p>
<ul>
<li>改变字体颜色</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSMutableAttributedString</span> *string = [[<span class="built_in">NSMutableAttributedString</span> alloc] initWithString:<span class="string">@"很好玩的富文本"</span>];</span><br><span class="line"></span><br><span class="line">[string addAttribute:<span class="built_in">NSForegroundColorAttributeName</span> value:[<span class="built_in">UIColor</span> blueColor] range:<span class="built_in">NSMakeRange</span>(<span class="number">1</span>, <span class="number">2</span>)];</span><br><span class="line">[string addAttribute:<span class="built_in">NSForegroundColorAttributeName</span> value:[<span class="built_in">UIColor</span> redColor] range:<span class="built_in">NSMakeRange</span>(<span class="number">3</span>, <span class="number">1</span>)];</span><br><span class="line">[string addAttribute:<span class="built_in">NSForegroundColorAttributeName</span> value:[<span class="built_in">UIColor</span> blueColor] range:<span class="built_in">NSMakeRange</span>(<span class="number">4</span>, <span class="number">3</span>)];</span><br><span class="line"><span class="keyword">self</span>.textView.attributedText = string;</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-9ab05decdf730650.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="改变字体颜色"></p>
<ul>
<li>改变字体大小</li>
</ul>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">NSMutableAttributedString *string = [[NSMutableAttributedString alloc] <span class="string">initWithString:</span>@<span class="string">"很好玩的富文本"</span>];</span><br><span class="line">[string <span class="string">addAttribute:</span>NSFontAttributeName <span class="string">value:</span>[UIFont <span class="string">systemFontOfSize:</span><span class="number">20</span>] <span class="string">range:</span>NSMakeRange(<span class="number">1</span>, <span class="number">2</span>)];</span><br><span class="line">[string <span class="string">addAttribute:</span>NSFontAttributeName <span class="string">value:</span>[UIFont <span class="string">systemFontOfSize:</span><span class="number">30</span>] <span class="string">range:</span>NSMakeRange(<span class="number">4</span>, <span class="number">3</span>)];</span><br><span class="line">self.textView.attributedText = string;</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-c85ab447f29b3333.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="改变字体大小"></p>
<ul>
<li>给文字添加背景色<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSMutableAttributedString</span> *string = [[<span class="built_in">NSMutableAttributedString</span> alloc] initWithString:<span class="string">@"很好玩的富文本"</span>];</span><br><span class="line">[string addAttribute:<span class="built_in">NSBackgroundColorAttributeName</span> value:[<span class="built_in">UIColor</span> cyanColor] range:<span class="built_in">NSMakeRange</span>(<span class="number">1</span>, <span class="number">2</span>)];</span><br><span class="line">[string addAttribute:<span class="built_in">NSBackgroundColorAttributeName</span> value:[<span class="built_in">UIColor</span> yellowColor] range:<span class="built_in">NSMakeRange</span>(<span class="number">4</span>, <span class="number">3</span>)];</span><br><span class="line"><span class="keyword">self</span>.textView.attributedText = string;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-5b3beb42cba98ef1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="给文字添加背景色"></p>
<ul>
<li>给文字设置间距<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSMutableAttributedString</span> *string = [[<span class="built_in">NSMutableAttributedString</span> alloc] initWithString:<span class="string">@"很好玩的富文本"</span>];</span><br><span class="line">[string addAttribute:<span class="built_in">NSKernAttributeName</span> value:@(<span class="number">20</span>) range:<span class="built_in">NSMakeRange</span>(<span class="number">0</span>, <span class="number">6</span>)];</span><br><span class="line"><span class="keyword">self</span>.textView.attributedText = string;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-faf5af7f1000d40e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="给文字设置间距"></p>
<ul>
<li>字体倾斜<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSMutableAttributedString</span> *string = [[<span class="built_in">NSMutableAttributedString</span> alloc] initWithString:<span class="string">@"很好玩的富文本"</span>];</span><br><span class="line">[string addAttribute:<span class="built_in">NSObliquenessAttributeName</span> value:@(<span class="number">0.5</span>) range:<span class="built_in">NSMakeRange</span>(<span class="number">0</span>, <span class="number">7</span>)];</span><br><span class="line"><span class="keyword">self</span>.textView.attributedText = string;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-84144fae563a02fd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="字体倾斜"></p>
<ul>
<li>字体加粗<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSMutableAttributedString</span> *string = [[<span class="built_in">NSMutableAttributedString</span> alloc] initWithString:<span class="string">@"很好玩的富文本"</span>];</span><br><span class="line">[string addAttribute:<span class="built_in">NSExpansionAttributeName</span> value:@(<span class="number">0.5</span>) range:<span class="built_in">NSMakeRange</span>(<span class="number">4</span>, <span class="number">3</span>)];</span><br><span class="line"><span class="keyword">self</span>.textView.attributedText = string;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-1a4c2b74f132931e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="字体加粗"></p>
<ul>
<li>加下划线并设置下划线颜色<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSMutableAttributedString</span> *string = [[<span class="built_in">NSMutableAttributedString</span> alloc] initWithString:<span class="string">@"很好玩的富文本"</span>];</span><br><span class="line">[string addAttribute:<span class="built_in">NSUnderlineStyleAttributeName</span> value:@(<span class="number">1</span>) range:<span class="built_in">NSMakeRange</span>(<span class="number">4</span>, <span class="number">3</span>)];</span><br><span class="line">[string addAttribute:<span class="built_in">NSUnderlineColorAttributeName</span> value:[<span class="built_in">UIColor</span> blueColor] range:<span class="built_in">NSMakeRange</span>(<span class="number">4</span>, <span class="number">3</span>)];</span><br><span class="line"><span class="keyword">self</span>.textView.attributedText = string;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-54fdb333b29af0a2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="加下划线并设置下划线颜色"></p>
<ul>
<li>加删除线并设置删除线颜色<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSMutableAttributedString</span> *string = [[<span class="built_in">NSMutableAttributedString</span> alloc] initWithString:<span class="string">@"原价666💰，现价只要66💰！"</span>];</span><br><span class="line">[string addAttribute:<span class="built_in">NSStrikethroughStyleAttributeName</span> value:@(<span class="number">1</span>) range:<span class="built_in">NSMakeRange</span>(<span class="number">2</span>, <span class="number">3</span>)];</span><br><span class="line">[string addAttribute:<span class="built_in">NSStrikethroughColorAttributeName</span> value:[<span class="built_in">UIColor</span> blueColor] range:<span class="built_in">NSMakeRange</span>(<span class="number">2</span>, <span class="number">3</span>)];</span><br><span class="line"><span class="keyword">self</span>.textView.attributedText = string;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-7660641928dfc070.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="加删除线并设置删除线颜色"></p>
<ul>
<li>设置文字方向<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">NSMutableAttributedString *string = [[NSMutableAttributedString alloc] <span class="string">initWithString:</span>@<span class="string">"很好玩的富文本"</span>];</span><br><span class="line">[string <span class="string">addAttribute:</span>NSVerticalGlyphFormAttributeName <span class="string">value:</span>@(<span class="number">1</span>) <span class="string">range:</span>NSMakeRange(<span class="number">0</span>, <span class="number">7</span>)];</span><br><span class="line">[string <span class="string">addAttribute:</span>NSWritingDirectionAttributeName <span class="string">value:</span>@[@(<span class="number">2</span>),@(<span class="number">3</span>)] <span class="string">range:</span>NSMakeRange(<span class="number">0</span>, <span class="number">7</span>)];</span><br><span class="line">self.textView.attributedText = string;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-3e892743a9f112f5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="设置文字方向"></p>
<ul>
<li>给文字添加阴影<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">NSMutableAttributedString *string = [[NSMutableAttributedString alloc] initWithString:@<span class="string">"很好玩的富文本"</span>]<span class="comment">;</span></span><br><span class="line">NSShadow *<span class="keyword">shadow </span>= [[NSShadow alloc]init]<span class="comment">;</span></span><br><span class="line"><span class="keyword">shadow.shadowOffset </span>= CGSizeMake(<span class="number">5</span>, <span class="number">5</span>)<span class="comment">;</span></span><br><span class="line"><span class="keyword">shadow.shadowColor </span>= [UIColor <span class="keyword">blueColor];</span></span><br><span class="line"><span class="keyword">shadow.shadowBlurRadius </span>= <span class="number">1</span><span class="comment">;</span></span><br><span class="line">[string <span class="keyword">addAttribute:NSShadowAttributeName </span>value:<span class="keyword">shadow </span>range:NSMakeRange(<span class="number">4</span>, <span class="number">3</span>)]<span class="comment">;</span></span><br><span class="line">self.textView.attributedText = string<span class="comment">;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-8f882d994febb18b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="给文字添加阴影"></p>
<ul>
<li>图文混排</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSMutableAttributedString</span> *string = [[<span class="built_in">NSMutableAttributedString</span> alloc] initWithString:<span class="string">@"很好玩的富文本"</span>];</span><br><span class="line"><span class="comment">// 创建图片图片附件</span></span><br><span class="line"><span class="built_in">NSTextAttachment</span> *attach = [[<span class="built_in">NSTextAttachment</span> alloc] init];</span><br><span class="line">attach.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"1.jpg"</span>];</span><br><span class="line">attach.bounds = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">20</span>, <span class="number">20</span>);</span><br><span class="line"><span class="built_in">NSAttributedString</span> *attachString = [<span class="built_in">NSAttributedString</span> attributedStringWithAttachment:attach];</span><br><span class="line">[string appendAttributedString:attachString];</span><br><span class="line"><span class="keyword">self</span>.textView.attributedText = string;</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-27adc1a27e0637ee.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图文混排"></p>
<ul>
<li>文字偏移<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">NSMutableAttributedString *string = [[NSMutableAttributedString alloc] <span class="string">initWithString:</span>@<span class="string">"很好玩的富文本"</span>];</span><br><span class="line">[string <span class="string">addAttribute:</span>NSBaselineOffsetAttributeName <span class="string">value:</span>@(<span class="number">10</span>) <span class="string">range:</span>NSMakeRange(<span class="number">0</span>, <span class="number">1</span>)];</span><br><span class="line">[string <span class="string">addAttribute:</span>NSBaselineOffsetAttributeName <span class="string">value:</span>@(<span class="number">20</span>) <span class="string">range:</span>NSMakeRange(<span class="number">1</span>, <span class="number">1</span>)];</span><br><span class="line">[string <span class="string">addAttribute:</span>NSBaselineOffsetAttributeName <span class="string">value:</span>@(<span class="number">30</span>) <span class="string">range:</span>NSMakeRange(<span class="number">2</span>, <span class="number">1</span>)];</span><br><span class="line">[string <span class="string">addAttribute:</span>NSBaselineOffsetAttributeName <span class="string">value:</span>@(<span class="number">40</span>) <span class="string">range:</span>NSMakeRange(<span class="number">3</span>, <span class="number">1</span>)];</span><br><span class="line">[string <span class="string">addAttribute:</span>NSBaselineOffsetAttributeName <span class="string">value:</span>@(<span class="number">50</span>) <span class="string">range:</span>NSMakeRange(<span class="number">4</span>, <span class="number">3</span>)];</span><br><span class="line">self.textView.attributedText = string;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-4e0d6a0908bfb1e7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="文字偏移"></p>
<p>以上是对 iOS 中富文本相关的知识做的一些整理，如果有粗心写错的地方，还请朋友们指出！如果还有遗漏的地方，以后碰到了再来补充。。。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/15/iOS开发之 - 多线程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="刘朋坤">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="以梦为马">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/15/iOS开发之 - 多线程/" itemprop="url">
                  iOS开发之 - 多线程
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
                
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-15T12:30:20+08:00">2018-04-15</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="http://upload-images.jianshu.io/upload_images/2665449-72633919539a5942.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="iOS开发之 － 多线程"></p>
<blockquote>
<p>最近利用晚上的空闲时间，整理了一下多线程相关的知识，几经更改，就变成你现在看到的模样了（如有失误之处，还请不吝赐教）。把多线程相关的知识总结在这里，只希望对看到的朋友们有所帮助！文章有些长，涵盖的知识点也比较多，希望朋友们能够耐心读完哈！我们这篇文章主要包括以下几个模块：</p>
</blockquote>
<ul>
<li><strong>（一）iOS开发之多线程 基础知识</strong></li>
<li><strong>（二）iOS开发之多线程 NSThread</strong></li>
<li><strong>（三）iOS开发之多线程 NSOperation</strong></li>
<li><strong>（四）iOS开发之多线程 GCD</strong></li>
<li><strong>（五）iOS开发之多线程 线程间的通信</strong></li>
</ul>
<p><em>下面我们开始了解 iOS 多线程的基础知识，如果在此之前对多线程已经有所了解的朋友，大可跳过这一部分，直接看后边三种多线程编程的 demo 即可！</em></p>
<h2 id="（一）iOS-开发之多线程-基础知识"><a href="#（一）iOS-开发之多线程-基础知识" class="headerlink" title="（一）iOS 开发之多线程 基础知识"></a>（一）iOS 开发之多线程 基础知识</h2><h3 id="1-多线程简介"><a href="#1-多线程简介" class="headerlink" title="1.多线程简介:"></a>1.多线程简介:</h3><p>一个进程要想执行任务, 必须得有线程(每个进程至少要有一条线程), 线程是进程的基本执行单元, 一个进程（程序）的所有任务都在线程中执行.</p>
<h3 id="2-多线程的原理"><a href="#2-多线程的原理" class="headerlink" title="2.多线程的原理:"></a>2.多线程的原理:</h3><p>同一时间, CPU 只能处理一条线程,只有一条线程在工作.<br>多线程并发(同时)执行, 其实是 CPU 快速地在多条线程之间调度.<br>如果 CPU 调度线程的时间足够快,就造成了多线程并发执行的假象.</p>
<h3 id="3-多线程的优缺点"><a href="#3-多线程的优缺点" class="headerlink" title="3.多线程的优缺点:"></a>3.多线程的优缺点:</h3><h4 id="多线程的优点"><a href="#多线程的优点" class="headerlink" title="多线程的优点:"></a>多线程的优点:</h4><p>能适当提高程序的执行效率.<br>能适当提高资源利用率(CPU、内存利用率).</p>
<h4 id="多线程的缺点"><a href="#多线程的缺点" class="headerlink" title="多线程的缺点:"></a>多线程的缺点:</h4><p>开启线程需要占用一定的内存空间(默认情况下，主线程占用1M，子线程占用512KB),如果开启大量的线程,会占用大量的内存空间,降低程序的性能.</p>
<h3 id="4-多线程在-iOS-开发中的应用"><a href="#4-多线程在-iOS-开发中的应用" class="headerlink" title="4.多线程在 iOS 开发中的应用:"></a>4.多线程在 iOS 开发中的应用:</h3><p>主线程:一个 iOS 程序运行后，默认会开启1条线程，称为“主线程”或“ UI 线程”.<br>主线程的主要作用:刷新 UI 界面、处理 UI 事件(比如点击事件、滚动事件、拖拽事件等).</p>
<h3 id="5-iOS-中三种多线程编程的技术，分别是："><a href="#5-iOS-中三种多线程编程的技术，分别是：" class="headerlink" title="5.iOS 中三种多线程编程的技术，分别是："></a>5.iOS 中三种多线程编程的技术，分别是：</h3><h4 id="（一）NSThread"><a href="#（一）NSThread" class="headerlink" title="（一）NSThread"></a>（一）NSThread</h4><h4 id="（二）Cocoa-NSOperation"><a href="#（二）Cocoa-NSOperation" class="headerlink" title="（二）Cocoa NSOperation"></a>（二）Cocoa NSOperation</h4><h4 id="（三）GCD（全称：Grand-Central-Dispatch）"><a href="#（三）GCD（全称：Grand-Central-Dispatch）" class="headerlink" title="（三）GCD（全称：Grand Central Dispatch）"></a>（三）GCD（全称：Grand Central Dispatch）</h4><p>这三种编程方式从上到下，抽象度层次是从低到高的，抽象度越高的使用越简单，也是Apple最推荐使用的。</p>
<h4 id="三种方式的优缺点介绍："><a href="#三种方式的优缺点介绍：" class="headerlink" title="三种方式的优缺点介绍："></a>三种方式的优缺点介绍：</h4><h5 id="NSThread"><a href="#NSThread" class="headerlink" title="NSThread:"></a>NSThread:</h5><p>优点：NSThread 比其他两个轻量级<br>缺点：需要自己管理线程的生命周期，线程同步。线程同步对数据的加锁会有一定的系统开销。</p>
<h5 id="Cocoa-NSOperation"><a href="#Cocoa-NSOperation" class="headerlink" title="Cocoa NSOperation"></a>Cocoa NSOperation</h5><p>优点：不需要关心线程管理，数据同步的事情，可以把精力放在自己需要执行的操作上。<br>Cocoa operation 相关的类是 NSOperation ，NSOperationQueue。<br>NSOperation是个抽象类，使用它必须用它的子类，可以实现它或者使用它定义好的两个子类：NSInvocationOperation 和 NSBlockOperation。<br>创建NSOperation子类的对象，把对象添加到NSOperationQueue队列里执行。</p>
<h5 id="GCD"><a href="#GCD" class="headerlink" title="GCD"></a>GCD</h5><p>Grand Central Dispatch (GCD)是Apple开发的一个多核编程的解决方法。在iOS4.0开始之后才能使用。GCD是一个替代诸如NSThread, NSOperationQueue, NSInvocationOperation等技术的很高效和强大的技术。</p>
<hr>
<p><em>对 iOS 基础知识有了一定了解之后，下边我们开始看多线程相关的一些 demo， 建议朋友们试试下边的 demo，这样更方便理解！如有疑问，或发现某些 demo 写的有误，还请朋友们告知！</em></p>
<p><strong>下边我们开始了解NSThread，NSThread 其实用的真不多，主要还是用另外两种，不过作为 iOS 开发者，还是应该对它有些了解的，下边是 NSThread 相关的 demo ！</strong></p>
<h2 id="（二）iOS-开发之多线程-NSThread"><a href="#（二）iOS-开发之多线程-NSThread" class="headerlink" title="（二）iOS 开发之多线程 NSThread"></a>（二）iOS 开发之多线程 NSThread</h2><h3 id="一、NSThread-初始化"><a href="#一、NSThread-初始化" class="headerlink" title="一、NSThread 初始化"></a>一、NSThread 初始化</h3><h4 id="1-动态方法"><a href="#1-动态方法" class="headerlink" title="1.动态方法"></a>1.动态方法</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">id</span>)initWithTarget:(<span class="keyword">id</span>)target selector:(SEL)selector object:(<span class="keyword">id</span>)argument</span><br><span class="line"><span class="comment">// 初始化线程</span></span><br><span class="line"><span class="built_in">NSThread</span>* thread = [[<span class="built_in">NSThread</span> alloc] initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(doSomething:)object:<span class="literal">nil</span>];</span><br><span class="line"><span class="comment">// 线程名字</span></span><br><span class="line">thread.name = <span class="string">@"MYThread"</span>;</span><br><span class="line"><span class="comment">// 启动线程</span></span><br><span class="line">[thread start];</span><br></pre></td></tr></table></figure>
<h4 id="2-静态方法"><a href="#2-静态方法" class="headerlink" title="2.静态方法"></a>2.静态方法</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="keyword">void</span>)detachNewThreadSelector:(SEL)aSelector toTarget:(<span class="keyword">id</span>)aTarget withObject:(<span class="keyword">id</span>)anArgument</span><br><span class="line">[<span class="built_in">NSThread</span> detachNewThreadSelector:<span class="keyword">@selector</span>(doSomething:) toTarget:<span class="keyword">self</span> withObject:<span class="literal">nil</span>];</span><br><span class="line"><span class="comment">// 调用完毕后，会马上创建并开启新线程</span></span><br></pre></td></tr></table></figure>
<h4 id="3-隐式创建线程的方法："><a href="#3-隐式创建线程的方法：" class="headerlink" title="3.隐式创建线程的方法："></a>3.隐式创建线程的方法：</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)performSelectorInBackground:(SEL)aSelector withObject:(<span class="keyword">id</span>)arg;</span><br><span class="line">[<span class="keyword">self</span> performSelectorInBackground:<span class="keyword">@selector</span>(run) withObject:<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p><strong>提示朋友们一下:第一种方式会直接创建线程并且开始运行线程，第二种方式是先创建线程对象，然后再运行线程操作，在运行线程操作前可以设置线程的优先级等线程信息</strong></p>
<h3 id="二、线程间的通信"><a href="#二、线程间的通信" class="headerlink" title="二、线程间的通信"></a>二、线程间的通信</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在主线程上执行操作</span></span><br><span class="line">[<span class="keyword">self</span> performSelectorOnMainThread:<span class="keyword">@selector</span>(run) withObject:<span class="literal">nil</span> waitUntilDone:<span class="literal">YES</span>];</span><br><span class="line"><span class="comment">//在当前线程执行操作</span></span><br><span class="line">[<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(run) withObject:<span class="literal">nil</span>];</span><br><span class="line"><span class="comment">//在指定线程上执行操作</span></span><br><span class="line">[<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(run) onThread:thread withObject:<span class="literal">nil</span> waitUntilDone:<span class="literal">YES</span>];</span><br></pre></td></tr></table></figure>
<h3 id="三、一些简单方法"><a href="#三、一些简单方法" class="headerlink" title="三、一些简单方法"></a>三、一些简单方法</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取当前线程</span></span><br><span class="line"><span class="built_in">NSThread</span> *thread = [<span class="built_in">NSThread</span> currentThread];</span><br><span class="line"><span class="comment">//获取主线程</span></span><br><span class="line"><span class="built_in">NSThread</span> *main = [<span class="built_in">NSThread</span> mainThread];</span><br><span class="line"><span class="comment">//睡眠，相当于暂停</span></span><br><span class="line">[<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">3</span>];</span><br></pre></td></tr></table></figure>
<hr>
<p><em>NSThread  就说到这，一起再看下NSOperation， NSOperation 在开发中用的还是挺多的，虽然苹果建议使用 GCD ，但依然有开发者觉得 NSOperation  比 GCD 更好用！仁者见仁智者见智吧！本小白觉得如果能掌握还是都掌握的好！</em></p>
<h2 id="（三）iOS开发之多线程-NSOperation"><a href="#（三）iOS开发之多线程-NSOperation" class="headerlink" title="（三）iOS开发之多线程 NSOperation"></a>（三）iOS开发之多线程 NSOperation</h2><h3 id="一、创建线程的方式"><a href="#一、创建线程的方式" class="headerlink" title="一、创建线程的方式"></a>一、创建线程的方式</h3><p>使用NSOperation创建线程的方式有3种:</p>
<p>（1）NSInvocationOperation 方式<br>（2）NSBlockOperation 方式<br>（3）自定义子类继承NSOperation,实现内部相应的⽅法</p>
<p>下面是这三种方式创建线程的具体方法：</p>
<h4 id="1-NSInvocationOperation"><a href="#1-NSInvocationOperation" class="headerlink" title="1.NSInvocationOperation"></a>1.NSInvocationOperation</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)invocationOperation</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//创建NSInvocationOperation对象</span></span><br><span class="line"><span class="built_in">NSInvocationOperation</span> *operation = [[<span class="built_in">NSInvocationOperation</span> alloc] initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(run) object:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//开始执行操作</span></span><br><span class="line">[operation start];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//一旦执行操作,就会调用target的run方法</span></span><br></pre></td></tr></table></figure>
<p>提示:默认情况下,调用了start方法后并不会开一条新线程去执行操作,只有将NSOperation放到一个NSOperationQueue中,才会异步执行操作.</p>
<h4 id="2-NSBlockOperation"><a href="#2-NSBlockOperation" class="headerlink" title="2.NSBlockOperation"></a>2.NSBlockOperation</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)blockOperation</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//创建NSBlockOperation对象</span></span><br><span class="line"><span class="built_in">NSBlockOperation</span> *operation = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^&#123;</span><br><span class="line"><span class="comment">// 主线程</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"1---%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;];</span><br><span class="line"><span class="comment">// 添加任务(在子线程执行)</span></span><br><span class="line">[operation addExecutionBlock:^&#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"2---%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;];</span><br><span class="line">[operation addExecutionBlock:^&#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"3---%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;];</span><br><span class="line"><span class="comment">//开启执行操作</span></span><br><span class="line">[operation start];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>提示:只要NSBlockOperation封装的操作数 &gt; 1,就会异步执行操作</p>
<h4 id="3-自定义子类继承自NSOperation"><a href="#3-自定义子类继承自NSOperation" class="headerlink" title="3.自定义子类继承自NSOperation"></a>3.自定义子类继承自NSOperation</h4><p>自定义NSOperation子类需要重写 - (void)main方法</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)main</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// 新建一个自动释放池，如果是异步执行操作，那么将无法访问到主线程的自动释放池</span></span><br><span class="line"><span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i&lt;<span class="number">100</span>; i++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"1 - %ld - %@"</span>, i, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//检测操作是否被取消,对取消做出响应</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">self</span>.isCancelled) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i&lt;<span class="number">100</span>; i++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"2 - %ld - %@"</span>, i, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">self</span>.isCancelled) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i&lt;<span class="number">100</span>; i++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"3 - %ld - %@"</span>, i, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">self</span>.isCancelled) <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="二、NSOperationQueue的应用"><a href="#二、NSOperationQueue的应用" class="headerlink" title="二、NSOperationQueue的应用"></a>二、NSOperationQueue的应用</h3><p>一个NSOperation对象可以通过调用start方法来执行任务,默认是同步执行的.也可以将NSOperation添加到一个NSOperationQueue中去执行,而且是异步执行的.</p>
<h4 id="1-NSOperationQueue简单创建"><a href="#1-NSOperationQueue简单创建" class="headerlink" title="1.NSOperationQueue简单创建"></a>1.NSOperationQueue简单创建</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//第一种方式</span></span><br><span class="line">- (<span class="keyword">void</span>)operationQueue</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// 创建NSOperationQueue队列</span></span><br><span class="line"><span class="built_in">NSOperationQueue</span> *queue = [[<span class="built_in">NSOperationQueue</span> alloc] init];</span><br><span class="line"><span class="comment">// 创建NSInvocationOperation对象</span></span><br><span class="line"><span class="built_in">NSInvocationOperation</span> *operation1 = [[<span class="built_in">NSInvocationOperation</span> alloc] initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(run1) object:<span class="literal">nil</span>];</span><br><span class="line"><span class="built_in">NSInvocationOperation</span> *operation2 = [[<span class="built_in">NSInvocationOperation</span> alloc] initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(run2) object:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建NSBlockOperation对象</span></span><br><span class="line"><span class="built_in">NSBlockOperation</span> *operation3 = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^&#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"1 --- %@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;];</span><br><span class="line">[operation3 addExecutionBlock:^&#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"2 --- %@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;];</span><br><span class="line"><span class="built_in">NSBlockOperation</span> *operation4 = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^&#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"3 --- %@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;];</span><br><span class="line"><span class="comment">// 添加任务到队列中</span></span><br><span class="line">[queue addOperation:operation1];</span><br><span class="line">[queue addOperation:operation2];</span><br><span class="line">[queue addOperation:operation3];</span><br><span class="line">[queue addOperation:operation4];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//第二种方式</span></span><br><span class="line">- (<span class="keyword">void</span>)operationQueue2</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// 创建NSOperationQueue队列</span></span><br><span class="line"><span class="built_in">NSOperationQueue</span> *queue = [[<span class="built_in">NSOperationQueue</span> alloc] init];</span><br><span class="line">[queue addOperationWithBlock:^&#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"1 --- %@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;];</span><br><span class="line">[queue addOperationWithBlock:^&#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"2 --- %@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-NSOperation中的操作依赖"><a href="#2-NSOperation中的操作依赖" class="headerlink" title="2.NSOperation中的操作依赖"></a>2.NSOperation中的操作依赖</h4><p>NSOperation之间可以设置依赖来保证执行顺序,比如一定要让操作A执行完后,才能执行操作B,可以这么写[operationB addDependency:operationA]; // 操作B依赖于操作operationA,另外,通过removeDependency方法可以删除依赖对象.</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#pragma mark - 依赖操作调整执行顺序</span></span><br><span class="line">- (<span class="keyword">void</span>)<span class="built_in">NSOperationTest1</span> &#123;</span><br><span class="line"><span class="built_in">NSOperationQueue</span> *queue = [[<span class="built_in">NSOperationQueue</span> alloc] init];</span><br><span class="line"><span class="built_in">NSBlockOperation</span> *op1 = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^&#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"~~1~~%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;];</span><br><span class="line"><span class="built_in">NSBlockOperation</span> *op2 = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"~~2~~%@~~%d~~"</span>, [<span class="built_in">NSThread</span> currentThread], i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;];</span><br><span class="line"><span class="built_in">NSBlockOperation</span> *op3 = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^&#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"~~3~~%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;];</span><br><span class="line">[op2 addExecutionBlock:^&#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"~~4~~%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;];</span><br><span class="line">op3.completionBlock = ^&#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"~~5~~%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 设置依赖</span></span><br><span class="line">[op1 addDependency:op2];</span><br><span class="line">[op1 addDependency:op3];</span><br><span class="line">[queue addOperation:op1];</span><br><span class="line">[queue addOperation:op2];</span><br><span class="line">[queue addOperation:op3];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-线程间的通信"><a href="#3-线程间的通信" class="headerlink" title="3.线程间的通信"></a>3.线程间的通信</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#pragma mark - NSOperation实现线程间的通信</span></span><br><span class="line">- (<span class="keyword">void</span>)<span class="built_in">NSOperationTest2</span> &#123;</span><br><span class="line">[[[<span class="built_in">NSOperationQueue</span> alloc] init] addOperationWithBlock:^&#123;</span><br><span class="line"><span class="built_in">NSData</span> *data = [<span class="built_in">NSData</span> dataWithContentsOfURL:[<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://img.lanrentuku.com/img/allimg/1310/13822295641903.jpg"</span>]];</span><br><span class="line"></span><br><span class="line"><span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageWithData:data];</span><br><span class="line"></span><br><span class="line">[[<span class="built_in">NSOperationQueue</span> mainQueue] addOperationWithBlock:^&#123;</span><br><span class="line"><span class="keyword">self</span>.imageview.image = image;</span><br><span class="line">&#125;];</span><br><span class="line">&#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="三、一些简单方法-1"><a href="#三、一些简单方法-1" class="headerlink" title="三、一些简单方法"></a>三、一些简单方法</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 取消单个操作</span></span><br><span class="line">[operation cancel];</span><br><span class="line"><span class="comment">// 取消queue中所有的操作</span></span><br><span class="line">[queue cancelAllOperations];</span><br><span class="line"><span class="comment">//设置队列的最大并发操作数量</span></span><br><span class="line">queue.maxConcurrentOperationCount = <span class="number">1</span>;</span><br><span class="line"><span class="comment">// 会阻塞当前线程，等到某个operation执行完毕</span></span><br><span class="line">[operation waitUntilFinished];</span><br><span class="line"><span class="comment">// 阻塞当前线程，等待queue的所有操作执行完毕</span></span><br><span class="line">[queue waitUntilAllOperationsAreFinished];</span><br><span class="line"><span class="comment">// 暂停queue YES代表暂停队列,NO代表恢复队列</span></span><br><span class="line">[queue setSuspended:<span class="literal">YES</span>];</span><br></pre></td></tr></table></figure>
<hr>
<p><em>NSOperation 常用的基本上也就上面那些了。。。GCD 就不用多说了，老东家苹果推荐的，不过我却觉得名字太长~~~，一开始总是记不住，多敲就好了！所有编程语言大概都有这么一个绝招O(∩_∩)O！</em></p>
<h2 id="（四）iOS开发之多线程-GCD"><a href="#（四）iOS开发之多线程-GCD" class="headerlink" title="（四）iOS开发之多线程 GCD"></a>（四）iOS开发之多线程 GCD</h2><h3 id="一、GCD-术语"><a href="#一、GCD-术语" class="headerlink" title="一、GCD 术语"></a>一、GCD 术语</h3><p>要理解GCD ，我们先来熟悉与线程和并发相关的几个概念。</p>
<h4 id="1-Serial-vs-Concurrent-串行-vs-并发"><a href="#1-Serial-vs-Concurrent-串行-vs-并发" class="headerlink" title="1.Serial vs. Concurrent 串行 vs. 并发"></a>1.Serial vs. Concurrent 串行 vs. 并发</h4><p>任务串行执行就是每次只有一个任务被执行，任务并发执行就是在同一时间可以有多个任务被执行。</p>
<h4 id="2-同步（Synchronous）与异步（Asynchronous）"><a href="#2-同步（Synchronous）与异步（Asynchronous）" class="headerlink" title="2.同步（Synchronous）与异步（Asynchronous）"></a>2.同步（Synchronous）与异步（Asynchronous）</h4><p>同步，意味着在当前线程中执行任务，不具备开启新的线程的能力。<br>异步，在新的线程中执行任务，具备开启新的线程的能力。</p>
<h4 id="3-临界区（Critical-Section）"><a href="#3-临界区（Critical-Section）" class="headerlink" title="3.临界区（Critical Section）"></a>3.临界区（Critical Section）</h4><p>就是一段代码不能被并发执行，即两个线程不能同时执行这段代码。</p>
<h4 id="4-死锁（Deadlock）"><a href="#4-死锁（Deadlock）" class="headerlink" title="4.死锁（Deadlock）"></a>4.死锁（Deadlock）</h4><p>停止等待事情的线程会导致多个线程相互维持等待，即死锁。</p>
<h4 id="5-Thread-Safe-线程安全"><a href="#5-Thread-Safe-线程安全" class="headerlink" title="5.Thread Safe 线程安全"></a>5.Thread Safe 线程安全</h4><p>线程安全的代码能在多线程或并发任务中被安全的调用，而不会导致任何问题（数据损坏，崩溃等）。</p>
<h4 id="6-Queues-队列"><a href="#6-Queues-队列" class="headerlink" title="6.Queues 队列"></a>6.Queues 队列</h4><p>GCD 提供有 dispatch queues 来处理代码块，这些队列管理你提供给 GCD 的任务并用 FIFO 顺序执行这些任务。</p>
<h3 id="二、代码演示"><a href="#二、代码演示" class="headerlink" title="二、代码演示"></a>二、代码演示</h3><h3 id="1、dispatch-async-异步函数"><a href="#1、dispatch-async-异步函数" class="headerlink" title="1、dispatch_async(异步函数)"></a>1、dispatch_async(异步函数)</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//异步函数 + 并发队列:可以同时开启多条线程,任务是并行的</span></span><br><span class="line"><span class="comment">// 1.创建并发队列</span></span><br><span class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</span><br><span class="line"><span class="comment">//2.将任务加入队列</span></span><br><span class="line"><span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span> ; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%ld~~~~1~~~~%@"</span>, i, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%ld~~~2~~~%@"</span>, i, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%ld~~~~3~~~~%@"</span>, i, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//异步函数 + 串行队列:会开启新的线程，但是任务是串行的，执行完一个任务，再执行下一个任务</span></span><br><span class="line"><span class="comment">// 1.创建串行队列</span></span><br><span class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_queue_create(<span class="string">"YMWM"</span>, DISPATCH_QUEUE_SERIAL);</span><br><span class="line"><span class="comment">// 2.将任务加入队列</span></span><br><span class="line"><span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span> ; i ++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"1~~~%@~~~~~%ld"</span>, [<span class="built_in">NSThread</span> currentThread], i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"2~~~%@~~~~~%ld"</span>, [<span class="built_in">NSThread</span> currentThread], i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"2~~~%@~~~~~%ld"</span>, [<span class="built_in">NSThread</span> currentThread], i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="2、dispatch-sync-同步函数"><a href="#2、dispatch-sync-同步函数" class="headerlink" title="2、dispatch_sync(同步函数)"></a>2、dispatch_sync(同步函数)</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//同步函数 + 并发队列:不会开启新的线程</span></span><br><span class="line"><span class="comment">// 1.获得全局的并发队列</span></span><br><span class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// 2.将任务加入队列</span></span><br><span class="line"><span class="built_in">dispatch_sync</span>(queue, ^&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"1~~~%@~~~~~%ld"</span>, [<span class="built_in">NSThread</span> currentThread], i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_sync</span>(queue, ^&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"2~~~%@~~~~~%ld"</span>, [<span class="built_in">NSThread</span> currentThread], i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_sync</span>(queue, ^&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"3~~~%@~~~~~%ld"</span>, [<span class="built_in">NSThread</span> currentThread], i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//同步函数 + 串行队列:不会开启新的线程</span></span><br><span class="line"><span class="comment">// 1.创建串行队列</span></span><br><span class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_queue_create(<span class="string">"YMWM"</span>, DISPATCH_QUEUE_SERIAL);</span><br><span class="line"><span class="comment">// 2.将任务加入队列</span></span><br><span class="line"><span class="built_in">dispatch_sync</span>(queue, ^&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"1~~~%@~~~~~%ld"</span>, [<span class="built_in">NSThread</span> currentThread], i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_sync</span>(queue, ^&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"2~~~%@~~~~~%ld"</span>, [<span class="built_in">NSThread</span> currentThread], i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_sync</span>(queue, ^&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"3~~~%@~~~~~%ld"</span>, [<span class="built_in">NSThread</span> currentThread], i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="3-两者在主队列中的应用"><a href="#3-两者在主队列中的应用" class="headerlink" title="3.两者在主队列中的应用"></a>3.两者在主队列中的应用</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//异步函数 + 主队列：只在主线程中执行任务</span></span><br><span class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_get_main_queue();</span><br><span class="line"><span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"1~~~%@~~~~~%ld"</span>, [<span class="built_in">NSThread</span> currentThread], i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"2~~~%@~~~~~%ld"</span>, [<span class="built_in">NSThread</span> currentThread], i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"3~~~%@~~~~~%ld"</span>, [<span class="built_in">NSThread</span> currentThread], i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//同步函数 + 主队列：死循环</span></span><br><span class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_get_main_queue();</span><br><span class="line"><span class="built_in">dispatch_sync</span>(queue, ^&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"1~~~%@~~~~~%ld"</span>, [<span class="built_in">NSThread</span> currentThread], i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_sync</span>(queue, ^&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"1~~~%@~~~~~%ld"</span>, [<span class="built_in">NSThread</span> currentThread], i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_sync</span>(queue, ^&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"1~~~%@~~~~~%ld"</span>, [<span class="built_in">NSThread</span> currentThread], i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="4、dispatch-group-async的使用"><a href="#4、dispatch-group-async的使用" class="headerlink" title="4、dispatch_group_async的使用"></a>4、dispatch_group_async的使用</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// 创建一个队列组</span></span><br><span class="line">dispatch_group_t group = dispatch_group_create();</span><br><span class="line">dispatch_group_async(group, queue, ^&#123;</span><br><span class="line"><span class="comment">//添加操作...</span></span><br><span class="line">[<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">1</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"1%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;);</span><br><span class="line">dispatch_group_async(group, queue, ^&#123;</span><br><span class="line"><span class="comment">//添加操作...</span></span><br><span class="line">[<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">1</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"2%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;);</span><br><span class="line">dispatch_group_async(group, queue, ^&#123;</span><br><span class="line"><span class="comment">//添加操作...</span></span><br><span class="line">[<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">1</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"3%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 回到主线程</span></span><br><span class="line">dispatch_group_notify(group, dispatch_get_main_queue(), ^&#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"回到主线程刷新UI"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="5、dispatch-barrier-async的使用"><a href="#5、dispatch-barrier-async的使用" class="headerlink" title="5、dispatch_barrier_async的使用"></a>5、dispatch_barrier_async的使用</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_queue_create(<span class="string">"YMWM"</span>, DISPATCH_QUEUE_CONCURRENT);</span><br><span class="line"><span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">[<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">.5</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"1%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">[<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">.5</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"2%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;);</span><br><span class="line">dispatch_barrier_async(queue, ^&#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"barrier --- %@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">[<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">.5</span>];</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"3%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"4%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="6、dispatch-apply的使用"><a href="#6、dispatch-apply的使用" class="headerlink" title="6、dispatch_apply的使用"></a>6、dispatch_apply的使用</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//执行某个代码片段10次</span></span><br><span class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</span><br><span class="line">dispatch_apply(<span class="number">10</span>, queue, ^(size_t index) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="7、dispatch-once-t的使用"><a href="#7、dispatch-once-t的使用" class="headerlink" title="7、dispatch_once_t的使用"></a>7、dispatch_once_t的使用</h4><p>第一个参数predicate，该参数是检查后面第二个参数所代表的代码块是否被调用的谓词，第二个参数则是在整个应用程序中只会被调用一次的代码块<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</span><br><span class="line"><span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h4 id="8-dispatch-after的使用"><a href="#8-dispatch-after的使用" class="headerlink" title="8.dispatch_after的使用"></a>8.dispatch_after的使用</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"-------"</span>);</span><br><span class="line"><span class="comment">//延迟执行，较为精确</span></span><br><span class="line">dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">2.0</span> * <span class="built_in">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"~~~~~~"</span>);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="9-线程间的通信"><a href="#9-线程间的通信" class="headerlink" title="9.线程间的通信"></a>9.线程间的通信</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#pragma mark - GCD-线程间的通信</span></span><br><span class="line">- (<span class="keyword">void</span>)downloadImage &#123;</span><br><span class="line"><span class="built_in">NSData</span> *data = [<span class="built_in">NSData</span> dataWithContentsOfURL:[<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://img.lanrentuku.com/img/allimg/1310/13822295641903.jpg"</span>]];</span><br><span class="line"></span><br><span class="line"><span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageWithData:data];</span><br><span class="line"></span><br><span class="line"><span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">self</span>.imageview.image = image;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="10-文件剪切"><a href="#10-文件剪切" class="headerlink" title="10.文件剪切"></a>10.文件剪切</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//第一种方式</span></span><br><span class="line"><span class="comment">//将文件从from剪切至to</span></span><br><span class="line"><span class="built_in">NSString</span> *from = <span class="string">@"/Users/iOS/Desktop/Test"</span>;</span><br><span class="line"><span class="built_in">NSString</span> *to = <span class="string">@"/Users/iOS/Desktop/test1"</span>;</span><br><span class="line"><span class="built_in">NSFileManager</span> *mgr = [<span class="built_in">NSFileManager</span> defaultManager];</span><br><span class="line"><span class="built_in">NSArray</span> *subpaths = [mgr subpathsAtPath:from];</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSString</span> *subpath <span class="keyword">in</span> subpaths) &#123;</span><br><span class="line"><span class="built_in">NSString</span> *fromFullpath = [from stringByAppendingPathComponent:subpath];</span><br><span class="line"><span class="built_in">NSString</span> *toFullpath = [to stringByAppendingPathComponent:subpath];</span><br><span class="line"><span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</span><br><span class="line"><span class="comment">//剪切</span></span><br><span class="line">[mgr moveItemAtPath:fromFullpath toPath:toFullpath error:<span class="literal">nil</span>];</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//第二种方式</span></span><br><span class="line"><span class="comment">//将文件从from剪切至to</span></span><br><span class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</span><br><span class="line"><span class="built_in">NSString</span> *from = <span class="string">@"/Users/iOS/Desktop/Test"</span>;</span><br><span class="line"><span class="built_in">NSString</span> *to = <span class="string">@"/Users/iOS/Desktop/test1"</span>;</span><br><span class="line"><span class="built_in">NSFileManager</span> *mag = [<span class="built_in">NSFileManager</span> defaultManager];</span><br><span class="line"><span class="built_in">NSArray</span> *subpaths = [mag subpathsAtPath:from];</span><br><span class="line">dispatch_apply(subpaths.count, queue, ^(size_t index) &#123;</span><br><span class="line"><span class="built_in">NSString</span> *subpath = subpaths[index];</span><br><span class="line"><span class="built_in">NSString</span> *fromFullpath = [from stringByAppendingPathComponent:subpath];</span><br><span class="line"><span class="built_in">NSString</span> *toFullpath = [to stringByAppendingPathComponent:subpath];</span><br><span class="line"><span class="comment">//        剪切</span></span><br><span class="line">[mag moveItemAtPath:fromFullpath toPath:toFullpath error:<span class="literal">nil</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@~~~~~~%@"</span>, [<span class="built_in">NSThread</span> currentThread], subpath);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="三、GCD与非GCD实现单粒设计模式"><a href="#三、GCD与非GCD实现单粒设计模式" class="headerlink" title="三、GCD与非GCD实现单粒设计模式"></a>三、GCD与非GCD实现单粒设计模式</h3><h4 id="1-GCD实现设计模式"><a href="#1-GCD实现设计模式" class="headerlink" title="1.GCD实现设计模式"></a>1.GCD实现设计模式</h4><p>类的.h文件<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">PKPerson</span> : <span class="title">NSObject</span></span></span><br><span class="line">+ (<span class="keyword">instancetype</span>)sharedCar;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure></p>
<p>类的.m文件<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">PKPerson</span>() &lt;<span class="title">NSCopying</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">PKPerson</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例变量，当前类</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">id</span> _instance;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重写allocWithZone方法</span></span><br><span class="line">+ (<span class="keyword">instancetype</span>)allocWithZone:(<span class="keyword">struct</span> _NSZone *)zone&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 该方法整个应用程序只调用一次</span></span><br><span class="line"><span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</span><br><span class="line">_instance = [<span class="keyword">super</span> allocWithZone:zone];</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">return</span> _instance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">instancetype</span>)sharedInstance&#123;</span><br><span class="line"><span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</span><br><span class="line"><span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</span><br><span class="line">_instance = [[<span class="keyword">self</span> alloc] init];</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">return</span> _instance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 保证每复制一个对象也是同一内存空间</span></span><br><span class="line">- (<span class="keyword">id</span>)copyWithZone:(<span class="built_in">NSZone</span> *)zone&#123;</span><br><span class="line"><span class="keyword">return</span> _instance;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure></p>
<h4 id="2-宏定义封装GCD单粒设计模式"><a href="#2-宏定义封装GCD单粒设计模式" class="headerlink" title="2.宏定义封装GCD单粒设计模式"></a>2.宏定义封装GCD单粒设计模式</h4><p>通常当多个类之间有相同的属性和方法时，我们会考虑将相同的部分抽取出来，封装到父类中，但单粒模式不可以这样做，因为单粒模式采用继承方式的话，所有的类会共享一份内存。所以一般采取宏定义封装GCD单粒设计模式。注意，每行的结尾需要添加 “\”。<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .h文件</span></span><br><span class="line"><span class="meta">#define PKSingletonH + (instancetype)sharedInstance;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// .m文件</span></span><br><span class="line"><span class="meta">#define PKSingletonH \</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">id</span> _instace; \</span><br><span class="line">\</span><br><span class="line">+ (<span class="keyword">instancetype</span>)allocWithZone:(<span class="keyword">struct</span> _NSZone *)zone \</span><br><span class="line">&#123; \</span><br><span class="line"><span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken; \</span><br><span class="line"><span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123; \</span><br><span class="line">_instace = [<span class="keyword">super</span> allocWithZone:zone]; \</span><br><span class="line">&#125;); \</span><br><span class="line"><span class="keyword">return</span> _instace; \</span><br><span class="line">&#125; \</span><br><span class="line">\</span><br><span class="line">+ (<span class="keyword">instancetype</span>)sharedInstance \</span><br><span class="line">&#123; \</span><br><span class="line"><span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken; \</span><br><span class="line"><span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123; \</span><br><span class="line">_instace = [[<span class="keyword">self</span> alloc] init]; \</span><br><span class="line">&#125;); \</span><br><span class="line"><span class="keyword">return</span> _instace; \</span><br><span class="line">&#125; \</span><br><span class="line">\</span><br><span class="line">- (<span class="keyword">id</span>)copyWithZone:(<span class="built_in">NSZone</span> *)zone \</span><br><span class="line">&#123; \</span><br><span class="line"><span class="keyword">return</span> _instace; \</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="3-非GCD实现设计模式"><a href="#3-非GCD实现设计模式" class="headerlink" title="3.非GCD实现设计模式"></a>3.非GCD实现设计模式</h4><p>类的.h文件</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">PKPerson</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">instancetype</span>)sharedInstance;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>类的.m文件<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"PKPerson.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">PKPerson</span>()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">PKPerson</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">id</span> _instance;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">instancetype</span>)allocWithZone:(<span class="keyword">struct</span> _NSZone *)zone</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// 同步锁，防止多线程同时进入</span></span><br><span class="line"><span class="keyword">@synchronized</span>(<span class="keyword">self</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (_instance == <span class="literal">nil</span>) &#123;</span><br><span class="line">_instance = [<span class="keyword">super</span> allocWithZone:zone];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> _instance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">instancetype</span>)sharedInstance</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">@synchronized</span>(<span class="keyword">self</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (_instance == <span class="literal">nil</span>) &#123;</span><br><span class="line">_instance = [[<span class="keyword">self</span> alloc] init];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> _instance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>)copyWithZone:(<span class="built_in">NSZone</span> *)zone</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> _instance;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure></p>
<h3 id="四、GCD定时器"><a href="#四、GCD定时器" class="headerlink" title="四、GCD定时器"></a>四、GCD定时器</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="comment">/** 定时器(这里不用带*，因为dispatch_source_t就是个类，内部已经包含了*) */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) dispatch_source_t timer;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span> *)touches withEvent:(<span class="built_in">UIEvent</span> *)event</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// 获得队列</span></span><br><span class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_get_main_queue();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个定时器(dispatch_source_t本质还是个OC对象)</span></span><br><span class="line"><span class="keyword">self</span>.timer = dispatch_source_create(DISPATCH_SOURCE_TYPE_TIMER, <span class="number">0</span>, <span class="number">0</span>, queue);</span><br><span class="line"></span><br><span class="line"><span class="comment">// GCD的时间参数一般是纳秒（1秒 == 10的9次方纳秒）</span></span><br><span class="line">dispatch_time_t start = dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">1.0</span> * <span class="built_in">NSEC_PER_SEC</span>));</span><br><span class="line">uint64_t interval = (uint64_t)(<span class="number">1.0</span> * <span class="built_in">NSEC_PER_SEC</span>);</span><br><span class="line">dispatch_source_set_timer(<span class="keyword">self</span>.timer, start, interval, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置回调</span></span><br><span class="line">dispatch_source_set_event_handler(<span class="keyword">self</span>.timer, ^&#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"------%@-------"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动定时器</span></span><br><span class="line">dispatch_resume(<span class="keyword">self</span>.timer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p><em>三种多线程编程都说完了，代码有些多，不过希望朋友们有所收获，另外再补充一些关于线程间通信的。。。</em></p>
<h2 id="（五）iOS开发之多线程-线程间的通信"><a href="#（五）iOS开发之多线程-线程间的通信" class="headerlink" title="（五）iOS开发之多线程 线程间的通信"></a>（五）iOS开发之多线程 线程间的通信</h2><h3 id="一、简单介绍"><a href="#一、简单介绍" class="headerlink" title="一、简单介绍"></a>一、简单介绍</h3><p>在一个进程中，线程往往不是孤立存在的，多个线程之间需要经常进行通信。以下是线程之间进行通信的方法:</p>
<h3 id="二、常用方法"><a href="#二、常用方法" class="headerlink" title="二、常用方法:"></a>二、常用方法:</h3><h4 id="代码1-performSelector"><a href="#代码1-performSelector" class="headerlink" title="代码1:performSelector"></a>代码1:performSelector</h4><p>performSelector常用方法的常用方法主要有以下几种:<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在主线程上执行操作</span></span><br><span class="line">[<span class="keyword">self</span> performSelectorOnMainThread:<span class="keyword">@selector</span>(run) withObject:<span class="literal">nil</span> waitUntilDone:<span class="literal">YES</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//在当前线程执行操作</span></span><br><span class="line">[<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(run) withObject:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//在指定线程上执行操作</span></span><br><span class="line">[<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(run) onThread:thread withObject:<span class="literal">nil</span> waitUntilDone:<span class="literal">YES</span>];</span><br></pre></td></tr></table></figure></p>
<p>具体代码:<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//点击屏幕开始执行以下方法</span></span><br><span class="line">- (<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span> *)touches withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</span><br><span class="line">[<span class="keyword">self</span> performSelectorInBackground:<span class="keyword">@selector</span>(download) withObject:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)download</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// 图片的网络路径</span></span><br><span class="line"><span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://img.lanrentuku.com/img/allimg/1310/13822295641903.jpg"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据地址加载图片</span></span><br><span class="line"><span class="built_in">NSData</span> *data = [<span class="built_in">NSData</span> dataWithContentsOfURL:url]; <span class="comment">//耗时操作</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成图片</span></span><br><span class="line"><span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageWithData:data];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 回到主线程，刷新UI界面</span></span><br><span class="line"><span class="comment">//方式一</span></span><br><span class="line">[<span class="keyword">self</span>.imageView performSelector:<span class="keyword">@selector</span>(setImage:) onThread:[<span class="built_in">NSThread</span> mainThread] withObject:image waitUntilDone:<span class="literal">NO</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//方式二</span></span><br><span class="line"><span class="comment">//    [self.imageView performSelectorOnMainThread:@selector(setImage:) withObject:image waitUntilDone:NO];</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//方式三</span></span><br><span class="line"><span class="comment">//    [self performSelectorOnMainThread:@selector(showImage:) withObject:image waitUntilDone:NO];</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//显示图片(如果performSelector调用的是setImage:方法，会直接调用系统的方法)</span></span><br><span class="line"><span class="comment">//- (void)showImage:(UIImage *)image</span></span><br><span class="line"><span class="comment">//&#123;</span></span><br><span class="line"><span class="comment">//    self.imageView.image = image;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br></pre></td></tr></table></figure></p>
<h4 id="代码2-NSOperationQueue方式"><a href="#代码2-NSOperationQueue方式" class="headerlink" title="代码2:NSOperationQueue方式"></a>代码2:NSOperationQueue方式</h4><p>一个NSOperation对象可以通过调用start方法来执行任务,默认是同步执行的.也可以将NSOperation添加到一个NSOperationQueue中去执行,而且是异步执行的.</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#pragma mark - NSOperation实现线程间的通信</span></span><br><span class="line">- (<span class="keyword">void</span>)<span class="built_in">NSOperationTest</span> &#123;</span><br><span class="line">[[[<span class="built_in">NSOperationQueue</span> alloc] init] addOperationWithBlock:^&#123;</span><br><span class="line"><span class="built_in">NSData</span> *data = [<span class="built_in">NSData</span> dataWithContentsOfURL:[<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://img.lanrentuku.com/img/allimg/1310/13822295641903.jpg"</span>]];</span><br><span class="line"><span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageWithData:data];</span><br><span class="line">[[<span class="built_in">NSOperationQueue</span> mainQueue] addOperationWithBlock:^&#123;</span><br><span class="line"><span class="keyword">self</span>.imageView.image = image;</span><br><span class="line">&#125;];</span><br><span class="line">&#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="代码3-GCD方式"><a href="#代码3-GCD方式" class="headerlink" title="代码3:GCD方式"></a>代码3:GCD方式</h4><p>GCD，全称Grand Central Dispath，是苹果开发的一种支持并行操作的机制。它的主要部件是一个FIFO队列和一个线程池，前者用来添加任务，后者用来执行任务。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 图片的网络路径</span></span><br><span class="line"><span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://img.lanrentuku.com/img/allimg/1310/13822295641903.jpg"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加载图片</span></span><br><span class="line"><span class="built_in">NSData</span> *data = [<span class="built_in">NSData</span> dataWithContentsOfURL:url];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成图片</span></span><br><span class="line"><span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageWithData:data];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 回到主线程显示图片</span></span><br><span class="line"><span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line"><span class="keyword">self</span>.imageView.image = image;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="三、NSPort方法"><a href="#三、NSPort方法" class="headerlink" title="三、NSPort方法:"></a>三、NSPort方法:</h3><p>NSPort有3个子类，NSSocketPort、NSMessagePort、NSMachPort，但在iOS下只有NSMachPort可用。代码如下:</p>
<p>UIViewController中的代码:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MyPort.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> () &lt;<span class="title">NSPortDelegate</span>&gt;</span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">[<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"><span class="comment">//创建主线程的port</span></span><br><span class="line"><span class="built_in">NSPort</span> *myPort = [<span class="built_in">NSPort</span> port];</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置代理</span></span><br><span class="line">myPort.delegate = <span class="keyword">self</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//把port加入runloop</span></span><br><span class="line">[[<span class="built_in">NSRunLoop</span> currentRunLoop] addPort:myPort forMode:<span class="built_in">NSDefaultRunLoopMode</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//启动子线程,并传入主线程的port</span></span><br><span class="line">MyPort *work = [[MyPort alloc] init];</span><br><span class="line"></span><br><span class="line">[<span class="built_in">NSThread</span> detachNewThreadSelector:<span class="keyword">@selector</span>(launchThreadWithPort:)</span><br><span class="line">toTarget:work</span><br><span class="line">withObject:myPort];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)handlePortMessage:(<span class="built_in">NSMessagePort</span>*)message&#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"已接到子线程的消息 --- %@"</span>, message);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>MyPort中的代码:</p>
<p>.h文件:<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MyPort</span> : <span class="title">NSPort</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure></p>
<p>.m文件:<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"MyPort.h"</span></span></span><br><span class="line"><span class="meta">#define PKMessage 10</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MyPort</span> ()&lt;<span class="title">NSMachPortDelegate</span>&gt; </span>&#123;</span><br><span class="line"><span class="built_in">NSPort</span> *firstPort;</span><br><span class="line"><span class="built_in">NSPort</span> *secondPort;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">MyPort</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)launchThreadWithPort:(<span class="built_in">NSPort</span> *)port &#123;</span><br><span class="line"><span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//接收主线程传入的port</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//设置子线程名字</span></span><br><span class="line">[[<span class="built_in">NSThread</span> currentThread] setName:<span class="string">@"MyThread"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//开启runloop</span></span><br><span class="line">[[<span class="built_in">NSRunLoop</span> currentRunLoop] run];</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建自己port</span></span><br><span class="line">secondPort = [<span class="built_in">NSPort</span> port];</span><br><span class="line">secondPort.delegate = <span class="keyword">self</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//将自己的port添加到runloop,防止runloop执行完毕之后退出,接收主线程发送过来的port消息</span></span><br><span class="line">[[<span class="built_in">NSRunLoop</span> currentRunLoop] addPort:secondPort forMode:<span class="built_in">NSDefaultRunLoopMode</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//完成向主线程发送消息</span></span><br><span class="line">[<span class="keyword">self</span> sendPortMessage];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*   完成向主线程发送消息</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">- (<span class="keyword">void</span>)sendPortMessage &#123;</span><br><span class="line"><span class="comment">//发送消息到主线程</span></span><br><span class="line">[firstPort sendBeforeDate:[<span class="built_in">NSDate</span> date]</span><br><span class="line">msgid:PKMessage</span><br><span class="line">components:<span class="literal">nil</span></span><br><span class="line">from:secondPort</span><br><span class="line">reserved:<span class="number">0</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>提示:通常来说, NSPort可以做的事情通过performSelector也同样可以搞定，因此线程间通信完全可以通过performSelector来实现。<br><strong><end></end></strong></p>
<hr>
<p><strong>结束语：以上是多线程相关的知识总结，本人也是小白级别，如果有写错的地方，还请朋友们能够指出来，谢谢！</strong></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/15/iOS开发之 - 小冷易忘知识点总结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="刘朋坤">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="以梦为马">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/15/iOS开发之 - 小冷易忘知识点总结/" itemprop="url">
                  iOS开发之 - 小冷易忘知识点总结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
                
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-15T12:30:20+08:00">2018-04-15</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>看网上有人整理 iOS 开发中常用的易忘知识点，<a href="http://www.jianshu.com/p/b3ea66bffc68" target="_blank" rel="noopener">iOS 开发小冷易忘知识点总结</a>，觉得不错，于是自己也想着整理一些易忘的知识点。会持续更新……</p>
</blockquote>
<ul>
<li>iOS 控制器的基类，搭建框架之初一般都会设计一个 ViewController 基类，这里设置的基类是 NNBaseViewController，继承自 UIViewController。</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"NNBaseViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NNBaseViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">NNBaseViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">[<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">[<span class="keyword">self</span> setupViews];</span><br><span class="line"><span class="comment">// 判断是否有上级页面，有的话再设置返回按钮</span></span><br><span class="line"><span class="keyword">if</span> ([<span class="keyword">self</span>.navigationController.viewControllers indexOfObject:<span class="keyword">self</span>] != <span class="number">0</span>) &#123;</span><br><span class="line">[<span class="keyword">self</span> setupLeftBarButton];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)setupViews &#123;</span><br><span class="line"><span class="comment">// 设置应用的背景色</span></span><br><span class="line"><span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> lightGrayColor];</span><br><span class="line"><span class="comment">// 不允许 viewController 自动调整，我们自己布局；如果设置为YES，视图会自动下移 64 像素</span></span><br><span class="line"><span class="keyword">self</span>.automaticallyAdjustsScrollViewInsets = <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 自定义返回按钮</span></span><br><span class="line">- (<span class="keyword">void</span>)setupLeftBarButton &#123;</span><br><span class="line"><span class="comment">// 自定义 leftBarButtonItem ，UIImageRenderingModeAlwaysOriginal 防止图片被渲染</span></span><br><span class="line"><span class="keyword">self</span>.navigationItem.leftBarButtonItem = [[<span class="built_in">UIBarButtonItem</span> alloc]</span><br><span class="line">initWithImage:[[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"Back-蓝"</span>] imageWithRenderingMode:<span class="built_in">UIImageRenderingModeAlwaysOriginal</span>]</span><br><span class="line">style:<span class="built_in">UIBarButtonItemStylePlain</span></span><br><span class="line">target:<span class="keyword">self</span></span><br><span class="line">action:<span class="keyword">@selector</span>(leftBarButtonClick)];</span><br><span class="line"><span class="comment">// 防止返回手势失效</span></span><br><span class="line"><span class="keyword">self</span>.navigationController.interactivePopGestureRecognizer.delegate = (<span class="keyword">id</span>&lt;<span class="built_in">UIGestureRecognizerDelegate</span>&gt;)<span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)leftBarButtonClick &#123;</span><br><span class="line">[<span class="keyword">self</span>.navigationController popViewControllerAnimated:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<ul>
<li>隐藏 navigationControll 左侧的返回按钮</li>
</ul>
<p>因为项目需要，有时需要隐藏 navigationControll 左侧或右侧的按钮。</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这两句貌似不太管用</span></span><br><span class="line"><span class="keyword">self</span>.navigationItem.leftBarButtonItems = <span class="literal">nil</span>;</span><br><span class="line"><span class="keyword">self</span>.navigationItem.rightBarButtonItem = <span class="literal">nil</span>;</span><br><span class="line"><span class="comment">// 可以试试这两句代码</span></span><br><span class="line"><span class="keyword">self</span>.navigationItem.hidesBackButton = <span class="literal">YES</span>;</span><br><span class="line"><span class="keyword">self</span>.navigationItem.rightBarButtonItem.customView.hidden = <span class="literal">YES</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>改变 button 内部的图片以及文字的偏移量</li>
</ul>
<p>有时候需要在 button 的右部添加指示箭头，但 button 默认的是图片在左，文字在右，因此想要实现项目需求，我们需要改变 button 内部的偏移量。在 storyboard 或 xib 中也可以改变 button 内部的图片以及文字的偏移量，但貌似没有做适配的地方，那么在不同机型上的显示就会有问题（如果哪位道友发现可以在 storyboard 或 xib 中可以做适配，还请告知），下面是改变 button 内部图片以及文字偏移量的代码。</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 已经做了适配，各位可以根据需要做屏幕适配</span></span><br><span class="line">self.changeSpecialistBtn.titleEdgeInsets = UIEdgeInsetsMake(<span class="number">0</span>, -lengthFit(<span class="number">16</span>), <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">self.changeSpecialistBtn.imageEdgeInsets = UIEdgeInsetsMake(<span class="number">0</span>, lengthFit(<span class="number">76</span>), <span class="number">0</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>tableView 滚动时自动收起键盘</li>
</ul>
<p>项目中某个 tableView 页面有文字搜索功能，输入文本完毕之后滚动 tableView，要求键盘自动收起。</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">self</span>.tableView.keyboardDismissMode = <span class="built_in">UIScrollViewKeyboardDismissModeOnDrag</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>判断上级页面是哪个页面</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 我这里的项目需求是，如果上一个页面是 KXOrderCenterViewController，就隐藏稍后支付按钮，否则不隐藏</span></span><br><span class="line"><span class="built_in">NSArray</span> *array = <span class="keyword">self</span>.navigationController.viewControllers;</span><br><span class="line"><span class="keyword">if</span> ([array[<span class="number">0</span>] isKindOfClass:[KXOrderCenterViewController <span class="keyword">class</span>]]) &#123;</span><br><span class="line"><span class="keyword">self</span>.payLaterBtn.hidden = <span class="literal">YES</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">self</span>.payLaterBtn.hidden = <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>从任意界面返回 NavigationController 中的任意一个</li>
</ul>
<p>这个方法还是挺实用的，从某个界面跳转到任意一个界面。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 得到当前的 NavigationController</span></span><br><span class="line">[[APPDELEGATE getCurrentViewController].navigationController <span class="string">popToRootViewControllerAnimated:</span>NO];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 跳转到哪个 NavigationController，这里下标为1，表示第二个</span></span><br><span class="line">[APPDELEGATE.tabBarController <span class="string">setSelectedIndex:</span><span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 退出当前界面并执行 block 中的内容</span></span><br><span class="line">[self.navigationController <span class="string">dismissViewControllerAnimated:</span>YES <span class="string">completion:</span>^&#123;</span><br><span class="line"></span><br><span class="line">UINavigationController *navi = APPDELEGATE.tabBarController.viewControllers[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 保险起见，再判断下是否是将要跳转到的页面</span></span><br><span class="line"><span class="keyword">if</span> ([navi.viewControllers[<span class="number">0</span>] <span class="string">isKindOfClass:</span>[KXOrderCenterViewController <span class="class"><span class="keyword">class</span>]]) &#123;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 我这里需要刷新</span></span><br><span class="line">KXOrderCenterViewController *orderCenter = navi.viewControllers[<span class="number">0</span>];</span><br><span class="line">[orderCenter beginRefreshing];</span><br><span class="line">&#125;</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<ul>
<li>设置导航栏右部点击按钮，并添加点击事件</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加文字按钮</span></span><br><span class="line"><span class="built_in">UIBarButtonItem</span> *rightBarButton = [[<span class="built_in">UIBarButtonItem</span> alloc] initWithTitle:<span class="string">@"编辑"</span> style:<span class="built_in">UIBarButtonItemStylePlain</span> target:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(editor)];</span><br><span class="line"></span><br><span class="line"><span class="keyword">self</span>.navigationItem.rightBarButtonItem = rightBarButton;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加图片按钮</span></span><br><span class="line"><span class="built_in">UIBarButtonItem</span> *rightBarBtn = [[<span class="built_in">UIBarButtonItem</span> alloc] initWithImage:[[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"图片名"</span>] imageWithRenderingMode:<span class="built_in">UIImageRenderingModeAlwaysOriginal</span>] style:<span class="built_in">UIBarButtonItemStylePlain</span> target:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(rightBarButtonEvent)];</span><br><span class="line"></span><br><span class="line">[<span class="keyword">self</span>.navigationItem setRightBarButtonItem:rightBarBtn];</span><br></pre></td></tr></table></figure>
<ul>
<li>给 view 添加手势，并加入点击事件</li>
</ul>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UITapGestureRecognizer *operationTap = [[UITapGestureRecognizer alloc]<span class="string">initWithTarget:</span>self <span class="string">action:</span><span class="meta">@selector</span>(<span class="string">gotoCapture:</span>)];</span><br><span class="line"></span><br><span class="line">[self.operationView <span class="string">addGestureRecognizer:</span>operationTap];</span><br></pre></td></tr></table></figure>
<ul>
<li>textview 输入文本，服务器那边要求返回文本个数不超过32</li>
</ul>
<p>服务器那边有限制，要求返回文本个数不超过32个。。。于是这里做了判断，如果超过32个就不再允许输入，允许删除。</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)textViewDidChange:(<span class="built_in">UITextView</span> *)textView &#123;</span><br><span class="line"></span><br><span class="line">[<span class="keyword">self</span> updateViewHeight];</span><br><span class="line"><span class="comment">// 该判断用于联想输入</span></span><br><span class="line"><span class="keyword">if</span> (textView == <span class="keyword">self</span>.secondDiagnosisTextView) &#123;</span><br><span class="line"><span class="keyword">if</span> (textView.text.length &gt; <span class="number">32</span>) &#123;</span><br><span class="line"><span class="comment">// 截取字符串</span></span><br><span class="line">textView.text = [textView.text substringToIndex:<span class="number">32</span>];</span><br><span class="line"><span class="comment">// HUD 提示</span></span><br><span class="line">[CommunityPublicClass showHUDwithLabelText:<span class="string">@"最多输入32个字"</span> andDetailsLabelText:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 代理方法规定只能输入32个字</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)textView:(<span class="built_in">UITextView</span> *)textView shouldChangeTextInRange:(<span class="built_in">NSRange</span>)range replacementText:(<span class="built_in">NSString</span> *)text &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输入32字之后，允许删除</span></span><br><span class="line"><span class="keyword">if</span> ([text isEqualToString:<span class="string">@""</span>]) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (textView == <span class="keyword">self</span>.secondDiagnosisTextView) &#123;</span><br><span class="line"><span class="keyword">if</span> (textView.text.length == <span class="number">0</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line"><span class="built_in">NSInteger</span> existedLength = textView.text.length;</span><br><span class="line"><span class="built_in">NSInteger</span> selectedLength = range.length;</span><br><span class="line"><span class="built_in">NSInteger</span> replaceLength = text.length;</span><br><span class="line"><span class="keyword">if</span> (existedLength - selectedLength + replaceLength &gt; <span class="number">32</span>) &#123;</span><br><span class="line"><span class="comment">// HUD 提示</span></span><br><span class="line">[CommunityPublicClass showHUDwithLabelText:<span class="string">@"最多输入32个字"</span> andDetailsLabelText:<span class="literal">nil</span>];</span><br><span class="line"><span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>textfield 中输入手机号，只允许输入数字</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">BOOL</span>)textField:(<span class="built_in">UITextField</span> *)textField shouldChangeCharactersInRange:(<span class="built_in">NSRange</span>)range replacementString:(<span class="built_in">NSString</span> *)string&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (textField == <span class="keyword">self</span>.secondAgeTextField) &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ([<span class="keyword">self</span> isPureInt:string] || [string isEqualToString:<span class="string">@""</span>]) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断输入的是否是纯数字</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)isPureInt:(<span class="built_in">NSString</span>*)string&#123;</span><br><span class="line"><span class="built_in">NSScanner</span> *scan = [<span class="built_in">NSScanner</span> scannerWithString:string];</span><br><span class="line"><span class="keyword">int</span> val;</span><br><span class="line"><span class="keyword">return</span> [scan scanInt:&amp;val] &amp;&amp; [scan isAtEnd];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>给 button 设置边框、圆角、边框设置颜色</li>
</ul>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="literal">self</span>.completeBtn.layer <span class="built_in">set</span>BorderWidth:<span class="number">1.0</span>];</span><br><span class="line"><span class="literal">self</span>.completeBtn.layer.cornerRadius = <span class="number">1</span>;</span><br><span class="line">[<span class="literal">self</span>.completeBtn.layer <span class="built_in">set</span>BorderColor:KXColorTextBlack.CGColor];</span><br></pre></td></tr></table></figure>
<ul>
<li>设置图片拉伸</li>
</ul>
<p>有时 UI 设计师给出的图片并不合适，比如我们这的 UI 设计师一边忙 web 端，一边忙我们移动端，有时候都不忍心让他重新作图，于是只好自己想办法</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置图片拉伸</span></span><br><span class="line">UIImage *bgImage = [UIImage <span class="string">imageNamed:</span>@<span class="string">""</span>];</span><br><span class="line">_bgImageView.image = [bgImage <span class="string">stretchableImageWithLeftCapWidth:</span><span class="number">15</span> <span class="string">topCapHeight:</span><span class="number">15</span>];</span><br></pre></td></tr></table></figure>
<ul>
<li>点击单元格时，默认的点击效果比较丑，大多时候不显示点击效果</li>
</ul>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)<span class="string">tableView:</span>(UITableView *)tableView <span class="string">didSelectRowAtIndexPath:</span>(NSIndexPath *)indexPath</span><br><span class="line">&#123;</span><br><span class="line">[tableView <span class="string">deselectRowAtIndexPath:</span>indexPath <span class="string">animated:</span>YES] ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>改变导航栏标题的颜色</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UIColor</span> *color = [<span class="built_in">UIColor</span> cyanColor];</span><br><span class="line"><span class="built_in">NSDictionary</span> *dictionary = [<span class="built_in">NSDictionary</span> dictionaryWithObject: color forKey:<span class="built_in">NSForegroundColorAttributeName</span>];</span><br><span class="line"><span class="keyword">self</span>.navigationController.navigationBar.titleTextAttributes = dictionary;</span><br></pre></td></tr></table></figure>
<ul>
<li>延迟调用</li>
</ul>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 延迟两秒钟调用 beginAction 方法</span></span><br><span class="line">[self <span class="string">performSelector:</span><span class="meta">@selector</span>(beginAction) <span class="string">withObject:</span>nil <span class="string">afterDelay:</span><span class="number">0.2</span>] ;</span><br></pre></td></tr></table></figure>
<ul>
<li>项目中用到了 UISwitch 控件，需要更改它的大小</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 改变 UISwitch  的大小，CGAffineTransformMakeScale(CGFloat x, CGFloat y) 对 view 的长和宽进行缩放，不改变 view 的中心点</span></span><br><span class="line"><span class="keyword">self</span>.orderSwitch.transform = <span class="built_in">CGAffineTransformMakeScale</span>(<span class="number">0.7</span>, <span class="number">0.7</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 改变 UISwitch 开启时的颜色</span></span><br><span class="line"><span class="keyword">self</span>.orderSwitch.onTintColor = KXColorBlue;</span><br></pre></td></tr></table></figure>
<ul>
<li>在做明暗文切换(密码输入框)的时候遇见一个坑——就是切换 secureTextEntry 的时候，输入框的光标会偏移，下面是解决办法及明暗文切换的方法：</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">IBAction</span>)btnClick:(<span class="built_in">UIButton</span> *)sender &#123;</span><br><span class="line"></span><br><span class="line">sender.selected = !sender.selected;</span><br><span class="line"><span class="built_in">NSString</span> *passwordString = <span class="keyword">self</span>.passwordText.text;</span><br><span class="line"><span class="comment">// 这句代码可以防止切换的时候光标偏移</span></span><br><span class="line"><span class="keyword">self</span>.passwordText.text = <span class="string">@""</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (sender.selected) &#123; <span class="comment">// 明文</span></span><br><span class="line"><span class="keyword">self</span>.passwordText.secureTextEntry = <span class="literal">NO</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123; <span class="comment">// 暗文</span></span><br><span class="line"><span class="keyword">self</span>.passwordText.secureTextEntry = <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">self</span>.passwordText.text = passwordString;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>判断屏幕横屏/竖屏(在ViewController里面)</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 屏幕发生翻转的时候会调用</span></span><br><span class="line">- (<span class="keyword">void</span>)viewWillLayoutSubviews &#123;</span><br><span class="line">[<span class="keyword">self</span> shouldRotateToOrientation:(<span class="built_in">UIDeviceOrientation</span>)[<span class="built_in">UIApplication</span> sharedApplication].statusBarOrientation];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)shouldRotateToOrientation:(<span class="built_in">UIDeviceOrientation</span>)orientation &#123;</span><br><span class="line"><span class="keyword">if</span> (orientation == <span class="built_in">UIDeviceOrientationPortrait</span> ||orientation == <span class="built_in">UIDeviceOrientationPortraitUpsideDown</span>) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"这是竖屏"</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"这是横屏"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>加载本地的 HTML 文件，比如文件名字是<code>serviceDescription.html</code></li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *resourcePath = [[<span class="built_in">NSBundle</span> mainBundle] resourcePath];</span><br><span class="line"><span class="built_in">NSString</span> *filePath = [resourcePath stringByAppendingPathComponent:<span class="string">@"serviceDescription.html"</span>];</span><br><span class="line"><span class="built_in">NSString</span> *htmlString = [[<span class="built_in">NSString</span> alloc] initWithContentsOfFile:filePath encoding:<span class="built_in">NSUTF8StringEncoding</span> error:<span class="literal">nil</span>];</span><br><span class="line">[<span class="keyword">self</span>.webView loadHTMLString: htmlString baseURL: [<span class="built_in">NSURL</span> fileURLWithPath:[[<span class="built_in">NSBundle</span> mainBundle] bundlePath]]];</span><br></pre></td></tr></table></figure>
<ul>
<li>iOS 项目开发中用的一部分宏定义</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** self的弱引用 */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NNWeakSelf __weak typeof(self) weakSelf = self;</span></span><br><span class="line"><span class="comment">/** self的强引用 */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NNStrongSelf __strong __typeof(weakSelf)strongSelf = weakSelf;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NNColorBlue [UIColor colorWithRed:0.0/255.0f green:135.0/255.0f blue:209.0/255.0f alpha:1]</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NNFontBoldText [UIFont boldSystemFontOfSize:fontFit(16)]</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NNFontText [UIFont systemFontOfSize:fontFit(16)]</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SCREENWIDTH [UIScreen mainScreen].bounds.size.width</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SCREENHEIGHT [UIScreen mainScreen].bounds.size.height</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> iPhone5 (([[UIScreen mainScreen] bounds].size.height*[[UIScreen mainScreen] bounds].size.width &lt;= 320*568)?YES:NO)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> iPhone6 (([[UIScreen mainScreen] bounds].size.height*[[UIScreen mainScreen] bounds].size.width &lt;= 375*667)?YES:NO)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> iPhone6p (([[UIScreen mainScreen] bounds].size.height*[[UIScreen mainScreen] bounds].size.width &lt;= 414*736)?YES:NO)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> iOS7 ([[[UIDevice currentDevice] systemVersion] floatValue] &gt;= 7.0 ? YES : NO) <span class="comment">// 是否IOS7</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">float</span> <span class="title">lengthFit</span><span class="params">(<span class="keyword">float</span> iphone6PlusLength)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (iPhone5) &#123;</span><br><span class="line"><span class="keyword">return</span> iphone6PlusLength *<span class="number">320.0f</span>/<span class="number">414.0f</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (iPhone6) &#123;</span><br><span class="line"><span class="keyword">return</span> iphone6PlusLength *<span class="number">375.0f</span>/<span class="number">414.0f</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> iphone6PlusLength;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">float</span> <span class="title">fontFit</span><span class="params">(<span class="keyword">float</span> iphone6PlusFont)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (iPhone5) &#123;</span><br><span class="line"><span class="keyword">return</span> iphone6PlusFont - <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (iPhone6) &#123;</span><br><span class="line"><span class="keyword">return</span> iphone6PlusFont - <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> iphone6PlusFont;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PlaceholderAvatarImage [UIImage imageNamed:@<span class="meta-string">"默认头像"</span>]</span></span><br></pre></td></tr></table></figure>
<ul>
<li>一句代码隐藏 UITableView 中空的 cell</li>
</ul>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">self</span>.<span class="built_in">table</span>View.<span class="built_in">table</span>FooterView = [[UIView alloc] init];</span><br></pre></td></tr></table></figure>
<ul>
<li>自定义 leftBarButtonItem 返回按钮时，防止返回手势失效的办法</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)setupLeftBarButton &#123;</span><br><span class="line"><span class="keyword">self</span>.navigationItem.leftBarButtonItem = [[<span class="built_in">UIBarButtonItem</span> alloc]</span><br><span class="line">initWithImage:[[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"Back-蓝"</span>] imageWithRenderingMode:<span class="built_in">UIImageRenderingModeAlwaysOriginal</span>]</span><br><span class="line">style:<span class="built_in">UIBarButtonItemStylePlain</span></span><br><span class="line">target:<span class="keyword">self</span></span><br><span class="line">action:<span class="keyword">@selector</span>(leftBarButtonClick)];</span><br><span class="line"><span class="keyword">self</span>.navigationController.interactivePopGestureRecognizer.delegate = (<span class="keyword">id</span>&lt;<span class="built_in">UIGestureRecognizerDelegate</span>&gt;)<span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)leftBarButtonClick &#123;</span><br><span class="line">[<span class="keyword">self</span>.navigationController popViewControllerAnimated:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>不允许 viewController 自动调整，我们自己布局；如果设置为YES，视图会自动下移 64 像素</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">self</span>.automaticallyAdjustsScrollViewInsets = <span class="literal">NO</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>去空格，开发中有些地方不需要空格，这里记录一下</li>
</ul>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 去掉两端的空格</span></span><br><span class="line">[trimString <span class="string">stringByTrimmingCharactersInSet:</span>[NSCharacterSet whitespaceAndNewlineCharacterSet]];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 去掉所有空格</span></span><br><span class="line">[trimString <span class="string">stringByReplacingOccurrencesOfString:</span>@<span class="string">" "</span> <span class="string">withString:</span>@<span class="string">""</span>];</span><br></pre></td></tr></table></figure>
<ul>
<li>判断字符串中是否包含非法字符</li>
</ul>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ([self.searchText.text <span class="string">rangeOfString:</span>@<span class="string">"'"</span>].location != NSNotFound) &#123;</span><br><span class="line"><span class="comment">// 用封装好的提示框提示</span></span><br><span class="line">[CommunityPublicClass <span class="string">showHUDwithLabelText:</span>@<span class="string">"您输入的字符不合法"</span> <span class="string">andDetailsLabelText:</span>nil];</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>iOS 导航栏的正确隐藏方法</li>
</ul>
<p>第一种方法</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)<span class="string">viewWillAppear:</span>(BOOL)animated &#123;</span><br><span class="line">[<span class="keyword">super</span> <span class="string">viewWillAppear:</span>animated];</span><br><span class="line"></span><br><span class="line">[self.navigationController <span class="string">setNavigationBarHidden:</span>YES <span class="string">animated:</span>YES];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)<span class="string">viewWillDisappear:</span>(BOOL)animated &#123;</span><br><span class="line">[<span class="keyword">super</span> <span class="string">viewWillDisappear:</span>animated];</span><br><span class="line"></span><br><span class="line">[self.navigationController <span class="string">setNavigationBarHidden:</span>NO <span class="string">animated:</span>YES];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第二种方法</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NNViewController</span> () &lt;<span class="title">UINavigationControllerDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">NNViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">[<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置导航控制器的代理为self</span></span><br><span class="line"><span class="keyword">self</span>.navigationController.delegate = <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - UINavigationControllerDelegate</span></span><br><span class="line">- (<span class="keyword">void</span>)navigationController:(<span class="built_in">UINavigationController</span> *)navigationController willShowViewController:(<span class="built_in">UIViewController</span> *)viewController animated:(<span class="built_in">BOOL</span>)animated &#123;</span><br><span class="line"></span><br><span class="line">[<span class="keyword">self</span>.navigationController setNavigationBarHidden: [viewController isKindOfClass:[<span class="keyword">self</span> <span class="keyword">class</span>]] animated:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>判断字符串是否为空</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 判断字符串是否为空</span></span><br><span class="line">+ (<span class="built_in">BOOL</span>)isBlankString:(<span class="built_in">NSString</span> *)string &#123;</span><br><span class="line"><span class="keyword">if</span> (string == <span class="literal">nil</span> || string == <span class="literal">NULL</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ([string isKindOfClass:[<span class="built_in">NSNull</span> <span class="keyword">class</span>]]) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ([[string stringByTrimmingCharactersInSet:[<span class="built_in">NSCharacterSet</span> whitespaceCharacterSet]] length]==<span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/15/iOS开发之 - 广告植入/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="刘朋坤">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="以梦为马">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/15/iOS开发之 - 广告植入/" itemprop="url">
                  iOS开发之 - 广告植入
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
                
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-15T12:30:20+08:00">2018-04-15</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>应用中植入广告是iOS开发者获得收益的方式之一，其实有很多 app 的绝大部分盈利都来自于广告收入……下面就开始介绍两种主流的植入广告的方法：iAd 方式和 Admob方式。</p>
</blockquote>
<h2 id="一、iAd-方式"><a href="#一、iAd-方式" class="headerlink" title="一、iAd 方式"></a>一、iAd 方式</h2><ul>
<li><p>iAd 方式简介<br>iAd 移动广告业务是乔布斯在2010年推出来的，怀念～～～<br><img src="http://upload-images.jianshu.io/upload_images/2665449-d2c8ede84e6f61e5.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="iAd"><br>刚开始的时候，iAd 的确有很大的发展，但是随着时间的推移，更是在老乔辞世😢之后，iAd 的使用人数便越来越少。以至于今年年初，苹果公司宣布将要放弃在 iAd 平台上直接出售广告，而是将其转交给出版商。。。但是作为 iOS 开发者的我们，还是有了解的必要， iAd 广告平台依在。</p>
</li>
<li><p>使用步骤如下：</p>
</li>
</ul>
<p>1.1 导入iAd.framework 依赖库<br><img src="http://upload-images.jianshu.io/upload_images/2665449-636c983733641509.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="iAd.framework"></p>
<p>1.2 方便起见，我是在 Main.storyboard 中拉入ADBannerView<br><img src="http://upload-images.jianshu.io/upload_images/2665449-57e14a8fb97ab7c4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ADBannerView"></p>
<p>1.3 代码实现<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;iAd/iAd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> () &lt;<span class="title">ADBannerViewDelegate</span>&gt;</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">NSLayoutConstraint</span> *bannerViewBottom;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>)ADBannerView *bannerView;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad</span><br><span class="line">&#123;</span><br><span class="line">[<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - ADBannerViewDelegate 协议一共有五个方法</span></span><br><span class="line"><span class="comment">// 广告即将被加载</span></span><br><span class="line">- (<span class="keyword">void</span>)bannerViewWillLoadAd:(ADBannerView *)banner&#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"bannerViewWillLoadAd"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 广告已被加载</span></span><br><span class="line">- (<span class="keyword">void</span>)bannerViewDidLoadAd:(ADBannerView *)banner</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"bannerViewDidLoadAd"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">self</span>.bannerViewBottom.constant = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">[<span class="built_in">UIView</span> animateWithDuration:<span class="number">0.5</span> animations:^&#123;</span><br><span class="line">[<span class="keyword">self</span>.view layoutIfNeeded];</span><br><span class="line">&#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 是否出现全屏的广告</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)bannerViewActionShouldBegin:(ADBannerView *)banner willLeaveApplication:(<span class="built_in">BOOL</span>)willLeave &#123;</span><br><span class="line"><span class="comment">// return YES: 用户点击 Banner 之后，会出现全屏广告</span></span><br><span class="line"><span class="comment">//    如果返回的是 NO，用户点击 Banner 之后, 不会出现全屏广告</span></span><br><span class="line"><span class="comment">//    另外如果返回 YES， 用户其它的活动都会被暂停</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 全屏的广告退出时调用，用户其它的活动都会被唤醒</span></span><br><span class="line">- (<span class="keyword">void</span>)bannerViewActionDidFinish:(ADBannerView *)banner &#123;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"bannerViewActionDidFinish"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果 app 上没有广告，就会调用这个方法</span></span><br><span class="line">- (<span class="keyword">void</span>)bannerView:(ADBannerView *)banner didFailToReceiveAdWithError:(<span class="built_in">NSError</span> *)error</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"didFailToReceiveAdWithError"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure></p>
<h2 id="二、Admob方式"><a href="#二、Admob方式" class="headerlink" title="二、Admob方式"></a>二、Admob方式</h2><ul>
<li>Admob方式简介<br>Admob 是 Google 推出的，用的人比较多，它提供了目前为止最方便的 iPhone app 广告集成库。</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-a4d5bb0d7fb0e5b0.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Admob"></p>
<p>下面说一下它的基本使用～～～</p>
<p>2.1 首先需要注册Admob、设置账户信息、创建应用等等，这里不再详细介绍，如果有朋友需要可以借鉴<a href="http://blog.csdn.net/songrotek/article/details/8501557" target="_blank" rel="noopener">这篇文章</a>。</p>
<p>2.2  集成Admob SDK.<br>2.21 下载Admob SDK：<a href="http://www.cocoachina.com/bbs/read.php?tid=284847" target="_blank" rel="noopener">Admob SDK</a><br>2.22 下载完成后，将这两个文件导入项目：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-bb165f16616a1c81.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Admob SDK"></p>
<p>2.23 添加依赖库</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2665449-717cd15cdd022342.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="添加依赖库"></p>
<p>2.24 导入头文件<br><strong>注意需要导入的事这两个头文件！</strong><br><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#<span class="keyword">import</span> <span class="string">"GoogleMobileAds/GADInterstitial.h"</span></span><br><span class="line">#<span class="keyword">import</span> <span class="string">"GoogleMobileAds/GADBannerView.h"</span></span><br></pre></td></tr></table></figure></p>
<p>2.3 代码实现</p>
<ul>
<li>在屏幕底部植入广告</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">"GoogleMobileAds/GADInterstitial.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"GoogleMobileAds/GADBannerView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span>&#123;</span><br><span class="line">GADBannerView *bannerView;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="built_in">NSString</span> *MyId = <span class="string">@"********"</span>;</span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">[<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在屏幕底部创建标准尺寸的视图</span></span><br><span class="line">bannerView = [[GADBannerView alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0.0</span>, <span class="keyword">self</span>.view.frame.size.height -GAD_SIZE_320x50.height, GAD_SIZE_320x50.width, GAD_SIZE_320x50.height)];</span><br><span class="line">bannerView.backgroundColor = [<span class="built_in">UIColor</span> redColor];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 指定广告的标识符</span></span><br><span class="line">bannerView.adUnitID = MyId;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 转至广告的展示位置之后恢复哪个 UIViewController</span></span><br><span class="line">bannerView.rootViewController = <span class="keyword">self</span>;</span><br><span class="line">[<span class="keyword">self</span>.view addSubview:bannerView];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 请求并加载广告</span></span><br><span class="line">[bannerView loadRequest:[GADRequest request]];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<ul>
<li>也可以在屏幕顶部植入广告</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">"GoogleMobileAds/GADInterstitial.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"GoogleMobileAds/GADBannerView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span>&#123;</span><br><span class="line">GADBannerView *bannerView;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="built_in">NSString</span> *MyId = <span class="string">@"********"</span>;</span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line"></span><br><span class="line">[<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"><span class="comment">// 导航栏位置添加广告</span></span><br><span class="line"><span class="keyword">float</span> y =<span class="keyword">self</span>.navigationController.navigationBar.frame.size.height + [[<span class="built_in">UIApplication</span> sharedApplication] statusBarFrame].size.height;</span><br><span class="line"><span class="keyword">float</span> x = ([<span class="built_in">UIScreen</span> mainScreen].bounds.size.width - <span class="number">320</span>) / <span class="number">2</span>;</span><br><span class="line">bannerView=[[GADBannerView alloc]initWithAdSize:kGADAdSizeBanner origin:<span class="built_in">CGPointMake</span>(x, y)];</span><br><span class="line">bannerView.adUnitID = MyId;</span><br><span class="line">bannerView.backgroundColor = [<span class="built_in">UIColor</span> redColor];</span><br><span class="line">bannerView.rootViewController = <span class="keyword">self</span>;</span><br><span class="line">[<span class="keyword">self</span>.view addSubview:bannerView];</span><br><span class="line">GADRequest *request = [GADRequest request];</span><br><span class="line">request.testDevices = @[MyId,MyId];</span><br><span class="line">[bannerView loadRequest:request];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p>当然，你可以在任何你希望的地方植入广告，大家可以试试的😊！以后要是用的多了，我会继续在这里补充，另外如果代码书写有误，还请大家能够指出来！互相交流学习！谢谢！</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">刘朋坤</p>
              <p class="site-description motion-element" itemprop="description">iOS 修炼中...</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives">
                
                    <span class="site-state-item-count">44</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              

              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">刘朋坤</span>

  

  
</div>




  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Muse</a> v6.1.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.1.0"></script>



  



	





  





  










  





  

  

  

  

  
  

  

  

  

  

</body>
</html>
